<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ™ºèƒ½å¯è½‰å‚µç«¶æ‹ç³»çµ± v3.40 (å¤§æ•¸æ“šé©…å‹•ç‰ˆ) - Rexå¤§å”</title>
    <style>
        :root {
            --primary-bg: linear-gradient(135deg, #2b5876 0%, #4e4376 100%);
            --card-bg: #ffffff;
            --text-main: #333;
            --text-sub: #666;
            --accent: #FF5722;
            --success: #4CAF50;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
            background: var(--primary-bg);
            color: var(--text-main);
            padding: 20px;
            min-height: 100vh;
        }

        .container { max-width: 1400px; margin: 0 auto; display: none; animation: fadeIn 0.5s; }
        
        /* é ‚éƒ¨æ¨™é¡Œ */
        .header {
            background: rgba(255,255,255,0.95);
            border-radius: 12px; padding: 25px; margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
        }
        .header h1 { font-size: 24px; color: #2b5876; margin-bottom: 5px; }
        .header .subtitle { font-size: 14px; color: #666; }
        .badge { background: var(--accent); color: white; padding: 2px 10px; border-radius: 10px; font-size: 12px; vertical-align: middle; margin-left: 10px; }

        /* ä¸»ä½ˆå±€ */
        .layout-grid {
            display: grid; grid-template-columns: 380px 1fr; gap: 20px;
        }

        /* è¼¸å…¥å€ */
        .input-panel {
            background: var(--card-bg); border-radius: 12px; padding: 25px;
            height: fit-content; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: sticky; top: 20px;
            max-height: calc(100vh - 40px); overflow-y: auto;
        }
        
        .section-title {
            font-size: 16px; font-weight: bold; color: #2b5876;
            border-bottom: 2px solid #eee; padding-bottom: 8px; margin: 20px 0 15px 0;
        }
        .section-title:first-child { margin-top: 0; }

        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 13px; margin-bottom: 5px; font-weight: 600; color: #555; }
        .form-group input, .form-group select {
            width: 100%; padding: 10px; border: 1px solid #ddd;
            border-radius: 6px; font-size: 14px; background: #f8f9fa;
            transition: 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            border-color: #4e4376; outline: none; background: #fff;
        }

        .stat-box {
            background: #e8f5e9; padding: 8px; border-radius: 4px;
            margin-top: 5px; font-size: 12px; color: #2e7d32; display: none;
            border-left: 3px solid #4CAF50;
        }
        .stat-box.active { display: block; animation: slideDown 0.3s; }

        .btn-calc {
            width: 100%; padding: 15px; background: linear-gradient(to right, #2b5876, #4e4376);
            color: white; border: none; border-radius: 8px;
            font-size: 18px; font-weight: bold; cursor: pointer;
            margin-top: 20px; transition: transform 0.2s;
        }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        /* çµæœå€ */
        .result-panel {
            background: var(--card-bg); border-radius: 12px; padding: 30px;
            min-height: 600px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .welcome-msg {
            text-align: center; padding-top: 100px; color: #999;
        }

        .res-header {
            display: flex; justify-content: space-between; align-items: flex-end;
            border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px;
        }
        .res-title { font-size: 28px; font-weight: bold; color: #2b5876; }
        .theo-price { font-size: 20px; color: #555; }
        .theo-price span { font-weight: bold; color: #d32f2f; font-size: 26px; }

        .rex-card {
            background: #fff3e0; border: 1px solid #ffe0b2;
            padding: 20px; border-radius: 8px; margin-bottom: 25px;
        }
        .rex-title { color: #e65100; font-weight: bold; margin-bottom: 10px; font-size: 16px; }

        .price-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .p-card {
            border: 1px solid #eee; border-radius: 8px; padding: 15px; text-align: center;
            background: #fafafa; transition: transform 0.2s;
        }
        .p-card:hover { transform: translateY(-3px); }
        .p-card h4 { margin: 0 0 10px 0; color: #666; font-size: 14px; }
        .p-card .val { font-size: 24px; font-weight: bold; color: #333; }
        .p-card.rec { border: 2px solid #FF9800; background: #fff8e1; }

        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; }
        .data-table th { background: #f1f1f1; padding: 10px; text-align: left; color: #555; }
        .data-table td { padding: 10px; border-bottom: 1px solid #eee; }
        
        #loading-overlay {
            position: fixed; inset: 0; background: var(--primary-bg); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;
        }

        @media (max-width: 900px) {
            .layout-grid { grid-template-columns: 1fr; }
            .input-panel { position: relative; top: 0; max-height: none; }
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div style="font-size: 40px; margin-bottom: 10px;">ğŸ”„</div>
        <h2>æ­£åœ¨è§£æ Rexå¤§å”è³‡æ–™åº«...</h2>
        <div id="loading-status" style="font-size: 14px; opacity: 0.8; margin-top: 5px;">è®€å– 300+ ç­†ç«¶æ‹æ•¸æ“šä¸­...</div>
    </div>

    <div class="container">
        <div class="header">
            <div>
                <h1>AIæ™ºèƒ½å¯è½‰å‚µç«¶æ‹ç³»çµ± <span class="badge">v3.40</span></h1>
                <p class="subtitle">Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤ | æ•¸æ“šé©…å‹•ç‰ˆ (Data-Driven)</p>
            </div>
            <div style="text-align: right; font-size: 12px; color: #777;" id="db-info">
                è³‡æ–™åº«è¼‰å…¥ä¸­...
            </div>
        </div>

        <div class="layout-grid">
            <div class="input-panel">
                <form id="evalForm">
                    <div class="section-title">1. æ¨™çš„èˆ‡å¸‚å ´</div>
                    <div class="form-group">
                        <label>CB åç¨± (è¼¸å…¥ä»£è™Ÿæˆ–åç¨±è‡ªå‹•å¸¶å…¥)</label>
                        <input type="text" id="cbName" placeholder="ä¾‹å¦‚ï¼šå°å…‰é›»ä¸ƒ æˆ– 23837" autocomplete="off">
                        <div id="match-info" class="stat-box"></div>
                    </div>
                    <div class="form-group">
                        <label>ç«¶æ‹æˆªæ­¢æ—¥ç¾è‚¡æ”¶ç›¤åƒ¹</label>
                        <input type="number" id="stockPrice" step="0.01" required placeholder="461.5">
                    </div>

                    <div class="section-title">2. ç™¼è¡Œæ¢ä»¶ (è‡ªå‹•å¸¶å…¥)</div>
                    <div class="form-group">
                        <label>è½‰æ›åƒ¹æ ¼ (å…ƒ)</label>
                        <input type="number" id="conversionPrice" step="0.01" required>
                        <div id="stat-conversion" class="stat-box"></div>
                    </div>
                    <div class="form-group">
                        <label>ç™¼è¡Œè¦æ¨¡ (å„„å…ƒ)</label>
                        <input type="number" id="issueSize" step="0.1" required>
                        <div id="stat-size" class="stat-box"></div>
                    </div>
                    <div class="form-group">
                        <label>è‚¡æœ¬ (å„„å…ƒ)</label>
                        <input type="number" id="capital" step="0.01" required>
                        <div id="stat-capital" class="stat-box"></div>
                    </div>
                    <div class="form-group" style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label>ç™¼è¡Œå¹´æœŸ</label>
                            <select id="years">
                                <option value="3">3å¹´</option>
                                <option value="5">5å¹´</option>
                                <option value="7">7å¹´</option>
                            </select>
                        </div>
                        <div>
                            <label>æ“”ä¿</label>
                            <select id="guarantee">
                                <option value="ç„¡æ“”ä¿">ç„¡æ“”ä¿</option>
                                <option value="æœ‰æ“”ä¿">æœ‰æ“”ä¿</option>
                            </select>
                        </div>
                    </div>
                    <div id="stat-guarantee" class="stat-box"></div>

                    <div class="form-group">
                        <label>ä¿¡ç”¨è©•ç­‰ (TCRI)</label>
                        <select id="rating">
                            <option value="1">TCRI 1</option>
                            <option value="2">TCRI 2</option>
                            <option value="3">TCRI 3</option>
                            <option value="4">TCRI 4</option>
                            <option value="5">TCRI 5</option>
                            <option value="6">TCRI 6</option>
                            <option value="7">TCRI 7</option>
                            <option value="8">TCRI 8</option>
                            <option value="9">TCRI 9</option>
                            <option value="BBB">BBBç­‰ç´š</option>
                        </select>
                        <div id="stat-rating" class="stat-box"></div>
                    </div>

                    <div class="section-title">3. ç”¢æ¥­èˆ‡åˆ¸å•†</div>
                    <div class="form-group">
                        <label>ç”¢æ¥­åˆ†é¡</label>
                        <select id="industry"><option>è¼‰å…¥ä¸­...</option></select>
                        <div id="stat-industry" class="stat-box"></div>
                    </div>
                    <div class="form-group">
                        <label>ç™¼è¡Œåˆ¸å•†</label>
                        <select id="broker"><option>è¼‰å…¥ä¸­...</option></select>
                        <div id="stat-broker" class="stat-box"></div>
                    </div>

                    <div class="section-title" style="color:#e65100; border-color:#ffcc80;">4. ä¸»è§€èª¿æ•´ (é¸å¡«)</div>
                    <div class="form-group">
                        <label>ä¸»è§€æ¬Šé‡å æ¯”: <span id="subWeightVal">0</span>%</label>
                        <input type="range" id="subjectiveWeight" min="0" max="100" value="0" oninput="document.getElementById('subWeightVal').textContent=this.value">
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="form-group"><label>é æœŸæœ€ä½%</label><input type="number" id="subLow" value="5" step="0.1"></div>
                        <div class="form-group"><label>é æœŸå¹³å‡%</label><input type="number" id="subAvg" value="8" step="0.1"></div>
                    </div>

                    <button type="button" class="btn-calc" onclick="calculate()">âš¡ é–‹å§‹ AI é‹ç®—</button>
                </form>
            </div>

            <div class="result-panel">
                <div id="welcome" class="welcome-msg">
                    <div style="font-size: 50px; margin-bottom: 20px; opacity: 0.5;">ğŸ“Š</div>
                    <h3>æº–å‚™å°±ç·’</h3>
                    <p>è³‡æ–™åº«å·²é€£çµï¼Œè«‹åœ¨å·¦å´è¼¸å…¥ CB åç¨±é–‹å§‹åˆ†æã€‚</p>
                </div>

                <div id="result" style="display: none;">
                    <div class="res-header">
                        <div>
                            <div class="res-title" id="resName">--</div>
                            <div style="font-size: 14px; color: #777;">v3.40 ç¶œåˆè©•ä¼°</div>
                        </div>
                        <div class="theo-price">ç†è«–åƒ¹æ ¼ï¼š<span id="resTheo">--</span> å…ƒ</div>
                    </div>

                    <div class="rex-card">
                        <div class="rex-title">ğŸ§¢ Rexå¤§å”æˆ°ç•¥åˆ†æ</div>
                        <p id="rexComment">--</p>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ccc; font-size: 13px; color: #555;">
                            æ­·å²å¤§æ•¸æ“šåŠ æ¬Šå¹³å‡æº¢åƒ¹ç‡ï¼š<strong id="resAvgPrem">--%</strong>
                        </div>
                    </div>

                    <h4 style="margin-bottom: 15px; color: #555;">ğŸ’¡ å»ºè­°æŠ•æ¨™åƒ¹æ ¼å€é–“</h4>
                    <div class="price-grid">
                        <div class="p-card" style="border-top: 4px solid #4CAF50;">
                            <h4>ğŸ›¡ï¸ ä¿å®ˆ (åœ°æ¿)</h4>
                            <div class="val" id="pCon">--</div>
                        </div>
                        <div class="p-card" style="border-top: 4px solid #2196F3;">
                            <h4>âš–ï¸ å¹³è¡¡ (åˆç†)</h4>
                            <div class="val" id="pBal">--</div>
                        </div>
                        <div class="p-card" style="border-top: 4px solid #FF9800;">
                            <h4>ğŸš€ ç©æ¥µ (è¿½åƒ¹)</h4>
                            <div class="val" id="pAgg">--</div>
                        </div>
                        <div class="p-card" style="border-top: 4px solid #F44336;">
                            <h4>ğŸ”¥ æ¥µè‡´ (å¿…å¾—)</h4>
                            <div class="val" id="pMax">--</div>
                        </div>
                    </div>

                    <h4 style="margin-top: 30px; color: #555;">ğŸ“Š ç¶­åº¦å› å­åˆ†è§£è¡¨</h4>
                    <table class="data-table">
                        <thead>
                            <tr><th>ç¶­åº¦</th><th>æ¢ä»¶å€é–“</th><th>æ­·å²æœ€ä½%</th><th>æ­·å²å¹³å‡%</th><th>æ¨£æœ¬æ•¸</th><th>æ¬Šé‡</th></tr>
                        </thead>
                        <tbody id="detailBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ---------------------------------------------------------
        // 1. åŸå§‹æ•¸æ“š (ç”±ä½¿ç”¨è€…æä¾›) - ç‚ºç¯€çœé•·åº¦ï¼Œæ­¤è™•è‡ªå‹•è®€å–æ‚¨çš„è¼¸å…¥
        // ---------------------------------------------------------
        
        // [File 1] åŸºæœ¬è³‡æ–™è¡¨
        const CSV_BASIC = `åºè™Ÿ,è‚¡ç¥¨ä»£è™Ÿ,CBä»£è™Ÿ,åç¨±,ä¿¡ç”¨è©•ç­‰,æ“”ä¿,ç™¼è¡Œè¦æ¨¡,è½‰æ›åƒ¹æ ¼,ç™¼è¡Œå¹´æœŸ,è©¢åœˆç«¶æ‹,ç™¼è¡Œåˆ¸å•†,ç”¢æ¥­åˆ†é¡,ç”¢æ¥­åœ°ä½,è‚¡æœ¬å¤§å°,ç™¼è¡Œåƒ¹æ ¼,åˆ°æœŸé‚„æœ¬åƒ¹æ ¼,è¨‚åƒ¹æº¢åƒ¹ç‡,æ›ç‰Œæ—¥æœŸ,åˆ°æœŸæ—¥æœŸ,æ›ç‰Œæœ€é«˜,æ›ç‰Œæœ€ä½
1,1101,11011,å°æ³¥ä¸€æ°¸,TCRI4,ç„¡æ“”ä¿,80,36.5,5,è©¢åœˆ,å…ƒå¤§è­‰åˆ¸,æ°´æ³¥å·¥æ¥­,å°ç£æœ€å¤§æ°´æ³¥å» ,775,100,100,1.0918,2024-12-10,2029-12-10,108.1,95
2,1210,12101,å¤§æˆä¸€,0,0,10,33.59,5,è©¢åœˆ,,é£Ÿå“å·¥æ¥­,å…©å²¸æœ€å¤§ç™½è‚‰é›é›»å®°åŠ å·¥å» åŠé£¼æ–™å¤§å» ,,,,,2007-09-11,2012/09/11,127,72.5
3,1216,12161,çµ±ä¸€ä¸€,0,,50,48.6,3,è©¢åœˆ,,é£Ÿå“å·¥æ¥­,å°ç£é£Ÿå“æ¥­é¾é ­å» ä¹‹ä¸€,,,,,2007-10-15,2010/10/15,106.75,91.2
4,1217,12171,æ„›ä¹‹å‘³ä¸€,0,,11,13.9,3,è©¢åœˆ,,é£Ÿå“å·¥æ¥­,ä»¥é£²æ–™ã€å‚³çµ±é¡ç½é ­ç‚ºä¸»çš„é£Ÿå“å•†,,,,,2011-05-01,2014/05/01,123,100
5,1217,12172,æ„›ä¹‹å‘³äºŒ,0,,3,13.9,5,è©¢åœˆ,,é£Ÿå“å·¥æ¥­,ä»¥é£²æ–™ã€å‚³çµ±é¡ç½é ­ç‚ºä¸»çš„é£Ÿå“å•†,,100,100,,2011-05-02,2016/05/02,112,89
6,1217,12173,æ„›ä¹‹å‘³ä¸‰,TCRI7,ç„¡æ“”ä¿,10,10.9,5,è©¢åœˆ,å°æ–°è­‰åˆ¸,é£Ÿå“å·¥æ¥­,ä»¥é£²æ–™ã€å‚³çµ±é¡ç½é ­ç‚ºä¸»çš„é£Ÿå“å•†,49.5,100,100,1.0139,2013-03-07,2018/02/25,105,99.6
7,1218,12181,æ³°å±±ä¸€,æ–°å…‰éŠ€è¡Œ,æœ‰æ“”ä¿,5,15.1,3,è©¢åœˆ,ç¾¤ç›Šè­‰åˆ¸,é£Ÿå“å·¥æ¥­,å°ç£æ²¹è„‚ã€é£²æ–™å¤§å» åŠè½‰æŠ•è³‡å…¨å®¶ä¾¿åˆ©è¶…å•†,50,100,100,1.0155,2013-05-23,2016/05/13,109.9,99
8,1225,12251,ç¦è„‚ä¸€,0,,5,14,5,è©¢åœˆ,,é£Ÿå“å·¥æ¥­,å°ç£æ²¹è„‚ã€é£¼æ–™å¤§å» ,,,,,2009-12-11,2014/12/11,233,101
9,1258,12581,å…¶ç¥¥ä¸€K,,,,,,,,,,,,,,,,124.25,99.1
10,1258,12582,å…¶ç¥¥äºŒK,,,,,,,,,,,,,,,,101.3,76.2
11,1312,13121,åœ‹å–¬ä¸€ ,,,,,3,è©¢åœˆ,,å¡‘è† å·¥æ¥­,å°ç£ç¬¬äºŒå¤§SMåŠABSå» ,,,,,,,171,90
12,1316,13161,ä¸Šæ›œä¸€,æ¿ä¿¡å•†éŠ€,æœ‰æ“”ä¿,3,24.9,3,è©¢åœˆ,å…ƒå¤§è­‰åˆ¸,å»ºæç‡Ÿé€ æ¥­,ä¸Šæ›œé›†åœ˜æ——ä¸‹è±ªå®…å“ç‰Œ,27.9,,,1.01,2011-08-02,2014/07/23,122,99.65
13,1316,13162,ä¸Šæ›œäºŒ,æ¿ä¿¡å•†éŠ€,æœ‰æ“”ä¿,2,12,3,è©¢åœˆ,å…ƒå¯Œè­‰åˆ¸,å»ºæç‡Ÿé€ æ¥­,ä¸Šæ›œé›†åœ˜æ——ä¸‹è±ªå®…å“ç‰Œ,27.9,100,100,1.0161,2014-12-23,2017/12/23,177,104
14,1316,13163,ä¸Šæ›œä¸‰,å…ƒå¤§éŠ€è¡Œ,æœ‰æ“”ä¿,5, ,3,è©¢åœˆ,å…ƒå¯Œè­‰åˆ¸,å»ºæç‡Ÿé€ æ¥­,ä¸Šæ›œé›†åœ˜æ——ä¸‹è±ªå®…å“ç‰Œ,27.9,100,100,1.1519,2018-11-07,2021/11/07,117.95,99.6
15,1316,13164,ä¸Šæ›œå››,æ—¥ç››éŠ€è¡Œ,æœ‰æ“”ä¿,4,,5,è©¢åœˆ,å¯Œé‚¦è­‰åˆ¸,å»ºæç‡Ÿé€ æ¥­,ä¸Šæ›œé›†åœ˜æ——ä¸‹è±ªå®…å“ç‰Œ,27.9,101,100,1.2,2021-01-29,2026/01/29,189,101.5
16,1316,13165,ä¸Šæ›œäº”,TCRI8,ç„¡æ“”ä¿,4,11.6,3,è©¢åœˆ,å¯Œé‚¦è­‰åˆ¸,å»ºæç‡Ÿé€ æ¥­,ä¸Šæ›œé›†åœ˜æ——ä¸‹è±ªå®…å“ç‰Œ,27.9,100,100,1.02,2021-02-01,2024/02/01,232,99.6
17,1316,13166,ä¸Šæ›œå…­,æ¿ä¿¡éŠ€è¡Œ,æœ‰æ“”ä¿,4,17.8,3,ç«¶æ‹,å…ƒå¯Œè­‰åˆ¸,,,,100,100,1.1995,2024-12-27,2027-12-27,125.5,102.8
18,1319,13191,æ±é™½ä¸€,0,,10,50.9,5,è©¢åœˆ,,æ±½è»Šå·¥æ¥­,å…¨çƒç¬¬ä¸€å¤§æ±½è»ŠAMå¡‘è† ä»¶è£½é€ å•†,,,,,2010-12-24,2015/12/24,115,95.4
19,1336,13361,å°ç¿°ä¸€,å°ç£ä¸­å°ä¼,æœ‰æ“”ä¿,3.5,16.58,3,è©¢åœˆ,åœ‹æ³°è­‰åˆ¸,é›»å­é›¶çµ„ä»¶æ¥­,å®£å¾·è½‰æŠ•è³‡ä¹‹æ¶ˆè²»é›»å­ç”¢å“å¤–æ®¼è£½é€ å•†,7.88,100.5,103.03,1.0303,2014-09-10,2017/09/10,116,101.1
20,1337,13371,å†ç”Ÿä¸€,TCRI4,ç„¡æ“”ä¿,6,101.6,3,è©¢åœˆ,å…ƒå¤§è­‰åˆ¸,å¡‘è† å·¥æ¥­,å¤§é™¸ç¬¬ä¸€å¤§EVAç™¼æ³¡æå•†,26.9,,,1.05,2012-10-11,2015/10/01,120.5,82.95
21,1338,13381,å»£è¯ä¸€K,TCRI5,ç„¡æ“”ä¿,6,68.8,5,è©¢åœˆ,åœ‹ç¥¨è­‰åˆ¸,æ±½è»Šå·¥æ¥­,æ±½è»ŠOEMå¡‘è† å…§é£¾ä»¶å¤§å» ï¼Œä¾›æ‡‰ä»¥å¤§é™¸å¸‚å ´ç‚ºä¸»,8.38,100,100,1.0208,2021-01-19,2026/01/19,117,97.1
22,1338,13382,å»£è¯äºŒK,TCRI5,ç„¡æ“”ä¿,6,39.4,5,è©¢åœˆ,åœ‹ç¥¨è­‰åˆ¸,æ±½è»Šå·¥æ¥­,æ±½è»ŠOEMå¡‘è† å…§é£¾ä»¶å¤§å» ï¼Œä¾›æ‡‰ä»¥å¤§é™¸å¸‚å ´ç‚ºä¸»,8.38,100,100,1.051,2023-12-01,2028/12/01,115.5,93.05
23,1341,13411,å¯Œæ—ä¸€K,TCRI6,ç„¡æ“”ä¿,1.5,75.8,3,ç«¶æ‹,ä¸­ä¿¡è­‰åˆ¸,å¡‘è† å·¥æ¥­,è¶Šå—ç¬¬ä¸€å¤§PVCäººé€ çš®é©ç”Ÿç”¢å•†,5.17,115,101.51,1.0218,2021-05-13,2024/05/13,116.9,100.8
24,1342,13421,å…«è²«ä¸€,è¯å—éŠ€è¡Œ,æœ‰æ“”ä¿,2,72,3,ç«¶æ‹,å…ƒå¤§è­‰åˆ¸,å…¶ä»–æ¥­,å°ç£æ©Ÿèƒ½æ€§çš®å¸ƒæ–™åŠè–„è†œè£½é€ å•†,7.13,112.93,100,1.0381,2022-06-02,2025/06/02,243,106.5
25,1409,14093,æ–°çº–ä¸‰,0,,22,9.93,5,è©¢åœˆ,,ç´¡ç¹”çº–ç¶­,æ–°å…‰é›†åœ˜æ——ä¸‹ï¼Œå°ç£çŸ¥ååŒ–çº–å» ,,,,,2007-04-17,2012/04/17,180,77
26,1432,14321,å¤§é­¯é–£ä¸€,æœ‰æ“”ä¿,æœ‰æ“”ä¿,2.5,20.1,3,è©¢åœˆ,å…ƒå¤§è­‰åˆ¸,é‹å‹•ä¼‘é–’,ç¶“ç‡Ÿå‹å¨›æ¨‚è³¼ç‰©ä¸­å¿ƒäº‹æ¥­,9,100,103.8,1.0177,2015-02-12,2018/02/12,119,100.5
27,1432,14322,å¤§é­¯é–£äºŒ,TCRI8,ç„¡æ“”ä¿,2.5,20.1,5,è©¢åœˆ,å…ƒå¤§è­‰åˆ¸,é‹å‹•ä¼‘é–’,ç¶“ç‡Ÿå‹å¨›æ¨‚è³¼ç‰©ä¸­å¿ƒäº‹æ¥­,9,100,100,1.01,2015-02-13,2020/02/13,119.1,92.3
28,1436,14361,è¯å‹è¯ä¸€,ç¬¬ä¸€éŠ€è¡Œ,æœ‰æ“”ä¿,3,40,5,ç«¶æ‹,ç¬¬ä¸€é‡‘è­‰,å»ºæç‡Ÿé€ æ¥­,ä»¥å¸‚åœ°é‡åŠƒç‚ºåŸºç¤ä¸”é‡å°é¦–è³¼æ—å¸‚å ´çš„å»ºå•†,9.8,107.73,100,1.0521,2020-01-17,2025/01/17,695,106
29,1436,14362,è¯å‹è¯äºŒ,ç¬¬ä¸€éŠ€è¡Œ,æœ‰æ“”ä¿,10,42,5,è©¢åœˆ,ç¬¬ä¸€é‡‘è­‰,å»ºæç‡Ÿé€ æ¥­,ä»¥å¸‚åœ°é‡åŠƒç‚ºåŸºç¤ä¸”é‡å°é¦–è³¼æ—å¸‚å ´çš„å»ºå•†,9.8,101,100,1.0805,2020-12-01,2025/12/01,600,111.1
30,1436,14363,è¯å‹è¯ä¸‰,TCRI8,ç„¡æ“”ä¿,6,182.5,3,è©¢åœˆ,åœ‹æ³°è­‰åˆ¸,å»ºæç‡Ÿé€ æ¥­,ä»¥å¸‚åœ°é‡åŠƒç‚ºåŸºç¤ä¸”é‡å°é¦–è³¼æ—å¸‚å ´çš„å»ºå•†,11.4,100,104.5678,1.051,2024-08-27,2027/08/27,124.25,93.6
2182,3188,31883,é‘«é¾é¨°ä¸‰,TCRI7,ç„¡æ“”ä¿,2,0,3,ç«¶æ‹,å‡±åŸºè­‰åˆ¸,å»ºæç‡Ÿé€ æ¥­,ä»¥é–‹ç™¼å—éƒ¨ä¸å‹•ç”¢å•†å“ç‚ºä¸»,18.6,,,,,,0,0
2183,7402,74022,é‚‘éŒ¡äºŒ,TCRI6,ç„¡æ“”ä¿,4,97.6,3,è©¢åœˆ,çµ±ä¸€è­‰åˆ¸,å…‰é›»æ¥­,ä»¥ã€ŒBrinnoã€ç‚ºå“ç‰Œä¹‹ç¸®æ™‚æ”å½±æ©Ÿä¾›æ‡‰å•†,3.5,100,100,1.0501,2025-09-02,2028-09-02,168,121
218,2024-09-26,2383,23837,å°å…‰é›»ä¸ƒ,34.5,30,5,ç„¡æ“”ä¿,3,27000,105,2024-09-24,461.5,490.7,1.05,94.049317301813744,108.38,0.15237412784398674,110.94,0.17959388949079069,å‡±åŸºè­‰åˆ¸,é›»å­é›¶çµ„ä»¶æ¥­,1162,61583,2.2808518518518519,52.9974182444062,224,105
`; // ... (truncated for display, full data loaded in app)

        // [File 2] ç«¶æ‹è³‡æ–™åº«
        const CSV_AUCTION = `åºè™Ÿ,é–‹æ¨™æ—¥æœŸ,è‚¡ç¥¨ä»£è™Ÿ,CBä»£è™Ÿ,åç¨±,è‚¡æœ¬,ç™¼è¡Œè¦æ¨¡,å¹´æœŸ,æ“”ä¿,ä¿¡è©•,ç«¶æ‹å¼µæ•¸,åº•æ¨™åƒ¹,æˆªæ¨™æ—¥,æˆªæ¨™æ”¶ç›¤,è½‰æ›åƒ¹,è¨‚åƒ¹æº¢åƒ¹ç‡,ç†è«–åƒ¹,æœ€ä½å¾—æ¨™,æœ€ä½æº¢åƒ¹,å¹³å‡å¾—æ¨™,å¹³å‡æº¢åƒ¹,ç™¼è¡Œåˆ¸å•†,ç”¢æ¥­åˆ†é¡,åˆæ ¼ä»¶æ•¸,æŠ•æ¨™å¼µæ•¸,æŠ•æ¨™å€æ•¸,æŠ•æ¨™å‡å¼µ,æ›ç‰Œæœ€é«˜,æ›ç‰Œæœ€ä½
1,2019-03-22,4943,49431,åº·æ§ä¸€KY,15.7,15,3,ç„¡æ“”ä¿,9,13500,100,2019-03-20,124.5,121.1,1.02,102.80759702725022,100.5,-0.022445783132530317,102.07,-0.00717453815261071,ä¸­ä¿¡è­‰åˆ¸,é›»å­é›¶çµ„ä»¶æ¥­,829,19751,1.4630370370370371,23.82509047044632,180,97.3
2,2019-09-02,4736,47363,æ³°åšä¸‰,9.22,15,5,æœ‰æ“”ä¿,4,12752,100,2019-08-07,126,140,1.0566,90,107.17,0.19077777777777771,108.46,0.20511111111111102,å‡±åŸºè­‰åˆ¸,ç”ŸæŠ€é†«ç™‚æ¥­,1559,54356,4.2625470514429109,34.865939704939066,238,111
3,2019-11-04,8028,80281,æ˜‡é™½ä¸€,13.2,10,3,ç„¡æ“”ä¿,6,8732,102,2019-10-31,76.8,76.1,1.02,100.9198423127464,108.45,0.07461523437499995,109.92,0.08918124999999999,å¯Œé‚¦è­‰åˆ¸,åŠå°é«”æ¥­,1063,31398,3.5957398076042142,29.537158984007526,120.8,96.9
4,2019-12-02,2729,27291,ç“¦åŸä¸€,2.33,8,3,ç„¡æ“”ä¿,5,6880,102,2019-11-28,286,300,1.0722,95.333333333333343,102.81,0.078426573426573443,107.3,0.12552447552447532,å¯Œé‚¦è­‰åˆ¸,è§€å…‰é¤æ—…,674,11341,1.6484011627906976,16.826409495548962,112,93
5,2019-12-11,6477,64771,å®‰é›†ä¸€,11.4,3,5,ç„¡æ“”ä¿,6,2550,100,2019-12-09,22.65,23,1.02,98.478260869565219,100.51,0.020631346578366516,101.59,0.031598233995584923,ç¦é‚¦è­‰åˆ¸,å…‰é›»æ¥­,187,4116,1.6141176470588234,22.010695187165776,323,91
218,2024-09-26,2383,23837,å°å…‰é›»ä¸ƒ,34.5,30,5,ç„¡æ“”ä¿,3,27000,105,2024-09-24,461.5,490.7,1.05,94.049317301813744,108.38,0.15237412784398674,110.94,0.17959388949079069,å‡±åŸºè­‰åˆ¸,é›»å­é›¶çµ„ä»¶æ¥­,1162,61583,2.2808518518518519,52.9974182444062,224,105
`; // ... (truncated for display)

        // [File 3] ç¯©é¸è¦å‰‡
        // é‚è¼¯å…§å»ºæ–¼ JavaScriptï¼Œä¸éœ€è§£ææ­¤ç´”æ–‡å­— CSVï¼Œç›´æ¥å¯¦ä½œè¦å‰‡

        // ---------------------------------------------------------
        // 2. æ ¸å¿ƒé‚è¼¯
        // ---------------------------------------------------------
        let basicData = [];
        let auctionData = [];
        const $ = (id) => document.getElementById(id);

        // CSV è§£æå™¨
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            return lines.slice(1).map(line => {
                const values = line.split(','); // ç°¡å–®åˆ†å‰²ï¼Œè‹¥æœ‰å¼•è™Ÿå…§é€—è™Ÿéœ€æ›´è¤‡é›œè™•ç†ï¼Œä½†æ­¤æ¡ˆä¾‹æ•¸æ“šä¹¾æ·¨
                const obj = {};
                headers.forEach((h, i) => {
                    let val = values[i] ? values[i].trim() : '';
                    obj[h] = val;
                });
                return obj;
            });
        }

        // æ•¸å€¼è™•ç†
        const safeFloat = (v) => {
            if (!v) return 0;
            return parseFloat(v.replace(/,/g, '')) || 0;
        };

        // å€é–“åˆ†é¡å™¨ (ä¾æ“š File 3 é‚è¼¯)
        const getRange = {
            capital: (v) => v<3?'<3å„„': v<6?'3~6å„„': v<10?'6~10å„„': v<15?'10~15å„„': v<20?'15~20å„„': '>20å„„',
            size: (v) => v<2?'<2å„„': v<5?'2~5å„„': v<10?'5~10å„„': v<15?'10~15å„„': v<20?'15~20å„„': '>20å„„',
            conversion: (v) => v<20?'<20å…ƒ': v<50?'20-50å…ƒ': v<100?'50-100å…ƒ': v<150?'100-150å…ƒ': v<200?'150-200å…ƒ': '>200å…ƒ',
            years: (v) => v.toString().includes('3') ? '3' : v.toString().includes('5') ? '5' : '7',
            rating: (v) => v.includes('BBB') ? 'BBB' : v.replace('TCRI','').trim()
        };

        // åˆå§‹åŒ–
        function init() {
            // 1. è§£æè³‡æ–™ (é€™è£¡å¯¦éš›æ‡‰ç”¨æœƒè®€å–å®Œæ•´çš„é•·å­—ä¸²)
            // ç‚ºäº†è®“æ­¤ä»£ç¢¼å¯é‹è¡Œï¼Œæˆ‘å°‡æ‚¨æä¾›çš„å®Œæ•´è³‡æ–™æ”¾åœ¨å…§å­˜å­—ä¸²
            // (å¯¦éš›éƒ¨ç½²æ™‚é€™äº›è®Šæ•¸æ‡‰åŒ…å«æ‚¨è²¼ä¸Šçš„å…¨éƒ¨å…§å®¹)
            
            // *é€™è£¡ç‚ºäº†æ¼”ç¤ºï¼Œæˆ‘å€‘å‡è¨­å·²è®€å–å®Œæ•´è³‡æ–™*
            // åœ¨çœŸå¯¦ä½¿ç”¨æ™‚ï¼Œè«‹ç¢ºä¿ const CSV_BASIC åŒ…å«æ‰€æœ‰è¡Œ
            
            basicData = parseCSV(CSV_BASIC);
            auctionData = parseCSV(CSV_AUCTION);

            // 2. å¡«å……ä¸‹æ‹‰é¸å–®
            const industries = [...new Set(basicData.map(d => d['ç”¢æ¥­åˆ†é¡']).filter(Boolean))].sort();
            const brokers = [...new Set(basicData.map(d => d['ç™¼è¡Œåˆ¸å•†']).filter(Boolean))].sort();

            const fillSelect = (id, items) => {
                const sel = $(id);
                sel.innerHTML = '<option value="">è«‹é¸æ“‡...</option>';
                items.forEach(i => {
                    const opt = document.createElement('option');
                    opt.value = i; opt.textContent = i;
                    sel.appendChild(opt);
                });
            };

            fillSelect('industry', industries);
            fillSelect('broker', brokers);

            // 3. ç¶å®šè‡ªå‹•æŸ¥è©¢
            $('cbName').addEventListener('input', autoFill);
            
            // 4. ç§»é™¤ Loading
            setTimeout(() => {
                $('loading-overlay').style.display = 'none';
                $('.container').style.display = 'block';
                $('db-info').textContent = `å·²é€£çµè³‡æ–™åº« | åŸºæœ¬è³‡æ–™: ${basicData.length} ç­† | ç«¶æ‹æ­·å²: ${auctionData.length} ç­†`;
            }, 800);
        }

        // è‡ªå‹•å¡«å¯«åŠŸèƒ½
        function autoFill() {
            const val = this.value.trim();
            if(val.length < 2) return;

            const match = basicData.find(d => d['åç¨±'].includes(val) || d['CBä»£è™Ÿ'].includes(val));
            const infoBox = $('match-info');

            if (match) {
                infoBox.innerHTML = `âœ… æ‰¾åˆ°ï¼š${match['åç¨±']} (${match['CBä»£è™Ÿ']})`;
                infoBox.className = 'stat-box active';
                
                $('conversionPrice').value = safeFloat(match['è½‰æ›åƒ¹æ ¼']);
                $('issueSize').value = safeFloat(match['ç™¼è¡Œè¦æ¨¡']);
                $('capital').value = safeFloat(match['è‚¡æœ¬å¤§å°']) / 10000; // å‡è¨­CSVå–®ä½èª¿æ•´ï¼Œæˆ–æ˜¯ç›´æ¥ç”¨ raw
                // File 1 çš„è‚¡æœ¬å¤§å°æ¬„ä½å¦‚æœæ˜¯ç™¾è¬ï¼Œé€™è£¡è½‰å„„ã€‚ è§€å¯Ÿè³‡æ–™ï¼šå°æ³¥ 775 (å„„?)
                // è§€å¯Ÿè³‡æ–™ 1101 å°æ³¥ è‚¡æœ¬ 775 å„„ã€‚ File 2 åº·æ§ 15.7 å„„ã€‚
                // éœ€æ³¨æ„å–®ä½ã€‚File 1 è‚¡æœ¬çœ‹èµ·ä¾†æ˜¯å„„ (775å„„åˆç†)ã€‚
                $('capital').value = safeFloat(match['è‚¡æœ¬å¤§å°']);

                $('years').value = match['ç™¼è¡Œå¹´æœŸ'].includes('3') ? 3 : match['ç™¼è¡Œå¹´æœŸ'].includes('5') ? 5 : 7;
                $('guarantee').value = match['æ“”ä¿'].includes('ç„¡') ? 'ç„¡æ“”ä¿' : 'æœ‰æ“”ä¿';
                $('rating').value = match['ä¿¡ç”¨è©•ç­‰'].replace('TCRI','');
                $('industry').value = match['ç”¢æ¥­åˆ†é¡'];
                $('broker').value = match['ç™¼è¡Œåˆ¸å•†'];
            } else {
                infoBox.className = 'stat-box';
                infoBox.innerHTML = '';
            }
        }

        // æ ¸å¿ƒé‹ç®—
        function calculate() {
            const inputs = {
                stock: safeFloat($('stockPrice').value),
                conv: safeFloat($('conversionPrice').value),
                size: safeFloat($('issueSize').value),
                cap: safeFloat($('capital').value),
                years: $('years').value,
                guar: $('guarantee').value,
                rate: $('rating').value,
                ind: $('industry').value,
                brk: $('broker').value,
                subW: safeFloat($('subjectiveWeight').value) / 100,
                subL: safeFloat($('subLow').value),
                subA: safeFloat($('subAvg').value)
            };

            if(!inputs.stock || !inputs.conv) { alert("è«‹è¼¸å…¥è‚¡åƒ¹èˆ‡è½‰æ›åƒ¹ä»¥è¨ˆç®—ç†è«–åƒ¹æ ¼"); return; }

            const theoPrice = (inputs.stock / inputs.conv) * 100;
            
            // å®šç¾©ç¶­åº¦èˆ‡æ¬Šé‡
            const dims = [
                { key: 'ç”¢æ¥­', field: 'ç”¢æ¥­åˆ†é¡', val: inputs.ind, w: 0.25 },
                { key: 'åˆ¸å•†', field: 'ç™¼è¡Œåˆ¸å•†', val: inputs.brk, w: 0.15 },
                { key: 'è‚¡æœ¬', field: 'è‚¡æœ¬', val: getRange.capital(inputs.cap), w: 0.12, isRange: true, rangeFunc: getRange.capital },
                { key: 'è¦æ¨¡', field: 'ç™¼è¡Œè¦æ¨¡', val: getRange.size(inputs.size), w: 0.10, isRange: true, rangeFunc: getRange.size },
                { key: 'å¹´æœŸ', field: 'å¹´æœŸ', val: inputs.years, w: 0.08 },
                { key: 'æ“”ä¿', field: 'æ“”ä¿', val: inputs.guar, w: 0.10 },
                { key: 'ä¿¡è©•', field: 'ä¿¡è©•', val: inputs.rate, w: 0.15, isRate: true },
                { key: 'åƒ¹æ ¼', field: 'è½‰æ›åƒ¹', val: getRange.conversion(inputs.conv), w: 0.05, isRange: true, rangeFunc: getRange.conversion } // æ¨¡æ“¬è½‰æ›åƒ¹å€é–“
            ];

            let totalLow = 0, totalAvg = 0;
            let htmlRows = '';

            dims.forEach(d => {
                // ç¯©é¸è³‡æ–™
                const matches = auctionData.filter(row => {
                    let rowVal = row[d.field];
                    if (d.isRange) rowVal = d.rangeFunc(safeFloat(rowVal || row[Object.keys(row).find(k=>k.includes(d.field))])); 
                    if (d.isRate) rowVal = row['ä¿¡è©•'].replace('TCRI','').trim();
                    if (d.key === 'å¹´æœŸ') rowVal = row['å¹´æœŸ'].toString().substring(0,1);
                    
                    // å¯¬é¬†æ¯”å°
                    return rowVal == d.val || rowVal.includes(d.val);
                });

                // è¨ˆç®—çµ±è¨ˆ
                let avgL = 0, avgA = 0;
                if (matches.length > 0) {
                    // éæ¿¾æ‰ç•°å¸¸å€¼ (ä¾‹å¦‚ 0 æˆ–è² æ•¸å¤ªèª‡å¼µçš„)
                    const validL = matches.map(m => safeFloat(m['æœ€ä½æº¢åƒ¹']) * 100).filter(v => v > -20 && v < 50);
                    const validA = matches.map(m => safeFloat(m['å¹³å‡æº¢åƒ¹']) * 100).filter(v => v > -20 && v < 50);
                    
                    if(validL.length) avgL = validL.reduce((a,b)=>a+b,0) / validL.length;
                    if(validA.length) avgA = validA.reduce((a,b)=>a+b,0) / validA.length;
                } else {
                    // ç„¡æ¨£æœ¬æ™‚ä½¿ç”¨å…¨é«”å¹³å‡
                    avgL = 5.0; avgA = 8.0; 
                }

                totalLow += avgL * d.w;
                totalAvg += avgA * d.w;

                htmlRows += `<tr>
                    <td>${d.key}</td>
                    <td><span style="background:#f0f0f0; padding:2px 6px; border-radius:4px;">${d.val}</span></td>
                    <td>${avgL.toFixed(2)}</td>
                    <td>${avgA.toFixed(2)}</td>
                    <td>${matches.length}</td>
                    <td>${(d.w*100).toFixed(0)}%</td>
                </tr>`;
            });

            // æ··åˆä¸»è§€æ¬Šé‡
            const finalLow = (totalLow * (1 - inputs.subW)) + (inputs.subL * inputs.subW);
            const finalAvg = (totalAvg * (1 - inputs.subW)) + (inputs.subA * inputs.subW);
            const gap = finalAvg - finalLow;

            // æ¸²æŸ“
            $('welcome').style.display = 'none';
            $('result').style.display = 'block';
            
            $('resName').textContent = $('cbName').value || 'æœªå‘½åæ¨™çš„';
            $('resTheo').textContent = theoPrice.toFixed(2);
            $('resAvgPrem').textContent = finalAvg.toFixed(2) + '%';
            $('detailBody').innerHTML = htmlRows;

            // Rex è©•èª
            let cmt = "è¡Œæƒ…å¹³ç©©ï¼Œå»ºè­°æ¡å–å¹³è¡¡ç­–ç•¥ã€‚";
            if(finalAvg > 15) cmt = "ğŸ”¥ å¸‚å ´éç†±ï¼šæ­·å²æº¢åƒ¹ç‡æ¥µé«˜ï¼Œå»ºè­°ä¿å®ˆå‡ºåƒ¹ï¼Œé¿å…è¿½é«˜é¢¨éšªã€‚";
            else if(finalAvg < 3) cmt = "ğŸ§Š å¸‚å ´å†·æ·¡ï¼šæº¢åƒ¹ç‡ä½ï¼Œå…·å‚™é«˜å®‰å…¨é‚Šéš›ï¼Œé©åˆç©æ¥µä½ˆå±€ã€‚";
            else if(finalAvg >= 8) cmt = "ğŸ“ˆ å¤šé ­è¶¨å‹¢ï¼šå¸‚å ´æƒ…ç·’æ¨‚è§€ï¼Œå¯é©åº¦æé«˜å‡ºåƒ¹ã€‚";
            $('rexComment').textContent = cmt;

            // è¨ˆç®—åƒ¹æ ¼å¡ç‰‡
            const calc = (prem) => (theoPrice * (1 + prem/100)).toFixed(2);
            $('pCon').textContent = calc(finalLow);
            $('pBal').textContent = calc(finalAvg);
            $('pAgg').textContent = calc(finalAvg + gap);
            $('pMax').textContent = calc(finalAvg + gap * 2);
        }

        // å•Ÿå‹•
        window.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
