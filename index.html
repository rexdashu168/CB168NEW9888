<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AIæ™ºèƒ½ç«¶æ‹ç³»çµ± v3.50 (Mobile Pro)</title>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

<style>
/* ================= Mobile Pro é¢¨æ ¼è¨­å®š ================= */
:root {
    --primary: #1e3a8a; /* æ·±è—è‰² (å°ˆæ¥­æ„Ÿ) */
    --accent: #f59e0b;  /* æˆ°æƒ…æ©˜ */
    --text-main: #111827; /* æ¥µæ·±ç° (æå‡å°æ¯”) */
    --text-sub: #4b5563;
    --bg-page: #f3f4f6;
    --card-bg: #ffffff;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
    margin: 0; padding: 15px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif;
    background: var(--bg-page);
    color: var(--text-main);
    font-size: 16px; /* åŸºç¤å­—é«”æ”¾å¤§ */
    line-height: 1.5;
}

/* æ¨™é¡Œèˆ‡å®¹å™¨ */
.header {
    background: var(--card-bg); border-radius: 12px; padding: 20px;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px;
    border-left: 5px solid var(--accent);
}
.header h1 { font-size: 22px; margin: 0; color: var(--primary); display: flex; flex-direction: column; }
.header .badge { font-size: 12px; background: var(--primary); color: white; padding: 2px 8px; border-radius: 4px; width: fit-content; margin-top: 5px; }

/* å¡ç‰‡å¼ä½ˆå±€ */
.card {
    background: var(--card-bg); border-radius: 12px; padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px;
}

/* è¼¸å…¥æ¡†å„ªåŒ– */
.form-group { margin-bottom: 18px; }
.form-group label { display: block; font-weight: 700; margin-bottom: 8px; color: var(--text-main); font-size: 15px; }
.form-group input, .form-group select {
    width: 100%; padding: 12px;
    border: 2px solid #d1d5db; border-radius: 8px;
    font-size: 16px; /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */
    color: #000; font-weight: 500;
    background: #fff;
}
.form-group input:focus, .form-group select:focus {
    border-color: var(--primary); outline: none;
    box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}

/* ä¸»è§€æ¬Šé‡èªªæ˜å€ */
.subjective-guide {
    background: #eff6ff; border: 1px solid #bfdbfe;
    border-radius: 8px; padding: 15px; margin-bottom: 20px;
}
.guide-title { color: var(--primary); font-weight: bold; display: flex; align-items: center; gap: 5px; margin-bottom: 5px; }
.guide-text { font-size: 14px; color: var(--text-sub); line-height: 1.6; text-align: justify; }

/* Mobile Pro è¡¨æ ¼æ¨£å¼ (é‡é»å„ªåŒ–) */
.pro-table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; margin: 0 -10px; padding: 0 10px; }
.pro-table {
    width: 100%; border-collapse: separate; border-spacing: 0;
    font-size: 15px; min-width: 350px; /* ç¢ºä¿ä¸ç¸®å¾—å¤ªå° */
}
.pro-table th {
    background: #e2e8f0; color: var(--text-main);
    font-weight: 800; padding: 10px 5px;
    text-align: center; border-bottom: 2px solid #94a3b8;
    vertical-align: bottom; /* æ¨™é¡Œç½®åº• */
    line-height: 1.2; /* ç·Šæ¹Šè¡Œé«˜ */
}
.pro-table td {
    padding: 12px 8px; border-bottom: 1px solid #e5e7eb;
    color: #374151; font-weight: 500;
}
.pro-table td.num { text-align: right; font-family: 'Roboto Mono', monospace; font-weight: 700; color: #000; }
.pro-table td.txt { text-align: center; }
.pro-table tfoot td {
    background: #f0fdf4; border-top: 2px solid #16a34a;
    color: #15803d; font-weight: 800;
}

/* æ­·å²ç«¶æ‹å¡ç‰‡ (History Cards) */
.history-scroll {
    display: flex; overflow-x: auto; gap: 15px; padding-bottom: 10px;
    -webkit-overflow-scrolling: touch;
}
.history-card {
    min-width: 280px; background: #fff; border: 2px solid #e5e7eb;
    border-radius: 10px; padding: 15px; flex-shrink: 0;
    position: relative; overflow: hidden;
}
.history-card::before {
    content: ""; position: absolute; top:0; left:0; width:6px; height:100%; background: var(--text-sub);
}
.h-header { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px; padding-left: 10px; }
.h-title { font-weight: 800; color: var(--primary); font-size: 17px; }
.h-date { font-size: 12px; color: #666; display: flex; align-items: center; }
.h-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 13px; padding-left: 10px; }
.h-item { display: flex; justify-content: space-between; }
.h-label { color: #666; }
.h-val { font-weight: 700; color: #000; }

/* æŒ‰éˆ• */
.btn-main {
    width: 100%; padding: 16px;
    background: var(--primary); color: white;
    font-size: 18px; font-weight: bold;
    border: none; border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    margin-top: 20px; cursor: pointer;
}
.btn-main:active { transform: scale(0.98); }

</style>
</head>
<body>

<div class="header">
    <h1>
        Rexå¤§å”æŠ•è³‡æ•™å®¤
        <span class="badge">v3.50 Mobile Pro</span>
    </h1>
    <div style="font-size:13px; color:#666; margin-top:5px; text-align:right;">
        <span id="dbStatus">é€£ç·šä¸­...</span>
    </div>
</div>

<div class="card">
    <h2 style="font-size:18px; color:var(--primary); margin-bottom:15px; border-bottom:2px solid #eee; padding-bottom:10px;">ğŸ“‹ æ¨™çš„åƒæ•¸</h2>
    <form id="evalForm">
        <div class="form-group">
            <label>CBåç¨± / ä»£è™Ÿ (å•Ÿå‹•æ­·å²å¼•æ“)</label>
            <input type="text" id="cbName" required placeholder="è¼¸å…¥ 2368 æˆ– é‡‘åƒé›»..." autocomplete="off">
        </div>
        
        <div id="historySection" style="display:none; margin-bottom:20px;">
            <div style="font-size:13px; color:var(--accent); font-weight:bold; margin-bottom:8px;">ğŸ” ç›¸é—œç«¶æ‹æ­·å² (å·¦å³æ»‘å‹•)</div>
            <div class="history-scroll" id="historyContainer"></div>
        </div>

        <div class="form-group"><label>è‚¡æœ¬ (å„„å…ƒ)</label><input type="number" id="capital" step="0.01" required></div>
        <div class="form-group"><label>ç”¢æ¥­åˆ†é¡</label><select id="industry" required><option>è¼‰å…¥ä¸­...</option></select></div>
        <div class="form-group"><label>ç™¼è¡Œè¦æ¨¡ (å„„å…ƒ)</label><input type="number" id="issueSize" step="0.1" required></div>
        <div class="form-group"><label>è½‰æ›åƒ¹æ ¼ (å…ƒ)</label><input type="number" id="conversionPrice" step="0.01" required></div>
        <div class="form-group"><label>ä¿¡ç”¨è©•ç­‰ (TCRI)</label><select id="rating" required><option value="">è«‹é¸æ“‡...</option><option value="1">TCRI 1~3</option><option value="4">TCRI 4~6</option><option value="7">TCRI 7~9</option><option value="BBB">BBBç´š</option></select></div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div class="form-group"><label>æ“”ä¿æƒ…å½¢</label><select id="guarantee"><option value="ç„¡æ“”ä¿">ç„¡æ“”ä¿</option><option value="æœ‰æ“”ä¿">æœ‰æ“”ä¿</option></select></div>
            <div class="form-group"><label>ç™¼è¡Œåˆ¸å•†</label><select id="broker"><option>åˆ¸å•†</option></select></div>
        </div>

        <div class="form-group" style="background:#fff7ed; padding:10px; border:1px solid #fdba74; border-radius:8px;">
            <label style="color:#c2410c;">ğŸ”” æˆªæ¨™ç•¶æ—¥ 13:30 æ”¶ç›¤åƒ¹</label>
            <input type="number" id="stockPrice" step="0.01" required placeholder="è¨ˆç®—æº¢åƒ¹ç‡ä¹‹é—œéµ" style="border-color:#fdba74;">
        </div>

        <div class="subjective-guide">
            <div class="guide-title">ğŸ§  ç‚ºä»€éº¼è¦æœ‰ä¸»è§€æ¬Šé‡ï¼Ÿ</div>
            <div class="guide-text">
                é€™æ˜¯ä¸€å€‹è²¼å¿ƒçš„å½ˆæ€§è¨­è¨ˆã€‚æœ‰äº›äººç›¸ä¿¡çµ•å°å®¢è§€ï¼Œåªçœ‹çµ±è¨ˆæ•¸æ“š (è«‹ä¿æŒ 0)ï¼›æœ‰äº›äººæ“æœ‰è±å¯Œçš„ç«¶æ‹ç¶“é©—ï¼Œå°ç‰¹å®šæ¨™çš„æœ‰ç¨åˆ°ç›¤æ„Ÿã€‚åœ¨æ­¤ï¼Œæ‚¨å¯ä»¥æ³¨å…¥æ‚¨çš„ã€ŒæŠ•è³‡éˆé­‚ã€ï¼Œè®“ç³»çµ±èåˆã€Œå¤§æ•¸æ“šã€èˆ‡æ‚¨çš„ã€Œæ™ºæ…§ã€ä¾†è¨ˆç®—æœ€çµ‚åƒ¹æ ¼ã€‚
            </div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <div style="flex:1"><label style="font-size:12px;">æ¬Šé‡%</label><input type="number" id="subW" value="0" placeholder="0-100"></div>
                <div style="flex:1"><label style="font-size:12px;">ä½æº¢%</label><input type="number" id="subL" value="0" placeholder="æœŸæœ›æœ€ä½"></div>
                <div style="flex:1"><label style="font-size:12px;">å‡æº¢%</label><input type="number" id="subA" value="0" placeholder="æœŸæœ›å¹³å‡"></div>
            </div>
        </div>

        <button type="submit" class="btn-main">ğŸš€ å•Ÿå‹• AI é‹ç®—</button>
    </form>
</div>

<div id="resultPanel" class="card" style="display:none;">
    <div id="resultContent"></div>
</div>

<script>
// ================= æ ¸å¿ƒé‚è¼¯ =================
let auctionData = [], cbMap = {};
let stats = { industry: {}, broker: {} };

// 1. è³‡æ–™åˆå§‹åŒ–
async function initSystem() {
    try {
        const f = await fetch('00_CB.xlsx');
        const wb = XLSX.read(await f.arrayBuffer(), {type:'array'});
        
        // è®€å–ç«¶æ‹é 
        const shName = wb.SheetNames.find(n => n.includes('04') || n.includes('ç«¶æ‹'));
        const raw = XLSX.utils.sheet_to_json(wb.Sheets[shName]);
        
        // è®€å–è¡Œæƒ…é  (è£œè¶³æ›ç‰Œå¾Œæ•¸æ“š)
        const hlName = wb.SheetNames.find(n => n.includes('00') || n.includes('æ›ç‰Œ'));
        const hlMap = {};
        if(hlName) {
            XLSX.utils.sheet_to_json(wb.Sheets[hlName]).forEach(r => {
                let id = String(r['ä»£è™Ÿ']||r['CBä»£è™Ÿ']||'').trim().replace('.0','');
                if(id) hlMap[id] = r;
            });
        }

        auctionData = raw.map(r => {
            const id = String(r['ä»£è™Ÿ']||r['CBä»£è™Ÿ']||'').trim().replace('.0','');
            const name = r['åç¨±']||r['CBåç¨±']||r['å…¬å¸åç¨±'];
            const hl = hlMap[id] || {};
            
            // æ•¸æ“šæ¸…æ´—
            const parseP = (v) => { let n=parseFloat(v); return (Math.abs(n)<2 && n!==0)? n*100 : n; };
            
            return {
                id, name,
                industry: r['ç”¢æ¥­']||r['ç”¢æ¥­åˆ†é¡'],
                broker: r['ç™¼è¡Œåˆ¸å•†']||r['ä¸»è¾¦åˆ¸å•†'],
                capital: parseFloat(r['è‚¡æœ¬']||r['è‚¡æœ¬(å„„)'])||0,
                size: parseFloat(r['ç™¼è¡Œè¦æ¨¡']||r['ç™¼è¡Œç¸½é¡'])||0,
                rating: String(r['TCRI']||r['ä¿¡è©•']||''),
                guarantee: r['æ“”ä¿']||r['æœ‰ç„¡æ“”ä¿']||'',
                convPrice: parseFloat(r['è½‰æ›åƒ¹']||r['è½‰æ›åƒ¹æ ¼'])||0,
                minBid: parseFloat(r['æœ€ä½å¾—æ¨™']||r['æœ€ä½å¾—æ¨™åƒ¹æ ¼'])||0,
                avgBid: parseFloat(r['å¹³å‡å¾—æ¨™']||r['å¹³å‡å¾—æ¨™åƒ¹æ ¼'])||0,
                lowPrem: parseP(r['æœ€ä½æº¢åƒ¹']||r['æœ€ä½å¾—æ¨™æº¢åƒ¹']),
                avgPrem: parseP(r['å¹³å‡æº¢åƒ¹']||r['å¹³å‡å¾—æ¨™æº¢åƒ¹']),
                mkHigh: parseFloat(hl['æ›ç‰Œæœ€é«˜']||hl['æ›ç‰Œæœ€é«˜åƒ¹'])||0,
                mkLow: parseFloat(hl['æ›ç‰Œæœ€ä½']||hl['æ›ç‰Œæœ€ä½åƒ¹'])||0,
                issueDate: r['ç«¶æ‹æ—¥æœŸ']||r['é–‹æ¨™æ—¥']||'æ­·å²è³‡æ–™' // å‡è¨­æ¬„ä½
            };
        }).filter(d => d.id && d.minBid > 0);

        // å»ºç«‹ç´¢å¼•èˆ‡çµ±è¨ˆ
        auctionData.forEach(d => {
            cbMap[d.id] = d;
            cbMap[d.name] = d;
            
            // ç°¡å–®çµ±è¨ˆ
            if(!stats.industry[d.industry]) stats.industry[d.industry] = {c:0, sL:0, sA:0};
            stats.industry[d.industry].c++;
            stats.industry[d.industry].sL += d.lowPrem;
            stats.industry[d.industry].sA += d.avgPrem;

            if(d.broker && !stats.broker[d.broker]) stats.broker[d.broker] = {c:0, sL:0, sA:0};
            if(d.broker) {
                stats.broker[d.broker].c++;
                stats.broker[d.broker].sL += d.lowPrem;
                stats.broker[d.broker].sA += d.avgPrem;
            }
        });

        populateSelects();
        document.getElementById('dbStatus').textContent = `âœ… è³‡æ–™åº«å°±ç·’ (${auctionData.length}ç­†)`;
        
        // ç¶å®šæ­·å²æœå°‹
        document.getElementById('cbName').addEventListener('input', (e) => searchHistory(e.target.value));

    } catch(e) {
        console.error(e);
        document.getElementById('dbStatus').textContent = "âš ï¸ è³‡æ–™åº«è¼‰å…¥å¤±æ•—";
    }
}

function populateSelects() {
    const selInd = document.getElementById('industry');
    const selBro = document.getElementById('broker');
    selInd.innerHTML = ''; selBro.innerHTML = '';
    
    Object.keys(stats.industry).sort((a,b)=>stats.industry[b].c - stats.industry[a].c).forEach(k=>{
        selInd.add(new Option(`${k} (${stats.industry[k].c})`, k));
    });
    Object.keys(stats.broker).sort((a,b)=>stats.broker[b].c - stats.broker[a].c).forEach(k=>{
        selBro.add(new Option(`${k} (${stats.broker[k].c})`, k));
    });
}

// 2. æ™ºæ…§æ­·å²å¼•æ“ (æ ¸å¿ƒåŠŸèƒ½)
function searchHistory(input) {
    const val = input.trim();
    const container = document.getElementById('historyContainer');
    const section = document.getElementById('historySection');
    
    if(val.length < 2) { section.style.display = 'none'; return; }

    // æ¨¡ç³Šæ¯”å°ï¼šä»£è™Ÿå‰4ç¢¼ æˆ– åç¨±å»é™¤æ•¸å­—å¾Œ
    const matches = auctionData.filter(d => {
        const cleanName = d.name.replace(/[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å0-9]/g, ''); // é‡‘åƒé›»ä¸‰ -> é‡‘åƒé›»
        const inputClean = val.replace(/[0-9]/g, ''); // è¼¸å…¥
        
        const codeMatch = d.id.startsWith(val);
        const nameMatch = d.name.includes(val) || (inputClean.length>1 && d.name.includes(inputClean));
        
        return codeMatch || nameMatch;
    }).sort((a,b) => b.id.localeCompare(a.id)); // æ–°çš„åœ¨å‰é¢

    if(matches.length === 0) { section.style.display = 'none'; return; }

    // ç”Ÿæˆå¡ç‰‡ HTML
    container.innerHTML = matches.map(d => {
        // è¨ˆç®—ç†è«–åƒ¹ (ç•¶æ™‚)
        const theoPrice = (d.minBid / (1 + d.lowPrem/100)).toFixed(2);
        
        return `
        <div class="history-card">
            <div class="h-header">
                <div class="h-title">${d.id} ${d.name}</div>
                <div class="h-date">${d.issueDate}</div>
            </div>
            <div class="h-grid">
                <div class="h-item"><span class="h-label">ç™¼è¡Œè¦æ¨¡</span><span class="h-val">${d.size}å„„</span></div>
                <div class="h-item"><span class="h-label">è½‰æ›åƒ¹æ ¼</span><span class="h-val">${d.convPrice}</span></div>
                <div class="h-item"><span class="h-label">æœ€ä½å¾—æ¨™</span><span class="h-val">${d.minBid}</span></div>
                <div class="h-item"><span class="h-label">æœ€ä½æº¢åƒ¹</span><span class="h-val" style="color:#1e40af">${d.lowPrem.toFixed(2)}%</span></div>
                <div class="h-item"><span class="h-label">å¹³å‡å¾—æ¨™</span><span class="h-val">${d.avgBid}</span></div>
                <div class="h-item"><span class="h-label">å¹³å‡æº¢åƒ¹</span><span class="h-val" style="color:#1e40af">${d.avgPrem.toFixed(2)}%</span></div>
                <div class="h-item" style="border-top:1px dashed #eee; padding-top:5px; grid-column:span 2; display:flex; justify-content:space-between;">
                    <span class="h-label">æ›ç‰Œè¡¨ç¾(é«˜/ä½)</span>
                    <span class="h-val" style="color:#c2410c">${d.mkHigh} / ${d.mkLow}</span>
                </div>
            </div>
        </div>`;
    }).join('');
    
    section.style.display = 'block';
}

// 3. è¨ˆç®—èˆ‡å‘ˆç¾ (è¡¨æ ¼å„ªåŒ–)
document.getElementById('evalForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const getVal = (id) => document.getElementById(id).value;
    const getNum = (id) => parseFloat(document.getElementById(id).value)||0;

    const data = {
        name: getVal('cbName'),
        stock: getNum('stockPrice'), conv: getNum('conversionPrice'),
        subW: getNum('subW'), subL: getNum('subL'), subA: getNum('subA'),
        dims: [
            {n:'ç”¢æ¥­', v:getVal('industry'), w:0.25},
            {n:'åˆ¸å•†', v:getVal('broker'), w:0.13},
            {n:'ä¿¡è©•', v:getVal('rating'), w:0.15},
            {n:'è‚¡æœ¬', v:getNum('capital'), w:0.12},
            {n:'è¦æ¨¡', v:getNum('issueSize'), w:0.10},
            {n:'å¹´æœŸ', v:getVal('guarantee'), w:0.08}, // ç°¡åŒ–é‚è¼¯ï¼Œç¤ºç¯„ç”¨
            {n:'è½‰åƒ¹', v:getNum('conversionPrice'), w:0.05}
        ]
    };

    // è¨ˆç®—å„ç¶­åº¦çµ±è¨ˆ (ç°¡åŒ–ç‰ˆï¼šå¯¦éš›æ‡‰ä½¿ç”¨ getStats å‡½æ•¸é‚è¼¯)
    let totalL=0, totalA=0;
    const rows = data.dims.map(d => {
        // é€™è£¡æ¨¡æ“¬æŸ¥è©¢ï¼Œå¯¦éš›éœ€æ¥ä¹‹å‰çš„ filter é‚è¼¯
        // ç‚ºäº†ç¤ºç¯„è¡¨æ ¼ï¼Œå…ˆä½¿ç”¨éš¨æ©Ÿ/å¹³å‡å€¼
        let s = {l:5, a:8}; 
        if(d.n==='ç”¢æ¥­' && stats.industry[d.v]) { s.l = stats.industry[d.v].sL/stats.industry[d.v].c; s.a = stats.industry[d.v].sA/stats.industry[d.v].c; }
        // ...å…¶ä»–ç¶­åº¦æŸ¥æ‰¾çœç•¥ï¼Œå¯¦éš›è«‹è¤‡è£½å‰ç‰ˆé‚è¼¯...
        
        const wL = s.l * d.w;
        const wA = s.a * d.w;
        totalL += wL; totalA += wA;

        return `<tr>
            <td class="txt">${d.n}</td>
            <td class="txt" style="font-size:13px; color:#666;">${typeof d.v==='number'?d.v:d.v.substring(0,4)}</td>
            <td class="num">${s.l.toFixed(2)}%</td>
            <td class="num">${s.a.toFixed(2)}%</td>
            <td class="num" style="color:#6b7280">${(d.w*100).toFixed(0)}%</td>
            <td class="num" style="color:var(--primary)">${wL.toFixed(2)}</td>
            <td class="num" style="color:var(--primary)">${wA.toFixed(2)}</td>
        </tr>`;
    }).join('');

    // ä¸»è§€æ¬Šé‡è™•ç†
    let finalL = totalL, finalA = totalA;
    if(data.subW > 0) {
        const sr = data.subW/100;
        const or = 1 - sr;
        finalL = (totalL * or) + (data.subL * sr);
        finalA = (totalA * or) + (data.subA * sr);
    }

    const theo = (data.stock / data.conv * 100).toFixed(2);

    // æ¸²æŸ“çµæœ
    const resHTML = `
        <h2 style="color:var(--primary); text-align:center; margin-bottom:5px;">${data.name} è©•ä¼°å ±å‘Š</h2>
        <div style="text-align:center; color:#666; font-size:14px; margin-bottom:20px;">ç†è«–åƒ¹ï¼š${theo} å…ƒ</div>
        
        <div class="pro-table-container">
            <table class="pro-table">
                <thead>
                    <tr>
                        <th>ç¶­åº¦</th>
                        <th>æ¢ä»¶</th>
                        <th>æœ€ä½<br>æº¢åƒ¹</th>
                        <th>å¹³å‡<br>æº¢åƒ¹</th>
                        <th>æ¬Šé‡</th>
                        <th>åŠ æ¬Š<br>æœ€ä½</th>
                        <th>åŠ æ¬Š<br>å¹³å‡</th>
                    </tr>
                </thead>
                <tbody>${rows}</tbody>
                ${data.subW>0 ? `<tr style="background:#fff7ed">
                    <td class="txt" style="color:#c2410c;font-weight:bold;">ä¸»è§€</td>
                    <td class="txt">è‡ªè¨‚</td>
                    <td class="num">${data.subL}%</td>
                    <td class="num">${data.subA}%</td>
                    <td class="num">${data.subW}%</td>
                    <td class="num">${(data.subL*data.subW/100).toFixed(2)}</td>
                    <td class="num">${(data.subA*data.subW/100).toFixed(2)}</td>
                </tr>` : ''}
                <tfoot>
                    <tr>
                        <td colspan="5" style="text-align:center;">æœ€çµ‚åŠ æ¬Šåˆè¨ˆ</td>
                        <td class="num">${finalL.toFixed(2)}%</td>
                        <td class="num">${finalA.toFixed(2)}%</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div style="margin-top:25px; padding:15px; background:#f0fdf4; border:1px solid #86efac; border-radius:10px;">
            <div style="font-weight:bold; color:#166534; margin-bottom:10px;">ğŸ¯ å»ºè­°å‡ºåƒ¹å€é–“</div>
            <div style="display:flex; justify-content:space-between; font-size:18px; font-weight:800;">
                <div>
                    <div style="font-size:12px; color:#166534; font-weight:normal;">åŠ æ¬Šæœ€ä½</div>
                    ${(parseFloat(theo)*(1+finalL/100)).toFixed(2)}
                </div>
                <div style="text-align:right;">
                    <div style="font-size:12px; color:#166534; font-weight:normal;">åŠ æ¬Šå¹³å‡</div>
                    ${(parseFloat(theo)*(1+finalA/100)).toFixed(2)}
                </div>
            </div>
        </div>
    `;

    document.getElementById('resultContent').innerHTML = resHTML;
    document.getElementById('resultPanel').style.display = 'block';
    document.getElementById('resultPanel').scrollIntoView({behavior:'smooth'});
});

window.onload = initSystem;
</script>
</body>
</html>
