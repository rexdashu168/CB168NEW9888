<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤ - AIæ™ºèƒ½å¯è½‰å‚µç«¶æ‹ç³»çµ±</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* Rexå¤§å”å“ç‰Œé¢¨æ ¼è¨­å®š */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8f9fa;
        }
        .rex-header {
            background: linear-gradient(135deg, #2c3e50 0%, #4ca1af 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .card-header {
            border-radius: 12px 12px 0 0 !important;
            font-weight: 600;
        }
        .btn-rex {
            background-color: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
        }
        .btn-rex:hover {
            background-color: #e0a800;
        }
        .result-box {
            background-color: #e8f4f8;
            border-left: 5px solid #17a2b8;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
        }
        .recommendation-card {
            border: 2px solid #ffc107;
            background-color: #fffbf0;
        }
        .text-highlight {
            color: #d9534f;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <header class="rex-header text-center">
        <div class="container">
            <h1 class="display-5 fw-bold"><i class="fas fa-chart-line me-2"></i>Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤</h1>
            <p class="lead mb-0">AI æ™ºèƒ½å¯è½‰å‚µç«¶æ‹æ±ºç­–ç³»çµ± v3.3</p>
            <small class="text-white-50">çµåˆ Black-Scholes æ¨¡å‹èˆ‡è³ªåŒ–åˆ†æçš„é›™é‡é©—è­‰</small>
        </div>
    </header>

    <div class="container mb-5">
        <div class="row">
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <i class="fas fa-sliders-h me-2"></i>åŸºç¤åƒæ•¸è¨­å®š (Input)
                    </div>
                    <div class="card-body">
                        <form id="calcForm">
                            <div class="mb-3">
                                <label class="form-label">æ¨™çš„è‚¡åƒ¹ (Stock Price)</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="S" placeholder="ä¾‹å¦‚: 85.5" step="0.1" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">è½‰æ›åƒ¹æ ¼ (Strike Price)</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="K" placeholder="ä¾‹å¦‚: 90.0" step="0.1" required>
                                </div>
                                <div class="form-text text-muted">è«‹æŸ¥è©¢ç«¶æ‹å…¬å‘Šä¹‹è½‰æ›åƒ¹</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ç«¶æ‹åº•åƒ¹ (Floor Price)</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="floorPrice" placeholder="ä¾‹å¦‚: 100" value="100" step="0.1">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">æ­·å²æ³¢å‹•ç‡ (Volatility, %)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="sigma" placeholder="ä¾‹å¦‚: 25" step="0.1" value="30" required>
                                    <span class="input-group-text">%</span>
                                </div>
                                <div class="form-text text-muted">å»ºè­°è¼¸å…¥ HV20 æˆ– HV60 æ•¸å€¼</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">å‰©é¤˜å¹´æœŸ (Years)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="t" placeholder="å¹´" value="5" step="0.1" required>
                                    <span class="input-group-text">å¹´</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ç„¡é¢¨éšªåˆ©ç‡ (Risk-free Rate)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="r" placeholder="%" value="1.5" step="0.01">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-rex btn-lg" onclick="analyze()">
                                    <i class="fas fa-calculator me-2"></i>é–‹å§‹ AI é‹ç®—
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                                    <i class="fas fa-undo me-2"></i>æ¸…é™¤é‡ç½®
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="alert alert-info shadow-sm">
                    <h6 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Rexå¤§å”å°å®åš€ï¼š</h6>
                    <hr>
                    <p class="mb-0 small">æœ¬å·¥å…·åƒ…ä¾›å­¸è¡“ç ”ç©¶èˆ‡æ•™å­¸è¼”åŠ©ä½¿ç”¨ã€‚ç«¶æ‹å¯è½‰å‚µå…·æœ‰åƒ¹æ ¼æ³¢å‹•é¢¨éšªï¼Œæ¨¡å‹é‹ç®—çµæœåƒ…ä¾›åƒè€ƒï¼ŒéæŠ•è³‡å»ºè­°ã€‚</p>
                </div>
            </div>

            <div class="col-lg-8">
                
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-warning text-dark fw-bold">
                        <i class="fas fa-balance-scale me-2"></i>ä¸»è§€æ¬Šé‡èª¿æ•´ (Subjective Assessment)
                    </div>
                    <div class="card-body">
                        <div class="alert alert-light border-warning mb-3">
                            <i class="fas fa-info-circle text-warning me-2"></i>
                            <strong>Rexå¤§å”å¿ƒæ³•æç¤ºï¼š</strong> é‡åŒ–æ•¸æ“šåƒ…æ˜¯åŸºç¤ï¼ŒæŠ•è³‡äººçš„æ´å¯ŸåŠ›ï¼ˆInsightï¼‰æ‰æ˜¯è¶…é¡å ±é…¬çš„ä¾†æºã€‚è«‹æ ¹æ“šç•¶ä¸‹å¸‚å ´ç‹€æ³å¾®èª¿ä»¥ä¸‹æ¬Šé‡ã€‚
                        </div>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="industry-score" class="form-label fw-bold">
                                    <i class="fas fa-industry me-1"></i> ç”¢æ¥­å‰æ™¯ (Industry)
                                </label>
                                <p class="text-muted small mb-2" style="font-size: 0.85rem; line-height: 1.4;">
                                    <strong>è©•ä¼°é‡é»ï¼š</strong>è©²å…¬å¸æ‰€è™•ç”¢æ¥­æ˜¯å¦ä½æ–¼è¶¨å‹¢æµªé ­ï¼Ÿï¼ˆå¦‚ï¼šAIã€åŠå°é«”ã€ç¶ èƒ½ï¼‰ã€‚<br>
                                    <span class="text-success">åŠ åˆ†ï¼š</span>ç”¢æ¥­è™•æ–¼æˆé•·æœŸæˆ–æ”¿ç­–åˆ©å¤šã€‚<br>
                                    <span class="text-danger">æ‰£åˆ†ï¼š</span>å¤•é™½ç”¢æ¥­æˆ–ç”¢èƒ½éå‰©ã€‚
                                </p>
                                <select class="form-select border-warning" id="industry-score">
                                    <option value="1.1">ğŸ”¥ éå¸¸çœ‹å¥½ (+10%)</option>
                                    <option value="1.05">ğŸ“ˆ æº«å’Œæˆé•· (+5%)</option>
                                    <option value="1.0" selected>âš–ï¸ æŒå¹³/ä¸­æ€§ (ä¸èª¿æ•´)</option>
                                    <option value="0.95">ğŸ“‰ ç¨å¾®çœ‹æ·¡ (-5%)</option>
                                    <option value="0.9">ğŸ§Š å‰æ™¯å ªæ†‚ (-10%)</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label for="market-mood" class="form-label fw-bold">
                                    <i class="fas fa-chart-line me-1"></i> å¤§ç›¤æ°›åœ (Market)
                                </label>
                                <p class="text-muted small mb-2" style="font-size: 0.85rem; line-height: 1.4;">
                                    <strong>è©•ä¼°é‡é»ï¼š</strong>ç›®å‰çš„åŠ æ¬ŠæŒ‡æ•¸ä½éšèˆ‡å¸‚å ´è³‡é‡‘æµå‘ã€‚<br>
                                    <span class="text-success">åŠ åˆ†ï¼š</span>å¤šé ­æ’åˆ—ã€æˆäº¤é‡å¤§ã€è³‡é‡‘å……æ²›ã€‚<br>
                                    <span class="text-danger">æ‰£åˆ†ï¼š</span>ç©ºé ­ä¿®æ­£ã€æµå‹•æ€§æ¯ç«­ã€é¢¨éšªé«˜ã€‚
                                </p>
                                <select class="form-select border-warning" id="market-mood">
                                    <option value="1.1">ğŸ‚ ç‰›å¸‚/è³‡é‡‘å……æ²› (+10%)</option>
                                    <option value="1.05">ğŸŒ¤ï¸ åå¤šçœ‹å¾… (+5%)</option>
                                    <option value="1.0" selected>â˜ï¸ éœ‡ç›ªæ•´ç† (ä¸èª¿æ•´)</option>
                                    <option value="0.95">ğŸŒ§ï¸ åç©ºçœ‹å¾… (-5%)</option>
                                    <option value="0.9">ğŸ» ç†Šå¸‚/ææ…Œ (-10%)</option>
                                </select>
                            </div>

                            <div class="col-md-4">
                                <label for="company-credit" class="form-label fw-bold">
                                    <i class="fas fa-building me-1"></i> å…¬å¸ä¿¡ç”¨ (Credit)
                                </label>
                                <p class="text-muted small mb-2" style="font-size: 0.85rem; line-height: 1.4;">
                                    <strong>è©•ä¼°é‡é»ï¼š</strong>é™¤äº†ä¿¡è©•å ±å‘Šå¤–ï¼Œç¶“ç‡Ÿåœ˜éšŠçš„éå¾€èª ä¿¡èˆ‡æ­·å²ç´€éŒ„ã€‚<br>
                                    <span class="text-success">åŠ åˆ†ï¼š</span>é¾é ­ä¼æ¥­ã€éå¾€CBè½‰æ›ç‡é«˜ã€‚<br>
                                    <span class="text-danger">æ‰£åˆ†ï¼š</span>æ›¾æœ‰é•ç´„ç´€éŒ„ã€è²¡å‹™æ“ä½œé »ç¹ã€‚
                                </p>
                                <select class="form-select border-warning" id="company-credit">
                                    <option value="1.1">ğŸ’ ç¸¾å„ªé¾é ­ (+10%)</option>
                                    <option value="1.05">âœ… ä¿¡ç”¨è‰¯å¥½ (+5%)</option>
                                    <option value="1.0" selected>âš–ï¸ æ™®é€š/ä¸€èˆ¬ (ä¸èª¿æ•´)</option>
                                    <option value="0.95">âš ï¸ ç¨å¾®ç–‘æ…® (-5%)</option>
                                    <option value="0.9">âŒ ä¿¡ç”¨ä¸ä½³ (-10%)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="resultSection" style="display: none;">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-poll me-2"></i>AI é‹ç®—åˆ†æå ±å‘Š</span>
                            <button class="btn btn-sm btn-outline-light" onclick="exportCSV()">
                                <i class="fas fa-download me-1"></i>åŒ¯å‡º CSV
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row text-center mb-4">
                                <div class="col-md-4">
                                    <div class="p-3 bg-light rounded">
                                        <h6 class="text-muted">è½‰æ›åƒ¹å€¼ (Parity)</h6>
                                        <h3 class="fw-bold text-primary" id="parityVal">--</h3>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 bg-light rounded">
                                        <h6 class="text-muted">BS ç†è«–åƒ¹æ ¼ (BS Price)</h6>
                                        <h3 class="fw-bold text-success" id="bsPrice">--</h3>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 bg-light rounded">
                                        <h6 class="text-muted">æº¢åƒ¹ç‡ (Premium)</h6>
                                        <h3 class="fw-bold text-secondary" id="premiumRate">--</h3>
                                    </div>
                                </div>
                            </div>

                            <h6 class="fw-bold border-bottom pb-2 mb-3">æ•æ„Ÿåº¦ä¿‚æ•¸ (The Greeks)</h6>
                            <div class="row mb-4 small">
                                <div class="col-3"><strong>Delta (Î”):</strong> <span id="deltaVal">--</span></div>
                                <div class="col-3"><strong>Gamma (Î“):</strong> <span id="gammaVal">--</span></div>
                                <div class="col-3"><strong>Vega (Î½):</strong> <span id="vegaVal">--</span></div>
                                <div class="col-3"><strong>Theta (Î¸):</strong> <span id="thetaVal">--</span></div>
                            </div>

                            <div class="recommendation-card p-4 rounded text-center">
                                <h4 class="fw-bold mb-3">
                                    <i class="fas fa-gavel me-2"></i>AI ç¶œåˆç«¶æ‹å»ºè­°
                                </h4>
                                <div class="row">
                                    <div class="col-md-6 border-end">
                                        <h6 class="text-muted">ä¿å®ˆå‹å‡ºåƒ¹å»ºè­°</h6>
                                        <h2 class="text-success fw-bold display-6" id="recPriceConservative">--</h2>
                                        <small class="text-muted">(è¿½æ±‚å®‰å…¨é‚Šéš›)</small>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-muted">ç©æ¥µå‹å‡ºåƒ¹å»ºè­°</h6>
                                        <h2 class="text-danger fw-bold display-6" id="recPriceAggressive">--</h2>
                                        <small class="text-muted">(è€ƒé‡å¸‚å ´ç†±åº¦åŠ æ¬Š)</small>
                                    </div>
                                </div>
                                <hr>
                                <div class="mt-3 text-start">
                                    <strong><i class="fas fa-comment-dots me-2"></i>Rexå¤§å”åˆ†æè§€é»ï¼š</strong>
                                    <p id="analysisComment" class="mb-0 mt-1">è«‹è¼¸å…¥æ•¸æ“šä»¥å–å¾—åˆ†æçµæœ...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-5">
        <div class="container">
            <small>&copy; 2025 Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤. All Rights Reserved.</small>
        </div>
    </footer>

    <script>
        // æ¨™æº–å¸¸æ…‹åˆ†ä½ˆç´¯ç©å‡½æ•¸ (CDF) - ç”¨æ–¼ BS æ¨¡å‹
        function cdf(x) {
            var t = 1 / (1 + 0.2316419 * Math.abs(x));
            var d = 0.3989423 * Math.exp(-x * x / 2);
            var prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            if (x > 0) prob = 1 - prob;
            return prob;
        }

        // æ¨™æº–å¸¸æ…‹æ©Ÿç‡å¯†åº¦å‡½æ•¸ (PDF) - ç”¨æ–¼ Greeks
        function pdf(x) {
            return (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);
        }

        // ä¸»åˆ†æå‡½æ•¸
        function analyze() {
            // 1. ç²å–è¼¸å…¥å€¼
            let S = parseFloat(document.getElementById('S').value); // è‚¡åƒ¹
            let K = parseFloat(document.getElementById('K').value); // è½‰æ›åƒ¹
            let floorPrice = parseFloat(document.getElementById('floorPrice').value) || 100; // ç«¶æ‹åº•åƒ¹
            let sigma = parseFloat(document.getElementById('sigma').value) / 100; // æ³¢å‹•ç‡
            let t = parseFloat(document.getElementById('t').value); // å¹´æœŸ
            let r = parseFloat(document.getElementById('r').value) / 100; // ç„¡é¢¨éšªåˆ©ç‡

            if (isNaN(S) || isNaN(K) || isNaN(sigma) || isNaN(t)) {
                alert("è«‹ç¢ºèªæ‰€æœ‰å¿…å¡«æ¬„ä½çš†å·²æ­£ç¢ºè¼¸å…¥æ•¸å€¼ï¼");
                return;
            }

            // 2. è¨ˆç®— Black-Scholes æ¨¡å‹
            // d1 = [ln(S/K) + (r + sigma^2/2)t] / (sigma * sqrt(t))
            let d1 = (Math.log(S / K) + (r + 0.5 * Math.pow(sigma, 2)) * t) / (sigma * Math.sqrt(t));
            let d2 = d1 - sigma * Math.sqrt(t);

            // Call Option Value (æ¯è‚¡é¸æ“‡æ¬Šåƒ¹å€¼)
            let callPricePerShare = S * cdf(d1) - K * Math.exp(-r * t) * cdf(d2);
            
            // è½‰æ›ç‚º CB åƒ¹å€¼ (å‡è¨­ä¸€å¼µ CB è½‰æ› 100/K * 1000 è‚¡ï¼Œç°¡åŒ–è¨ˆç®—ç›´æ¥ä»¥æ¯ç™¾å…ƒé¢é¡è¨ˆç®—)
            // ç†è«–åƒ¹æ ¼ = å‚µåº•åƒ¹å€¼(å‡è¨­ç‚º100) + é¸æ“‡æ¬Šåƒ¹å€¼ * (100/K)
            // é€™è£¡æ¡ç”¨å¸¸è¦‹ä¼°ç®—ï¼šParity + Time Valueï¼Œæˆ–ç´” BS å°æ‡‰å¯è½‰å‚µæ¨¡çµ„
            // ç‚ºäº†ç¬¦åˆç«¶æ‹æƒ…å¢ƒï¼Œæˆ‘å€‘ä½¿ç”¨ï¼šç†è«–åƒ¹æ ¼ = 100 + (CallPricePerShare / K) * 100
            // ä¿®æ­£é‚è¼¯ï¼šè½‰æ›åƒ¹å€¼ = (S/K)*100ã€‚BSæ¨¡å‹ç®—å‡ºçš„ Call Price æ˜¯ã€Œæ¬Šåˆ©é‡‘ã€ã€‚
            // CB ç†è«–åƒ¹é€šå¸¸è¢«è¦–ç‚ºï¼š Max(ç´”å‚µåƒ¹å€¼, è½‰æ›åƒ¹å€¼) + æ™‚é–“åƒ¹å€¼
            // é€™è£¡ç°¡åŒ–æ¨¡å‹ï¼š åŸºç¤åº•åƒ¹(100) + (CallPrice / K * 100)
            
            let parity = (S / K) * 100;
            let bsTheoreticalPrice = 100 + (callPricePerShare / K) * 100; 
            // è‹¥è½‰æ›åƒ¹å€¼æ·±åº¦åƒ¹å…§ï¼Œç†è«–åƒ¹æ‡‰è²¼è¿‘è½‰æ›åƒ¹å€¼ + å°‘è¨±æ™‚é–“åƒ¹å€¼
            if(parity > 100) {
                // ç°¡å–®ä¿®æ­£ï¼šè‹¥æ·±åº¦åƒ¹å…§ï¼ŒBSæ¨¡å‹æœƒè‡ªå‹•åæ˜ å…§å«åƒ¹å€¼
                // bsTheoreticalPrice å·²ç¶“åŒ…å« (S-K) çš„éƒ¨åˆ†
            }

            // Greeks è¨ˆç®—
            let delta = cdf(d1);
            let gamma = pdf(d1) / (S * sigma * Math.sqrt(t));
            let vega = S * Math.sqrt(t) * pdf(d1) / 100; // èª¿æ•´é¡¯ç¤ºæ¯”ä¾‹
            let theta = (- (S * sigma * pdf(d1)) / (2 * Math.sqrt(t)) - r * K * Math.exp(-r * t) * cdf(d2)) / 365;

            // 3. ç²å–ä¸»è§€æ¬Šé‡
            let w_industry = parseFloat(document.getElementById('industry-score').value);
            let w_market = parseFloat(document.getElementById('market-mood').value);
            let w_credit = parseFloat(document.getElementById('company-credit').value);

            // 4. ç¶œåˆåŠ æ¬Šè¨ˆç®—
            // ç¸½æ¬Šé‡ä¿‚æ•¸
            let totalWeight = w_industry * w_market * w_credit;

            // æ ¹æ“šæ¬Šé‡èª¿æ•´å»ºè­°å‡ºåƒ¹
            // åŸºæº–å»ºè­°ï¼šBS ç†è«–åƒ¹æ ¼
            let baseRec = bsTheoreticalPrice;
            
            // ä¿å®ˆå‡ºåƒ¹ï¼š(BSåƒ¹æ ¼ + è½‰æ›åƒ¹å€¼) / 2 * æ¬Šé‡ (å–è¼ƒä½è€…åšé˜²å®ˆ)
            // é‚è¼¯ï¼šå¦‚æœ BS å¾ˆé«˜ä½†è½‰æ›åƒ¹å€¼ä½ï¼ˆè™›å€¼ï¼‰ï¼Œä¿å®ˆè€…æ‡‰è²¼è¿‘åº•åƒ¹æˆ–å‚µåº•
            let conservativePrice = Math.max(floorPrice, baseRec * 0.98 * totalWeight);
            if (parity < 100 && conservativePrice > 105) {
                conservativePrice = 102 + (conservativePrice - 102) * 0.5; // ä¿®æ­£è™›å€¼æ™‚çš„é«˜ä¼°
            }

            // ç©æ¥µå‡ºåƒ¹ï¼šBSåƒ¹æ ¼ * æ¬Šé‡ * æº¢åƒ¹å‹•èƒ½
            let aggressivePrice = Math.max(floorPrice, baseRec * 1.02 * totalWeight);

            // 5. æ›´æ–° UI
            document.getElementById('parityVal').innerText = parity.toFixed(2);
            document.getElementById('bsPrice').innerText = bsTheoreticalPrice.toFixed(2);
            document.getElementById('premiumRate').innerText = ((bsTheoreticalPrice - 100) / 100 * 100).toFixed(2) + '%';

            document.getElementById('deltaVal').innerText = delta.toFixed(4);
            document.getElementById('gammaVal').innerText = gamma.toFixed(4);
            document.getElementById('vegaVal').innerText = vega.toFixed(4);
            document.getElementById('thetaVal').innerText = theta.toFixed(4);

            document.getElementById('recPriceConservative').innerText = conservativePrice.toFixed(2);
            document.getElementById('recPriceAggressive').innerText = aggressivePrice.toFixed(2);

            // ç”Ÿæˆåˆ†æè§€é»æ–‡å­—
            generateComment(parity, totalWeight, delta);

            // é¡¯ç¤ºçµæœå€
            document.getElementById('resultSection').style.display = 'block';
            
            // æ»¾å‹•åˆ°çµæœå€
            document.getElementById('resultSection').scrollIntoView({behavior: 'smooth'});
        }

        function generateComment(parity, weight, delta) {
            let comment = "";
            
            // åˆ¤æ–·åƒ¹å…§å¤–
            if (parity >= 100) {
                comment += "æ­¤æ¨™çš„ç›®å‰è™•æ–¼<span class='text-highlight'>åƒ¹å…§ (In-the-Money)</span>ï¼Œè½‰æ›åƒ¹å€¼å…·æ”¯æ’ã€‚";
            } else {
                comment += "æ­¤æ¨™çš„ç›®å‰è™•æ–¼<span class='text-highlight'>åƒ¹å¤– (Out-of-the-Money)</span>ï¼Œä¸»è¦ä¾è³´æ™‚é–“åƒ¹å€¼èˆ‡å‚µåº•ä¿è­·ã€‚";
            }

            // åˆ¤æ–·æ¬Šé‡å½±éŸ¿
            if (weight > 1.1) {
                comment += " ç¶œåˆæ‚¨å°ç”¢æ¥­èˆ‡å¸‚å ´çš„è©•ä¼°ï¼ŒAI çµ¦äºˆ<span class='text-highlight'>é«˜åº¦æº¢åƒ¹</span>è©•åƒ¹ï¼Œé©åˆç©æ¥µåƒèˆ‡ã€‚";
            } else if (weight < 0.9) {
                comment += " è€ƒé‡å¸‚å ´é¢¨éšªå› ç´ ï¼ŒAI å»ºè­°<span class='text-highlight'>ä¿å®ˆå› æ‡‰</span>ï¼Œç•™æ„æµå‹•æ€§é¢¨éšªã€‚";
            } else {
                comment += " ç›®å‰å„é …ä¸»è§€æŒ‡æ¨™å‘ˆç¾<span class='text-highlight'>ä¸­æ€§</span>ï¼Œå»ºè­°ä¾æ“šæ¨¡å‹ç†è«–åƒ¹å€é–“æ“ä½œã€‚";
            }

            document.getElementById('analysisComment').innerHTML = comment;
        }

        function resetForm() {
            document.getElementById('calcForm').reset();
            document.getElementById('resultSection').style.display = 'none';
            // é‡ç½® Select é è¨­å€¼
            document.getElementById('industry-score').value = "1.0";
            document.getElementById('market-mood').value = "1.0";
            document.getElementById('company-credit').value = "1.0";
        }

        function exportCSV() {
            let stock = document.getElementById('S').value;
            let strike = document.getElementById('K').value;
            let bs = document.getElementById('bsPrice').innerText;
            let conservative = document.getElementById('recPriceConservative').innerText;
            let aggressive = document.getElementById('recPriceAggressive').innerText;
            
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // åŠ å…¥ BOM é˜²æ­¢äº‚ç¢¼
            csvContent += "æ¨™çš„è‚¡åƒ¹,è½‰æ›åƒ¹æ ¼,BSç†è«–åƒ¹,ä¿å®ˆå»ºè­°,ç©æ¥µå»ºè­°\n";
            csvContent += `${stock},${strike},${bs},${conservative},${aggressive}`;

            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "Rex_CB_Auction_Analysis.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
