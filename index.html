<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AIæ™ºèƒ½å¯è½‰å‚µç«¶æ‹ç³»çµ± v3.51 (å‹•æ…‹æ¬Šé‡ç‰ˆ)</title>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<script src="embedded_data.js" onerror="console.warn('embedded_data.js not found')"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Microsoft JhengHei','Segoe UI',Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
.container{max-width:1600px;margin:0 auto}
.header{background:#fff;border-radius:15px;padding:30px;margin-bottom:20px;box-shadow:0 10px 30px rgba(0,0,0,.2);position:relative;overflow:hidden}
.header::before{content:"";position:absolute;top:0;left:0;width:10px;height:100%;background:#9C27B0}
.header h1{color:#667eea;font-size:28px;margin-bottom:10px;font-weight:900}
.header .subtitle{color:#666;font-size:15px;display:flex;align-items:center;gap:10px;font-weight:700;flex-wrap:wrap}
.version-badge{display:inline-block;background:#7B1FA2;color:#fff;padding:4px 12px;border-radius:20px;font-size:13px;font-weight:700}
.evaluation-container{display:grid;grid-template-columns:520px 1fr;gap:20px}
.input-panel{background:#fff;border-radius:15px;padding:25px;box-shadow:0 5px 20px rgba(0,0,0,.1);height:fit-content;position:sticky;top:20px}
.input-panel h2{color:#667eea;font-size:20px;margin-bottom:20px;padding-bottom:12px;border-bottom:3px solid #667eea;font-weight:800}
.form-section{margin-bottom:20px}
.form-section h3{color:#333;font-size:15px;margin-bottom:12px;font-weight:700;border-left:4px solid #667eea;padding-left:10px}
.form-group{margin-bottom:12px}
.form-group label{display:block;color:#555;font-size:13px;margin-bottom:6px;font-weight:700}
.form-group input,.form-group select{width:100%;padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;transition:border-color .3s;font-weight:600;color:#333}
.form-group input:focus,.form-group select:focus{outline:none;border-color:#667eea;background:#fcfdff}
.required-mark{color:#d32f2f;font-weight:700}
.dimension-section{background:linear-gradient(135deg,#f8f9ff 0%,#f0f4ff 100%);border:2px solid #667eea;border-radius:12px;padding:15px;margin-bottom:20px}
.dimension-section h3{color:#667eea;margin-bottom:15px;display:flex;align-items:center;gap:8px}
.dimension-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid #ddd}
.dimension-header .total-weight{font-size:14px;font-weight:700;padding:4px 12px;border-radius:20px}
.weight-ok{background:#e8f5e9;color:#2e7d32}
.weight-warning{background:#fff3e0;color:#e65100}
.weight-error{background:#ffebee;color:#c62828}
.dimension-item{display:grid;grid-template-columns:30px 1fr 80px;gap:10px;align-items:center;padding:10px;margin-bottom:8px;background:#fff;border-radius:8px;border:1px solid #e0e0e0;transition:all .2s}
.dimension-item:hover{border-color:#667eea;box-shadow:0 2px 8px rgba(102,126,234,.15)}
.dimension-item.disabled{opacity:.5;background:#f5f5f5}
.dimension-item input[type="checkbox"]{width:20px;height:20px;cursor:pointer}
.dimension-content{display:flex;flex-direction:column;gap:4px}
.dimension-content label{font-size:13px;font-weight:700;color:#333;margin-bottom:0}
.dimension-content select,.dimension-content input[type="number"]{padding:8px;font-size:13px}
.weight-input{display:flex;align-items:center;gap:4px}
.weight-input input{width:50px!important;padding:6px!important;text-align:center;font-size:13px!important}
.weight-input span{font-size:12px;color:#666}
.info-box{background:#e8f5e9;padding:12px;border-radius:8px;border-left:5px solid #4CAF50;margin-top:8px;display:none;box-shadow:0 2px 5px rgba(0,0,0,.05);animation:slideDown .3s ease-out}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.history-results{margin-top:10px;background:linear-gradient(135deg,#f3e5f5 0%,#e1bee7 100%);border:2px solid #9c27b0;border-radius:12px;padding:15px;display:none;max-height:400px;overflow-y:auto}
.history-results-title{font-size:14px;font-weight:700;color:#6a1b9a;margin-bottom:12px;display:flex;align-items:center;gap:6px}
.inquiry-card{background:#fff3e0;border:1px solid #ffb74d;border-radius:6px;margin-bottom:6px;padding:8px 10px;font-size:11px}
.inquiry-line1,.inquiry-line2{display:flex;align-items:center;gap:4px;flex-wrap:wrap}
.inquiry-line2{margin-top:4px}
.inquiry-badge{background:#ff9800;color:#fff;padding:2px 5px;border-radius:4px;font-size:9px;font-weight:700}
.inquiry-name{font-weight:700;color:#e65100;margin-right:2px}
.inquiry-info{color:#666;white-space:nowrap}
.inquiry-info b{color:#333}
.inquiry-info b.pink{color:#E91E63}
.history-card{background:#f3e5f5;padding:10px 12px;border-radius:8px;margin-bottom:8px;border:1px solid #ba68c8;font-size:11px}
.history-card:last-child{margin-bottom:0}
.hc-header{display:flex;align-items:center;gap:6px;margin-bottom:6px;flex-wrap:wrap}
.hc-badge{background:#9C27B0;color:#fff;padding:2px 6px;border-radius:4px;font-size:9px;font-weight:700}
.hc-name{font-weight:700;color:#6a1b9a;flex:1}
.hc-date{font-size:10px;color:#999}
.hc-line{display:flex;flex-wrap:wrap;gap:4px 8px;margin-bottom:6px}
.hc-info{color:#666;font-size:11px;white-space:nowrap}
.hc-info b{color:#333;margin-left:2px}
.hc-table{width:100%;border-collapse:collapse;font-size:11px;margin-top:6px;background:#fff;border-radius:4px;overflow:hidden}
.hc-table th{background:#7B1FA2;color:#fff;padding:5px 4px;font-weight:700;text-align:center}
.hc-table td{padding:5px 4px;text-align:center;border:1px solid #e0e0e0;font-weight:600}
.td-label{background:#f3e5f5;color:#6a1b9a;font-weight:700;font-size:10px}
.val-red{color:#d32f2f;font-weight:700}
.val-pink{color:#E91E63;font-weight:900}
.warning-box{background:#fff3e0;border-left:4px solid #ff9800;padding:10px;margin-top:5px;font-size:12px;color:#e65100;font-weight:700;border-radius:4px}
.card-market-table{width:100%;border-collapse:collapse;font-size:11px;margin-top:8px;border-radius:4px;overflow:hidden}
.card-market-table th{background:#2e7d32;color:#fff;padding:4px 5px;font-weight:700;font-size:10px;text-align:center}
.card-market-table td{padding:4px 5px;text-align:center;border-bottom:1px solid #c8e6c9;background:#f1f8e9}
.card-market-table .type-label{font-weight:700;color:#1b5e20;text-align:left;padding-left:8px}
.card-market-table .type-label .count{font-size:9px;color:#666;margin-left:3px}
.card-market-table .val-blue{font-weight:700;color:#1565c0}
.card-market-table .val-pink{font-weight:700;color:#E91E63}
.card-market-table .total-row td{background:#c8e6c9;font-weight:900;border-top:2px solid #4CAF50}
.stats-header{font-size:13px;color:#2e7d32;font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:5px;border-bottom:1px solid #c8e6c9;padding-bottom:5px}
.stat-row{font-size:12px;color:#444;margin-bottom:5px;display:flex;align-items:center;justify-content:space-between}
.stat-label{color:#555;font-weight:500}
.stat-value{font-weight:700;color:#333}
.market-sentiment-section{background:#e3f2fd;border:1px solid #2196F3;border-radius:8px;padding:12px;margin-top:15px}
.market-sentiment-section .toggle-header{display:flex;align-items:center;gap:8px;cursor:pointer}
.market-sentiment-section .toggle-header input{width:18px;height:18px}
.market-sentiment-content{margin-top:10px;display:none}
.market-sentiment-content.active{display:block}
.calculate-btn{width:100%;padding:16px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;border-radius:10px;font-size:18px;font-weight:700;cursor:pointer;transition:all .2s;margin-top:15px;box-shadow:0 4px 15px rgba(102,126,234,.4)}
.calculate-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,.6)}
.result-panel{background:#fff;border-radius:15px;padding:25px;box-shadow:0 5px 20px rgba(0,0,0,.1);min-height:600px}
.welcome-message{text-align:center;padding:50px 20px}
.stats-summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;margin-top:30px}
.stat-box{background:#f8f9fa;padding:20px;border-radius:10px;text-align:center;border:1px solid #eee;transition:transform .3s}
.stat-box:hover{transform:translateY(-5px);border-color:#b39ddb}
.stat-box .number{font-size:32px;font-weight:700;color:#667eea;margin-bottom:8px}
.evaluation-result{display:none}
.evaluation-result.active{display:block;animation:fadeIn .5s}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.result-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:25px;border-radius:12px;margin-bottom:25px;text-align:center}
.completeness-badge{display:inline-block;padding:4px 12px;border-radius:20px;font-size:13px;margin-top:8px}
.detail-section{background:#fff;border-radius:12px;padding:25px;margin-bottom:20px;border:2px solid #e0e0e0}
.detail-section h3{color:#667eea;font-size:18px;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #667eea}
.price-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px}
.strategy-card{border:2px solid;border-radius:12px;padding:20px;transition:transform .3s}
.strategy-card:hover{transform:translateY(-5px)}
.strategy-card h4{font-size:16px;margin-bottom:10px}
.strategy-card.conservative{border-color:#4CAF50;background:#f1f8f4}
.strategy-card.conservative h4{color:#2e7d32}
.strategy-card.balanced{border-color:#FF9800;background:#fff8f0}
.strategy-card.balanced h4{color:#e65100}
.strategy-card.aggressive{border-color:#f44336;background:#fff0f0}
.strategy-card.aggressive h4{color:#c62828}
.strategy-card.ultimate{border-color:#9C27B0;background:#f3e5f5}
.strategy-card.ultimate h4{color:#6a1b9a}
.strategy-card .price{font-size:28px;font-weight:700;margin:8px 0;color:#333}
.data-table{width:100%;border-collapse:collapse;font-size:14px;margin-top:10px}
.data-table th{background-color:#1A237E;color:#fff;padding:10px 5px;text-align:center;font-weight:900;border:1px solid #0d1b5e;vertical-align:bottom;line-height:1.2}
.data-table td{padding:10px 8px;text-align:center;border:1px solid #e0e0e0;color:#000;font-weight:600}
.data-table td:nth-child(n+3){text-align:right;font-family:'Segoe UI',monospace}
.data-table tr:nth-child(even){background-color:#f8f9fa}
.data-table tr:hover{background-color:#e8eaf6}
.data-table tfoot td{background-color:#e8eaf6;font-weight:900;color:#1A237E;border-top:2px solid #3f51b5}
.rex-analysis{background:linear-gradient(to right,#fff3e0,#ffe0b2);border-left:6px solid #ff9800;padding:20px;border-radius:8px;margin-top:25px}
.rex-title{font-size:18px;font-weight:700;color:#e65100;margin-bottom:12px}
.rex-content{color:#5d4037;line-height:1.8;font-size:14px}
.site-footer{margin-top:30px;padding:20px;background:rgba(255,255,255,.95);border-radius:10px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}
.footer-content{display:flex;flex-direction:column;align-items:center;gap:10px}
.visitor-count{font-size:13px;color:#666;display:flex;align-items:center;gap:5px}
.copyright{font-size:12px;color:#888;line-height:1.6}
@media(max-width:1200px){.evaluation-container{grid-template-columns:1fr}.input-panel{position:relative;top:0}}
@media(max-width:600px){.dimension-item{grid-template-columns:25px 1fr 60px;gap:6px;padding:8px}.weight-input input{width:40px!important}}
</style>
</head>
<body>
<div id="loading" style="position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;color:#fff;font-size:22px;font-weight:700">
<div>ğŸ”„ ç³»çµ±å•Ÿå‹•ä¸­ (v3.51)...</div>
<div style="font-size:15px;margin-top:10px;font-weight:400;opacity:.9">æ­£åœ¨æ•´åˆç«¶æ‹è³‡æ–™åº«...</div>
</div>
<div class="container" style="display:none">
<div class="header">
<h1>ğŸ¤– AIæ™ºèƒ½å¯è½‰å‚µç«¶æ‹ç³»çµ± <span class="version-badge">v3.51</span></h1>
<div class="subtitle">
<span>Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤</span>
<span style="color:#ddd">|</span>
<span id="headerSubtitle">è¼‰å…¥ä¸­...</span>
<span style="color:#ddd">|</span>
<span style="color:#9C27B0;font-size:12px">ğŸ›ï¸ å‹•æ…‹æ¬Šé‡ç‰ˆ</span>
</div>
</div>
<div class="evaluation-container">
<div class="input-panel">
<h2>ğŸ“‹ è¼¸å…¥æ¨™çš„è³‡æ–™</h2>
<form id="evaluationForm">
<div class="form-section">
<h3>ğŸ“Œ å¿…å¡«è³‡æ–™</h3>
<div class="form-group">
<label>CBåç¨± / ä»£è™Ÿ <span class="required-mark">*</span></label>
<input type="text" id="cbName" required placeholder="è¼¸å…¥ä»£è™Ÿæˆ–åç¨±">
<div id="historyResults" class="history-results"></div>
</div>
<div class="form-group">
<label>è½‰æ›åƒ¹æ ¼ (å…ƒ) <span class="required-mark">*</span></label>
<input type="number" id="conversionPrice" step="0.01" required placeholder="ä¾‹å¦‚ï¼š450">
</div>
<div class="form-group">
<label>ç«¶æ‹æˆªæ­¢æ—¥æ”¶ç›¤åƒ¹ (å…ƒ) <span class="required-mark">*</span></label>
<input type="number" id="stockPrice" step="0.01" required placeholder="ä¾‹å¦‚ï¼š461.5">
<div class="warning-box">âš ï¸ ç†è«–åƒ¹æ ¼éš¨è‚¡åƒ¹è®Šå‹•ï¼Œå»ºè­°æ–¼ 13:30 æˆªæ¨™å‰å†é€²è¡Œæœ€çµ‚è©¦ç®—</div>
</div>
<div id="theoreticalPriceDisplay" style="display:none;background:#e8f5e9;padding:12px;border-radius:8px;margin-top:10px;border-left:4px solid #4CAF50">
<span style="font-size:14px">ğŸ“Š å³æ™‚ç†è«–åƒ¹ï¼š</span>
<span id="liveTheoPrice" style="font-size:20px;font-weight:700;color:#2e7d32">-</span>
<span style="font-size:14px"> å…ƒ</span>
</div>
</div>
<div class="dimension-section">
<h3>ğŸ›ï¸ è©•ä¼°ç¶­åº¦è¨­å®š <span style="font-size:12px;font-weight:400;color:#666">ï¼ˆå‹¾é¸å•Ÿç”¨ï¼Œå¯èª¿æ•´æ¬Šé‡ï¼‰</span></h3>
<div class="dimension-header">
<span style="font-size:12px;color:#666">å·²å•Ÿç”¨ç¶­åº¦çš„æ¬Šé‡æœƒè‡ªå‹•æ­£è¦åŒ–ç‚º 100%</span>
<span id="totalWeightDisplay" class="total-weight weight-ok">æ¬Šé‡: 100%</span>
</div>
<div class="dimension-item" data-dim="industry">
<input type="checkbox" id="dim_industry_check" checked>
<div class="dimension-content">
<label>ç”¢æ¥­åˆ†é¡</label>
<select id="industry"><option value="">è¼‰å…¥ä¸­...</option></select>
<div id="industryInfo" class="info-box"></div>
</div>
<div class="weight-input"><input type="number" id="dim_industry_weight" value="25" min="0" max="100"><span>%</span></div>
</div>
<div class="dimension-item" data-dim="broker">
<input type="checkbox" id="dim_broker_check" checked>
<div class="dimension-content">
<label>ç™¼è¡Œåˆ¸å•†</label>
<select id="broker"><option value="">è¼‰å…¥ä¸­...</option></select>
<div id="brokerInfo" class="info-box"></div>
</div>
<div class="weight-input"><input type="number" id="dim_broker_weight" value="13" min="0" max="100"><span>%</span></div>
</div>
<div class="dimension-item" data-dim="capital">
<input type="checkbox" id="dim_capital_check" checked>
<div class="dimension-content">
<label>è‚¡æœ¬ (å„„å…ƒ)</label>
<input type="number" id="capital" step="0.01" placeholder="ä¾‹å¦‚ï¼š33.80">
<div id="capitalInfo" class="info-box"></div>
</div>
<div class="weight-input"><input type="number" id="dim_capital_weight" value="12" min="0" max="100"><span>%</span></div>
</div>
<div class="dimension-item" data-dim="size">
<input type="checkbox" id="dim_size_check" checked>
<div class="dimension-content">
<label>ç™¼è¡Œè¦æ¨¡ (å„„å…ƒ)</label>
<input type="number" id="issueSize" step="0.1" placeholder="ä¾‹å¦‚ï¼š30">
<div id="issueSizeInfo" class="info-box"></div>
</div>
<div class="weight-input"><input type="number" id="dim_size_weight" value="10" min="0" max="100"><span>%</span></div>
</div>
<div class="dimension-item" data-dim="rating">
<input type="checkbox" id="dim_rating_check" checked>
<div class="dimension-content">
<label>ä¿¡ç”¨è©•ç­‰ (TCRI)</label>
<select id="rating">
<option value="">ä¸æŒ‡å®š</option>
<option value="1">TCRI 1</option><option value="2">TCRI 2</option><option value="3">TCRI 3</option>
<option value="4">TCRI 4</option><option value="5">TCRI 5</option><option value="6">TCRI 6</option>
<option value="7">TCRI 7</option><option value="8">TCRI 8</option><option value="9">TCRI 9</option>
<option value="BBB">BBBç´š</option>
</select>
<div id="ratingInfo" class="info-box"></div>
</div>
<div class="weight-input"><input type="number" id="dim_rating_weight" value="15" min="0" max="100"><span>%</span></div>
</div>
<div class="dimension-item" data-dim="guarantee">
<input type="checkbox" id="dim_guarantee_check" checked>
<div class="dimension-content">
<label>æ“”ä¿æƒ…æ³</label>
<select id="guarantee">
<option value="">ä¸æŒ‡å®š</option>
<option value="æœ‰æ“”ä¿">æœ‰æ“”ä¿</option>
<option value="ç„¡æ“”ä¿">ç„¡æ“”ä¿</option>
</select>
<div id="guaranteeInfo" class="info-box"></div>
</div>
<div class="weight-input"><input type="number" id="dim_guarantee_weight" value="12" min="0" max="100"><span>%</span></div>
</div>
<div class="dimension-item" data-dim="years">
<input type="checkbox" id="dim_years_check" checked>
<div class="dimension-content">
<label>ç™¼è¡Œå¹´æœŸ</label>
<select id="years">
<option value="">ä¸æŒ‡å®š</option>
<option value="3">3å¹´æœŸ</option><option value="5">5å¹´æœŸ</option><option value="7">7å¹´æœŸ</option>
</select>
<div id="yearsInfo" class="info-box"></div>
</div>
<div class="weight-input"><input type="number" id="dim_years_weight" value="8" min="0" max="100"><span>%</span></div>
</div>
<div class="dimension-item" data-dim="conversion">
<input type="checkbox" id="dim_conversion_check" checked>
<div class="dimension-content">
<label>è½‰æ›åƒ¹å€é–“</label>
<div id="conversionRangeDisplay" style="font-size:13px;color:#667eea;font-weight:600;padding:8px 0">ä¾è½‰æ›åƒ¹æ ¼è‡ªå‹•åˆ¤æ–·</div>
<div id="conversionPriceInfo" class="info-box"></div>
</div>
<div class="weight-input"><input type="number" id="dim_conversion_weight" value="5" min="0" max="100"><span>%</span></div>
</div>
</div>
<div class="market-sentiment-section">
<div class="toggle-header" onclick="toggleMarketSentiment()">
<input type="checkbox" id="useMarketSentiment">
<label style="font-weight:700;color:#1565c0;cursor:pointer">ğŸŒ¡ï¸ ç´å…¥å¸‚å ´æ°›åœåˆ†æ</label>
<span style="font-size:11px;color:#666;margin-left:auto">ï¼ˆé¸å¡«ï¼‰</span>
</div>
<div id="marketSentimentContent" class="market-sentiment-content">
<div id="marketSentiment" style="font-size:13px;color:#444;padding:10px 0">è«‹å…ˆé¸æ“‡ã€Œæ“”ä¿æƒ…æ³ã€ä»¥é¡¯ç¤ºå¸‚å ´æ°›åœ</div>
</div>
</div>
<div class="form-section" style="background:linear-gradient(135deg,#fff9e6 0%,#ffe6cc 100%);border:2px solid #ff9800;border-radius:12px;padding:15px;margin-top:15px">
<h3 style="color:#e65100;margin-bottom:10px">âš–ï¸ ä¸»è§€èª¿æ•´ï¼ˆé¸å¡«ï¼‰</h3>
<div style="font-size:12px;color:#666;margin-bottom:10px">ğŸ’¡ è‹¥æ‚¨æœ‰ç¨åˆ°è¦‹è§£ï¼Œå¯åœ¨æ­¤æ³¨å…¥ä¸»è§€åˆ¤æ–·</div>
<div class="form-group"><label>ä¸»è§€æ¬Šé‡ (%)</label><input type="number" id="subjectiveWeight" min="0" max="100" value="0"></div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
<div class="form-group"><label>ä¸»è§€æœ€ä½æº¢åƒ¹ (%)</label><input type="number" id="subjectiveLowPremium" step="0.1" value="0"></div>
<div class="form-group"><label>ä¸»è§€å¹³å‡æº¢åƒ¹ (%)</label><input type="number" id="subjectiveAvgPremium" step="0.1" value="0"></div>
</div>
</div>
<button type="submit" class="calculate-btn">ğŸ¯ é–‹å§‹AIè©•ä¼°</button>
</form>
</div>
<div class="result-panel">
<div id="welcomeMsg" class="welcome-message">
<h2>æ­¡è¿ä½¿ç”¨AIæ™ºèƒ½ç«¶æ‹è©•ä¼°ç³»çµ±</h2>
<p style="margin-top:10px;color:#666;font-size:14px">v3.51 å‹•æ…‹æ¬Šé‡ç‰ˆ<br>âœ… åªéœ€å¡«å¯«è½‰æ›åƒ¹èˆ‡è‚¡åƒ¹å³å¯è©•ä¼°<br>âœ… è‡ªç”±é¸æ“‡è©•ä¼°ç¶­åº¦<br>âœ… å¯è‡ªè¨‚å„ç¶­åº¦æ¬Šé‡</p>
<div class="stats-summary" id="statsSummary"></div>
</div>
<div id="evaluationResult" class="evaluation-result"></div>
</div>
</div>
<footer class="site-footer">
<div class="footer-content">
<div class="visitor-count">ğŸ‘ï¸ ç€è¦½äººæ•¸ï¼š<a href="https://www.hitwebcounter.com" target="_blank"><img src="https://hitwebcounter.com/counter/counter.php?page=16839468&style=0006&nbdigits=6&type=page&initCount=0" alt="Visit counter" border="0" style="vertical-align:middle"/></a></div>
<div class="copyright">Â© 2025 Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤ ç‰ˆæ¬Šæ‰€æœ‰<br><span style="font-size:11px;color:#999">æœ¬ç³»çµ±åƒ…ä¾›åƒè€ƒï¼ŒæŠ•è³‡æœ‰é¢¨éšªï¼Œè«‹è‡ªè² ç›ˆè™§</span></div>
</div>
</footer>
</div>
<script>
if(typeof window.WEIGHT_COEFFICIENTS==='undefined')window.WEIGHT_COEFFICIENTS={};
const FIELD_ALIASES={'cbId':['CBä»£è™Ÿ','ä»£è™Ÿ','è‚¡ç¥¨ä»£è™Ÿ'],'stockId':['è‚¡ç¥¨ä»£è™Ÿ'],'name':['åç¨±','CBåç¨±','å…¬å¸åç¨±'],'openDate':['é–‹æ¨™æ—¥æœŸ','é–‹æ¨™æ—¥'],'industry':['ç”¢æ¥­åˆ†é¡','ç”¢æ¥­åˆ¥','ç”¢æ¥­'],'broker':['ç™¼è¡Œåˆ¸å•†','æ‰¿éŠ·åˆ¸å•†','ä¸»è¾¦åˆ¸å•†'],'guarantee':['æ“”ä¿','æœ‰ç„¡æ“”ä¿','æ“”ä¿æƒ…å½¢'],'rating':['ä¿¡è©•','ä¿¡ç”¨æ“”ä¿','TCRI'],'capital':['è‚¡æœ¬','è‚¡æœ¬è¦æ¨¡','è‚¡æœ¬(å„„)'],'issueSize':['ç™¼è¡Œè¦æ¨¡','ç™¼è¡Œç¸½é¡'],'years':['å¹´æœŸ','ç™¼è¡Œå¹´æœŸ'],'conversionPrice':['è½‰æ›åƒ¹','è½‰æ›åƒ¹æ ¼'],'closePrice':['æˆªæ¨™æ”¶ç›¤','æˆªæ¨™æ—¥æ”¶ç›¤'],'theoreticalPrice':['ç†è«–åƒ¹','ç†è«–åƒ¹æ ¼'],'floorPrice':['åº•æ¨™åƒ¹','åº•æ¨™'],'premiumRate':['è¨‚åƒ¹æº¢åƒ¹ç‡','æº¢åƒ¹ç‡'],'minBidPrice':['æœ€ä½å¾—æ¨™','æœ€ä½å¾—æ¨™åƒ¹æ ¼','æœ€ä½å¾—æ¨™åƒ¹'],'lowPremium':['æœ€ä½æº¢åƒ¹','æœ€ä½å¾—æ¨™åƒ¹æ ¼_æº¢åƒ¹ç‡','æœ€ä½å¾—æ¨™æº¢åƒ¹','æœ€ä½æº¢åƒ¹(%)'],'avgBidPrice':['å¹³å‡å¾—æ¨™','å¹³å‡å¾—æ¨™åƒ¹æ ¼','å¾—æ¨™åŠ æ¬Šå¹³å‡åƒ¹æ ¼','å¹³å‡å¾—æ¨™åƒ¹'],'avgPremium':['å¹³å‡æº¢åƒ¹','å¾—æ¨™åŠ æ¬Šå¹³å‡åƒ¹æ ¼_æº¢åƒ¹ç‡','å¹³å‡å¾—æ¨™æº¢åƒ¹','å¹³å‡æº¢åƒ¹(%)'],'marketHigh':['æ›ç‰Œæœ€é«˜','æ›ç‰Œæœ€é«˜åƒ¹'],'marketLow':['æ›ç‰Œæœ€ä½','æ›ç‰Œæœ€ä½åƒ¹'],'qualifiedCount':['åˆæ ¼ä»¶æ•¸','åˆæ ¼æ¨™å–®'],'bidShares':['æŠ•æ¨™å¼µæ•¸','æŠ•æ¨™ç¸½å¼µæ•¸'],'bidMultiple':['æŠ•æ¨™å€æ•¸'],'avgBidShares':['æŠ•æ¨™å‡å¼µ','å¹³å‡æŠ•æ¨™å¼µæ•¸'],'auctionShares':['ç«¶æ‹å¼µæ•¸','ç«¶æ‹ç¸½å¼µæ•¸']};
function normalizeKeys(o){const n={};Object.keys(o).forEach(k=>{n[k.trim()]=o[k]});return n}
function getSmartValue(r,k){if(!r||!FIELD_ALIASES[k])return undefined;for(let n of FIELD_ALIASES[k])if(r[n]!==undefined&&r[n]!==null&&r[n]!=='')return r[n];return undefined}
function safeFloat(v){const n=parseFloat(v);return isNaN(n)?0:n}
function safeFixed(v,d=2){const n=parseFloat(v);return isNaN(n)?'-':n.toFixed(d)}
function formatDate(v){if(!v)return'-';if(typeof v==='number'){const d=new Date((v-25569)*86400*1000);return`${d.getFullYear()}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getDate().toString().padStart(2,'0')}`}if(typeof v==='string')return v.replace(/-/g,'/');return v}
function normalizePremium(p){const v=safeFloat(p);if(v!==0&&Math.abs(v)<2)return v*100;return v}
function getWeightCoefficient(c,v){const w=window.WEIGHT_COEFFICIENTS||{};if(!w[c])return 1.0;return w[c][v]?w[c][v].coefficient:1.0}
function getRangeLabel(c,v){const n=parseFloat(v);if(isNaN(n))return v;if(c==='è‚¡æœ¬'){if(n<3)return"< 3 å„„";if(n<6)return"3~6 å„„";if(n<10)return"6~10 å„„";if(n<15)return"10~15 å„„";if(n<20)return"15~20 å„„";return"> 20 å„„"}if(c==='ç™¼è¡Œè¦æ¨¡'){if(n<2)return"< 2 å„„";if(n<5)return"2~5 å„„";if(n<10)return"5~10 å„„";if(n<15)return"10~15 å„„";if(n<20)return"15~20 å„„";return"> 20 å„„"}if(c==='è½‰æ›åƒ¹'){if(n<20)return"< 20 å…ƒ";if(n<50)return"20~50 å…ƒ";if(n<100)return"50~100 å…ƒ";if(n<150)return"100~150 å…ƒ";if(n<200)return"150~200 å…ƒ";return"> 200 å…ƒ"}return v}
let statistics={'ç¶­åº¦çµ±è¨ˆ':{'ç”¢æ¥­':{},'ç™¼è¡Œåˆ¸å•†':{}}};
let cbDatabase={},auctionRawData=[],inquiryRawData=[],globalMarketStats={low:0,avg:0},cbNameMap={};
async function loadStatistics(){const l=document.getElementById('loading');try{const r=await fetch('00_CB.xlsx');if(!r.ok)throw new Error("æ‰¾ä¸åˆ° 00_CB.xlsx");const w=XLSX.read(await r.arrayBuffer(),{type:'array'});const getSheet=(kw)=>{const n=w.SheetNames.find(x=>kw.some(k=>x.includes(k)));if(!n)return null;return XLSX.utils.sheet_to_json(w.Sheets[n]).map(row=>normalizeKeys(row))};const sa=getSheet(['04','æ‰€æœ‰CBç«¶æ‹']);const sh=getSheet(['00','æ›ç‰Œ','åç¨±éæ¿¾']);const sc=getSheet(['01','ALLCBåŸºæœ¬']);if(!sa||sa.length===0)throw new Error("æ‰¾ä¸åˆ°ç«¶æ‹è³‡æ–™");const hm={};if(sh)sh.forEach(r=>{let id=r['ä»£è™Ÿ']||r['CBä»£è™Ÿ'];if(id)hm[String(id).replace('.0','').trim()]=r});if(sc)inquiryRawData=sc.filter(r=>(r['è©¢åœˆç«¶æ‹']||'').includes('è©¢åœˆ')).map(r=>{let id=r['CBä»£è™Ÿ']||r['ä»£è™Ÿ'];if(!id)return null;const i=String(id).replace('.0','').trim();const h=hm[i]||{};return{id:i,name:getSmartValue(r,'name')||'',industry:getSmartValue(r,'industry')||'',broker:getSmartValue(r,'broker')||'',guarantee:getSmartValue(r,'guarantee')||'',rating:getSmartValue(r,'rating')||'',capital:safeFloat(getSmartValue(r,'capital')),issueSize:safeFloat(getSmartValue(r,'issueSize')),years:safeFloat(getSmartValue(r,'years')),conversionPrice:safeFloat(getSmartValue(r,'conversionPrice')),marketHigh:safeFloat(getSmartValue(h,'marketHigh'))||safeFloat(getSmartValue(r,'marketHigh')),marketLow:safeFloat(getSmartValue(h,'marketLow'))||safeFloat(getSmartValue(r,'marketLow')),premiumRate:normalizePremium(getSmartValue(r,'premiumRate')),type:'è©¢åœˆ'}}).filter(x=>x);auctionRawData=sa.map(r=>{let id=r['CBä»£è™Ÿ']||r['ä»£è™Ÿ'];if(!id)return null;const i=String(id).replace('.0','').trim();const h=hm[i]||{};return{id:i,stockId:getSmartValue(r,'stockId'),name:getSmartValue(r,'name'),openDate:getSmartValue(r,'openDate'),industry:getSmartValue(r,'industry'),broker:getSmartValue(r,'broker'),guarantee:getSmartValue(r,'guarantee'),rating:getSmartValue(r,'rating'),capital:safeFloat(getSmartValue(r,'capital')),issueSize:safeFloat(getSmartValue(r,'issueSize')),years:safeFloat(getSmartValue(r,'years')),conversionPrice:safeFloat(getSmartValue(r,'conversionPrice')),closePrice:safeFloat(getSmartValue(r,'closePrice')),theoreticalPrice:safeFloat(getSmartValue(r,'theoreticalPrice')),floorPrice:safeFloat(getSmartValue(r,'floorPrice')),premiumRate:getSmartValue(r,'premiumRate'),minBidPrice:safeFloat(getSmartValue(r,'minBidPrice')),avgBidPrice:safeFloat(getSmartValue(r,'avgBidPrice')),lowPremium:normalizePremium(getSmartValue(r,'lowPremium')),avgPremium:normalizePremium(getSmartValue(r,'avgPremium')),marketHigh:safeFloat(getSmartValue(h,'marketHigh'))||safeFloat(getSmartValue(r,'marketHigh')),marketLow:safeFloat(getSmartValue(h,'marketLow'))||safeFloat(getSmartValue(r,'marketLow')),qualifiedCount:safeFloat(getSmartValue(r,'qualifiedCount')),bidShares:safeFloat(getSmartValue(r,'bidShares')),bidMultiple:safeFloat(getSmartValue(r,'bidMultiple')),avgBidShares:safeFloat(getSmartValue(r,'avgBidShares')),auctionShares:safeFloat(getSmartValue(r,'auctionShares'))}}).filter(x=>x);auctionRawData.forEach(x=>{if(x.name){cbDatabase[x.name]=x;cbNameMap[x.name]=x}});autoGenerateStatistics();calculateGlobalMarketStats();initializeUI();l.style.display='none';document.querySelector('.container').style.display='block'}catch(e){console.error(e);l.innerHTML=`<div style="padding:20px;background:#fff;color:#D32F2F;border-radius:10px;text-align:center;max-width:400px"><h3>âš ï¸ ç³»çµ±å•Ÿå‹•å¤±æ•—</h3><p style="margin:10px 0">${e.message}</p><button onclick="location.reload()" style="padding:8px 20px;cursor:pointer">é‡è©¦</button></div>`}}
function autoGenerateStatistics(){statistics['ç¶­åº¦çµ±è¨ˆ']['ç”¢æ¥­']={};statistics['ç¶­åº¦çµ±è¨ˆ']['ç™¼è¡Œåˆ¸å•†']={};auctionRawData.forEach(r=>{if(r.industry)updateStatCategory('ç”¢æ¥­',r.industry,r);if(r.broker)updateStatCategory('ç™¼è¡Œåˆ¸å•†',r.broker,r)});['ç”¢æ¥­','ç™¼è¡Œåˆ¸å•†'].forEach(c=>{Object.keys(statistics['ç¶­åº¦çµ±è¨ˆ'][c]).forEach(k=>{const i=statistics['ç¶­åº¦çµ±è¨ˆ'][c][k];if(i.count>0){i['å¹³å‡æœ€ä½æº¢åƒ¹']=i.sumLowPrem/i.count;i['å¹³å‡æº¢åƒ¹']=i.sumAvgPrem/i.count;i['å¹³å‡æœ€ä½å¾—æ¨™åƒ¹']=i.sumLowPrice/i.count;i['å¹³å‡å¾—æ¨™åƒ¹']=i.sumAvgPrice/i.count;i['å¹³å‡æ›ç‰Œæœ€é«˜']=i.countMarket>0?i.sumHigh/i.countMarket:0;i['å¹³å‡æ›ç‰Œæœ€ä½']=i.countMarket>0?i.sumLow/i.countMarket:0;i['æ¨£æœ¬æ•¸']=i.count}})})}
function updateStatCategory(c,k,r){if(!statistics['ç¶­åº¦çµ±è¨ˆ'][c][k])statistics['ç¶­åº¦çµ±è¨ˆ'][c][k]={count:0,sumLowPrem:0,sumAvgPrem:0,sumLowPrice:0,sumAvgPrice:0,sumHigh:0,sumLow:0,countMarket:0};const o=statistics['ç¶­åº¦çµ±è¨ˆ'][c][k];if(r.minBidPrice>0||r.avgBidPrice>0){o.count++;o.sumLowPrem+=r.lowPremium;o.sumAvgPrem+=r.avgPremium;o.sumLowPrice+=r.minBidPrice;o.sumAvgPrice+=r.avgBidPrice}if(r.marketHigh>0&&r.marketLow>0){o.sumHigh+=r.marketHigh;o.sumLow+=r.marketLow;o.countMarket++}}
function calculateGlobalMarketStats(){let sL=0,sA=0,c=0;auctionRawData.forEach(d=>{if(d.minBidPrice>0){sL+=d.lowPremium;sA+=d.avgPremium;c++}});if(c>0){globalMarketStats.low=sL/c;globalMarketStats.avg=sA/c}}
function getStatsSmart(cat,val){let s={low:0,avg:0,usedFallback:false,rawData:null,inquiryData:null};let fn=null;const v=parseFloat(val);let rl="";if(cat==='è‚¡æœ¬'){if(v<3){rl="< 3 å„„";fn=d=>d.capital<3}else if(v<6){rl="3~6 å„„";fn=d=>d.capital>=3&&d.capital<6}else if(v<10){rl="6~10 å„„";fn=d=>d.capital>=6&&d.capital<10}else if(v<15){rl="10~15 å„„";fn=d=>d.capital>=10&&d.capital<15}else if(v<20){rl="15~20 å„„";fn=d=>d.capital>=15&&d.capital<20}else{rl="> 20 å„„";fn=d=>d.capital>=20}}else if(cat==='ç™¼è¡Œè¦æ¨¡'){if(v<2){rl="< 2 å„„";fn=d=>d.issueSize<2}else if(v<5){rl="2~5 å„„";fn=d=>d.issueSize>=2&&d.issueSize<5}else if(v<10){rl="5~10 å„„";fn=d=>d.issueSize>=5&&d.issueSize<10}else if(v<15){rl="10~15 å„„";fn=d=>d.issueSize>=10&&d.issueSize<15}else if(v<20){rl="15~20 å„„";fn=d=>d.issueSize>=15&&d.issueSize<20}else{rl="> 20 å„„";fn=d=>d.issueSize>=20}}else if(cat==='è½‰æ›åƒ¹'){if(v<20){rl="< 20 å…ƒ";fn=d=>d.conversionPrice<20}else if(v<50){rl="20~50 å…ƒ";fn=d=>d.conversionPrice>=20&&d.conversionPrice<50}else if(v<100){rl="50~100 å…ƒ";fn=d=>d.conversionPrice>=50&&d.conversionPrice<100}else if(v<150){rl="100~150 å…ƒ";fn=d=>d.conversionPrice>=100&&d.conversionPrice<150}else if(v<200){rl="150~200 å…ƒ";fn=d=>d.conversionPrice>=150&&d.conversionPrice<200}else{rl="> 200 å…ƒ";fn=d=>d.conversionPrice>=200}}else{const sv=String(val||"");if(sv==="")return s;if(cat==='ç™¼è¡Œåˆ¸å•†')fn=d=>(d.broker||'').includes(sv)||sv.includes(d.broker||'');else if(cat==='ç”¢æ¥­')fn=d=>d.industry===sv;else if(cat==='æ“”ä¿')fn=d=>(d.guarantee||'').includes(sv);else if(cat==='å¹´æœŸ')fn=d=>d.years==sv;else if(cat==='ä¿¡è©•')fn=d=>(d.rating||'').toString().includes(sv)}if(fn){let sLP=0,sAP=0,sLPr=0,sAPr=0,sH=0,sL=0,cM=0,c=0;auctionRawData.filter(fn).forEach(d=>{if(d.minBidPrice>0||d.avgBidPrice>0){sLP+=d.lowPremium;sAP+=d.avgPremium;sLPr+=d.minBidPrice;sAPr+=d.avgBidPrice;c++}if(d.marketHigh>0&&d.marketLow>0){sH+=d.marketHigh;sL+=d.marketLow;cM++}});if(c>0){s.rawData={'å¹³å‡æœ€ä½æº¢åƒ¹':sLP/c,'å¹³å‡æº¢åƒ¹':sAP/c,'å¹³å‡æœ€ä½å¾—æ¨™åƒ¹':sLPr/c,'å¹³å‡å¾—æ¨™åƒ¹':sAPr/c,'å¹³å‡æ›ç‰Œæœ€é«˜':cM>0?sH/cM:0,'å¹³å‡æ›ç‰Œæœ€ä½':cM>0?sL/cM:0,'æ¨£æœ¬æ•¸':c};if(rl)s.rawData['å€é–“åç¨±']=rl;s.low=s.rawData['å¹³å‡æœ€ä½æº¢åƒ¹'];s.avg=s.rawData['å¹³å‡æº¢åƒ¹']}let iH=0,iL=0,iC=0;inquiryRawData.filter(fn).forEach(d=>{if(d.marketHigh>0&&d.marketLow>0){iH+=d.marketHigh;iL+=d.marketLow;iC++}});if(iC>0)s.inquiryData={'å¹³å‡æ›ç‰Œæœ€é«˜':iH/iC,'å¹³å‡æ›ç‰Œæœ€ä½':iL/iC,'æ¨£æœ¬æ•¸':iC}}if(s.low===0&&(!s.rawData||s.rawData['å¹³å‡å¾—æ¨™åƒ¹']===0)){if(statistics['ç¶­åº¦çµ±è¨ˆ'][cat]&&statistics['ç¶­åº¦çµ±è¨ˆ'][cat][val]){s.rawData=statistics['ç¶­åº¦çµ±è¨ˆ'][cat][val];s.low=safeFloat(s.rawData['å¹³å‡æœ€ä½æº¢åƒ¹']);s.avg=safeFloat(s.rawData['å¹³å‡æº¢åƒ¹'])}if(s.low===0||isNaN(s.low)){s.low=globalMarketStats.low;s.avg=globalMarketStats.avg;s.usedFallback=true;if(!s.rawData)s.rawData={'å¹³å‡æœ€ä½æº¢åƒ¹':s.low,'å¹³å‡æº¢åƒ¹':s.avg,'æ¨£æœ¬æ•¸':'å…¨å¸‚å ´'}}}return s}
function initializeUI(){document.getElementById('headerSubtitle').textContent=`ç«¶æ‹ ${auctionRawData.length} ç­† / è©¢åœˆ ${inquiryRawData.length} ç­†`;populateSelect('industry',statistics['ç¶­åº¦çµ±è¨ˆ']['ç”¢æ¥­']);populateSelect('broker',statistics['ç¶­åº¦çµ±è¨ˆ']['ç™¼è¡Œåˆ¸å•†']);showStatsSummary();bindInputEvents();bindDimensionEvents();updateTotalWeightDisplay()}
function populateSelect(id,obj){if(!obj)return;const s=document.getElementById(id);while(s.options.length>1)s.remove(1);s.options[0].text="ä¸æŒ‡å®š";s.options[0].value="";Object.keys(obj).sort((a,b)=>(obj[b].count||0)-(obj[a].count||0)).forEach(k=>{const o=document.createElement('option');o.value=k;o.text=`${k} (${obj[k].count})`;s.add(o)})}
function showStatsSummary(){document.getElementById('statsSummary').innerHTML=`<div class="stat-box"><div class="number">${auctionRawData.filter(d=>d.minBidPrice>0).length}</div><div class="label">ç«¶æ‹æ¡ˆä¾‹</div></div><div class="stat-box"><div class="number">${inquiryRawData.length}</div><div class="label">è©¢åœˆæ¡ˆä¾‹</div></div><div class="stat-box"><div class="number">${auctionRawData.filter(d=>d.marketHigh>0).length+inquiryRawData.filter(d=>d.marketHigh>0).length}</div><div class="label">æ›ç‰Œè¡Œæƒ…</div></div>`}
function bindDimensionEvents(){document.querySelectorAll('.dimension-item input[type="checkbox"]').forEach(cb=>{cb.addEventListener('change',function(){const i=this.closest('.dimension-item');if(this.checked)i.classList.remove('disabled');else i.classList.add('disabled');updateTotalWeightDisplay()})});document.querySelectorAll('.weight-input input').forEach(i=>{i.addEventListener('input',updateTotalWeightDisplay)})}
function updateTotalWeightDisplay(){let t=0;document.querySelectorAll('.dimension-item').forEach(i=>{const c=i.querySelector('input[type="checkbox"]');const w=i.querySelector('.weight-input input');if(c&&c.checked&&w)t+=parseFloat(w.value)||0});const d=document.getElementById('totalWeightDisplay');d.textContent=`åŸå§‹æ¬Šé‡: ${t}%`;d.classList.remove('weight-ok','weight-warning','weight-error');if(t===100)d.classList.add('weight-ok');else if(t>0){d.classList.add('weight-warning');d.textContent+=' (å°‡æ­£è¦åŒ–)'}else{d.classList.add('weight-error');d.textContent='è«‹è‡³å°‘å•Ÿç”¨ä¸€å€‹ç¶­åº¦'}}
function toggleMarketSentiment(){const c=document.getElementById('useMarketSentiment');const m=document.getElementById('marketSentimentContent');c.checked=!c.checked;m.classList.toggle('active',c.checked)}
function bindInputEvents(){const show=(id,h)=>{const e=document.getElementById(id);if(!e)return;e.innerHTML=h||'';e.style.display=h?'block':'none'};const updateTheo=()=>{const s=parseFloat(document.getElementById('stockPrice').value);const c=parseFloat(document.getElementById('conversionPrice').value);const d=document.getElementById('theoreticalPriceDisplay');const p=document.getElementById('liveTheoPrice');const r=document.getElementById('conversionRangeDisplay');if(s>0&&c>0){const t=(s/c)*100;p.textContent=t.toFixed(2);d.style.display='block';r.textContent=getRangeLabel('è½‰æ›åƒ¹',c);const sr=getStatsSmart('è½‰æ›åƒ¹',c);show('conversionPriceInfo',generateStandardCard(sr.rawData,`å€é–“çµ±è¨ˆ: ${getRangeLabel('è½‰æ›åƒ¹',c)}`,sr.inquiryData))}else{d.style.display='none';r.textContent='ä¾è½‰æ›åƒ¹æ ¼è‡ªå‹•åˆ¤æ–·'}};document.getElementById('stockPrice').addEventListener('input',updateTheo);document.getElementById('conversionPrice').addEventListener('input',updateTheo);document.getElementById('cbName').addEventListener('input',function(){const v=this.value.trim();const h=document.getElementById('historyResults');if(v.length>=2){const am=auctionRawData.filter(d=>(d.id&&d.id.startsWith(v))||(d.stockId&&String(d.stockId).startsWith(v))||(d.name&&d.name.includes(v))).slice(0,8);const im=inquiryRawData.filter(d=>(d.id&&d.id.startsWith(v))||(d.name&&d.name.includes(v))).slice(0,8);let html='';if(im.length>0){html+=`<div class="history-results-title">ğŸ“‹ è©¢åœˆæ¡ˆä¾‹ (${im.length}ç­†)</div>`;im.forEach(d=>{const hi=safeFloat(d.marketHigh);const lo=safeFloat(d.marketLow);const am=(hi>0&&lo>0)?((hi-lo)/lo*100).toFixed(1):'-';let g=d.guarantee?(d.guarantee.includes('æœ‰')?'æœ‰':(d.guarantee.includes('ç„¡')?'ç„¡':d.guarantee)):'-';html+=`<div class="inquiry-card"><div class="inquiry-line1"><span class="inquiry-badge">è©¢åœˆ</span><span class="inquiry-name">${d.name||'-'} (${d.id})</span><span class="inquiry-info">è¦æ¨¡:<b>${d.issueSize>0?d.issueSize+'å„„':'-'}</b></span><span class="inquiry-info">æ“”ä¿:<b>${g}</b></span></div><div class="inquiry-line2"><span class="inquiry-info">æ›ç‰Œé«˜:<b>${hi>0?safeFixed(hi,1):'-'}</b></span><span class="inquiry-info">æ›ç‰Œä½:<b>${lo>0?safeFixed(lo,1):'-'}</b></span><span class="inquiry-info">æŒ¯å¹…:<b class="pink">${am}%</b></span></div></div>`})}if(am.length>0){html+=`<div class="history-results-title" style="margin-top:${im.length>0?'12px':'0'}">ğŸ¯ ç«¶æ‹æ¡ˆä¾‹ (${am.length}ç­†)</div>`;html+=am.map(d=>generateHistoryCard(d)).join('')}if(html){h.innerHTML=html;h.style.display='block'}else h.style.display='none'}else h.style.display='none'});const bindDim=(id,cat)=>{const handler=function(){const rv=this.value;const v=parseFloat(rv)||rv;if(v){let dt=v;if(['è‚¡æœ¬','ç™¼è¡Œè¦æ¨¡','è½‰æ›åƒ¹'].includes(cat))dt=getRangeLabel(cat,v);const sr=getStatsSmart(cat,v);show(id+'Info',generateStandardCard(sr.rawData,`å€é–“çµ±è¨ˆ: ${dt}`,sr.inquiryData))}else show(id+'Info',null)};const e=document.getElementById(id);if(e){e.addEventListener('change',handler);if(e.tagName==='INPUT')e.addEventListener('input',handler)}};bindDim('capital','è‚¡æœ¬');bindDim('issueSize','ç™¼è¡Œè¦æ¨¡');bindDim('industry','ç”¢æ¥­');bindDim('broker','ç™¼è¡Œåˆ¸å•†');bindDim('years','å¹´æœŸ');bindDim('guarantee','æ“”ä¿');bindDim('rating','ä¿¡è©•');document.getElementById('guarantee').addEventListener('change',function(){const v=this.value;const d=document.getElementById('marketSentiment');if(!v){d.innerHTML='è«‹å…ˆé¸æ“‡ã€Œæ“”ä¿æƒ…æ³ã€ä»¥é¡¯ç¤ºå¸‚å ´æ°›åœ';return}const r=auctionRawData.filter(x=>(x.guarantee||'').includes(v)).slice(-20);if(r.length===0){d.innerHTML='ç„¡ç›¸é—œæ¡ˆä¾‹';return}const ap=r.reduce((s,i)=>s+(i.avgPremium||0),0)/r.length;d.innerHTML=`<div style="font-weight:700;margin-bottom:5px">è¿‘ ${r.length} ç­†${v}æ¡ˆä¾‹</div><div>å¹³å‡æº¢åƒ¹ï¼š<span style="color:#d32f2f;font-weight:700;font-size:16px">${ap.toFixed(2)}%</span></div>`})}
function generateHistoryCard(d){const h=safeFloat(d.marketHigh);const l=safeFloat(d.marketLow);const a=(h>0&&l>0)?((h-l)/l*100).toFixed(1):'-';let g=d.guarantee||'-';if(g.includes('æœ‰'))g='æœ‰';else if(g.includes('ç„¡'))g='ç„¡';return`<div class="history-card"><div class="hc-header"><span class="hc-badge">ç«¶æ‹</span><span class="hc-name">${d.name||'-'} (${d.id})</span><span class="hc-date">${formatDate(d.openDate)}</span></div><div class="hc-line"><span class="hc-info">ç”¢æ¥­:<b>${d.industry||'-'}</b></span><span class="hc-info">è¦æ¨¡:<b>${d.issueSize>0?d.issueSize+'å„„':'-'}</b></span><span class="hc-info">æ“”ä¿:<b>${g}</b></span><span class="hc-info">ä¿¡è©•:<b>${d.rating||'-'}</b></span></div><table class="hc-table"><tr><th></th><th>å¾—æ¨™åƒ¹</th><th>æº¢åƒ¹ç‡</th><th></th><th>æ›ç‰Œåƒ¹</th><th>æŒ¯å¹…</th></tr><tr><td class="td-label">æœ€ä½</td><td>${d.minBidPrice>0?safeFixed(d.minBidPrice,2):'-'}</td><td class="val-red">${d.lowPremium!==0?safeFixed(d.lowPremium,2)+'%':'-'}</td><td class="td-label">é«˜</td><td>${h>0?safeFixed(h,1):'-'}</td><td class="val-pink" rowspan="2">${a}%</td></tr><tr><td class="td-label">å¹³å‡</td><td>${d.avgBidPrice>0?safeFixed(d.avgBidPrice,2):'-'}</td><td class="val-red">${d.avgPremium!==0?safeFixed(d.avgPremium,2)+'%':'-'}</td><td class="td-label">ä½</td><td>${l>0?safeFixed(l,1):'-'}</td></tr></table></div>`}
function generateStandardCard(data,titleOverride=null,inquiryData=null){if(!data)return`<div class="stat-row" style="color:#999">æŸ¥ç„¡è³‡æ–™</div>`;const vs=(v,s='')=>(v!==undefined&&v!==null&&v!==''&&v!==0)?`${safeFixed(v,2)}${s}`:'-';const title=data['å€é–“åç¨±']?`å€é–“çµ±è¨ˆ: ${data['å€é–“åç¨±']}`:(titleOverride||'æ­·å²çµ±è¨ˆ');const aH=safeFloat(data['å¹³å‡æ›ç‰Œæœ€é«˜']);const aL=safeFloat(data['å¹³å‡æ›ç‰Œæœ€ä½']);const aAmp=(aH>0&&aL>0)?((aH-aL)/aL*100).toFixed(1):'-';let iH=0,iL=0,iAmp='-',iCount=0;if(inquiryData){iH=safeFloat(inquiryData['å¹³å‡æ›ç‰Œæœ€é«˜']);iL=safeFloat(inquiryData['å¹³å‡æ›ç‰Œæœ€ä½']);iAmp=(iH>0&&iL>0)?((iH-iL)/iL*100).toFixed(1):'-';iCount=inquiryData['æ¨£æœ¬æ•¸']||0}const aCount=data['æ¨£æœ¬æ•¸']||0;const totalCount=(typeof aCount==='number'?aCount:0)+(typeof iCount==='number'?iCount:0);let tH=0,tL=0,tAmp='-';if(aH>0&&iH>0){tH=((aH*aCount)+(iH*iCount))/totalCount;tL=((aL*aCount)+(iL*iCount))/totalCount}else if(aH>0){tH=aH;tL=aL}else if(iH>0){tH=iH;tL=iL}if(tH>0&&tL>0)tAmp=((tH-tL)/tL*100).toFixed(1);let html=`<div class="stats-header">ğŸ“Š ${title}</div>`;if(data['æ¨£æœ¬æ•¸'])html+=`<div style="background:#f1f8e9;padding:8px;border-radius:5px;margin:8px 0"><div style="font-weight:700;color:#2e7d32;font-size:12px;margin-bottom:5px">ğŸ¯ ç«¶æ‹ (${data['æ¨£æœ¬æ•¸']}æª”)</div><div class="stat-row"><span class="stat-label">æœ€ä½å¾—æ¨™:</span><span class="stat-value">${vs(data['å¹³å‡æœ€ä½å¾—æ¨™åƒ¹'])}å…ƒ / æº¢${vs(data['å¹³å‡æœ€ä½æº¢åƒ¹'],'%')}</span></div><div class="stat-row"><span class="stat-label">å¹³å‡å¾—æ¨™:</span><span class="stat-value">${vs(data['å¹³å‡å¾—æ¨™åƒ¹'])}å…ƒ / æº¢${vs(data['å¹³å‡æº¢åƒ¹'],'%')}</span></div></div>`;const hasA=aH>0||aL>0;const hasI=iH>0||iL>0;if(hasA||hasI){html+=`<table class="card-market-table"><tr><th></th><th>æ›ç‰Œé«˜</th><th>æ›ç‰Œä½</th><th>æŒ¯å¹…</th></tr>`;if(hasA)html+=`<tr><td class="type-label">ç«¶æ‹<span class="count">${aCount}</span></td><td class="val-blue">${aH>0?safeFixed(aH,1):'-'}</td><td class="val-blue">${aL>0?safeFixed(aL,1):'-'}</td><td class="val-pink">${aAmp}%</td></tr>`;if(hasI)html+=`<tr><td class="type-label">è©¢åœˆ<span class="count">${iCount}</span></td><td class="val-blue">${iH>0?safeFixed(iH,1):'-'}</td><td class="val-blue">${iL>0?safeFixed(iL,1):'-'}</td><td class="val-pink">${iAmp}%</td></tr>`;if(hasA&&hasI)html+=`<tr class="total-row"><td class="type-label">åˆè¨ˆ<span class="count">${totalCount}</span></td><td class="val-blue">${tH>0?safeFixed(tH,1):'-'}</td><td class="val-blue">${tL>0?safeFixed(tL,1):'-'}</td><td class="val-pink">${tAmp}%</td></tr>`;html+=`</table>`}return html}
function calculateEvaluation(d){const theo=(d.stockPrice/d.conversionPrice)*100;const dimConfigs=[{k:'industry',c:'ç”¢æ¥­',checkId:'dim_industry_check',weightId:'dim_industry_weight',v:d.industry},{k:'broker',c:'ç™¼è¡Œåˆ¸å•†',checkId:'dim_broker_check',weightId:'dim_broker_weight',v:d.broker},{k:'capital',c:'è‚¡æœ¬',checkId:'dim_capital_check',weightId:'dim_capital_weight',v:d.capital},{k:'size',c:'ç™¼è¡Œè¦æ¨¡',checkId:'dim_size_check',weightId:'dim_size_weight',v:d.issueSize},{k:'rating',c:'ä¿¡è©•',checkId:'dim_rating_check',weightId:'dim_rating_weight',v:d.rating},{k:'guarantee',c:'æ“”ä¿',checkId:'dim_guarantee_check',weightId:'dim_guarantee_weight',v:d.guarantee},{k:'years',c:'å¹´æœŸ',checkId:'dim_years_check',weightId:'dim_years_weight',v:d.years},{k:'conversion',c:'è½‰æ›åƒ¹',checkId:'dim_conversion_check',weightId:'dim_conversion_weight',v:d.conversionPrice}];const activeDims=dimConfigs.filter(dim=>{const cb=document.getElementById(dim.checkId);if(!cb||!cb.checked)return false;if(typeof dim.v==='number')return dim.v>0;if(typeof dim.v==='string')return dim.v.trim()!=='';return false}).map(dim=>{const wi=document.getElementById(dim.weightId);return{...dim,w:parseFloat(wi?.value)||0}});const totalWeight=activeDims.reduce((s,x)=>s+x.w,0);if(activeDims.length===0||totalWeight===0){const fL=globalMarketStats.low;const fA=globalMarketStats.avg;const g=fA-fL;return{cbName:d.cbName,theoreticalPrice:safeFixed(theo),dimensions:{},totalLowPremium:safeFixed(fL),totalAvgPremium:safeFixed(fA),bidPrices:{conservative:safeFixed(theo*(1+fL/100)),balanced:safeFixed(theo*(1+fA/100)),aggressive:safeFixed(theo*(1+(fA+g)/100)),ultimate:safeFixed(theo*(1+(fA+g*2)/100))},inputData:d,activeDimCount:0,totalDimCount:dimConfigs.length,usedFallback:true}}let wL=0,wA=0,resDims={};activeDims.forEach(x=>{const nw=x.w/totalWeight;const s=getStatsSmart(x.c,x.v);const co=getWeightCoefficient(x.k,x.v);resDims[x.k]={...s,coefficient:co,weight:nw,originalWeight:x.w,range:x.v,weightedLow:s.low*nw*co,weightedAvg:s.avg*nw*co};if(s.rawData&&s.rawData['å€é–“åç¨±'])resDims[x.k].displayRange=s.rawData['å€é–“åç¨±'];else if(['è‚¡æœ¬','ç™¼è¡Œè¦æ¨¡','è½‰æ›åƒ¹'].includes(x.c))resDims[x.k].displayRange=getRangeLabel(x.c,x.v);else resDims[x.k].displayRange=x.v;wL+=resDims[x.k].weightedLow;wA+=resDims[x.k].weightedAvg});const subR=(d.subjectiveWeight||0)/100;const objR=1-subR;const tL=(wL*objR)+((d.subjectiveLowPremium||0)*subR);const tA=(wA*objR)+((d.subjectiveAvgPremium||0)*subR);const gap=tA-tL;return{cbName:d.cbName,theoreticalPrice:safeFixed(theo),dimensions:resDims,totalLowPremium:safeFixed(tL),totalAvgPremium:safeFixed(tA),bidPrices:{conservative:safeFixed(theo*(1+tL/100)),balanced:safeFixed(theo*(1+tA/100)),aggressive:safeFixed(theo*(1+(tA+gap)/100)),ultimate:safeFixed(theo*(1+(tA+gap*2)/100))},inputData:d,weightedSubjectiveLow:safeFixed((d.subjectiveLowPremium||0)*subR),weightedSubjectiveAvg:safeFixed((d.subjectiveAvgPremium||0)*subR),activeDimCount:activeDims.length,totalDimCount:dimConfigs.length}}
function generateRexCommentary(r){const gap=parseFloat(r.bidPrices.balanced)-parseFloat(r.theoreticalPrice);let c="";if(r.usedFallback)c="ç›®å‰ä½¿ç”¨å…¨å¸‚å ´å¹³å‡æ•¸æ“šï¼Œå»ºè­°è£œå……æ›´å¤šç¶­åº¦è³‡è¨Šä»¥æé«˜è©•ä¼°ç²¾æº–åº¦ã€‚";else if(r.activeDimCount<4)c=`ç›®å‰åƒ…ä½¿ç”¨ ${r.activeDimCount} å€‹ç¶­åº¦è©•ä¼°ï¼Œçµæœåƒ…ä¾›åˆæ­¥åƒè€ƒã€‚`;else if(gap>20)c="å¸‚å ´å°æ­¤é¡æ¨™çš„ç†±æƒ…éé«˜ï¼Œå»ºè­°åš´æ§æˆæœ¬ã€‚";else if(gap>10)c="æº¢åƒ¹åˆç†åé«˜ï¼Œé©åˆåœ¨ã€Œå¹³è¡¡ã€èˆ‡ã€Œä¿å®ˆã€é–“å°‹æ‰¾ç”œèœœé»ã€‚";else if(gap>0)c="å¸‚å ´ä¼°å€¼ç†æ€§ï¼Œå¯åƒè€ƒã€Œç©æ¥µã€ç­–ç•¥çˆ­å–ç±Œç¢¼ã€‚";else c="ä¼°å€¼åä½ï¼Œå¯èƒ½å­˜åœ¨æ’¿æ¼æ©Ÿæœƒã€‚";return`<div class="rex-analysis"><div class="rex-title">ğŸ§¢ Rexå¤§å”åˆ†æ</div><div class="rex-content"><p>${c}</p></div></div>`}
function displayResult(r){document.getElementById('welcomeMsg').style.display='none';const div=document.getElementById('evaluationResult');div.className='evaluation-result active';const cp=Math.round((r.activeDimCount/r.totalDimCount)*100);let cc,ct;if(cp>=75){cc='#4CAF50';ct='å®Œæ•´è©•ä¼°'}else if(cp>=50){cc='#FF9800';ct='åŸºç¤è©•ä¼°'}else if(cp>0){cc='#f44336';ct='ç°¡æ˜“è©•ä¼°'}else{cc='#9e9e9e';ct='å…¨å¸‚å ´åƒè€ƒ'}const nm={'industry':'ç”¢æ¥­','broker':'åˆ¸å•†','capital':'è‚¡æœ¬','size':'è¦æ¨¡','rating':'ä¿¡è©•','guarantee':'æ“”ä¿','years':'å¹´æœŸ','conversion':'è½‰åƒ¹'};let rows='';for(const[k,d]of Object.entries(r.dimensions)){const np=(d.weight*100).toFixed(1);const op=d.originalWeight||'-';rows+=`<tr><td>${nm[k]||k}</td><td>${d.displayRange||d.range}</td><td>${safeFixed(d.low)}%</td><td>${safeFixed(d.avg)}%</td><td>${op}% â†’ ${np}%</td><td>${safeFixed(d.weightedLow)}</td><td>${safeFixed(d.weightedAvg)}</td></tr>`}if(r.inputData.subjectiveWeight>0)rows+=`<tr style="background:#fff3e0"><td>ä¸»è§€</td><td>è‡ªè¨‚</td><td>${r.inputData.subjectiveLowPremium}%</td><td>${r.inputData.subjectiveAvgPremium}%</td><td>${r.inputData.subjectiveWeight}%</td><td>${r.weightedSubjectiveLow}</td><td>${r.weightedSubjectiveAvg}</td></tr>`;rows+=`<tfoot><tr><td></td><td style="text-align:right">åˆè¨ˆ</td><td>-</td><td>-</td><td>100%</td><td>${r.totalLowPremium}%</td><td>${r.totalAvgPremium}%</td></tr></tfoot>`;div.innerHTML=`<div class="result-header"><h2>${r.cbName}</h2><div>AI è©•ä¼°çµæœ</div><div class="completeness-badge" style="background:${cc}">${ct} (${r.activeDimCount}/${r.totalDimCount} ç¶­åº¦)</div></div><div style="display:flex;gap:20px;flex-wrap:wrap"><div class="detail-section" style="flex:1;min-width:280px"><h3>ğŸ“Š æ ¸å¿ƒæ•¸æ“š</h3><div style="font-size:16px;line-height:2"><div>ç†è«–åƒ¹æ ¼ï¼š<b style="color:#667eea;font-size:20px">${r.theoreticalPrice}</b> å…ƒ</div><div>é ä¼°æº¢åƒ¹ï¼š<b>${r.totalLowPremium}% ~ ${r.totalAvgPremium}%</b></div></div></div><div class="detail-section" style="flex:2;min-width:280px"><h3>ğŸ“ ç¶­åº¦æ¬Šé‡åˆ†æ</h3>${Object.keys(r.dimensions).length>0?`<div style="overflow-x:auto"><table class="data-table"><thead><tr><th>ç¶­åº¦</th><th>æ¢ä»¶</th><th>æœ€ä½<br>æº¢åƒ¹</th><th>å¹³å‡<br>æº¢åƒ¹</th><th>æ¬Šé‡</th><th>åŠ æ¬Š<br>æœ€ä½</th><th>åŠ æ¬Š<br>å¹³å‡</th></tr></thead><tbody>${rows}</tbody></table></div>`:`<div style="text-align:center;padding:20px;color:#666">æœªé¸æ“‡ä»»ä½•è©•ä¼°ç¶­åº¦ï¼Œä½¿ç”¨å…¨å¸‚å ´å¹³å‡å€¼</div>`}</div></div>${generateRexCommentary(r)}<div class="detail-section"><h3>ğŸ’¡ æŠ•æ¨™å»ºè­°åƒ¹æ ¼</h3><div class="price-grid"><div class="strategy-card conservative"><h4>ğŸ›¡ï¸ ä¿å®ˆ</h4><div class="price">${r.bidPrices.conservative}</div><div style="font-size:12px;color:#666">è¿½æ±‚é«˜å®‰å…¨é‚Šéš›</div></div><div class="strategy-card balanced"><h4>âš–ï¸ å¹³è¡¡</h4><div class="price">${r.bidPrices.balanced}</div><div style="font-size:12px;color:#666">åƒè€ƒå¸‚å ´å¹³å‡</div></div><div class="strategy-card aggressive"><h4>ğŸš€ ç©æ¥µ</h4><div class="price">${r.bidPrices.aggressive}</div><div style="font-size:12px;color:#666">é¡˜ä»˜æº¢åƒ¹å–ç±Œç¢¼</div></div><div class="strategy-card ultimate"><h4>ğŸ”¥ æ¥µè‡´</h4><div class="price">${r.bidPrices.ultimate}</div><div style="font-size:12px;color:#666">å‹¢åœ¨å¿…å¾—</div></div></div></div><div style="text-align:center;margin-top:25px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap"><button onclick="location.reload()" class="calculate-btn" style="width:180px;background:#555">ğŸ”„ é‡æ–°è©•ä¼°</button><button onclick="window.print()" class="calculate-btn" style="width:180px">ğŸ–¨ï¸ åˆ—å°å ±å‘Š</button></div>`;div.scrollIntoView({behavior:'smooth'})}
document.getElementById('evaluationForm').addEventListener('submit',function(e){e.preventDefault();try{displayResult(calculateEvaluation({cbName:document.getElementById('cbName').value||'æœªå‘½åæ¨™çš„',industry:document.getElementById('industry').value,issueSize:parseFloat(document.getElementById('issueSize').value)||0,years:document.getElementById('years').value,guarantee:document.getElementById('guarantee').value,rating:document.getElementById('rating').value,capital:parseFloat(document.getElementById('capital').value)||0,stockPrice:parseFloat(document.getElementById('stockPrice').value),conversionPrice:parseFloat(document.getElementById('conversionPrice').value),subjectiveWeight:parseFloat(document.getElementById('subjectiveWeight').value)||0,subjectiveLowPremium:parseFloat(document.getElementById('subjectiveLowPremium').value)||0,subjectiveAvgPremium:parseFloat(document.getElementById('subjectiveAvgPremium').value)||0,broker:document.getElementById('broker').value}))}catch(e){alert("âš ï¸ è¨ˆç®—éŒ¯èª¤ï¼š\n"+e.message);console.error(e)}});
window.addEventListener('DOMContentLoaded',function(){loadStatistics()});
</script>
</body>
</html>