<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AIæ™ºèƒ½å¯è½‰å‚µç«¶æ‹ç³»çµ± v3.65 (ç²¾ç°¡ç‰ˆ)</title>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<script src="embedded_data.js" onerror="console.warn('embedded_data.js not found, using defaults.')"></script>

<style>
/* ================= é¢¨æ ¼è¨­å®š ================= */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 1600px; margin: 0 auto; }
.header { background: white; border-radius: 15px; padding: 25px 30px; margin-bottom: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); border: 2px solid rgba(102, 126, 234, 0.3); border-left: 6px solid #E91E63; width: 100%; box-sizing: border-box; }
.header h1 { color: #667eea; font-size: 32px; margin-bottom: 10px; font-weight: 900; }
.header .subtitle { color: #666; font-size: 15px; display: flex; align-items: center; gap: 10px; font-weight: bold; flex-wrap: wrap; }
.version-badge { display: inline-block; background: #7B1FA2; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; margin: 8px 0 12px 0; }

.evaluation-container { display: grid; grid-template-columns: 380px 8px 1fr; gap: 0; width: 100%; }
.resizer { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); cursor: col-resize; position: relative; border-radius: 4px; transition: background 0.2s; }
.resizer:hover { background: linear-gradient(135deg, #5a6fd6 0%, #6a4190 100%); }
.resizer::before { content: "â‹®"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 18px; font-weight: bold; }
.input-panel { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); height: fit-content; position: sticky; top: 20px; border: 2px solid rgba(102, 126, 234, 0.3); border-left: 6px solid #667eea; box-sizing: border-box; }
.input-panel h2 { color: #667eea; font-size: 20px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 3px solid #667eea; font-weight: 800; }
.form-section { margin-bottom: 20px; }
.form-section h3 { color: #333; font-size: 15px; margin-bottom: 12px; font-weight: bold; border-left: 4px solid #667eea; padding-left: 10px; }
.form-group { margin-bottom: 12px; }
.form-group label { display: block; color: #555; font-size: 13px; margin-bottom: 6px; font-weight: 700; }
.form-group input, .form-group select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; font-weight: 600; color:#333; }
.form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; background: #fcfdff; }

/* è³‡è¨Šå¡ç‰‡ */
.info-box { background: #e8f5e9; padding: 12px; border-radius: 8px; border-left: 5px solid #4CAF50; margin-top: 8px; display: none; box-shadow: 0 2px 5px rgba(0,0,0,0.05); animation: slideDown 0.3s ease-out; }
@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

/* ===== æ­·å²æœå°‹çµæœå¡ç‰‡ (v3.52 æ¢ä»¶è©•ä¼°ç‰ˆ) ===== */
.history-results { 
    margin-top: 10px; 
    background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
    border: 2px solid #9c27b0; 
    border-radius: 12px; 
    padding: 18px; 
    display: none; 
    max-height: 450px; 
    overflow-y: auto;
}
.history-results-title {
    font-size: 16px;
    font-weight: bold;
    color: #6a1b9a;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 6px;
}

/* è©¢åœˆæ¡ˆä¾‹ç°¡å–®å¡ç‰‡ - å–®è¡Œç·Šæ¹Šç‰ˆ */
.inquiry-card {
    background: #fff3e0;
    border: 1px solid #ffb74d;
    border-radius: 4px;
    margin-bottom: 4px;
    padding: 6px 10px;
    font-size: 12px;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 3px 8px;
}
.inquiry-badge {
    background: #ff9800;
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: bold;
}
.inquiry-name {
    font-weight: 700;
    color: #e65100;
    font-size: 12px;
}
.inquiry-info {
    color: #555;
    white-space: nowrap;
    font-size: 11px;
}
.inquiry-info b {
    color: #333;
}
.inquiry-info b.pink {
    color: #E91E63;
}

/* å–®ç­†æ­·å²å¡ç‰‡(ç«¶æ‹) - ç·Šæ¹Šç‰ˆ */
.history-card { 
    background: #f3e5f5; 
    padding: 8px 12px; 
    border-radius: 6px; 
    margin-bottom: 6px; 
    border: 1px solid #ba68c8;
    font-size: 12px;
}
.history-card:last-child { margin-bottom: 0; }

/* å¡ç‰‡æ¨™é¡Œåˆ— */
.hc-header {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 5px;
    flex-wrap: wrap;
}
.hc-badge {
    background: #9C27B0;
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: bold;
}
.hc-name {
    font-weight: 700;
    color: #6a1b9a;
    flex: 1;
    font-size: 12px;
}
.hc-date {
    font-size: 11px;
    color: #999;
}

/* è³‡è¨Šåˆ— - æ©«å‘ç·Šæ¹Šæ’åˆ— */
.hc-line {
    display: flex;
    flex-wrap: wrap;
    gap: 3px 8px;
    margin-bottom: 5px;
}
.hc-info {
    color: #555;
    font-size: 11px;
    white-space: nowrap;
}
.hc-info b {
    color: #333;
    margin-left: 1px;
}

/* å¡ç‰‡å…§è¡¨æ ¼ - å¾—æ¨™+æ›ç‰Œåˆä½µ */
.hc-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
    margin-top: 5px;
    background: white;
    border-radius: 3px;
    overflow: hidden;
}
.hc-table th {
    background: #7B1FA2;
    color: white;
    padding: 5px 3px;
    font-weight: 700;
    text-align: center;
    font-size: 10px;
}
.hc-table td {
    padding: 5px 3px;
    text-align: center;
    border: 1px solid #e0e0e0;
    font-weight: 600;
}
.td-label {
    background: #f3e5f5;
    color: #6a1b9a;
    font-weight: 700;
    font-size: 10px;
}
.val-red { color: #d32f2f; font-weight: 700; }
.val-pink { color: #E91E63; font-weight: 900; }

/* è­¦ç¤ºèª */
.warning-box { background: #fff3e0; border-left: 4px solid #ff9800; padding: 10px; margin-top: 5px; font-size: 12px; color: #e65100; font-weight: bold; border-radius: 4px; }

/* ç¶ è‰²å¡ç‰‡å…§çš„æ›ç‰Œè¡¨æ ¼ */
.card-market-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
    margin-top: 10px;
    border-radius: 4px;
    overflow: hidden;
}
.card-market-table th {
    background: #2e7d32;
    color: white;
    padding: 6px 6px;
    font-weight: 700;
    font-size: 12px;
    text-align: center;
}
.card-market-table td {
    padding: 6px 6px;
    text-align: center;
    border-bottom: 1px solid #c8e6c9;
    background: #f1f8e9;
}
.card-market-table .type-label {
    font-weight: 700;
    color: #1b5e20;
    text-align: left;
    padding-left: 10px;
}
.card-market-table .type-label .count {
    font-size: 11px;
    color: #666;
    margin-left: 4px;
}
.card-market-table .val-blue { font-weight: 700; color: #1565c0; }
.card-market-table .val-pink { font-weight: 700; color: #E91E63; }
.card-market-table .total-row td {
    background: #c8e6c9;
    font-weight: 900;
    border-top: 2px solid #4CAF50;
}
/* v3.52 æ–°å¢ï¼šæ’é™¤å‰ä¸‰çš„æ·ºè‰²åº• */
.card-market-table .exclude-row td {
    background: #e3f2fd;
    font-style: italic;
}

/* v3.53 æ–°å¢ï¼šç«¶æ‹å¾—æ¨™è¡¨æ ¼ */
.card-bid-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    margin-top: 8px;
    border-radius: 4px;
    overflow: hidden;
}
.card-bid-table th {
    background: #2e7d32;
    color: white;
    padding: 6px 4px;
    font-weight: 700;
    font-size: 11px;
    text-align: center;
}
.card-bid-table td {
    padding: 6px 4px;
    text-align: center;
    border-bottom: 1px solid #c8e6c9;
    background: #f1f8e9;
    font-weight: 600;
}
.card-bid-table .type-label {
    font-weight: 700;
    color: #1b5e20;
    text-align: left;
    padding-left: 8px;
    white-space: nowrap;
}
.card-bid-table .type-label .count {
    font-size: 10px;
    color: #666;
    margin-left: 3px;
}
.card-bid-table .val-green { font-weight: 700; color: #2e7d32; }
.card-bid-table .val-red { font-weight: 700; color: #d32f2f; }
.card-bid-table .total-row td {
    background: #c8e6c9;
    font-weight: 900;
    border-top: 2px solid #4CAF50;
}

/* v3.58 å¸‚å ´è¶¨å‹¢åˆ†ææ¨¡çµ„ */
.market-trend-section {
    background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
    border: 2px solid #ffa000;
    border-radius: 12px;
    padding: 18px;
    margin-top: 15px;
}
.market-trend-header {
    font-size: 18px;
    font-weight: bold;
    color: #e65100;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 6px;
}
.market-trend-tabs {
    display: flex;
    gap: 6px;
    margin-bottom: 12px;
    flex-wrap: wrap;
}
.market-trend-tab {
    padding: 10px 16px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    background: #ffcc80;
    color: #e65100;
}
.market-trend-tab:hover {
    background: #ffb74d;
}
.market-trend-tab.active {
    background: #ff9800;
    color: white;
}
.market-trend-content {
    background: white;
    border-radius: 8px;
    padding: 15px;
}
.trend-year-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
    margin-bottom: 12px;
}
.trend-year-table th {
    background: #ff9800;
    color: white;
    padding: 10px 8px;
    font-weight: 700;
    text-align: center;
    font-size: 13px;
}
.trend-year-table td {
    padding: 8px;
    text-align: center;
    border-bottom: 1px solid #ffe0b2;
    font-size: 13px;
}
.trend-year-table tr:hover {
    background: #fff8e1;
}
.trend-year-table .year-cell {
    font-weight: 700;
    color: #e65100;
}
.trend-year-table .amp-high {
    color: #2e7d32;
    font-weight: 700;
}
.trend-year-table .amp-low {
    color: #c62828;
    font-weight: 700;
}
.trend-year-table .total-row {
    background: #fff3e0;
    font-weight: 900;
    border-top: 2px solid #ff9800;
}
.trend-compare-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 12px;
}
@media (max-width: 600px) {
    .trend-compare-grid {
        grid-template-columns: 1fr;
    }
}
.trend-compare-card {
    background: #fff8e1;
    border: 1px solid #ffcc80;
    border-radius: 8px;
    padding: 12px;
}
.trend-compare-card h4 {
    font-size: 14px;
    color: #e65100;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 4px;
}
.trend-compare-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    border-bottom: 1px dashed #ffe0b2;
    font-size: 13px;
}
.trend-compare-row:last-child {
    border-bottom: none;
}
.trend-compare-label {
    color: #666;
}
.trend-compare-value {
    font-weight: 700;
}
.trend-compare-value.positive {
    color: #2e7d32;
}
.trend-compare-value.negative {
    color: #c62828;
}
.trend-insight-box {
    background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
    border-left: 4px solid #e91e63;
    padding: 12px;
    margin-top: 12px;
    border-radius: 0 8px 8px 0;
    font-size: 14px;
    line-height: 1.7;
}
.trend-insight-box .insight-title {
    font-weight: 700;
    color: #ad1457;
    margin-bottom: 6px;
}
.trend-insight-box .insight-content {
    color: #880e4f;
}

/* ä¸»è§€æ¬Šé‡èªªæ˜ */
.subjective-note { background: #f5f5f5; padding: 10px; border-radius: 6px; font-size: 12px; color: #555; margin-bottom: 12px; border: 1px solid #ddd; line-height: 1.5; }

/* Footer ç‰ˆæ¬Šå®£å‘Š */
.site-footer {
    margin-top: 30px;
    padding: 20px;
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.footer-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}
.visitor-count {
    font-size: 13px;
    color: #666;
    display: flex;
    align-items: center;
    gap: 5px;
}
.copyright {
    font-size: 12px;
    color: #888;
    line-height: 1.6;
}

.stats-header { font-size: 13px; color: #2e7d32; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 5px; border-bottom: 1px solid #c8e6c9; padding-bottom: 5px; }
.stat-row { font-size: 12px; color: #444; margin-bottom: 5px; display: flex; align-items: center; justify-content: space-between; }
.stat-label { color: #555; font-weight: 500; }
.stat-value { font-weight: bold; color: #333; }

/* v3.54 å¸‚å ´ä¾›çµ¦åˆ†æå€å¡Š */
.supply-analysis {
    background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
    border: 2px solid #ffc107;
    border-radius: 12px;
    padding: 18px;
    margin-top: 15px;
}
.supply-header {
    font-size: 16px;
    font-weight: bold;
    color: #e65100;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 6px;
}
.supply-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
    background: white;
    border-radius: 6px;
    overflow: hidden;
}
.supply-table th {
    background: linear-gradient(135deg, #ff9800, #ffa726);
    color: white;
    padding: 10px 6px;
    font-weight: 700;
    text-align: center;
    font-size: 12px;
}
.supply-table td {
    padding: 8px 6px;
    text-align: center;
    border-bottom: 1px solid #ffe0b2;
    font-weight: 600;
}
.supply-table tr:hover {
    background: #fff3e0;
}
.supply-table .period-cell {
    font-weight: 700;
    color: #e65100;
    text-align: left;
    padding-left: 10px;
}
.supply-table .highlight-row {
    background: #ffebee !important;
}
.supply-table .highlight-row td {
    color: #c62828;
}
.supply-table .current-row {
    background: #e3f2fd !important;
}
.supply-table .val-high { color: #d32f2f; font-weight: 900; }
.supply-table .val-low { color: #2e7d32; font-weight: 700; }
.supply-table .val-warn { color: #ff6f00; font-weight: 700; }

.supply-warning {
    margin-top: 12px;
    padding: 12px;
    background: #ffebee;
    border-left: 4px solid #f44336;
    border-radius: 4px;
    font-size: 13px;
    color: #c62828;
    line-height: 1.6;
}
.supply-note {
    margin-top: 10px;
    font-size: 12px;
    color: #666;
    line-height: 1.5;
}

/* v3.55 å¹´åº¦ç¸¾æ•ˆæ’è¡Œå€å¡Š */
.ranking-section {
    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
    border: 2px solid #4CAF50;
    border-radius: 12px;
    padding: 18px;
    margin-top: 15px;
}
.ranking-header {
    font-size: 16px;
    font-weight: bold;
    color: #2e7d32;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 6px;
}
.ranking-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 12px;
    flex-wrap: wrap;
}
.ranking-tab {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    background: #a5d6a7;
    color: #1b5e20;
}
.ranking-tab:hover {
    background: #81c784;
}
.ranking-tab.active {
    background: #2e7d32;
    color: white;
}
.ranking-content {
    display: none;
}
.ranking-content.active {
    display: block;
}
.ranking-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.ranking-box {
    background: white;
    border-radius: 8px;
    padding: 12px;
    border: 1px solid #c8e6c9;
}
.ranking-box.top {
    border-left: 4px solid #4CAF50;
}
.ranking-box.bottom {
    border-left: 4px solid #f44336;
}
.ranking-box-title {
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 4px;
}
.ranking-box.top .ranking-box-title {
    color: #2e7d32;
}
.ranking-box.bottom .ranking-box-title {
    color: #c62828;
}
.ranking-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}
.ranking-table th {
    background: #e8f5e9;
    color: #2e7d32;
    padding: 6px 4px;
    font-weight: 700;
    text-align: center;
    border-bottom: 1px solid #c8e6c9;
    font-size: 11px;
}
.ranking-box.bottom .ranking-table th {
    background: #ffebee;
    color: #c62828;
}
.ranking-table td {
    padding: 6px 4px;
    text-align: center;
    border-bottom: 1px solid #f5f5f5;
    font-weight: 500;
}
.ranking-table td:first-child {
    text-align: center;
    font-weight: 700;
}
.ranking-table td:nth-child(2) {
    text-align: left;
    max-width: 70px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.ranking-table .rank-num {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 900;
}
.ranking-box.top .rank-num {
    background: #c8e6c9;
    color: #2e7d32;
}
.ranking-box.bottom .rank-num {
    background: #ffcdd2;
    color: #c62828;
}
.ranking-type {
    font-size: 10px;
    padding: 3px 5px;
    border-radius: 3px;
}
.ranking-type.auction {
    background: #ff9800;
    color: white;
}
.ranking-type.inquiry {
    background: #9c27b0;
    color: white;
}
.ranking-box.top .val-gain {
    color: #2e7d32;
    font-weight: 700;
}
.ranking-box.bottom .val-gain {
    color: #c62828;
    font-weight: 700;
}
.val-amp {
    color: #1565c0;
    font-weight: 600;
}
.ranking-summary {
    margin-top: 12px;
    padding: 10px;
    background: #f1f8e9;
    border-radius: 6px;
    font-size: 13px;
    color: #558b2f;
    line-height: 1.6;
}

/* v3.56 æœˆå‡æˆäº¤ç¸¾æ•ˆå€å¡Š */
.realperf-section {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border: 2px solid #2196F3;
    border-radius: 12px;
    padding: 18px;
    margin-top: 15px;
}
.realperf-header {
    font-size: 16px;
    font-weight: bold;
    color: #1565c0;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 6px;
}
.realperf-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 12px;
    flex-wrap: wrap;
}
.realperf-tab {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    background: #90caf9;
    color: #0d47a1;
}
.realperf-tab:hover {
    background: #64b5f6;
}
.realperf-tab.active {
    background: #1565c0;
    color: white;
}
.realperf-stats {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
    margin-bottom: 12px;
}
@media (max-width: 500px) {
    .realperf-stats {
        grid-template-columns: repeat(3, 1fr);
    }
}
.realperf-stat-box {
    background: white;
    border-radius: 6px;
    padding: 10px 8px;
    text-align: center;
    border: 1px solid #90caf9;
}
.realperf-stat-box.highlight {
    border: 2px solid #1565c0;
}
.realperf-stat-label {
    font-size: 11px;
    color: #666;
    margin-bottom: 4px;
}
.realperf-stat-value {
    font-size: 16px;
    font-weight: 900;
}
.realperf-stat-value.green { color: #2e7d32; }
.realperf-stat-value.blue { color: #1565c0; }
.realperf-stat-value.gray { color: #666; }
.realperf-stat-value.orange { color: #e65100; }
.realperf-stat-value.red { color: #c62828; }

.realperf-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.realperf-box {
    background: white;
    border-radius: 8px;
    padding: 12px;
    border: 1px solid #90caf9;
}
.realperf-box.top {
    border-left: 4px solid #2e7d32;
}
.realperf-box.bottom {
    border-left: 4px solid #c62828;
}
.realperf-box-title {
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 4px;
}
.realperf-box.top .realperf-box-title { color: #2e7d32; }
.realperf-box.bottom .realperf-box-title { color: #c62828; }

.realperf-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}
.realperf-table th {
    background: #e3f2fd;
    color: #1565c0;
    padding: 6px 4px;
    font-weight: 700;
    text-align: center;
    border-bottom: 1px solid #90caf9;
    font-size: 11px;
}
.realperf-box.top .realperf-table th { background: #e8f5e9; color: #2e7d32; }
.realperf-box.bottom .realperf-table th { background: #ffebee; color: #c62828; }
.realperf-table td {
    padding: 6px 4px;
    text-align: center;
    border-bottom: 1px solid #f5f5f5;
    font-weight: 500;
}
.realperf-table td:nth-child(2) {
    text-align: left;
    max-width: 65px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.realperf-pos {
    font-weight: 700;
    padding: 4px 6px;
    border-radius: 3px;
    font-size: 11px;
}
.realperf-pos.high { background: #ffcdd2; color: #c62828; }
.realperf-pos.low { background: #c8e6c9; color: #2e7d32; }

.realperf-summary {
    margin-top: 12px;
    padding: 10px;
    background: #e1f5fe;
    border-radius: 6px;
    font-size: 13px;
    color: #0277bd;
    line-height: 1.6;
}

/* v3.59 æ–°å¢ï¼šç«¶æ‹ç›ˆè™§å‹ç‡åˆ†æ */
.profitloss-section {
    background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
    border: 2px solid #e91e63;
    border-radius: 12px;
    padding: 18px;
    margin-top: 15px;
}
.profitloss-header {
    font-size: 16px;
    font-weight: bold;
    color: #ad1457;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 6px;
}
.profitloss-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 12px;
    flex-wrap: wrap;
}
.profitloss-tab {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    background: #f48fb1;
    color: #880e4f;
}
.profitloss-tab:hover {
    background: #f06292;
}
.profitloss-tab.active {
    background: #c2185b;
    color: white;
}
.profitloss-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 15px;
}
@media (max-width: 500px) {
    .profitloss-stats {
        grid-template-columns: repeat(2, 1fr);
    }
}
.profitloss-stat-box {
    background: white;
    border-radius: 8px;
    padding: 12px 10px;
    text-align: center;
    border: 1px solid #f48fb1;
}
.profitloss-stat-label {
    font-size: 11px;
    color: #666;
    margin-bottom: 5px;
}
.profitloss-stat-value {
    font-size: 18px;
    font-weight: 900;
}
.profitloss-stat-value.win { color: #c62828; }
.profitloss-stat-value.lose { color: #2e7d32; }
.profitloss-stat-value.neutral { color: #1565c0; }
.profitloss-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    background: white;
    border-radius: 6px;
    overflow: hidden;
    margin-top: 12px;
}
.profitloss-table th {
    background: #c2185b;
    color: white;
    padding: 8px 5px;
    font-weight: 700;
    text-align: center;
    font-size: 11px;
}
.profitloss-table td {
    padding: 7px 5px;
    text-align: center;
    border-bottom: 1px solid #fce4ec;
    font-weight: 600;
}
.profitloss-table tr:hover {
    background: #fce4ec;
}
.profitloss-table .year-cell {
    font-weight: 700;
    color: #ad1457;
}
.profitloss-table .val-win { color: #c62828; font-weight: 700; }
.profitloss-table .val-lose { color: #2e7d32; font-weight: 700; }
.profitloss-insight {
    margin-top: 12px;
    padding: 12px;
    background: white;
    border-left: 4px solid #e91e63;
    border-radius: 0 8px 8px 0;
    font-size: 13px;
    line-height: 1.7;
    color: #880e4f;
}

/* v3.57 ç¶­åº¦åˆ†æç¸½è¦½ - è—ç¶ è‰²ç³» */
.dimension-section {
    background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
    border: 2px solid #009688;
    border-radius: 12px;
    padding: 18px;
    margin-top: 15px;
}
.dimension-header {
    font-size: 16px;
    font-weight: bold;
    color: #00695c;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 6px;
}
.dimension-main-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 12px;
    flex-wrap: wrap;
}
.dimension-main-tab {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    background: #80cbc4;
    color: #004d40;
}
.dimension-main-tab:hover {
    background: #4db6ac;
}
.dimension-main-tab.active {
    background: #00796b;
    color: white;
}
.dimension-content {
    background: white;
    border-radius: 8px;
    padding: 15px;
}
.dimension-range-card {
    border: 1px solid #b2dfdb;
    border-radius: 8px;
    margin-bottom: 10px;
    overflow: hidden;
}
.dimension-range-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 14px;
    background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
    cursor: pointer;
    transition: background 0.2s;
}
.dimension-range-header:hover {
    background: linear-gradient(135deg, #b2dfdb 0%, #80cbc4 100%);
}
.dimension-range-title {
    font-weight: 700;
    font-size: 14px;
    color: #00695c;
    display: flex;
    align-items: center;
    gap: 8px;
}
.dimension-range-stats {
    display: flex;
    gap: 12px;
    font-size: 12px;
    color: #666;
}
.dimension-range-stats span {
    white-space: nowrap;
}
.dimension-range-stats b {
    color: #00796b;
}
.dimension-range-toggle {
    font-size: 16px;
    color: #00695c;
    transition: transform 0.3s;
}
.dimension-range-toggle.open {
    transform: rotate(180deg);
}
.dimension-range-body {
    display: none;
    padding: 12px 14px;
    background: #fff;
    border-top: 1px solid #b2dfdb;
    max-height: 300px;
    overflow-y: auto;
}
.dimension-range-body.open {
    display: block;
}
.dimension-detail-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}
.dimension-detail-table th {
    background: #e0f2f1;
    color: #00695c;
    padding: 7px 5px;
    font-weight: 700;
    text-align: center;
    border-bottom: 1px solid #b2dfdb;
    position: sticky;
    top: 0;
}
.dimension-detail-table td {
    padding: 6px 5px;
    text-align: center;
    border-bottom: 1px solid #e0f2f1;
}
.dimension-detail-table td:nth-child(2) {
    text-align: left;
    max-width: 100px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.dimension-detail-table tr:hover {
    background: #e0f2f1;
}
.dimension-type-badge {
    display: inline-block;
    padding: 2px 5px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 700;
}
.dimension-type-badge.auction {
    background: #c8e6c9;
    color: #2e7d32;
}
.dimension-type-badge.inquiry {
    background: #fff3e0;
    color: #e65100;
}
.dimension-status-badge {
    display: inline-block;
    padding: 3px 6px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 700;
}
.dimension-status-badge.listed {
    background: #e3f2fd;
    color: #1565c0;
}
.dimension-status-badge.delisted {
    background: #f5f5f5;
    color: #9e9e9e;
}
.dimension-amp-high {
    color: #2e7d32;
    font-weight: 700;
}
.dimension-amp-low {
    color: #c62828;
    font-weight: 700;
}
.dimension-summary {
    margin-top: 12px;
    padding: 10px;
    background: #e0f2f1;
    border-radius: 6px;
    font-size: 13px;
    color: #00695c;
    line-height: 1.6;
}

.calculate-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; transition: all 0.2s; margin-top: 15px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
.calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6); }

.result-panel { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); min-height: 600px; border: 2px solid rgba(102, 126, 234, 0.3); border-left: 6px solid #667eea; font-size: 15px; }
.welcome-message { text-align: center; padding: 50px 20px; }
.welcome-message h2 { font-size: 26px; margin-bottom: 15px; }
.welcome-message p { font-size: 16px !important; line-height: 1.8; }
.stats-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 30px; }
.stat-box { background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; border: 1px solid #eee; transition: transform 0.3s; }
.stat-box:hover { transform: translateY(-5px); border-color: #b39ddb; }
.stat-box .number { font-size: 36px; font-weight: bold; color: #667eea; margin-bottom: 8px; }
.stat-box .label { font-size: 15px; }

.evaluation-result { display: none; }
.evaluation-result.active { display: block; animation: fadeIn 0.5s; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

.result-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; text-align: center; }
.detail-section { background: white; border-radius: 12px; padding: 25px; margin-bottom: 20px; border: 2px solid #e0e0e0; }
.detail-section h3 { color: #667eea; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea; }

.price-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
.strategy-card { border: 2px solid; border-radius: 12px; padding: 20px; transition: transform 0.3s; }
.strategy-card:hover { transform: translateY(-5px); }
.strategy-card h4 { font-size: 16px; margin-bottom: 10px; }
.strategy-card.conservative { border-color: #4CAF50; background: #f1f8f4; }
.strategy-card.conservative h4 { color: #2e7d32; }
.strategy-card.balanced { border-color: #FF9800; background: #fff8f0; }
.strategy-card.balanced h4 { color: #e65100; }
.strategy-card.aggressive { border-color: #f44336; background: #fff0f0; }
.strategy-card.aggressive h4 { color: #c62828; }
.strategy-card.ultimate { border-color: #9C27B0; background: #f3e5f5; }
.strategy-card.ultimate h4 { color: #6a1b9a; }
.strategy-card .price { font-size: 28px; font-weight: bold; margin: 8px 0; color: #333; }

/* è¡¨æ ¼ */
.data-table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 10px; }
.data-table th { background-color: #1A237E; color: white; padding: 12px 6px; text-align: center; font-weight: 900; border: 1px solid #0d1b5e; vertical-align: bottom; line-height: 1.3; }
.data-table td { padding: 12px 10px; text-align: center; border: 1px solid #e0e0e0; color: #000; font-weight: 600; }
.data-table td:nth-child(n+3) { text-align: right; font-family: 'Segoe UI', monospace; }
.data-table tr:nth-child(even) { background-color: #f8f9fa; }
.data-table tr:hover { background-color: #e8eaf6; }
.data-table tfoot td { background-color: #e8eaf6; font-weight: 900; color: #1A237E; border-top: 2px solid #3f51b5; }

.rex-analysis { background: linear-gradient(to right, #fff3e0, #ffe0b2); border-left: 6px solid #ff9800; padding: 22px; border-radius: 8px; margin-top: 25px; }
.rex-title { font-size: 20px; font-weight: bold; color: #e65100; margin-bottom: 14px; }
.rex-content { color: #5d4037; line-height: 1.9; font-size: 15px; }

@media (max-width: 1200px) { 
    .evaluation-container { grid-template-columns: 1fr !important; display: block; } 
    .resizer { display: none; }
    .input-panel { position: relative; top: 0; } 
}

@media (max-width: 768px) {
    body { padding: 8px; }
    .container { width: 100%; max-width: 100%; padding: 0; margin: 0; }
    .header { padding: 20px; margin-bottom: 10px; border-radius: 12px; }
    .header h1 { font-size: 26px; margin-bottom: 8px; }
    .header .subtitle { font-size: 14px; }
    .version-badge { font-size: 13px; padding: 4px 12px; margin: 6px 0 10px 0; }
    .evaluation-container { display: block; }
    .input-panel { padding: 20px; border-radius: 12px; }
    .result-panel { padding: 20px; border-radius: 12px; margin-top: 10px; }
}

@media (max-width: 500px) {
    body { padding: 6px; }
    .header { padding: 18px; margin-bottom: 8px; border-radius: 10px; }
    .header h1 { font-size: 24px; margin-bottom: 6px; }
    .header .subtitle { font-size: 13px; }
    .version-badge { font-size: 12px; padding: 4px 10px; margin: 5px 0 8px 0; }
    .input-panel { padding: 18px; border-radius: 10px; }
    .result-panel { padding: 18px; border-radius: 10px; }
    .history-info-line { gap: 2px 8px; }
    .history-bid-row { flex-direction: column; gap: 6px; }
}
</style>

</head>

<body>
<div id="loading" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; font-size: 22px; font-weight: bold;">
    <div>ğŸ”„ ç³»çµ±å•Ÿå‹•ä¸­ (v3.65)...</div>
    <div id="loading-detail" style="font-size: 15px; margin-top: 10px; font-weight: normal; opacity: 0.9;">æ­£åœ¨æ•´åˆç«¶æ‹è³‡æ–™åº«...</div>
</div>

<div class="container" style="display: none;">
    <div class="header">
        <h1>ğŸ¤– AIæ™ºèƒ½å¯è½‰å‚µç«¶æ‹ç³»çµ±</h1>
        <span class="version-badge">v3.65</span>
        <div class="subtitle">
            <span>Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤</span>
            <span style="color:#ddd">|</span>
            <span id="headerSubtitle">è¼‰å…¥ä¸­...</span>
        </div>
    </div>

<div class="evaluation-container">
    <div class="input-panel" id="inputPanel">
        <h2>ğŸ“‹ è¼¸å…¥æ¨™çš„è³‡æ–™</h2>
        <form id="evaluationForm">
            <div class="form-section">
                <h3>ğŸ“Œ åŸºæœ¬è³‡æ–™</h3>
                <div class="form-group">
                    <label>CBåç¨± / ä»£è™Ÿ *</label>
                    <input type="text" id="cbName" required placeholder="è¼¸å…¥ä»£è™Ÿ(å¦‚2383)æˆ–åç¨±æœå°‹æ­·å²">
                    <div id="historyResults" class="history-results"></div>
                    <div id="cbNameInfo" class="info-box"></div>
                </div>

```
            <div class="form-group"><label>è‚¡æœ¬ (å„„å…ƒ) *</label><input type="number" id="capital" step="0.01" required placeholder="ä¾‹å¦‚ï¼š33.80"><div id="capitalInfo" class="info-box"></div></div>
            <div class="form-group"><label>ç”¢æ¥­åˆ†é¡ *</label><select id="industry" required><option value="">è¼‰å…¥ä¸­...</option></select><div id="industryInfo" class="info-box"></div></div>
            <div class="form-group"><label>ç™¼è¡Œåˆ¸å•†</label><select id="broker"><option value="">è¼‰å…¥ä¸­...</option></select><div id="brokerInfo" class="info-box"></div></div>
        </div>
        <div class="form-section">
            <h3>ğŸ’° ç™¼è¡Œæ¢ä»¶</h3>
            <div class="form-group"><label>ç™¼è¡Œè¦æ¨¡ (å„„å…ƒ) *</label><input type="number" id="issueSize" step="0.1" required placeholder="ä¾‹å¦‚ï¼š30"><div id="issueSizeInfo" class="info-box"></div></div>
            <div class="form-group"><label>è½‰æ›åƒ¹æ ¼ (å…ƒ) *</label><input type="number" id="conversionPrice" step="0.01" required placeholder="ä¾‹å¦‚ï¼š450"><div id="conversionPriceInfo" class="info-box"></div></div>
            <div class="form-group"><label>ç™¼è¡Œå¹´æœŸ *</label><select id="years" required><option value="">è«‹é¸æ“‡...</option><option value="3">3å¹´æœŸ</option><option value="5">5å¹´æœŸ</option><option value="7">7å¹´æœŸ</option></select><div id="yearsInfo" class="info-box"></div></div>
            <div class="form-group"><label>æ“”ä¿æƒ…æ³ *</label><select id="guarantee" required><option value="">è«‹é¸æ“‡...</option><option value="æœ‰æ“”ä¿">æœ‰æ“”ä¿</option><option value="ç„¡æ“”ä¿">ç„¡æ“”ä¿</option></select><div id="guaranteeInfo" class="info-box"></div></div>
            <div class="form-group"><label>ä¿¡ç”¨è©•ç­‰ (TCRI) *</label><select id="rating" required><option value="">è«‹é¸æ“‡...</option><option value="1">TCRI 1</option><option value="2">TCRI 2</option><option value="3">TCRI 3</option><option value="4">TCRI 4</option><option value="5">TCRI 5</option><option value="6">TCRI 6</option><option value="7">TCRI 7</option><option value="8">TCRI 8</option></select><div id="ratingInfo" class="info-box"></div></div>
        </div>
        <div class="form-section">
            <h3>ğŸ¯ ç«¶æ‹è³‡æ–™</h3>
            <div class="form-group">
                <label>ç«¶æ‹æˆªæ­¢æ—¥1:30æ”¶ç›¤åƒ¹æ ¼ (å…ƒ) *</label>
                <input type="number" id="stockPrice" step="0.01" required placeholder="ä¾‹å¦‚ï¼š461.5">
                <div class="warning-box">âš ï¸ ç†è«–åƒ¹æ ¼éš¨è‚¡åƒ¹è®Šå‹•ï¼Œå»ºè­°æ–¼ 13:30 æˆªæ¨™å‰å†é€²è¡Œæœ€çµ‚è©¦ç®—</div>
            </div>
        </div>
        <div class="form-section" style="background: linear-gradient(135deg, #fff9e6 0%, #ffe6cc 100%); border: 2px solid #ff9800; border-radius: 12px; padding: 15px;">
            <h3 style="color: #e65100; margin-bottom: 10px;">âš–ï¸ ä¸»è§€æ¬Šé‡(é¸å¡«)</h3>
            <div class="subjective-note">
                ğŸ’¡ é è¨­ç‚º 0 è¡¨ç¤ºå®Œå…¨ä¾æ“šæ­·å²æ•¸æ“šï¼›è‹¥æ‚¨æœ‰ç¨åˆ°è¦‹è§£ï¼Œå¯èª¿æ•´æ­¤è™•æ³¨å…¥ä¸»è§€åˆ¤æ–·ã€‚
            </div>
            <div class="form-group"><label>ä¸»è§€æ¬Šé‡ (%)</label><input type="number" id="subjectiveWeight" min="0" max="100" step="1" value="0"></div>
            <div class="form-group"><label>ä¸»è§€æœ€ä½æº¢åƒ¹ (%)</label><input type="number" id="subjectiveLowPremium" step="0.1" value="0"></div>
            <div class="form-group"><label>ä¸»è§€å¹³å‡æº¢åƒ¹ (%)</label><input type="number" id="subjectiveAvgPremium" step="0.1" value="0"></div>
        </div>
        <div class="form-section">
            <h3>ğŸ“Š è¿‘æœŸå¸‚å ´æ°›åœ</h3>
            <div id="marketSentiment" class="info-box" style="display: block; background:#e3f2fd; border-left: 4px solid #2196F3;">
                <div class="stat-row">è«‹å…ˆé¸æ“‡ã€Œæ“”ä¿æƒ…æ³ã€</div>
            </div>
        </div>
        <div id="smartReminders" style="display:none; margin: 15px 0; padding: 12px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px;">
            <div style="font-weight: bold; color: #856404; font-size: 13px;">ğŸ’¡ Rexå¤§å”æé†’</div>
            <div id="reminderContent" style="font-size: 12px; line-height: 1.7; color: #856404; margin-top:5px;"></div>
        </div>
        <button type="submit" class="calculate-btn">ğŸ¯ é–‹å§‹AIè©•ä¼°</button>
    </form>
</div>

<div class="resizer" id="resizer"></div>

<div class="result-panel" id="resultPanel">
    <div id="welcomeMsg" class="welcome-message">
        <h2>æ­¡è¿ä½¿ç”¨AIæ™ºèƒ½ç«¶æ‹è©•ä¼°ç³»çµ±</h2>
        <p style="margin-top:10px; color:#666; font-size: 14px;">v3.65 ç²¾ç°¡ç‰ˆ<br>âœ… å·¦å´å°ˆæ³¨ç«¶æ‹æ¢ä»¶ç¯©é¸<br>âœ… å³å´æ•´åˆæ‰€æœ‰çµ±è¨ˆåˆ†æ<br>âœ… ä¿¡è©•å‹•æ…‹è¨ˆç®—åŠŸèƒ½</p>
        <div class="stats-summary" id="statsSummary"></div>
        
        <!-- v3.58 å¸‚å ´è¶¨å‹¢åˆ†æ -->
        <div class="market-trend-section" id="marketTrendSection" style="margin-top:20px; text-align:left;">
            <div class="market-trend-header">ğŸ“ˆ å¸‚å ´è¶¨å‹¢åˆ†æï¼ˆè‡ªå‹•çµ±è¨ˆï¼‰</div>
            <div class="market-trend-tabs">
                <button class="market-trend-tab active" onclick="showMarketTrendTab('yearly', event)">å¹´åº¦è¶¨å‹¢</button>
                <button class="market-trend-tab" onclick="showMarketTrendTab('guarantee', event)">æ“”ä¿æ¯”è¼ƒ</button>
                <button class="market-trend-tab" onclick="showMarketTrendTab('size', event)">ç™¼è¡Œè¦æ¨¡</button>
                <button class="market-trend-tab" onclick="showMarketTrendTab('capital', event)">è‚¡æœ¬å¤§å°</button>
                <button class="market-trend-tab" onclick="showMarketTrendTab('conversion', event)">è½‰æ›åƒ¹</button>
                <button class="market-trend-tab" onclick="showMarketTrendTab('rating', event)">ä¿¡è©•</button>
                <button class="market-trend-tab" onclick="showMarketTrendTab('yearPeriod', event)">ç™¼è¡Œå¹´æœŸ</button>
                <button class="market-trend-tab" onclick="showMarketTrendTab('type', event)">ç«¶æ‹vsè©¢åœˆ</button>
                <button class="market-trend-tab" onclick="showMarketTrendTab('issueNum', event)">ç™¼è¡Œæ¬¡æ•¸</button>
                <button class="market-trend-tab" onclick="showMarketTrendTab('ky', event)">KYè‚¡åˆ†æ</button>
            </div>
            <div class="market-trend-content" id="marketTrendContent">
                è¼‰å…¥ä¸­...
            </div>
        </div>
        
        <!-- å¸‚å ´ä¾›çµ¦é‡åˆ†æ -->
        <div id="supplyAnalysis" class="supply-analysis" style="margin-top:20px; text-align:left;">
            <div class="supply-header">ğŸ“Š å¸‚å ´ä¾›çµ¦é‡åˆ†æï¼ˆå„æœŸç™¼è¡Œé‡èˆ‡æ›ç‰Œè¡¨ç¾è¶¨å‹¢ï¼‰</div>
            <div id="supplyTable">è¼‰å…¥ä¸­...</div>
        </div>
        
        <!-- å¹´åº¦ç¸¾æ•ˆæ’è¡Œæ¦œ -->
        <div id="rankingSection" class="ranking-section" style="margin-top:20px; text-align:left;">
            <div class="ranking-header">ğŸ† å¹´åº¦ç¸¾æ•ˆæ’è¡Œæ¦œï¼ˆ2022-2025å¹´æ›ç‰Œè¡¨ç¾TOP10 / BOTTOM10ï¼‰</div>
            <div class="ranking-tabs">
                <button type="button" class="ranking-tab active" onclick="showRankingYear(2022, event)">2022</button>
                <button type="button" class="ranking-tab" onclick="showRankingYear(2023, event)">2023</button>
                <button type="button" class="ranking-tab" onclick="showRankingYear(2024, event)">2024</button>
                <button type="button" class="ranking-tab" onclick="showRankingYear(2025, event)">2025</button>
            </div>
            <div id="rankingContent">è¼‰å…¥ä¸­...</div>
        </div>
        
        <!-- æœˆå‡æˆäº¤çœŸå¯¦ç¸¾æ•ˆ -->
        <div id="realperfSection" class="realperf-section" style="margin-top:20px; text-align:left;">
            <div class="realperf-header">ğŸ“ˆ æœˆå‡æˆäº¤çœŸå¯¦ç¸¾æ•ˆï¼ˆ0%=æ›ç‰Œä½, 100%=æ›ç‰Œé«˜ï¼‰</div>
            <div class="realperf-tabs">
                <button type="button" class="realperf-tab active" onclick="showRealPerfYear(2022, event)">2022</button>
                <button type="button" class="realperf-tab" onclick="showRealPerfYear(2023, event)">2023</button>
                <button type="button" class="realperf-tab" onclick="showRealPerfYear(2024, event)">2024</button>
                <button type="button" class="realperf-tab" onclick="showRealPerfYear(2025, event)">2025</button>
            </div>
            <div id="realperfContent">è¼‰å…¥ä¸­...</div>
        </div>
        
        <!-- ç«¶æ‹ç›ˆè™§å‹ç‡åˆ†æ -->
        <div id="profitlossSection" class="profitloss-section" style="margin-top:20px; text-align:left;">
            <div class="profitloss-header">ğŸ’° ç«¶æ‹ç›ˆè™§å‹ç‡åˆ†æï¼ˆä»¥å¾—æ¨™åƒ¹vsæ›ç‰Œåƒ¹è¨ˆç®—ç›ˆè™§æ©Ÿç‡ï¼‰</div>
            <div class="profitloss-tabs">
                <button type="button" class="profitloss-tab active" onclick="showProfitLossYear(2022, event)">2022</button>
                <button type="button" class="profitloss-tab" onclick="showProfitLossYear(2023, event)">2023</button>
                <button type="button" class="profitloss-tab" onclick="showProfitLossYear(2024, event)">2024</button>
                <button type="button" class="profitloss-tab" onclick="showProfitLossYear(2025, event)">2025</button>
                <button type="button" class="profitloss-tab" onclick="showProfitLossYear('all', event)">å…¨éƒ¨</button>
            </div>
            <div id="profitlossContent">è¼‰å…¥ä¸­...</div>
        </div>
        
        <!-- ç¶­åº¦åˆ†æç¸½è¦½ -->
        <div id="dimensionSection" class="dimension-section" style="margin-top:20px; text-align:left;">
            <div class="dimension-header">ğŸ“Š ç¶­åº¦åˆ†æç¸½è¦½ï¼ˆå„ç¶­åº¦å€é–“çµ±è¨ˆï¼Œé»æ“Šå±•é–‹æŸ¥çœ‹è©³ç´°æ¨™çš„ï¼‰</div>
            <div class="dimension-main-tabs">
                <button type="button" class="dimension-main-tab active" onclick="showDimensionTab('capital', event)">è‚¡æœ¬</button>
                <button type="button" class="dimension-main-tab" onclick="showDimensionTab('size', event)">è¦æ¨¡</button>
                <button type="button" class="dimension-main-tab" onclick="showDimensionTab('conversion', event)">è½‰æ›åƒ¹</button>
                <button type="button" class="dimension-main-tab" onclick="showDimensionTab('rating', event)">ä¿¡è©•</button>
                <button type="button" class="dimension-main-tab" onclick="showDimensionTab('years', event)">å¹´æœŸ</button>
                <button type="button" class="dimension-main-tab" onclick="showDimensionTab('guarantee', event)">æ“”ä¿</button>
            </div>
            <div id="dimensionContent" class="dimension-content">è¼‰å…¥ä¸­...</div>
        </div>
    </div>
    <div id="evaluationResult" class="evaluation-result"></div>
</div>
```

</div>

<!-- ç‰ˆæ¬Šå®£å‘Šèˆ‡ç€è¦½äººæ•¸ -->

<footer class="site-footer">
    <div class="footer-content">
        <div class="visitor-count">
            ğŸ‘ï¸ ç€è¦½äººæ•¸ï¼š
            <a href="https://www.hitwebcounter.com" target="_blank">
                <img src="https://hitwebcounter.com/counter/counter.php?page=16839468&style=0006&nbdigits=6&type=page&initCount=0" 
                     title="Counter Widget" alt="Visit counter" border="0" style="vertical-align: middle;"/>
            </a>
        </div>
        <div class="copyright">
            Â© 2025 Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤ ç‰ˆæ¬Šæ‰€æœ‰<br>
            <span style="font-size:11px; color:#999;">æœ¬ç³»çµ±åƒ…ä¾›åƒè€ƒï¼ŒæŠ•è³‡æœ‰é¢¨éšªï¼Œè«‹è‡ªè² ç›ˆè™§</span>
        </div>
    </div>
</footer>

</div>

<script>
// ==========================================
// 0. åˆå§‹åŒ–æ¬Šé‡ä¿‚æ•¸ï¼ˆé˜²æ­¢ embedded_data.js æœªè¼‰å…¥ï¼‰
// ==========================================
if (typeof window.WEIGHT_COEFFICIENTS === 'undefined') {
    window.WEIGHT_COEFFICIENTS = {
        'industry': {}, 
        'broker': {}, 
        'capital': {}, 
        'size': {}, 
        'rating': {}, 
        'guarantee': {}, 
        'years': {}, 
        'conversion': {}
    };
    console.warn('WEIGHT_COEFFICIENTS æœªå®šç¾©ï¼Œä½¿ç”¨é è¨­å€¼');
}

// ==========================================
// 1. æ¬„ä½è¨­å®š & å·¥å…·å‡½æ•¸
// ==========================================
const FIELD_ALIASES = {
    'cbId': ['CBä»£è™Ÿ', 'ä»£è™Ÿ', 'è‚¡ç¥¨ä»£è™Ÿ'], 
    'stockId': ['è‚¡ç¥¨ä»£è™Ÿ'],
    'name': ['åç¨±', 'CBåç¨±', 'å…¬å¸åç¨±'],
    'openDate': ['é–‹æ¨™æ—¥æœŸ', 'é–‹æ¨™æ—¥'],
    'industry': ['ç”¢æ¥­åˆ†é¡', 'ç”¢æ¥­åˆ¥', 'ç”¢æ¥­'], 
    'broker': ['ç™¼è¡Œåˆ¸å•†', 'æ‰¿éŠ·åˆ¸å•†', 'ä¸»è¾¦åˆ¸å•†'],
    'guarantee': ['æ“”ä¿', 'æœ‰ç„¡æ“”ä¿', 'æ“”ä¿æƒ…å½¢'], 
    'rating': ['ä¿¡è©•', 'ä¿¡ç”¨æ“”ä¿', 'TCRI', 'ä¿¡ç”¨è©•ç­‰'],
    'capital': ['è‚¡æœ¬å¤§å°', 'è‚¡æœ¬', 'è‚¡æœ¬è¦æ¨¡', 'è‚¡æœ¬(å„„)'], 
    'issueSize': ['ç™¼è¡Œè¦æ¨¡', 'ç™¼è¡Œç¸½é¡'],
    'years': ['å¹´æœŸ', 'ç™¼è¡Œå¹´æœŸ'], 
    'conversionPrice': ['è½‰æ›åƒ¹', 'è½‰æ›åƒ¹æ ¼'],
    'closePrice': ['æˆªæ¨™æ”¶ç›¤', 'æˆªæ¨™æ—¥æ”¶ç›¤'],
    'theoreticalPrice': ['ç†è«–åƒ¹', 'ç†è«–åƒ¹æ ¼'],
    'floorPrice': ['åº•æ¨™åƒ¹', 'åº•æ¨™'],
    'premiumRate': ['è¨‚åƒ¹æº¢åƒ¹ç‡', 'æº¢åƒ¹ç‡'],
    'minBidPrice': ['æœ€ä½å¾—æ¨™', 'æœ€ä½å¾—æ¨™åƒ¹æ ¼', 'æœ€ä½å¾—æ¨™åƒ¹'], 
    'lowPremium': ['æœ€ä½æº¢åƒ¹', 'æœ€ä½å¾—æ¨™åƒ¹æ ¼_æº¢åƒ¹ç‡', 'æœ€ä½å¾—æ¨™æº¢åƒ¹', 'æœ€ä½æº¢åƒ¹(%)'],
    'avgBidPrice': ['å¹³å‡å¾—æ¨™', 'å¹³å‡å¾—æ¨™åƒ¹æ ¼', 'å¾—æ¨™åŠ æ¬Šå¹³å‡åƒ¹æ ¼', 'å¹³å‡å¾—æ¨™åƒ¹'], 
    'avgPremium': ['å¹³å‡æº¢åƒ¹', 'å¾—æ¨™åŠ æ¬Šå¹³å‡åƒ¹æ ¼_æº¢åƒ¹ç‡', 'å¹³å‡å¾—æ¨™æº¢åƒ¹', 'å¹³å‡æº¢åƒ¹(%)'],
    'marketHigh': ['æ›ç‰Œæœ€é«˜', 'æ›ç‰Œæœ€é«˜åƒ¹'], 
    'marketLow': ['æ›ç‰Œæœ€ä½', 'æ›ç‰Œæœ€ä½åƒ¹'],
    'qualifiedCount': ['åˆæ ¼ä»¶æ•¸', 'åˆæ ¼æ¨™å–®'],
    'bidShares': ['æŠ•æ¨™å¼µæ•¸', 'æŠ•æ¨™ç¸½å¼µæ•¸'],
    'bidMultiple': ['æŠ•æ¨™å€æ•¸'],
    'avgBidShares': ['æŠ•æ¨™å‡å¼µ', 'å¹³å‡æŠ•æ¨™å¼µæ•¸'],
    'auctionShares': ['ç«¶æ‹å¼µæ•¸', 'ç«¶æ‹ç¸½å¼µæ•¸']
};

function normalizeKeys(obj) {
    const newObj = {};
    Object.keys(obj).forEach(key => { newObj[key.trim()] = obj[key]; });
    return newObj;
}

function getSmartValue(row, fieldKey) {
    if (!FIELD_ALIASES[fieldKey]) return undefined;
    for (let name of FIELD_ALIASES[fieldKey]) {
        if (row[name] !== undefined && row[name] !== null && row[name] !== '') return row[name];
    }
    return undefined;
}

function safeFloat(val) { const num = parseFloat(val); return isNaN(num) ? 0 : num; }
function safeFixed(val, digits=2) { const num = parseFloat(val); return isNaN(num) ? '-' : num.toFixed(digits); }

function formatDate(dateVal) {
    if (!dateVal) return '-';
    if (typeof dateVal === 'number') {
        const date = new Date((dateVal - 25569) * 86400 * 1000);
        return `${date.getFullYear()}/${(date.getMonth()+1).toString().padStart(2,'0')}/${date.getDate().toString().padStart(2,'0')}`;
    }
    if (typeof dateVal === 'string') {
        return dateVal.replace(/-/g, '/');
    }
    return dateVal;
}

function normalizePremium(premium) {
    const p = safeFloat(premium);
    if (p !== 0 && Math.abs(p) < 2) {
        return p * 100;
    }
    return p;
}

function getWeightCoefficient(category, value) {
    const weights = window.WEIGHT_COEFFICIENTS || {};
    if (!weights[category]) return 1.0;
    return weights[category][value] ? weights[category][value].coefficient : 1.0;
}

function getRangeLabel(category, val) {
    const v = parseFloat(val);
    if (isNaN(v)) return val;
    if (category === 'è‚¡æœ¬') {
        if (v < 3) return "< 3 å„„";
        if (v < 6) return "3~6 å„„";
        if (v < 10) return "6~10 å„„";
        if (v < 15) return "10~15 å„„";
        if (v < 20) return "15~20 å„„";
        return "> 20 å„„";
    }
    if (category === 'ç™¼è¡Œè¦æ¨¡') {
        if (v < 2) return "< 2 å„„";
        if (v < 5) return "2~5 å„„";
        if (v < 10) return "5~10 å„„";
        if (v < 15) return "10~15 å„„";
        if (v < 20) return "15~20 å„„";
        return "> 20 å„„";
    }
    if (category === 'è½‰æ›åƒ¹') {
        if (v < 20) return "< 20 å…ƒ";
        if (v < 50) return "20~50 å…ƒ";
        if (v < 100) return "50~100 å…ƒ";
        if (v < 150) return "100~150 å…ƒ";
        if (v < 200) return "150~200 å…ƒ";
        return "> 200 å…ƒ";
    }
    return val;
}

let statistics = { 'ç¶­åº¦çµ±è¨ˆ': { 'ç”¢æ¥­': {}, 'ç™¼è¡Œåˆ¸å•†': {} }, 'è³‡æ–™æœŸé–“': {} };
let cbDatabase = {}, auctionRawData = [], inquiryRawData = [], globalMarketStats = { low: 0, avg: 0 }, cbNameMap = {};
let listedSet = new Set(); // æ›ç‰Œä¸­æ¸…å–®

// ==========================================
// 2. è³‡æ–™è®€å–
// ==========================================
async function loadStatistics() {
    const loadingDiv = document.getElementById('loading');
    try {
        const response = await fetch('00_CB.xlsx');
        if (!response.ok) throw new Error("æ‰¾ä¸åˆ° 00_CB.xlsx");
        const workbook = XLSX.read(await response.arrayBuffer(), { type: 'array' });
        
        const getSheetData = (keywords) => { 
            const n = workbook.SheetNames.find(x => keywords.some(k => x.includes(k)));
            if (!n) return null;
            return XLSX.utils.sheet_to_json(workbook.Sheets[n]).map(row => normalizeKeys(row));
        };

        const sheetAuction = getSheetData(['04', 'æ‰€æœ‰CBç«¶æ‹']);
        const sheetHighLow = getSheetData(['00', 'æ›ç‰Œ', 'åç¨±éæ¿¾']);
        const sheetAllCB = getSheetData(['01', 'ALLCBåŸºæœ¬']);
        const sheetListed = getSheetData(['08']); // æ›ç‰Œä¸­æ¸…å–®
        const sheetPending = getSheetData(['06', 'ç™¼è¡Œæ¡ˆä»¶']); // v3.59 æ–°å¢ï¼šæ‰¿éŠ·é€²è¡Œä¸­
        const sheetBoard = getSheetData(['07', 'è‘£äº‹æœƒ']); // v3.59 æ–°å¢ï¼šè‘£äº‹æœƒæ±ºè­°
        const sheetCBClose = getSheetData(['09', 'æ¯é€±æ—¥è¡Œæƒ…']); // v3.62 æ–°å¢ï¼šCBæ”¶ç›¤åƒ¹
        
        if (!sheetAuction || sheetAuction.length === 0) throw new Error("æ‰¾ä¸åˆ°ç«¶æ‹è³‡æ–™åˆ†é ");

        // v3.62 æ–°å¢ï¼šå»ºç«‹CBæ”¶ç›¤åƒ¹å°ç…§è¡¨ï¼ˆå¾09å·¥ä½œè¡¨Dæ¬„ã€ŒCBæ”¶ç›¤åƒ¹ã€è®€å–ï¼‰
        window.cbClosePriceMap = {};
        if (sheetCBClose && sheetCBClose.length > 0) {
            sheetCBClose.forEach(row => {
                // Aæ¬„æ˜¯ã€Œä»£ç¢¼ã€ï¼ŒDæ¬„æ˜¯ã€ŒCBæ”¶ç›¤åƒ¹ã€
                let id = row['ä»£ç¢¼'] || row['ä»£è™Ÿ'] || row['CBä»£è™Ÿ'];
                let closePrice = row['CBæ”¶ç›¤åƒ¹'] || row['æ”¶ç›¤åƒ¹'] || row['CBæ”¶ç›¤'];
                
                if (id && closePrice) {
                    const cleanId = String(id).replace('.0', '').trim();
                    window.cbClosePriceMap[cleanId] = safeFloat(closePrice);
                }
            });
            console.log(`è¼‰å…¥CBæ”¶ç›¤åƒ¹: ${Object.keys(window.cbClosePriceMap).length} ç­†`);
        }

        // å»ºç«‹æ›ç‰Œä¸­ä»£è™ŸSetï¼ˆç”¨æ–¼åˆ¤æ–·ç‹€æ…‹ï¼‰
        if (sheetListed && sheetListed.length > 0) {
            sheetListed.forEach(row => {
                let id = row['ä»£è™Ÿ'] || row['CBä»£è™Ÿ'] || row['è‚¡ç¥¨ä»£è™Ÿ'];
                if (id) listedSet.add(String(id).replace('.0','').trim());
            });
            console.log(`è¼‰å…¥æ›ç‰Œä¸­æ¸…å–®: ${listedSet.size} ç­†`);
        }
        
        // v3.59 æ–°å¢ï¼šè™•ç†æ‰¿éŠ·é€²è¡Œä¸­è³‡æ–™
        window.pendingIssueData = [];
        if (sheetPending && sheetPending.length > 0) {
            sheetPending.forEach(row => {
                const size = safeFloat(row['ç™¼è¡Œé‡']);
                if (size > 0) {
                    window.pendingIssueData.push({
                        id: row['æ¨™çš„ä»£è™Ÿ'] || row['è‚¡ç¥¨ä»£è™Ÿ'] || '',
                        name: row['ç™¼è¡Œæ¨™çš„'] || '',
                        type: row['è©¢åœˆ/ç«¶æ‹'] || '',
                        size: size,
                        broker: row['ç™¼è¡Œåˆ¸å•†'] || '',
                        rating: row['TCRI/æ“”ä¿'] || '',
                        listDate: row['æ›ç‰Œæ—¥'] || ''
                    });
                }
            });
            console.log(`è¼‰å…¥æ‰¿éŠ·é€²è¡Œä¸­: ${window.pendingIssueData.length} ç­†, ç¸½é¡ ${window.pendingIssueData.reduce((s,d)=>s+d.size,0).toFixed(1)} å„„`);
        }
        
        // v3.59 æ–°å¢ï¼šè™•ç†è‘£äº‹æœƒæ±ºè­°è³‡æ–™
        window.boardApprovalData = [];
        if (sheetBoard && sheetBoard.length > 0) {
            sheetBoard.forEach(row => {
                const size = safeFloat(row['ç™¼è¡Œé‡']);
                if (size > 0) {
                    window.boardApprovalData.push({
                        id: row['CBä»£ç¢¼'] || row['è‚¡é°¾ä»£è™Ÿ'] || '',
                        name: row['ç™¼è¡Œæ¨™çš„'] || '',
                        type: row['è©¢åœˆ/ç«¶åƒ¹'] || '',
                        size: size,
                        broker: row['ä¸»è¾¦åˆ¸å•†'] || '',
                        rating: row['TCRI/æ“”ä¿'] || '',
                        boardDate: row['è‘£äº‹æœƒé€šé'] || ''
                    });
                }
            });
            console.log(`è¼‰å…¥è‘£äº‹æœƒæ±ºè­°: ${window.boardApprovalData.length} ç­†, ç¸½é¡ ${window.boardApprovalData.reduce((s,d)=>s+d.size,0).toFixed(1)} å„„`);
        }

        // v3.61 æ–°å¢ï¼šè®€å–CBASå ±åƒ¹è¡¨ (å·¥ä½œè¡¨11)
        const sheetCBAS = getSheetData(['11', 'CBASå ±åƒ¹']);
        window.cbasData = [];
        if (sheetCBAS && sheetCBAS.length > 0) {
            sheetCBAS.forEach(row => {
                const name = row['å¯è½‰å‚µåç¨±'];
                const code = row['å¯è½‰å‚µä»£ç¢¼'];
                if (!name || !code) return;
                
                const premium = safeFloat(row['æ¬Šåˆ©é‡‘(ä½°å…ƒå ±åƒ¹)']);
                const remainingYears = safeFloat(row['å‰©é¤˜å¹´æœŸ']);
                const discountRate = safeFloat(row['æº¢(æŠ˜)åƒ¹%']);
                const ratingRaw = row['æ“”ä¿éŠ€è¡Œ/ä¿¡ç”¨è©•ç­‰(TCRI)'] || '';
                
                // åˆ¤æ–·æ“”ä¿é¡å‹ï¼šæ•¸å­—ç‚ºTCRIç„¡æ“”ä¿ï¼Œéæ•¸å­—ç‚ºéŠ€è¡Œæœ‰æ“”ä¿
                const isGuaranteed = ratingRaw && !/^\d+$/.test(ratingRaw.trim());
                const guaranteeType = isGuaranteed ? 'guaranteed' : 'unguaranteed';
                const guaranteeDisplay = isGuaranteed ? ratingRaw : `TCRI ${ratingRaw}`;
                
                window.cbasData.push({
                    name: name,
                    code: String(code).replace('.0', ''),
                    rating: ratingRaw,
                    guaranteeType: guaranteeType,
                    guaranteeDisplay: guaranteeDisplay,
                    isGuaranteed: isGuaranteed,
                    premium: premium,
                    expiryDate: row['é¸æ“‡æ¬Šåˆ°æœŸæ—¥'] || '',
                    sellbackPrice: safeFloat(row['è³£å›åƒ¹æ ¼(A)']),
                    sellbackDate: row['è³£å›æ—¥æœŸ(B)'] || '',
                    remainingYears: remainingYears,
                    discountRateC: safeFloat(row['æŠ˜ç¾ç‡(C)']),
                    premiumRef: safeFloat(row['æ¬Šåˆ©é‡‘åƒè€ƒåƒ¹']),
                    stockPrice: safeFloat(row['ç¾è‚¡åƒè€ƒåƒ¹']),
                    conversionPrice: safeFloat(row['è½‰æ›åƒ¹æ ¼']),
                    cbConversionValue: safeFloat(row['CBè½‰æ›åƒ¹å€¼']),
                    cbRefPrice: safeFloat(row['CBåƒè€ƒåƒ¹']),
                    discountPct: discountRate,
                    volatility120: safeFloat(row['è‚¡åƒ¹æ³¢å‹•ç‡120å¤©%']),
                    volatility240: safeFloat(row['è‚¡åƒ¹æ³¢å‹•ç‡240å¤©%']),
                    remainingRatio: safeFloat(row['æµé€šé¤˜é¡å ç™¼è¡Œç¸½é¡%']),
                    issueAmount: safeFloat(row['åŸå§‹ç™¼è¡Œé‡']),
                    industry: row['ç”¢æ¥­'] || ''
                });
            });
            const guaranteedCount = window.cbasData.filter(d => d.isGuaranteed).length;
            const unguaranteedCount = window.cbasData.filter(d => !d.isGuaranteed).length;
            console.log(`è¼‰å…¥CBASå ±åƒ¹è¡¨: ${window.cbasData.length} ç­† (æœ‰æ“”ä¿${guaranteedCount}ç­†, ç„¡æ“”ä¿${unguaranteedCount}ç­†)`);
        }
        
        // v3.61 æ–°å¢ï¼šå¾01å·¥ä½œè¡¨å»ºç«‹CBè£œå……è³‡è¨Šå°ç…§è¡¨ï¼ˆåˆ¸å•†ã€è‚¡æœ¬ï¼‰
        window.cbSupplementMap = {};
        if (sheetAllCB && sheetAllCB.length > 0) {
            sheetAllCB.forEach(row => {
                const rawId = row['CBä»£è™Ÿ'] || row['ä»£è™Ÿ'];
                if (!rawId) return;
                const id = String(rawId).replace('.0', '').trim();
                window.cbSupplementMap[id] = {
                    broker: row['ç™¼è¡Œåˆ¸å•†'] || row['æ‰¿éŠ·åˆ¸å•†'] || row['ä¸»è¾¦åˆ¸å•†'] || '',
                    capital: safeFloat(row['è‚¡æœ¬å¤§å°']) || safeFloat(row['è‚¡æœ¬']),
                    issueSize: safeFloat(row['ç™¼è¡Œè¦æ¨¡']) || safeFloat(row['ç™¼è¡Œç¸½é¡'])
                };
            });
            console.log(`å»ºç«‹CBè£œå……è³‡è¨Šå°ç…§è¡¨: ${Object.keys(window.cbSupplementMap).length} ç­†`);
            
            // è£œå……CBASè³‡æ–™çš„åˆ¸å•†å’Œè‚¡æœ¬è³‡è¨Š
            if (window.cbasData && window.cbasData.length > 0) {
                let supplemented = 0;
                window.cbasData.forEach(item => {
                    const supplement = window.cbSupplementMap[item.code];
                    if (supplement) {
                        item.broker = supplement.broker;
                        item.capital = supplement.capital;
                        if (!item.issueAmount || item.issueAmount <= 0) {
                            item.issueAmount = supplement.issueSize;
                        }
                        supplemented++;
                    }
                });
                console.log(`CBASè³‡æ–™è£œå……å®Œæˆ: ${supplemented} ç­†æœ‰è£œå……åˆ¸å•†/è‚¡æœ¬è³‡è¨Š`);
            }
        }

        // å»ºç«‹æ›ç‰Œé«˜ä½å°ç…§è¡¨
        const highLowMap = {};
        if (sheetHighLow && sheetHighLow.length > 0) {
            sheetHighLow.forEach(row => {
                let id = row['ä»£è™Ÿ'] || row['CBä»£è™Ÿ'] || row['è‚¡ç¥¨ä»£è™Ÿ'];
                if(id) highLowMap[String(id).replace('.0','').trim()] = row;
            });
        }
        
        // è®€å–è©¢åœˆè³‡æ–™ (å¾01å·¥ä½œè¡¨)
        if (sheetAllCB && sheetAllCB.length > 0) {
            inquiryRawData = sheetAllCB.filter(row => {
                const type = row['è©¢åœˆç«¶æ‹'] || '';
                return type.includes('è©¢åœˆ');
            }).map(row => {
                let rawId = row['CBä»£è™Ÿ'] || row['ä»£è™Ÿ'];
                if (!rawId) return null;
                const id = String(rawId).replace('.0','').trim();
                const hlRow = highLowMap[id] || {};
                
                // è™•ç†ä¿¡è©•æ ¼å¼ï¼šå„ªå…ˆå¾00å·¥ä½œè¡¨(hlRow)è®€å–ï¼Œçµ±ä¸€è½‰ç‚ºæ•¸å­—
                let rawRating = hlRow['ä¿¡ç”¨è©•ç­‰'] || hlRow['ä¿¡è©•'] || row['ä¿¡è©•'] || row['ä¿¡ç”¨æ“”ä¿'] || '';
                let normalizedRating = '';
                if (rawRating) {
                    rawRating = String(rawRating).trim();
                    // å¦‚æœå·²ç¶“æ˜¯1-8çš„ç´”æ•¸å­—ï¼Œç›´æ¥ä½¿ç”¨
                    if (rawRating.match(/^[1-8]$/)) {
                        normalizedRating = rawRating;
                    } else {
                        const match = rawRating.match(/TCRI\s*(\d+)/i);
                        if (match) {
                            normalizedRating = match[1]; // æå–æ•¸å­—éƒ¨åˆ†
                        } else if (rawRating.match(/^\d+$/)) {
                            normalizedRating = rawRating; // å·²ç¶“æ˜¯ç´”æ•¸å­—
                        } else if (rawRating.toUpperCase().includes('BBB')) {
                            normalizedRating = 'BBB';
                        } else {
                            // æœ‰æ“”ä¿çš„æƒ…æ³ï¼Œä¿¡è©•æ¬„ä½å¯èƒ½æ˜¯éŠ€è¡Œåç¨±
                            normalizedRating = rawRating;
                        }
                    }
                }
                
                return {
                    'id': id,
                    'name': getSmartValue(row, 'name') || row['åç¨±'] || '',
                    'industry': getSmartValue(row, 'industry') || row['ç”¢æ¥­åˆ†é¡'] || '',
                    'broker': getSmartValue(row, 'broker') || row['ç™¼è¡Œåˆ¸å•†'] || row['æ‰¿éŠ·åˆ¸å•†'] || '',
                    'guarantee': getSmartValue(row, 'guarantee') || row['æ“”ä¿'] || row['æœ‰ç„¡æ“”ä¿'] || '',
                    'rating': normalizedRating,
                    'capital': safeFloat(row['è‚¡æœ¬å¤§å°']) || safeFloat(getSmartValue(row, 'capital')),
                    'issueSize': safeFloat(row['ç™¼è¡Œè¦æ¨¡']) || safeFloat(getSmartValue(row, 'issueSize')),
                    'years': safeFloat(row['ç™¼è¡Œå¹´æœŸ']) || safeFloat(getSmartValue(row, 'years')),
                    'conversionPrice': safeFloat(row['è½‰æ›åƒ¹æ ¼']) || safeFloat(getSmartValue(row, 'conversionPrice')),
                    'marketHigh': safeFloat(hlRow['æ›ç‰Œæœ€é«˜']) || safeFloat(row['æ›ç‰Œæœ€é«˜']) || 0,
                    'marketLow': safeFloat(hlRow['æ›ç‰Œæœ€ä½']) || safeFloat(row['æ›ç‰Œæœ€ä½']) || 0,
                    'premiumRate': safeFloat(row['è¨‚åƒ¹æº¢åƒ¹ç‡']) || safeFloat(getSmartValue(row, 'premiumRate')),
                    'type': 'è©¢åœˆ'
                };
            }).filter(item => item !== null);
            
            console.log(`è¼‰å…¥è©¢åœˆè³‡æ–™: ${inquiryRawData.length} ç­†`);
            // é™¤éŒ¯ï¼šæª¢æŸ¥è©¢åœˆè³‡æ–™
            const withCapital = inquiryRawData.filter(d => d.capital > 0);
            const withMarket = inquiryRawData.filter(d => d.marketHigh > 0 && d.marketLow > 0);
            console.log(`è©¢åœˆè³‡æ–™ä¸­æœ‰è‚¡æœ¬æ•¸æ“š: ${withCapital.length} ç­†`);
            console.log(`è©¢åœˆè³‡æ–™ä¸­æœ‰æ›ç‰Œæ•¸æ“š: ${withMarket.length} ç­†`);
            console.log(`00å·¥ä½œè¡¨(highLowMap)ç­†æ•¸: ${Object.keys(highLowMap).length}`);
            if (withCapital.length > 0) {
                console.log('è©¢åœˆç¯„ä¾‹(å«è‚¡æœ¬):', withCapital.slice(0, 3).map(d => ({
                    id: d.id, 
                    name: d.name, 
                    capital: d.capital,
                    marketHigh: d.marketHigh,
                    marketLow: d.marketLow
                })));
            }
            // æª¢æŸ¥ highLowMap ç¯„ä¾‹
            const hlKeys = Object.keys(highLowMap).slice(0, 3);
            console.log('highLowMapç¯„ä¾‹:', hlKeys.map(k => ({
                id: k,
                high: highLowMap[k]['æ›ç‰Œæœ€é«˜'] || highLowMap[k]['æ›ç‰Œæœ€é«˜åƒ¹'],
                low: highLowMap[k]['æ›ç‰Œæœ€ä½'] || highLowMap[k]['æ›ç‰Œæœ€ä½åƒ¹']
            })));
        }

        auctionRawData = sheetAuction.map(row => {
            let rawId = row['CBä»£è™Ÿ'] || row['ä»£è™Ÿ']; 
            if (!rawId) return null;
            
            const id = String(rawId).replace('.0','').trim();
            const hlRow = highLowMap[id] || {}; 
            
            // è™•ç†ä¿¡è©•æ ¼å¼ï¼šå„ªå…ˆå¾00å·¥ä½œè¡¨(hlRow)è®€å–ï¼Œå†å¾04å·¥ä½œè¡¨Iæ¬„è®€å–
            let rawRating = hlRow['ä¿¡ç”¨è©•ç­‰'] || hlRow['ä¿¡è©•'] || getSmartValue(row, 'rating') || '';
            let normalizedRating = '';
            if (rawRating) {
                rawRating = String(rawRating).trim();
                // å¦‚æœå·²ç¶“æ˜¯1-8çš„ç´”æ•¸å­—ï¼Œç›´æ¥ä½¿ç”¨
                if (rawRating.match(/^[1-8]$/)) {
                    normalizedRating = rawRating;
                } else {
                    const match = rawRating.match(/TCRI\s*(\d+)/i);
                    if (match) {
                        normalizedRating = match[1];
                    } else if (rawRating.match(/^\d+$/)) {
                        normalizedRating = rawRating; // å·²ç¶“æ˜¯æ•¸å­—
                    } else if (rawRating.toUpperCase().includes('BBB')) {
                        normalizedRating = 'BBB';
                    } else {
                        normalizedRating = rawRating;
                    }
                }
            }

            return {
                'id': id, 
                'stockId': getSmartValue(row, 'stockId'),
                'name': getSmartValue(row, 'name'), 
                'openDate': getSmartValue(row, 'openDate'),
                'industry': getSmartValue(row, 'industry'), 
                'broker': getSmartValue(row, 'broker'),
                'guarantee': getSmartValue(row, 'guarantee'), 
                'rating': normalizedRating,
                'capital': safeFloat(getSmartValue(row, 'capital')), 
                'issueSize': safeFloat(getSmartValue(row, 'issueSize')), 
                'years': safeFloat(getSmartValue(row, 'years')),
                'conversionPrice': safeFloat(getSmartValue(row, 'conversionPrice')),
                'closePrice': safeFloat(getSmartValue(row, 'closePrice')),
                'theoreticalPrice': safeFloat(getSmartValue(row, 'theoreticalPrice')),
                'floorPrice': safeFloat(getSmartValue(row, 'floorPrice')),
                'premiumRate': getSmartValue(row, 'premiumRate'),
                'minBidPrice': safeFloat(getSmartValue(row, 'minBidPrice')), 
                'avgBidPrice': safeFloat(getSmartValue(row, 'avgBidPrice')),
                'lowPremium': normalizePremium(getSmartValue(row, 'lowPremium')), 
                'avgPremium': normalizePremium(getSmartValue(row, 'avgPremium')),
                'marketHigh': safeFloat(getSmartValue(hlRow, 'marketHigh')) || safeFloat(getSmartValue(row, 'marketHigh')), 
                'marketLow': safeFloat(getSmartValue(hlRow, 'marketLow')) || safeFloat(getSmartValue(row, 'marketLow')),
                'qualifiedCount': safeFloat(getSmartValue(row, 'qualifiedCount')),
                'bidShares': safeFloat(getSmartValue(row, 'bidShares')),
                'bidMultiple': safeFloat(getSmartValue(row, 'bidMultiple')),
                'avgBidShares': safeFloat(getSmartValue(row, 'avgBidShares')),
                'auctionShares': safeFloat(getSmartValue(row, 'auctionShares'))
            };
        }).filter(item => item !== null);

        auctionRawData.forEach(item => { 
            if (item.name) { 
                cbDatabase[item.name] = item; 
                cbNameMap[item.name] = item; 
            } 
        });
        
        autoGenerateStatistics(); 
        calculateGlobalMarketStats(); 
        initializeUI();
        
        loadingDiv.style.display = 'none'; 
        document.querySelector('.container').style.display = 'block';
    } catch (error) { 
        console.error(error); 
        loadingDiv.innerHTML = `<div style="padding:20px;background:white;color:#D32F2F;border-radius:10px;text-align:center;max-width:400px;">
        <h3>âš ï¸ ç³»çµ±å•Ÿå‹•å¤±æ•—</h3><p style="margin:10px 0;">${error.message}</p>
        <button onclick="location.reload()" style="padding:8px 20px;cursor:pointer;">é‡è©¦</button></div>`; 
    }
}

// ==========================================
// 3. çµ±è¨ˆæ ¸å¿ƒ
// ==========================================
function autoGenerateStatistics() {
    statistics['ç¶­åº¦çµ±è¨ˆ']['ç”¢æ¥­'] = {}; 
    statistics['ç¶­åº¦çµ±è¨ˆ']['ç™¼è¡Œåˆ¸å•†'] = {};
    auctionRawData.forEach(row => {
        if (row.industry) updateStatCategory('ç”¢æ¥­', row.industry, row);
        if (row.broker) updateStatCategory('ç™¼è¡Œåˆ¸å•†', row.broker, row);
    });

    ['ç”¢æ¥­', 'ç™¼è¡Œåˆ¸å•†'].forEach(cat => {
        Object.keys(statistics['ç¶­åº¦çµ±è¨ˆ'][cat]).forEach(key => {
            const item = statistics['ç¶­åº¦çµ±è¨ˆ'][cat][key];
            if (item.count > 0) {
                item['å¹³å‡æœ€ä½æº¢åƒ¹'] = item.sumLowPrem / item.count;
                item['å¹³å‡æº¢åƒ¹'] = item.sumAvgPrem / item.count;
                item['å¹³å‡æœ€ä½å¾—æ¨™åƒ¹'] = item.sumLowPrice / item.count;
                item['å¹³å‡å¾—æ¨™åƒ¹'] = item.sumAvgPrice / item.count;
                item['å¹³å‡æ›ç‰Œæœ€é«˜'] = item.countMarket > 0 ? item.sumHigh / item.countMarket : 0;
                item['å¹³å‡æ›ç‰Œæœ€ä½'] = item.countMarket > 0 ? item.sumLow / item.countMarket : 0;
                item['æ¨£æœ¬æ•¸'] = item.count;
            }
        });
    });
}

function updateStatCategory(category, key, row) {
    if (!statistics['ç¶­åº¦çµ±è¨ˆ'][category][key]) {
        statistics['ç¶­åº¦çµ±è¨ˆ'][category][key] = { count: 0, sumLowPrem: 0, sumAvgPrem: 0, sumLowPrice: 0, sumAvgPrice: 0, sumHigh: 0, sumLow: 0, countMarket: 0 };
    }
    const obj = statistics['ç¶­åº¦çµ±è¨ˆ'][category][key];
    if (row.minBidPrice > 0 || row.avgBidPrice > 0) {
        obj.count++; 
        obj.sumLowPrem += row.lowPremium; 
        obj.sumAvgPrem += row.avgPremium;
        obj.sumLowPrice += row.minBidPrice; 
        obj.sumAvgPrice += row.avgBidPrice;
    }
    if (row.marketHigh > 0 && row.marketLow > 0) {
        obj.sumHigh += row.marketHigh; 
        obj.sumLow += row.marketLow;
        obj.countMarket++;
    }
}

function calculateGlobalMarketStats() {
    let sumLow = 0, sumAvg = 0, count = 0;
    auctionRawData.forEach(d => { 
        if (d.minBidPrice > 0) { 
            sumLow += d.lowPremium; 
            sumAvg += d.avgPremium; 
            count++; 
        } 
    });
    if (count > 0) { 
        globalMarketStats.low = sumLow / count; 
        globalMarketStats.avg = sumAvg / count; 
    }
}

// v3.52 ä¿®æ”¹ï¼šå¢åŠ æ’é™¤å‰ä¸‰é«˜çš„çµ±è¨ˆ + æ“”ä¿é¡å‹ç´°åˆ†çµ±è¨ˆ
function getStatsSmart(category, val) {
    let stats = { 
        low: 0, 
        avg: 0, 
        usedFallback: false, 
        rawData: null, 
        inquiryData: null,
        excludeTop3Data: null,
        excludeTop3InquiryData: null,
        // v3.52 æ–°å¢ï¼šä¾æ“”ä¿é¡å‹ç´°åˆ†
        guaranteedAuctionData: null,
        guaranteedInquiryData: null,
        unguaranteedAuctionData: null,
        unguaranteedInquiryData: null
    };
    let filterFn = null;
    const v = parseFloat(val);
    let rangeLabel = "";

    if (category === 'è‚¡æœ¬') {
        if (v < 3) { rangeLabel = "< 3 å„„"; filterFn = d => d.capital > 0 && d.capital < 3; }
        else if (v < 6) { rangeLabel = "3~6 å„„"; filterFn = d => d.capital >= 3 && d.capital < 6; }
        else if (v < 10) { rangeLabel = "6~10 å„„"; filterFn = d => d.capital >= 6 && d.capital < 10; }
        else if (v < 15) { rangeLabel = "10~15 å„„"; filterFn = d => d.capital >= 10 && d.capital < 15; }
        else if (v < 20) { rangeLabel = "15~20 å„„"; filterFn = d => d.capital >= 15 && d.capital < 20; }
        else { rangeLabel = "> 20 å„„"; filterFn = d => d.capital >= 20; }
    }
    else if (category === 'ç™¼è¡Œè¦æ¨¡') {
        if (v < 2) { rangeLabel = "< 2 å„„"; filterFn = d => d.issueSize < 2; }
        else if (v < 5) { rangeLabel = "2~5 å„„"; filterFn = d => d.issueSize >= 2 && d.issueSize < 5; }
        else if (v < 10) { rangeLabel = "5~10 å„„"; filterFn = d => d.issueSize >= 5 && d.issueSize < 10; }
        else if (v < 15) { rangeLabel = "10~15 å„„"; filterFn = d => d.issueSize >= 10 && d.issueSize < 15; }
        else if (v < 20) { rangeLabel = "15~20 å„„"; filterFn = d => d.issueSize >= 15 && d.issueSize < 20; }
        else { rangeLabel = "> 20 å„„"; filterFn = d => d.issueSize >= 20; }
    }
    else if (category === 'è½‰æ›åƒ¹') {
        if (v < 20) { rangeLabel = "< 20 å…ƒ"; filterFn = d => d.conversionPrice < 20; }
        else if (v < 50) { rangeLabel = "20~50 å…ƒ"; filterFn = d => d.conversionPrice >= 20 && d.conversionPrice < 50; }
        else if (v < 100) { rangeLabel = "50~100 å…ƒ"; filterFn = d => d.conversionPrice >= 50 && d.conversionPrice < 100; }
        else if (v < 150) { rangeLabel = "100~150 å…ƒ"; filterFn = d => d.conversionPrice >= 100 && d.conversionPrice < 150; }
        else if (v < 200) { rangeLabel = "150~200 å…ƒ"; filterFn = d => d.conversionPrice >= 150 && d.conversionPrice < 200; }
        else { rangeLabel = "> 200 å…ƒ"; filterFn = d => d.conversionPrice >= 200; }
    }
    else {
        const safeVal = String(val || ""); 
        if (safeVal === "") return stats;
        
        if (category === 'ç™¼è¡Œåˆ¸å•†') filterFn = d => (d.broker || '').includes(safeVal) || safeVal.includes(d.broker || '');
        else if (category === 'ç”¢æ¥­') filterFn = d => d.industry === safeVal;
        else if (category === 'æ“”ä¿') filterFn = d => (d.guarantee || '').includes(safeVal);
        else if (category === 'å¹´æœŸ') filterFn = d => d.years == safeVal;
        else if (category === 'ä¿¡è©•') {
            // ä¿¡è©•æ¯”å°ï¼šç”¨æˆ¶é¸ "5" è¦èƒ½æ¯”å°åˆ° rating ç‚º "5" æˆ– "TCRI5" çš„è³‡æ–™
            filterFn = d => {
                const rating = (d.rating || '').toString().trim();
                if (!rating) return false;
                // ç²¾ç¢ºæ¯”å°æ•¸å­—
                if (rating === safeVal) return true;
                // æ¯”å° TCRI æ ¼å¼
                if (rating.toUpperCase() === 'TCRI' + safeVal) return true;
                // BBB ç‰¹æ®Šè™•ç†
                if (safeVal === 'BBB' && rating.toUpperCase().includes('BBB')) return true;
                return false;
            };
        }
    }

    if (filterFn) {
        // === ç«¶æ‹æ•¸æ“šçµ±è¨ˆï¼ˆå…¨éƒ¨ï¼‰===
        const auctionFiltered = auctionRawData.filter(filterFn);
        let sumLowP = 0, sumAvgP = 0, sumLowPr = 0, sumAvgPr = 0, sumH = 0, sumL = 0, countM = 0, count = 0;
        
        auctionFiltered.forEach(d => {
            if (d.minBidPrice > 0 || d.avgBidPrice > 0) { 
                sumLowP += d.lowPremium; sumAvgP += d.avgPremium; 
                sumLowPr += d.minBidPrice; sumAvgPr += d.avgBidPrice; 
                count++; 
            }
            if (d.marketHigh > 0 && d.marketLow > 0) { 
                sumH += d.marketHigh; sumL += d.marketLow; countM++; 
            }
        });

        if (count > 0) {
            stats.rawData = { 
                'å¹³å‡æœ€ä½æº¢åƒ¹': sumLowP / count, 
                'å¹³å‡æº¢åƒ¹': sumAvgP / count, 
                'å¹³å‡æœ€ä½å¾—æ¨™åƒ¹': sumLowPr / count, 
                'å¹³å‡å¾—æ¨™åƒ¹': sumAvgPr / count,
                'å¹³å‡æ›ç‰Œæœ€é«˜': countM > 0 ? sumH / countM : 0, 
                'å¹³å‡æ›ç‰Œæœ€ä½': countM > 0 ? sumL / countM : 0, 
                'æ¨£æœ¬æ•¸': count 
            };
            if(rangeLabel) stats.rawData['å€é–“åç¨±'] = rangeLabel; 
            stats.low = stats.rawData['å¹³å‡æœ€ä½æº¢åƒ¹']; 
            stats.avg = stats.rawData['å¹³å‡æº¢åƒ¹'];
        }
        
        // === v3.52 æ–°å¢ï¼šç«¶æ‹æ’é™¤å‰ä¸‰é«˜çš„è¨ˆç®— ===
        const auctionWithMarket = auctionFiltered.filter(d => d.marketHigh > 0 && d.marketLow > 0);
        if (auctionWithMarket.length > 3) {
            // æŒ‰æ›ç‰Œæœ€é«˜æ’åºï¼Œæ’é™¤å‰ä¸‰å
            const sortedAuction = [...auctionWithMarket].sort((a, b) => b.marketHigh - a.marketHigh);
            const excludedAuction = sortedAuction.slice(3);
            
            let exSumH = 0, exSumL = 0;
            excludedAuction.forEach(d => {
                exSumH += d.marketHigh;
                exSumL += d.marketLow;
            });
            
            stats.excludeTop3Data = {
                'å¹³å‡æ›ç‰Œæœ€é«˜': exSumH / excludedAuction.length,
                'å¹³å‡æ›ç‰Œæœ€ä½': exSumL / excludedAuction.length,
                'æ¨£æœ¬æ•¸': excludedAuction.length
            };
        }
        
        // === è©¢åœˆæ•¸æ“šçµ±è¨ˆï¼ˆå…¨éƒ¨ï¼‰===
        const inquiryFiltered = inquiryRawData.filter(filterFn);
        console.log(`[${category}=${val}] è©¢åœˆç¯©é¸çµæœ: ${inquiryFiltered.length} ç­† (åŸå§‹: ${inquiryRawData.length} ç­†)`);
        
        let iSumH = 0, iSumL = 0, iCountM = 0;
        
        inquiryFiltered.forEach(d => {
            if (d.marketHigh > 0 && d.marketLow > 0) { 
                iSumH += d.marketHigh; iSumL += d.marketLow; iCountM++; 
            }
        });
        
        console.log(`[${category}=${val}] è©¢åœˆæœ‰æ›ç‰Œæ•¸æ“š: ${iCountM} ç­†`);
        
        if (iCountM > 0) {
            stats.inquiryData = {
                'å¹³å‡æ›ç‰Œæœ€é«˜': iSumH / iCountM,
                'å¹³å‡æ›ç‰Œæœ€ä½': iSumL / iCountM,
                'æ¨£æœ¬æ•¸': iCountM
            };
        }
        
        // === v3.52 æ–°å¢ï¼šè©¢åœˆæ’é™¤å‰ä¸‰é«˜çš„è¨ˆç®— ===
        const inquiryWithMarket = inquiryFiltered.filter(d => d.marketHigh > 0 && d.marketLow > 0);
        if (inquiryWithMarket.length > 3) {
            const sortedInquiry = [...inquiryWithMarket].sort((a, b) => b.marketHigh - a.marketHigh);
            const excludedInquiry = sortedInquiry.slice(3);
            
            let exISumH = 0, exISumL = 0;
            excludedInquiry.forEach(d => {
                exISumH += d.marketHigh;
                exISumL += d.marketLow;
            });
            
            stats.excludeTop3InquiryData = {
                'å¹³å‡æ›ç‰Œæœ€é«˜': exISumH / excludedInquiry.length,
                'å¹³å‡æ›ç‰Œæœ€ä½': exISumL / excludedInquiry.length,
                'æ¨£æœ¬æ•¸': excludedInquiry.length
            };
        }
        
        // === v3.53 ä¿®æ”¹ï¼šä¾æ“”ä¿é¡å‹ç´°åˆ†çµ±è¨ˆï¼ˆå«å¾—æ¨™æ•¸æ“šï¼‰===
        // æœ‰æ“”ä¿ - ç«¶æ‹
        const guaranteedAuction = auctionFiltered.filter(d => (d.guarantee || '').includes('æœ‰'));
        if (guaranteedAuction.length > 0) {
            let gaSumH = 0, gaSumL = 0, gaCountM = 0;
            let gaSumLowP = 0, gaSumAvgP = 0, gaSumLowPr = 0, gaSumAvgPr = 0, gaCountBid = 0;
            guaranteedAuction.forEach(d => {
                if (d.marketHigh > 0 && d.marketLow > 0) {
                    gaSumH += d.marketHigh;
                    gaSumL += d.marketLow;
                    gaCountM++;
                }
                if (d.minBidPrice > 0 || d.avgBidPrice > 0) {
                    gaSumLowP += d.lowPremium;
                    gaSumAvgP += d.avgPremium;
                    gaSumLowPr += d.minBidPrice;
                    gaSumAvgPr += d.avgBidPrice;
                    gaCountBid++;
                }
            });
            stats.guaranteedAuctionData = {
                'å¹³å‡æ›ç‰Œæœ€é«˜': gaCountM > 0 ? gaSumH / gaCountM : 0,
                'å¹³å‡æ›ç‰Œæœ€ä½': gaCountM > 0 ? gaSumL / gaCountM : 0,
                'æ¨£æœ¬æ•¸': gaCountM,
                'å¹³å‡æœ€ä½å¾—æ¨™åƒ¹': gaCountBid > 0 ? gaSumLowPr / gaCountBid : 0,
                'å¹³å‡æœ€ä½æº¢åƒ¹': gaCountBid > 0 ? gaSumLowP / gaCountBid : 0,
                'å¹³å‡å¾—æ¨™åƒ¹': gaCountBid > 0 ? gaSumAvgPr / gaCountBid : 0,
                'å¹³å‡æº¢åƒ¹': gaCountBid > 0 ? gaSumAvgP / gaCountBid : 0,
                'å¾—æ¨™æ¨£æœ¬æ•¸': gaCountBid
            };
        }
        
        // æœ‰æ“”ä¿ - è©¢åœˆ
        const guaranteedInquiry = inquiryFiltered.filter(d => (d.guarantee || '').includes('æœ‰'));
        if (guaranteedInquiry.length > 0) {
            let giSumH = 0, giSumL = 0, giCountM = 0;
            guaranteedInquiry.forEach(d => {
                if (d.marketHigh > 0 && d.marketLow > 0) {
                    giSumH += d.marketHigh;
                    giSumL += d.marketLow;
                    giCountM++;
                }
            });
            if (giCountM > 0) {
                stats.guaranteedInquiryData = {
                    'å¹³å‡æ›ç‰Œæœ€é«˜': giSumH / giCountM,
                    'å¹³å‡æ›ç‰Œæœ€ä½': giSumL / giCountM,
                    'æ¨£æœ¬æ•¸': giCountM
                };
            }
        }
        
        // ç„¡æ“”ä¿ - ç«¶æ‹
        const unguaranteedAuction = auctionFiltered.filter(d => (d.guarantee || '').includes('ç„¡'));
        if (unguaranteedAuction.length > 0) {
            let uaSumH = 0, uaSumL = 0, uaCountM = 0;
            let uaSumLowP = 0, uaSumAvgP = 0, uaSumLowPr = 0, uaSumAvgPr = 0, uaCountBid = 0;
            unguaranteedAuction.forEach(d => {
                if (d.marketHigh > 0 && d.marketLow > 0) {
                    uaSumH += d.marketHigh;
                    uaSumL += d.marketLow;
                    uaCountM++;
                }
                if (d.minBidPrice > 0 || d.avgBidPrice > 0) {
                    uaSumLowP += d.lowPremium;
                    uaSumAvgP += d.avgPremium;
                    uaSumLowPr += d.minBidPrice;
                    uaSumAvgPr += d.avgBidPrice;
                    uaCountBid++;
                }
            });
            stats.unguaranteedAuctionData = {
                'å¹³å‡æ›ç‰Œæœ€é«˜': uaCountM > 0 ? uaSumH / uaCountM : 0,
                'å¹³å‡æ›ç‰Œæœ€ä½': uaCountM > 0 ? uaSumL / uaCountM : 0,
                'æ¨£æœ¬æ•¸': uaCountM,
                'å¹³å‡æœ€ä½å¾—æ¨™åƒ¹': uaCountBid > 0 ? uaSumLowPr / uaCountBid : 0,
                'å¹³å‡æœ€ä½æº¢åƒ¹': uaCountBid > 0 ? uaSumLowP / uaCountBid : 0,
                'å¹³å‡å¾—æ¨™åƒ¹': uaCountBid > 0 ? uaSumAvgPr / uaCountBid : 0,
                'å¹³å‡æº¢åƒ¹': uaCountBid > 0 ? uaSumAvgP / uaCountBid : 0,
                'å¾—æ¨™æ¨£æœ¬æ•¸': uaCountBid
            };
        }
        
        // ç„¡æ“”ä¿ - è©¢åœˆ
        const unguaranteedInquiry = inquiryFiltered.filter(d => (d.guarantee || '').includes('ç„¡'));
        if (unguaranteedInquiry.length > 0) {
            let uiSumH = 0, uiSumL = 0, uiCountM = 0;
            unguaranteedInquiry.forEach(d => {
                if (d.marketHigh > 0 && d.marketLow > 0) {
                    uiSumH += d.marketHigh;
                    uiSumL += d.marketLow;
                    uiCountM++;
                }
            });
            if (uiCountM > 0) {
                stats.unguaranteedInquiryData = {
                    'å¹³å‡æ›ç‰Œæœ€é«˜': uiSumH / uiCountM,
                    'å¹³å‡æ›ç‰Œæœ€ä½': uiSumL / uiCountM,
                    'æ¨£æœ¬æ•¸': uiCountM
                };
            }
        }
    }
    
    if (stats.low === 0 && (!stats.rawData || stats.rawData['å¹³å‡å¾—æ¨™åƒ¹'] === 0)) { 
        if (statistics['ç¶­åº¦çµ±è¨ˆ'][category] && statistics['ç¶­åº¦çµ±è¨ˆ'][category][val]) {
            stats.rawData = statistics['ç¶­åº¦çµ±è¨ˆ'][category][val]; 
            stats.low = safeFloat(stats.rawData['å¹³å‡æœ€ä½æº¢åƒ¹']); 
            stats.avg = safeFloat(stats.rawData['å¹³å‡æº¢åƒ¹']);
        } 
        
        if (stats.low === 0 || isNaN(stats.low)) {
            stats.low = globalMarketStats.low; 
            stats.avg = globalMarketStats.avg; 
            stats.usedFallback = true; 
            if(!stats.rawData) stats.rawData = { 'å¹³å‡æœ€ä½æº¢åƒ¹': stats.low, 'å¹³å‡æº¢åƒ¹': stats.avg, 'æ¨£æœ¬æ•¸': 'å…¨å¸‚å ´' };
        }
    }
    return stats;
}

// ==========================================
// 4. UI é¡¯ç¤º
// ==========================================

// v3.62 å¼·åŒ–ç‰ˆï¼šæ­·å²æœå°‹å¡ç‰‡ç”Ÿæˆï¼ˆåŠ å…¥CBæ”¶ç›¤åƒ¹ï¼‰
function generateHistoryCard(d) {
    const h = safeFloat(d.marketHigh);
    const l = safeFloat(d.marketLow);
    const amp = (h > 0 && l > 0) ? ((h - l) / l * 100).toFixed(1) : '-';
    
    const premium = safeFloat(d.premiumRate);
    const premiumStr = premium > 0 ? (premium < 2 ? (premium * 100).toFixed(1) : premium.toFixed(1)) : '-';
    
    let guarantee = d.guarantee || '-';
    if (guarantee.includes('æœ‰')) guarantee = 'æœ‰';
    else if (guarantee.includes('ç„¡')) guarantee = 'ç„¡';
    
    // v3.62 æ–°å¢ï¼šå–å¾—CBæ”¶ç›¤åƒ¹
    const cbClosePrice = window.cbClosePriceMap ? window.cbClosePriceMap[d.id] : null;
    const cbClosePriceStr = cbClosePrice > 0 ? safeFixed(cbClosePrice, 2) : '-';
    
    return `
    <div class="history-card">
        <div class="hc-header">
            <span class="hc-badge">ç«¶æ‹</span>
            <span class="hc-name">${d.name || '-'} (${d.id})</span>
            <span class="hc-date">${formatDate(d.openDate)}</span>
        </div>
        
        <div class="hc-line">
            <span class="hc-info">ç”¢æ¥­:<b>${d.industry || '-'}</b></span>
            <span class="hc-info">è¦æ¨¡:<b>${d.issueSize > 0 ? d.issueSize + 'å„„' : '-'}</b></span>
            <span class="hc-info">å¹´æœŸ:<b>${d.years > 0 ? d.years + 'å¹´' : '-'}</b></span>
            <span class="hc-info">æ“”ä¿:<b>${guarantee}</b></span>
            <span class="hc-info">ä¿¡è©•:<b>${d.rating || '-'}</b></span>
            <span class="hc-info">åˆ¸å•†:<b>${d.broker || '-'}</b></span>
            <span class="hc-info">åº•æ¨™:<b>${d.floorPrice > 0 ? safeFixed(d.floorPrice,2) : '-'}</b></span>
            <span class="hc-info">æº¢åƒ¹ç‡:<b class="pink">${premiumStr}%</b></span>
        </div>
        
        <div class="hc-line">
            <span class="hc-info">è½‰æ›åƒ¹:<b>${d.conversionPrice > 0 ? safeFixed(d.conversionPrice,1) : '-'}</b></span>
            <span class="hc-info">æˆªæ¨™æ”¶ç›¤:<b>${d.closePrice > 0 ? safeFixed(d.closePrice,1) : '-'}</b></span>
            <span class="hc-info">ç†è«–åƒ¹:<b style="color:#1565c0">${d.theoreticalPrice > 0 ? safeFixed(d.theoreticalPrice,2) : '-'}</b></span>
            <span class="hc-info">ç«¶æ‹å¼µæ•¸:<b>${d.auctionShares > 0 ? d.auctionShares.toLocaleString() : '-'}</b></span>
            <span class="hc-info">æŠ•æ¨™å¼µæ•¸:<b>${d.bidShares > 0 ? d.bidShares.toLocaleString() : '-'}</b></span>
            <span class="hc-info">æŠ•æ¨™å€æ•¸:<b style="color:#d32f2f">${d.bidMultiple > 0 ? safeFixed(d.bidMultiple, 2) + 'x' : '-'}</b></span>
        </div>
        
        <table class="hc-table">
            <tr>
                <th></th><th>å¾—æ¨™åƒ¹</th><th>æº¢åƒ¹ç‡</th><th></th><th>æ›ç‰Œåƒ¹</th><th>æŒ¯å¹…</th><th>CBæ”¶ç›¤</th>
            </tr>
            <tr>
                <td class="td-label">æœ€ä½</td>
                <td>${d.minBidPrice > 0 ? safeFixed(d.minBidPrice, 2) : '-'}</td>
                <td class="val-red">${d.lowPremium !== 0 ? safeFixed(d.lowPremium, 2) + '%' : '-'}</td>
                <td class="td-label">é«˜</td>
                <td>${h > 0 ? safeFixed(h, 1) : '-'}</td>
                <td class="val-pink" rowspan="2">${amp}%</td>
                <td rowspan="2" style="color:#1565c0; font-weight:700; font-size:11px;">${cbClosePriceStr}</td>
            </tr>
            <tr>
                <td class="td-label">å¹³å‡</td>
                <td>${d.avgBidPrice > 0 ? safeFixed(d.avgBidPrice, 2) : '-'}</td>
                <td class="val-red">${d.avgPremium !== 0 ? safeFixed(d.avgPremium, 2) + '%' : '-'}</td>
                <td class="td-label">ä½</td>
                <td>${l > 0 ? safeFixed(l, 1) : '-'}</td>
            </tr>
        </table>
    </div>
    `;
}

// v3.52 ä¿®æ”¹ï¼šgenerateStandardCard å¢åŠ æ’é™¤å‰ä¸‰çš„åƒæ•¸ï¼Œç¨ç«‹æˆå…©å€‹è¡¨æ ¼ï¼Œä¸¦åŠ å…¥æ“”ä¿é¡å‹ç´°åˆ†
function generateStandardCard(data, titleOverride=null, inquiryData=null, excludeTop3Data=null, excludeTop3InquiryData=null, guaranteedAuctionData=null, guaranteedInquiryData=null, unguaranteedAuctionData=null, unguaranteedInquiryData=null) {
    if (!data) return `<div class="stat-row" style="color:#999;">æŸ¥ç„¡è³‡æ–™</div>`;
    
    const valStr = (v, s='') => (v!==undefined && v!==null && v!=='' && v!==0) ? `${safeFixed(v,2)}${s}` : '-';
    const title = data['å€é–“åç¨±'] ? `å€é–“çµ±è¨ˆ: ${data['å€é–“åç¨±']}` : (titleOverride || 'æ­·å²çµ±è¨ˆ');

    // è¨ˆç®—ç«¶æ‹æŒ¯å¹…
    const aH = safeFloat(data['å¹³å‡æ›ç‰Œæœ€é«˜']);
    const aL = safeFloat(data['å¹³å‡æ›ç‰Œæœ€ä½']);
    const aAmp = (aH > 0 && aL > 0) ? ((aH - aL) / aL * 100).toFixed(1) : '-';
    
    // è¨ˆç®—è©¢åœˆæŒ¯å¹…
    let iH = 0, iL = 0, iAmp = '-', iCount = 0;
    if (inquiryData) {
        iH = safeFloat(inquiryData['å¹³å‡æ›ç‰Œæœ€é«˜']);
        iL = safeFloat(inquiryData['å¹³å‡æ›ç‰Œæœ€ä½']);
        iAmp = (iH > 0 && iL > 0) ? ((iH - iL) / iL * 100).toFixed(1) : '-';
        iCount = inquiryData['æ¨£æœ¬æ•¸'] || 0;
    }
    
    // v3.52ï¼šè¨ˆç®—æ’é™¤å‰ä¸‰çš„ç«¶æ‹æŒ¯å¹…
    let exAH = 0, exAL = 0, exAAmp = '-', exACount = 0;
    if (excludeTop3Data) {
        exAH = safeFloat(excludeTop3Data['å¹³å‡æ›ç‰Œæœ€é«˜']);
        exAL = safeFloat(excludeTop3Data['å¹³å‡æ›ç‰Œæœ€ä½']);
        exAAmp = (exAH > 0 && exAL > 0) ? ((exAH - exAL) / exAL * 100).toFixed(1) : '-';
        exACount = excludeTop3Data['æ¨£æœ¬æ•¸'] || 0;
    }
    
    // v3.52ï¼šè¨ˆç®—æ’é™¤å‰ä¸‰çš„è©¢åœˆæŒ¯å¹…
    let exIH = 0, exIL = 0, exIAmp = '-', exICount = 0;
    if (excludeTop3InquiryData) {
        exIH = safeFloat(excludeTop3InquiryData['å¹³å‡æ›ç‰Œæœ€é«˜']);
        exIL = safeFloat(excludeTop3InquiryData['å¹³å‡æ›ç‰Œæœ€ä½']);
        exIAmp = (exIH > 0 && exIL > 0) ? ((exIH - exIL) / exIL * 100).toFixed(1) : '-';
        exICount = excludeTop3InquiryData['æ¨£æœ¬æ•¸'] || 0;
    }
    
    // è¨ˆç®—åˆè¨ˆï¼ˆå®Œæ•´æ•¸æ“šï¼‰
    const aCount = data['æ¨£æœ¬æ•¸'] || 0;
    const totalCount = (typeof aCount === 'number' ? aCount : 0) + (typeof iCount === 'number' ? iCount : 0);
    
    let tH = 0, tL = 0, tAmp = '-';
    if (aH > 0 && iH > 0) {
        tH = ((aH * aCount) + (iH * iCount)) / totalCount;
        tL = ((aL * aCount) + (iL * iCount)) / totalCount;
    } else if (aH > 0) {
        tH = aH; tL = aL;
    } else if (iH > 0) {
        tH = iH; tL = iL;
    }
    if (tH > 0 && tL > 0) tAmp = ((tH - tL) / tL * 100).toFixed(1);
    
    // è¨ˆç®—æ’é™¤å‰ä¸‰çš„åˆè¨ˆ
    const exTotalCount = exACount + exICount;
    let exTH = 0, exTL = 0, exTAmp = '-';
    if (exAH > 0 && exIH > 0) {
        exTH = ((exAH * exACount) + (exIH * exICount)) / exTotalCount;
        exTL = ((exAL * exACount) + (exIL * exICount)) / exTotalCount;
    } else if (exAH > 0) {
        exTH = exAH; exTL = exAL;
    } else if (exIH > 0) {
        exTH = exIH; exTL = exIL;
    }
    if (exTH > 0 && exTL > 0) exTAmp = ((exTH - exTL) / exTL * 100).toFixed(1);

    let html = `<div class="stats-header">ğŸ“Š ${title}</div>`;
    
    // v3.53 ä¿®æ”¹ï¼šç«¶æ‹å¾—æ¨™æ•¸æ“šè¡¨æ ¼åŒ–ï¼ˆæœ‰æ“”ä¿/ç„¡æ“”ä¿/å…¨éƒ¨ï¼‰
    const hasBidData = data['æ¨£æœ¬æ•¸'] && data['æ¨£æœ¬æ•¸'] > 0;
    const hasGuaranteedBid = guaranteedAuctionData && guaranteedAuctionData['å¾—æ¨™æ¨£æœ¬æ•¸'] > 0;
    const hasUnguaranteedBid = unguaranteedAuctionData && unguaranteedAuctionData['å¾—æ¨™æ¨£æœ¬æ•¸'] > 0;
    
    if (hasBidData || hasGuaranteedBid || hasUnguaranteedBid) {
        html += `<div style="background:#f1f8e9; padding:8px; border-radius:5px; margin:8px 0;">
        <div style="font-weight:bold; color:#2e7d32; font-size:12px; margin-bottom:6px;">ğŸ¯ ç«¶æ‹å¾—æ¨™çµ±è¨ˆ</div>
        <table class="card-bid-table">
        <tr><th></th><th>æª”æ•¸</th><th>æœ€ä½å¾—æ¨™</th><th>æœ€ä½æº¢åƒ¹</th><th>å¹³å‡å¾—æ¨™</th><th>å¹³å‡æº¢åƒ¹</th></tr>`;
        
        // æœ‰æ“”ä¿
        if (hasGuaranteedBid) {
            const ga = guaranteedAuctionData;
            html += `<tr>
                <td class="type-label">æœ‰æ“”ä¿</td>
                <td>${ga['å¾—æ¨™æ¨£æœ¬æ•¸']}</td>
                <td class="val-green">${safeFixed(ga['å¹³å‡æœ€ä½å¾—æ¨™åƒ¹'],2)}</td>
                <td class="val-red">${safeFixed(ga['å¹³å‡æœ€ä½æº¢åƒ¹'],2)}%</td>
                <td class="val-green">${safeFixed(ga['å¹³å‡å¾—æ¨™åƒ¹'],2)}</td>
                <td class="val-red">${safeFixed(ga['å¹³å‡æº¢åƒ¹'],2)}%</td>
            </tr>`;
        }
        
        // ç„¡æ“”ä¿
        if (hasUnguaranteedBid) {
            const ua = unguaranteedAuctionData;
            html += `<tr>
                <td class="type-label">ç„¡æ“”ä¿</td>
                <td>${ua['å¾—æ¨™æ¨£æœ¬æ•¸']}</td>
                <td class="val-green">${safeFixed(ua['å¹³å‡æœ€ä½å¾—æ¨™åƒ¹'],2)}</td>
                <td class="val-red">${safeFixed(ua['å¹³å‡æœ€ä½æº¢åƒ¹'],2)}%</td>
                <td class="val-green">${safeFixed(ua['å¹³å‡å¾—æ¨™åƒ¹'],2)}</td>
                <td class="val-red">${safeFixed(ua['å¹³å‡æº¢åƒ¹'],2)}%</td>
            </tr>`;
        }
        
        // å…¨éƒ¨ï¼ˆåˆè¨ˆåˆ—ï¼‰
        if (hasBidData) {
            html += `<tr class="total-row">
                <td class="type-label">å…¨éƒ¨</td>
                <td>${data['æ¨£æœ¬æ•¸']}</td>
                <td class="val-green">${safeFixed(data['å¹³å‡æœ€ä½å¾—æ¨™åƒ¹'],2)}</td>
                <td class="val-red">${safeFixed(data['å¹³å‡æœ€ä½æº¢åƒ¹'],2)}%</td>
                <td class="val-green">${safeFixed(data['å¹³å‡å¾—æ¨™åƒ¹'],2)}</td>
                <td class="val-red">${safeFixed(data['å¹³å‡æº¢åƒ¹'],2)}%</td>
            </tr>`;
        }
        
        html += `</table></div>`;
    }
    
    // === ç¬¬ä¸€å€‹è¡¨æ ¼ï¼šå®Œæ•´æ•¸æ“š ===
    const hasAuction = aH > 0 || aL > 0;
    const hasInquiry = iH > 0 || iL > 0;
    
    if (hasAuction || hasInquiry) {
        html += `<div style="font-size:11px; color:#2e7d32; font-weight:bold; margin:8px 0 4px 0;">ğŸ“ˆ æ›ç‰Œçµ±è¨ˆï¼ˆå…¨éƒ¨ï¼‰</div>`;
        html += `<table class="card-market-table">
        <tr><th></th><th>æ›ç‰Œé«˜</th><th>æ›ç‰Œä½</th><th>æŒ¯å¹…</th></tr>`;
        
        if (hasAuction) {
            html += `<tr>
                <td class="type-label">ç«¶æ‹<span class="count">${aCount}</span></td>
                <td class="val-blue">${aH > 0 ? safeFixed(aH,1) : '-'}</td>
                <td class="val-blue">${aL > 0 ? safeFixed(aL,1) : '-'}</td>
                <td class="val-pink">${aAmp}%</td>
            </tr>`;
        }
        
        if (hasInquiry) {
            html += `<tr>
                <td class="type-label">è©¢åœˆ<span class="count">${iCount}</span></td>
                <td class="val-blue">${iH > 0 ? safeFixed(iH,1) : '-'}</td>
                <td class="val-blue">${iL > 0 ? safeFixed(iL,1) : '-'}</td>
                <td class="val-pink">${iAmp}%</td>
            </tr>`;
        }
        
        if (hasAuction && hasInquiry) {
            html += `<tr class="total-row">
                <td class="type-label">åˆè¨ˆ<span class="count">${totalCount}</span></td>
                <td class="val-blue">${tH > 0 ? safeFixed(tH,1) : '-'}</td>
                <td class="val-blue">${tL > 0 ? safeFixed(tL,1) : '-'}</td>
                <td class="val-pink">${tAmp}%</td>
            </tr>`;
        }
        
        html += `</table>`;
    }
    
    // === ç¬¬äºŒå€‹è¡¨æ ¼ï¼šæ’é™¤å‰ä¸‰é«˜ ===
    const hasExcludeAuction = exAH > 0 || exAL > 0;
    const hasExcludeInquiry = exIH > 0 || exIL > 0;
    
    if (hasExcludeAuction || hasExcludeInquiry) {
        html += `<div style="font-size:11px; color:#1565c0; font-weight:bold; margin:12px 0 4px 0;">ğŸ“‰ æ›ç‰Œçµ±è¨ˆï¼ˆæ’é™¤å‰3é«˜ï¼‰</div>`;
        html += `<table class="card-market-table" style="background:#e3f2fd;">
        <tr><th style="background:#1565c0;"></th><th style="background:#1565c0;">æ›ç‰Œé«˜</th><th style="background:#1565c0;">æ›ç‰Œä½</th><th style="background:#1565c0;">æŒ¯å¹…</th></tr>`;
        
        if (hasExcludeAuction) {
            html += `<tr>
                <td class="type-label" style="color:#1565c0;">ç«¶æ‹<span class="count">${exACount}</span></td>
                <td class="val-blue">${exAH > 0 ? safeFixed(exAH,1) : '-'}</td>
                <td class="val-blue">${exAL > 0 ? safeFixed(exAL,1) : '-'}</td>
                <td class="val-pink">${exAAmp}%</td>
            </tr>`;
        }
        
        if (hasExcludeInquiry) {
            html += `<tr>
                <td class="type-label" style="color:#1565c0;">è©¢åœˆ<span class="count">${exICount}</span></td>
                <td class="val-blue">${exIH > 0 ? safeFixed(exIH,1) : '-'}</td>
                <td class="val-blue">${exIL > 0 ? safeFixed(exIL,1) : '-'}</td>
                <td class="val-pink">${exIAmp}%</td>
            </tr>`;
        }
        
        if (hasExcludeAuction && hasExcludeInquiry) {
            html += `<tr class="total-row" style="background:#bbdefb;">
                <td class="type-label" style="color:#1565c0;">åˆè¨ˆ<span class="count">${exTotalCount}</span></td>
                <td class="val-blue">${exTH > 0 ? safeFixed(exTH,1) : '-'}</td>
                <td class="val-blue">${exTL > 0 ? safeFixed(exTL,1) : '-'}</td>
                <td class="val-pink">${exTAmp}%</td>
            </tr>`;
        }
        
        html += `</table>`;
        
        // === è¨ˆç®—è½å·®ä¸¦é¡¯ç¤ºæé†’ï¼ˆåˆ†é–‹ç«¶æ‹å’Œè©¢åœˆï¼‰===
        let warnings = [];
        
        // ç«¶æ‹è½å·®æª¢æŸ¥
        if (hasAuction && hasExcludeAuction) {
            const aAmpNum = parseFloat(aAmp);
            const exAAmpNum = parseFloat(exAAmp);
            
            if (!isNaN(aAmpNum) && !isNaN(exAAmpNum) && aAmpNum > 0) {
                const aAmpDiffPct = ((aAmpNum - exAAmpNum) / aAmpNum) * 100;
                
                if (aAmpDiffPct > 15) {
                    const aAmpDiff = (aAmpNum - exAAmpNum).toFixed(1);
                    const aHighDiff = (aH - exAH).toFixed(1);
                    warnings.push(`ğŸ¯ ç«¶æ‹ï¼šæŒ¯å¹…è½å·® ${aAmpDiff}%ï¼ˆé™å¹…${aAmpDiffPct.toFixed(0)}%ï¼‰ï¼Œæ›ç‰Œé«˜å‡åƒ¹å·® ${aHighDiff} å…ƒ`);
                }
            }
        }
        
        // è©¢åœˆè½å·®æª¢æŸ¥
        if (hasInquiry && hasExcludeInquiry) {
            const iAmpNum = parseFloat(iAmp);
            const exIAmpNum = parseFloat(exIAmp);
            
            if (!isNaN(iAmpNum) && !isNaN(exIAmpNum) && iAmpNum > 0) {
                const iAmpDiffPct = ((iAmpNum - exIAmpNum) / iAmpNum) * 100;
                
                if (iAmpDiffPct > 15) {
                    const iAmpDiff = (iAmpNum - exIAmpNum).toFixed(1);
                    const iHighDiff = (iH - exIH).toFixed(1);
                    warnings.push(`ğŸ“‹ è©¢åœˆï¼šæŒ¯å¹…è½å·® ${iAmpDiff}%ï¼ˆé™å¹…${iAmpDiffPct.toFixed(0)}%ï¼‰ï¼Œæ›ç‰Œé«˜å‡åƒ¹å·® ${iHighDiff} å…ƒ`);
                }
            }
        }
        
        if (warnings.length > 0) {
            html += `<div style="margin-top:6px; padding:6px 8px; background:#fff3e0; border-left:3px solid #ff9800; border-radius:4px; font-size:10px; color:#e65100; line-height:1.6;">
                <div style="font-weight:bold; margin-bottom:3px;">âš ï¸ å‰3é«˜å°æ•´é«”å½±éŸ¿é¡¯è‘—ï¼š</div>
                ${warnings.join('<br>')}
            </div>`;
        }
    }
    
    // === ç¬¬ä¸‰å€‹è¡¨æ ¼ï¼šä¾æ“”ä¿é¡å‹ç´°åˆ† ===
    const hasGuaranteedAuction = guaranteedAuctionData && safeFloat(guaranteedAuctionData['å¹³å‡æ›ç‰Œæœ€é«˜']) > 0;
    const hasGuaranteedInquiry = guaranteedInquiryData && safeFloat(guaranteedInquiryData['å¹³å‡æ›ç‰Œæœ€é«˜']) > 0;
    const hasUnguaranteedAuction = unguaranteedAuctionData && safeFloat(unguaranteedAuctionData['å¹³å‡æ›ç‰Œæœ€é«˜']) > 0;
    const hasUnguaranteedInquiry = unguaranteedInquiryData && safeFloat(unguaranteedInquiryData['å¹³å‡æ›ç‰Œæœ€é«˜']) > 0;
    
    if (hasGuaranteedAuction || hasGuaranteedInquiry || hasUnguaranteedAuction || hasUnguaranteedInquiry) {
        html += `<div style="font-size:11px; color:#7b1fa2; font-weight:bold; margin:12px 0 4px 0;">ğŸ·ï¸ ä¾æ“”ä¿é¡å‹ç´°åˆ†</div>`;
        html += `<table class="card-market-table" style="background:#f3e5f5;">
        <tr><th style="background:#7b1fa2;"></th><th style="background:#7b1fa2;">æ›ç‰Œé«˜</th><th style="background:#7b1fa2;">æ›ç‰Œä½</th><th style="background:#7b1fa2;">æŒ¯å¹…</th></tr>`;
        
        // æœ‰æ“”ä¿
        if (hasGuaranteedAuction || hasGuaranteedInquiry) {
            // æœ‰æ“”ä¿ - ç«¶æ‹
            if (hasGuaranteedAuction) {
                const gaH = safeFloat(guaranteedAuctionData['å¹³å‡æ›ç‰Œæœ€é«˜']);
                const gaL = safeFloat(guaranteedAuctionData['å¹³å‡æ›ç‰Œæœ€ä½']);
                const gaAmp = (gaH > 0 && gaL > 0) ? ((gaH - gaL) / gaL * 100).toFixed(1) : '-';
                html += `<tr>
                    <td class="type-label" style="color:#7b1fa2;">æœ‰æ“”ä¿-ç«¶æ‹<span class="count">${guaranteedAuctionData['æ¨£æœ¬æ•¸']}</span></td>
                    <td class="val-blue">${gaH > 0 ? safeFixed(gaH,1) : '-'}</td>
                    <td class="val-blue">${gaL > 0 ? safeFixed(gaL,1) : '-'}</td>
                    <td class="val-pink">${gaAmp}%</td>
                </tr>`;
            }
            
            // æœ‰æ“”ä¿ - è©¢åœˆ
            if (hasGuaranteedInquiry) {
                const giH = safeFloat(guaranteedInquiryData['å¹³å‡æ›ç‰Œæœ€é«˜']);
                const giL = safeFloat(guaranteedInquiryData['å¹³å‡æ›ç‰Œæœ€ä½']);
                const giAmp = (giH > 0 && giL > 0) ? ((giH - giL) / giL * 100).toFixed(1) : '-';
                html += `<tr>
                    <td class="type-label" style="color:#7b1fa2;">æœ‰æ“”ä¿-è©¢åœˆ<span class="count">${guaranteedInquiryData['æ¨£æœ¬æ•¸']}</span></td>
                    <td class="val-blue">${giH > 0 ? safeFixed(giH,1) : '-'}</td>
                    <td class="val-blue">${giL > 0 ? safeFixed(giL,1) : '-'}</td>
                    <td class="val-pink">${giAmp}%</td>
                </tr>`;
            }
        }
        
        // ç„¡æ“”ä¿
        if (hasUnguaranteedAuction || hasUnguaranteedInquiry) {
            // ç„¡æ“”ä¿ - ç«¶æ‹
            if (hasUnguaranteedAuction) {
                const uaH = safeFloat(unguaranteedAuctionData['å¹³å‡æ›ç‰Œæœ€é«˜']);
                const uaL = safeFloat(unguaranteedAuctionData['å¹³å‡æ›ç‰Œæœ€ä½']);
                const uaAmp = (uaH > 0 && uaL > 0) ? ((uaH - uaL) / uaL * 100).toFixed(1) : '-';
                html += `<tr style="background:#ede7f6;">
                    <td class="type-label" style="color:#512da8;">ç„¡æ“”ä¿-ç«¶æ‹<span class="count">${unguaranteedAuctionData['æ¨£æœ¬æ•¸']}</span></td>
                    <td class="val-blue">${uaH > 0 ? safeFixed(uaH,1) : '-'}</td>
                    <td class="val-blue">${uaL > 0 ? safeFixed(uaL,1) : '-'}</td>
                    <td class="val-pink">${uaAmp}%</td>
                </tr>`;
            }
            
            // ç„¡æ“”ä¿ - è©¢åœˆ
            if (hasUnguaranteedInquiry) {
                const uiH = safeFloat(unguaranteedInquiryData['å¹³å‡æ›ç‰Œæœ€é«˜']);
                const uiL = safeFloat(unguaranteedInquiryData['å¹³å‡æ›ç‰Œæœ€ä½']);
                const uiAmp = (uiH > 0 && uiL > 0) ? ((uiH - uiL) / uiL * 100).toFixed(1) : '-';
                html += `<tr style="background:#ede7f6;">
                    <td class="type-label" style="color:#512da8;">ç„¡æ“”ä¿-è©¢åœˆ<span class="count">${unguaranteedInquiryData['æ¨£æœ¬æ•¸']}</span></td>
                    <td class="val-blue">${uiH > 0 ? safeFixed(uiH,1) : '-'}</td>
                    <td class="val-blue">${uiL > 0 ? safeFixed(uiL,1) : '-'}</td>
                    <td class="val-pink">${uiAmp}%</td>
                </tr>`;
            }
        }
        
        html += `</table>`;
    }
    
    return html;
}

function initializeUI() {
    document.getElementById('headerSubtitle').textContent = `ç«¶æ‹è³‡æ–™åº« ${Object.keys(cbDatabase).length} ç­†`;
    populateSelect('industry', statistics['ç¶­åº¦çµ±è¨ˆ']['ç”¢æ¥­']); 
    populateSelect('broker', statistics['ç¶­åº¦çµ±è¨ˆ']['ç™¼è¡Œåˆ¸å•†']);
    showStatsSummary(); 
    bindInputEvents();
    generateSupplyAnalysis(); // v3.54 æ–°å¢
    generateYearlyRanking();  // v3.55 æ–°å¢
    generateRealPerformance(); // v3.56 æ–°å¢
    generateProfitLossAnalysis(); // v3.59 æ–°å¢
    generateDimensionAnalysis(); // v3.57 æ–°å¢
    generateMarketTrendAnalysis(); // v3.58 æ–°å¢
}

function populateSelect(id, dataObj) {
    if (!dataObj) return; 
    const sel = document.getElementById(id); 
    while (sel.options.length > 1) sel.remove(1);
    Object.keys(dataObj).sort((a,b)=>(dataObj[b].count||0)-(dataObj[a].count||0)).forEach(k=>{ 
        const o=document.createElement('option'); 
        o.value=k; 
        o.text=`${k} (${dataObj[k].count})`; 
        sel.add(o); 
    });
}

function showStatsSummary() { 
    document.getElementById('statsSummary').innerHTML = `
    <div class="stat-box"><div class="number">${auctionRawData.filter(d=>d.minBidPrice>0).length}</div><div class="label">ç«¶æ‹æ¡ˆä¾‹</div></div>
    <div class="stat-box"><div class="number">${inquiryRawData.length}</div><div class="label">è©¢åœˆæ¡ˆä¾‹</div></div>
    <div class="stat-box"><div class="number">${auctionRawData.filter(d=>d.marketHigh>0).length + inquiryRawData.filter(d=>d.marketHigh>0).length}</div><div class="label">æ›ç‰Œè¡Œæƒ…</div></div>
    `; 
}

// v3.54 æ–°å¢ï¼šå¸‚å ´ä¾›çµ¦é‡åˆ†æ
function generateSupplyAnalysis() {
    // åˆ¤æ–·ç•¶å‰æœŸé–“
    const now = new Date();
    const currentYear = now.getFullYear();
    const currentPeriod = now.getMonth() < 6 ? `${currentYear}H1` : `${currentYear}H2`;
    
    // ç¡¬ç·¨ç¢¼çš„æ­·å²çµ±è¨ˆæ•¸æ“šï¼ˆå¾åˆ†æçµæœï¼‰
    const hardcodedStats = {
        '2022H1': { total: 49, inquiry: 21, auction: 28, issueAmount: 496.0, avgGain: 88.1, medianGain: 62.0, above50: 26, range3050: 7, range1030: 15, below10: 1 },
        '2022H2': { total: 47, inquiry: 22, auction: 25, issueAmount: 314.5, avgGain: 66.9, medianGain: 48.0, above50: 22, range3050: 12, range1030: 7, below10: 5 },
        '2023H1': { total: 36, inquiry: 20, auction: 16, issueAmount: 400.5, avgGain: 86.7, medianGain: 61.5, above50: 21, range3050: 7, range1030: 7, below10: 1 },
        '2023H2': { total: 55, inquiry: 27, auction: 28, issueAmount: 592.2, avgGain: 64.8, medianGain: 39.9, above50: 27, range3050: 8, range1030: 17, below10: 3 },
        '2024H1': { total: 44, inquiry: 23, auction: 21, issueAmount: 358.7, avgGain: 61.5, medianGain: 53.5, above50: 24, range3050: 11, range1030: 9, below10: 0 },
        '2024H2': { total: 95, inquiry: 41, auction: 54, issueAmount: 1028.8, avgGain: 33.4, medianGain: 22.1, above50: 19, range3050: 14, range1030: 54, below10: 8 },
        '2025H1': { total: 50, inquiry: 27, auction: 23, issueAmount: 584.5, avgGain: 29.3, medianGain: 18.8, above50: 9, range3050: 4, range1030: 22, below10: 15 },
        '2025H2': { total: 45, inquiry: 19, auction: 26, issueAmount: 293.3, avgGain: 21.8, medianGain: 18.5, above50: 3, range3050: 7, range1030: 24, below10: 10 }
    };
    
    const periods = ['2022H1', '2022H2', '2023H1', '2023H2', '2024H1', '2024H2', '2025H1', '2025H2'];
    
    // === è¨ˆç®—æœªä¾†é«”é‡ ===
    const pendingData = window.pendingIssueData || [];
    const boardData = window.boardApprovalData || [];
    
    const pendingTotal = pendingData.reduce((s, d) => s + d.size, 0);
    const pendingAuction = pendingData.filter(d => d.type === 'ç«¶æ‹').reduce((s, d) => s + d.size, 0);
    const pendingInquiry = pendingData.filter(d => d.type === 'è©¢åœˆ').reduce((s, d) => s + d.size, 0);
    
    const boardTotal = boardData.reduce((s, d) => s + d.size, 0);
    const boardAuction = boardData.filter(d => d.type === 'ç«¶æ‹' || d.type === 'ç«¶åƒ¹').reduce((s, d) => s + d.size, 0);
    const boardInquiry = boardData.filter(d => d.type === 'è©¢åœˆ').reduce((s, d) => s + d.size, 0);
    
    const futureTotal = pendingTotal + boardTotal;
    
    // è¨ˆç®—2025å¹´å·²ç™¼è¡Œé‡
    const issued2025 = (hardcodedStats['2025H1']?.issueAmount || 0) + (hardcodedStats['2025H2']?.issueAmount || 0);
    
    // æ­·å²å¹´åº¦çµ±è¨ˆï¼ˆç”¨æ–¼æ¯”è¼ƒï¼‰
    const yearlyTotals = {
        2022: hardcodedStats['2022H1'].issueAmount + hardcodedStats['2022H2'].issueAmount,
        2023: hardcodedStats['2023H1'].issueAmount + hardcodedStats['2023H2'].issueAmount,
        2024: hardcodedStats['2024H1'].issueAmount + hardcodedStats['2024H2'].issueAmount
    };
    
    const historicalAvg = (yearlyTotals[2022] + yearlyTotals[2023] + yearlyTotals[2024]) / 3;
    const projectedTotal = issued2025 + futureTotal;
    const exceedPercent = ((projectedTotal / yearlyTotals[2024]) - 1) * 100;
    
    // === ç”ŸæˆHTML ===
    let html = '';
    
    // ç¬¬ä¸€å€å¡Šï¼šæœªä¾†ä¾›çµ¦é‡åˆ†æï¼ˆæ–°å¢ï¼‰
    html += `
    <div style="background:linear-gradient(135deg,#fff3e0,#ffe0b2); border:2px solid #ff6f00; border-radius:10px; padding:12px; margin-bottom:15px;">
        <div style="font-size:13px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸš€ æœªä¾†ä¾›çµ¦é‡é ä¼°</div>
        
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:10px;">
            <div style="background:white; padding:10px; border-radius:8px; text-align:center; border-left:4px solid #4CAF50;">
                <div style="font-size:10px; color:#666;">2025å¹´å·²ç™¼è¡Œ</div>
                <div style="font-size:18px; font-weight:900; color:#2e7d32;">${issued2025.toFixed(0)}å„„</div>
            </div>
            <div style="background:white; padding:10px; border-radius:8px; text-align:center; border-left:4px solid #ff9800;">
                <div style="font-size:10px; color:#666;">æ‰¿éŠ·é€²è¡Œä¸­(${pendingData.length}æª”)</div>
                <div style="font-size:18px; font-weight:900; color:#e65100;">${pendingTotal.toFixed(0)}å„„</div>
            </div>
            <div style="background:white; padding:10px; border-radius:8px; text-align:center; border-left:4px solid #9c27b0;">
                <div style="font-size:10px; color:#666;">è‘£äº‹æœƒå…¬å‘Š(${boardData.length}æª”)</div>
                <div style="font-size:18px; font-weight:900; color:#7b1fa2;">${boardTotal.toFixed(0)}å„„</div>
            </div>
        </div>
        
        <div style="background:white; padding:10px; border-radius:8px; margin-bottom:10px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                <span style="font-size:11px; color:#666;">æ‰¿éŠ·é€²è¡Œä¸­</span>
                <span style="font-size:11px;">ç«¶æ‹ <b style="color:#ff6f00;">${pendingAuction.toFixed(0)}å„„</b> ï½œ è©¢åœˆ <b style="color:#1565c0;">${pendingInquiry.toFixed(0)}å„„</b></span>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:11px; color:#666;">è‘£äº‹æœƒå…¬å‘Š</span>
                <span style="font-size:11px;">ç«¶æ‹ <b style="color:#ff6f00;">${boardAuction.toFixed(0)}å„„</b> ï½œ è©¢åœˆ <b style="color:#1565c0;">${boardInquiry.toFixed(0)}å„„</b></span>
            </div>
        </div>
        
        <div style="background:#ffebee; padding:10px; border-radius:8px; border-left:4px solid #f44336;">
            <div style="font-size:12px; font-weight:bold; color:#c62828; margin-bottom:5px;">ğŸ“Š 2025å¹´é ä¼°ç¸½é‡ vs æ­·å²æ¯”è¼ƒ</div>
            <div style="font-size:11px; color:#c62828; line-height:1.6;">
                é ä¼°ç¸½é‡: <b>${projectedTotal.toFixed(0)}å„„</b> (å·²ç™¼è¡Œ${issued2025.toFixed(0)} + å¾…ç™¼è¡Œ${futureTotal.toFixed(0)})<br>
                2024å¹´å…¨å¹´: <b>${yearlyTotals[2024].toFixed(0)}å„„</b> ï½œ 
                ${exceedPercent >= 0 ? 
                    `<span style="color:#c62828;">è¶…é${exceedPercent.toFixed(0)}%</span>` : 
                    `<span style="color:#2e7d32;">ä½æ–¼${Math.abs(exceedPercent).toFixed(0)}%</span>`}<br>
                è¿‘3å¹´å‡å€¼: <b>${historicalAvg.toFixed(0)}å„„</b> (2022:${yearlyTotals[2022].toFixed(0)} / 2023:${yearlyTotals[2023].toFixed(0)} / 2024:${yearlyTotals[2024].toFixed(0)})
            </div>
        </div>
    </div>`;
    
    // ç¬¬äºŒå€å¡Šï¼šæ‰¿éŠ·é€²è¡Œä¸­æ˜ç´°ï¼ˆå¯æ”¶åˆï¼‰
    if (pendingData.length > 0) {
        html += `
        <div style="margin-bottom:10px;">
            <div onclick="toggleSupplyDetail('pending')" style="cursor:pointer; background:#fff3e0; padding:8px 12px; border-radius:6px; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:11px; font-weight:bold; color:#e65100;">ğŸ“‹ æ‰¿éŠ·é€²è¡Œä¸­æ˜ç´° (${pendingData.length}æª”)</span>
                <span id="pending-toggle" style="color:#e65100;">â–¼</span>
            </div>
            <div id="pending-detail" style="display:none; background:#fffde7; padding:8px; border-radius:0 0 6px 6px; max-height:200px; overflow-y:auto;">
                <table style="width:100%; border-collapse:collapse; font-size:9px;">
                    <tr style="background:#ff9800; color:white;">
                        <th style="padding:4px;">ä»£è™Ÿ</th>
                        <th style="padding:4px;">åç¨±</th>
                        <th style="padding:4px;">é¡å‹</th>
                        <th style="padding:4px;">è¦æ¨¡</th>
                        <th style="padding:4px;">åˆ¸å•†</th>
                        <th style="padding:4px;">æ›ç‰Œæ—¥</th>
                    </tr>`;
        pendingData.forEach(d => {
            const typeColor = d.type === 'ç«¶æ‹' ? '#ff6f00' : '#1565c0';
            let listDateStr = '-';
            if (d.listDate) {
                if (typeof d.listDate === 'string') listDateStr = d.listDate.substring(0, 10);
                else if (d.listDate instanceof Date) listDateStr = d.listDate.toISOString().substring(0, 10);
            }
            html += `
                    <tr style="border-bottom:1px solid #ffe0b2;">
                        <td style="padding:3px; text-align:center;">${d.id}</td>
                        <td style="padding:3px;">${d.name}</td>
                        <td style="padding:3px; text-align:center; color:${typeColor}; font-weight:bold;">${d.type}</td>
                        <td style="padding:3px; text-align:right;">${d.size}å„„</td>
                        <td style="padding:3px;">${d.broker}</td>
                        <td style="padding:3px; text-align:center;">${listDateStr}</td>
                    </tr>`;
        });
        html += `</table></div></div>`;
    }
    
    // ç¬¬ä¸‰å€å¡Šï¼šè‘£äº‹æœƒå…¬å‘Šæ˜ç´°ï¼ˆå¯æ”¶åˆï¼‰
    if (boardData.length > 0) {
        html += `
        <div style="margin-bottom:15px;">
            <div onclick="toggleSupplyDetail('board')" style="cursor:pointer; background:#f3e5f5; padding:8px 12px; border-radius:6px; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:11px; font-weight:bold; color:#7b1fa2;">ğŸ›ï¸ è‘£äº‹æœƒå…¬å‘Šæ˜ç´° (${boardData.length}æª”)</span>
                <span id="board-toggle" style="color:#7b1fa2;">â–¼</span>
            </div>
            <div id="board-detail" style="display:none; background:#fce4ec; padding:8px; border-radius:0 0 6px 6px; max-height:200px; overflow-y:auto;">
                <table style="width:100%; border-collapse:collapse; font-size:9px;">
                    <tr style="background:#9c27b0; color:white;">
                        <th style="padding:4px;">ä»£è™Ÿ</th>
                        <th style="padding:4px;">åç¨±</th>
                        <th style="padding:4px;">é¡å‹</th>
                        <th style="padding:4px;">è¦æ¨¡</th>
                        <th style="padding:4px;">åˆ¸å•†</th>
                        <th style="padding:4px;">è‘£äº‹æœƒé€šé</th>
                    </tr>`;
        boardData.forEach(d => {
            const typeColor = (d.type === 'ç«¶æ‹' || d.type === 'ç«¶åƒ¹') ? '#ff6f00' : '#1565c0';
            let boardDateStr = '-';
            if (d.boardDate) {
                if (typeof d.boardDate === 'string') boardDateStr = d.boardDate.substring(0, 10);
                else if (d.boardDate instanceof Date) boardDateStr = d.boardDate.toISOString().substring(0, 10);
            }
            html += `
                    <tr style="border-bottom:1px solid #f8bbd9;">
                        <td style="padding:3px; text-align:center;">${d.id}</td>
                        <td style="padding:3px;">${d.name}</td>
                        <td style="padding:3px; text-align:center; color:${typeColor}; font-weight:bold;">${d.type}</td>
                        <td style="padding:3px; text-align:right;">${d.size > 0 ? d.size + 'å„„' : '-'}</td>
                        <td style="padding:3px;">${d.broker}</td>
                        <td style="padding:3px; text-align:center;">${boardDateStr}</td>
                    </tr>`;
        });
        html += `</table></div></div>`;
    }
    
    // ç¬¬å››å€å¡Šï¼šæ­·å²çµ±è¨ˆè¡¨æ ¼
    html += `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin-bottom:8px;">ğŸ“ˆ æ­·å²ç™¼è¡Œé‡èˆ‡ç¸¾æ•ˆè¶¨å‹¢</div>
    <table class="supply-table">
        <thead>
            <tr>
                <th>æœŸé–“</th>
                <th>æª”æ•¸</th>
                <th>ç™¼è¡Œé‡<br>(å„„)</th>
                <th>å¹³å‡<br>æ¼²å¹…</th>
                <th>ä¸­ä½æ•¸</th>
                <th>â‰¥50%</th>
                <th>30-50%</th>
                <th>10-30%</th>
                <th>&lt;10%</th>
            </tr>
        </thead>
        <tbody>`;
    
    periods.forEach(period => {
        const ps = hardcodedStats[period];
        const isHighlight = period === '2024H2';
        const isCurrent = period === currentPeriod;
        
        let rowClass = '';
        if (isHighlight) rowClass = 'highlight-row';
        else if (isCurrent) rowClass = 'current-row';
        
        const avgClass = ps.avgGain < 35 ? 'val-high' : (ps.avgGain > 60 ? 'val-low' : '');
        const below10Class = ps.below10 >= 10 ? 'val-high' : '';
        const above50Class = ps.above50 >= 20 ? 'val-low' : (ps.above50 < 10 ? 'val-warn' : '');
        
        html += `
        <tr class="${rowClass}">
            <td class="period-cell">${period}${isCurrent ? ' ğŸ“' : ''}</td>
            <td>${ps.total}</td>
            <td class="${ps.issueAmount > 800 ? 'val-high' : ''}">${ps.issueAmount.toFixed(0)}</td>
            <td class="${avgClass}">${ps.avgGain.toFixed(1)}%</td>
            <td>${ps.medianGain.toFixed(1)}%</td>
            <td class="${above50Class}">${ps.above50}</td>
            <td>${ps.range3050}</td>
            <td>${ps.range1030}</td>
            <td class="${below10Class}">${ps.below10}</td>
        </tr>`;
    });
    
    html += `</tbody></table>`;
    
    // è­¦ç¤ºèªªæ˜
    const warningMsg = exceedPercent >= 20 ? 
        `âš ï¸ <strong>ä¾›çµ¦å£“åŠ›è­¦ç¤ºï¼š</strong>2025å¹´é ä¼°ç™¼è¡Œé‡${projectedTotal.toFixed(0)}å„„ï¼Œè¼ƒ2024å¹´å¢åŠ ${exceedPercent.toFixed(0)}%ï¼Œå¸‚å ´æ¶ˆåŒ–å£“åŠ›æ¥µå¤§ï¼Œé¸è‚¡é›£åº¦æŒçºŒæé«˜ã€‚` :
        (exceedPercent >= 0 ?
            `ğŸ“Š <strong>ä¾›çµ¦é‡è§€å¯Ÿï¼š</strong>2025å¹´é ä¼°ç™¼è¡Œé‡${projectedTotal.toFixed(0)}å„„ï¼Œç•¥é«˜æ–¼2024å¹´æ°´æº–ï¼Œå¸‚å ´ä»éœ€ç•™æ„ä¾›çµ¦å£“åŠ›ã€‚` :
            `ğŸ“Š <strong>ä¾›çµ¦é‡è§€å¯Ÿï¼š</strong>2025å¹´é ä¼°ç™¼è¡Œé‡${projectedTotal.toFixed(0)}å„„ï¼Œè¼ƒ2024å¹´æ¸›å°‘ï¼Œä¾›çµ¦å£“åŠ›ç›¸å°ç·©è§£ã€‚`);
    
    html += `
    <div class="supply-warning">${warningMsg}</div>
    <div class="supply-note">
        ğŸ“Œ <strong>è§€å¯Ÿé‡é»ï¼š</strong>æ¼²å¹…æ¬„ä½ç´…è‰²è¡¨ç¤ºä½æ–¼35%ï¼Œç¶ è‰²è¡¨ç¤ºé«˜æ–¼60%ã€‚
        æ‰¿éŠ·é€²è¡Œä¸­æ¡ˆä»¶é€šå¸¸1-2å€‹æœˆå…§æ›ç‰Œï¼Œè‘£äº‹æœƒå…¬å‘Šæ¡ˆä»¶å‰‡éœ€3-6å€‹æœˆå®Œæˆç™¼è¡Œç¨‹åºã€‚
    </div>`;
    
    document.getElementById('supplyTable').innerHTML = html;
}

// åˆ‡æ›ä¾›çµ¦æ˜ç´°é¡¯ç¤º
function toggleSupplyDetail(type) {
    const detail = document.getElementById(type + '-detail');
    const toggle = document.getElementById(type + '-toggle');
    if (detail.style.display === 'none') {
        detail.style.display = 'block';
        toggle.textContent = 'â–²';
    } else {
        detail.style.display = 'none';
        toggle.textContent = 'â–¼';
    }
}

// v3.55 æ–°å¢ï¼šå¹´åº¦ç¸¾æ•ˆæ’è¡Œ
let yearlyRankingData = {};

function generateYearlyRanking() {
    // å‹•æ…‹å¾ç«¶æ‹å’Œè©¢åœˆè³‡æ–™ç”Ÿæˆå¹´åº¦ç¸¾æ•ˆ
    const years = [2022, 2023, 2024, 2025];
    
    // åˆä½µç«¶æ‹å’Œè©¢åœˆè³‡æ–™
    const allData = [];
    
    // ç«¶æ‹è³‡æ–™
    auctionRawData.forEach(d => {
        if (d.marketHigh > 0 && d.marketLow > 0) {
            let year = null;
            if (d.openDate) {
                if (typeof d.openDate === 'number') {
                    const date = new Date((d.openDate - 25569) * 86400 * 1000);
                    year = date.getFullYear();
                } else if (typeof d.openDate === 'string') {
                    const parts = d.openDate.split(/[\/\-]/);
                    year = parseInt(parts[0]);
                    if (year < 100) year += 2000;
                }
            }
            if (year && year >= 2022 && year <= 2025) {
                const amp = ((d.marketHigh - d.marketLow) / d.marketLow * 100);
                allData.push({
                    id: d.id,
                    name: d.name,
                    type: 'ç«¶æ‹',
                    high: d.marketHigh,
                    low: d.marketLow,
                    amp: amp,
                    year: year,
                    status: listedSet.has(d.id) ? 'æ›ç‰Œä¸­' : 'å·²ä¸‹å¸‚'
                });
            }
        }
    });
    
    // è©¢åœˆè³‡æ–™
    inquiryRawData.forEach(d => {
        if (d.marketHigh > 0 && d.marketLow > 0) {
            // æª¢æŸ¥æ˜¯å¦å·²åœ¨ç«¶æ‹ä¸­
            if (allData.find(a => a.id === d.id)) return;
            
            // è©¢åœˆè³‡æ–™æ²’æœ‰openDateï¼Œå˜—è©¦å¾å…¶ä»–æ¬„ä½æ¨æ¸¬å¹´åº¦
            // é€™è£¡ç°¡åŒ–è™•ç†ï¼Œå‡è¨­æœ‰æ›ç‰Œæ•¸æ“šçš„è©¢åœˆéƒ½æ˜¯è¼ƒæ—©å¹´ä»½
            const amp = ((d.marketHigh - d.marketLow) / d.marketLow * 100);
            // ç”±æ–¼è©¢åœˆæ²’æœ‰æ—¥æœŸï¼Œé€™è£¡å…ˆè·³éå¹´åº¦åˆ†çµ„
            // æœªä¾†å¯æ ¹æ“šå¯¦éš›éœ€æ±‚èª¿æ•´
        }
    });
    
    // ä¾å¹´åº¦åˆ†çµ„ä¸¦æ’åº
    years.forEach(year => {
        const yearData = allData.filter(d => d.year === year);
        const sortedByAmp = [...yearData].sort((a, b) => b.amp - a.amp);
        
        yearlyRankingData[year] = {
            total: yearData.length,
            top10: sortedByAmp.slice(0, 10),
            bottom10: sortedByAmp.slice(-10).reverse(),
            summary: generateYearSummary(year, sortedByAmp)
        };
    });
    
    // é è¨­é¡¯ç¤º2022å¹´
    showRankingYear(2022);
}

function generateYearSummary(year, sortedData) {
    if (sortedData.length === 0) return 'æš«ç„¡è³‡æ–™';
    const top = sortedData[0];
    const auctionInTop10 = sortedData.slice(0, 10).filter(d => d.type === 'ç«¶æ‹').length;
    return `å† è»${top.name}æŒ¯å¹…${top.amp.toFixed(1)}%ï¼Œå‰10åç«¶æ‹ä½”${auctionInTop10}æª”ã€‚`;
}

function showRankingYear(year, event) {
    // é˜²æ­¢é é¢è·³å‹•
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    // æ›´æ–°tabç‹€æ…‹
    document.querySelectorAll('.ranking-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.textContent == year) {
            tab.classList.add('active');
        }
    });
    
    const data = yearlyRankingData[year];
    if (!data) return;
    
    // å»ºç«‹TOP10è¡¨æ ¼
    let html = `
    <div class="ranking-grid">
        <div class="ranking-box top">
            <div class="ranking-box-title">ğŸ† è¡¨ç¾æœ€ä½³ TOP 10</div>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>ä»£è™Ÿ</th>
                        <th>åç¨±</th>
                        <th>é¡å‹</th>
                        <th>ç‹€æ…‹</th>
                        <th>æ›ç‰Œé«˜</th>
                        <th>æ›ç‰Œä½</th>
                        <th>æŒ¯å¹…</th>
                    </tr>
                </thead>
                <tbody>`;
    
    data.top10.forEach((item, idx) => {
        const typeClass = item.type === 'ç«¶æ‹' ? 'auction' : 'inquiry';
        const statusClass = item.status === 'æ›ç‰Œä¸­' ? 'listed' : 'delisted';
        html += `
                    <tr>
                        <td><span class="rank-num">${idx + 1}</span></td>
                        <td>${item.id || '-'}</td>
                        <td title="${item.name}">${item.name}</td>
                        <td><span class="ranking-type ${typeClass}">${item.type}</span></td>
                        <td><span class="dimension-status-badge ${statusClass}">${item.status || 'å·²ä¸‹å¸‚'}</span></td>
                        <td class="val-gain">${item.high.toFixed(1)}</td>
                        <td>${item.low.toFixed(1)}</td>
                        <td class="val-amp">${item.amp.toFixed(1)}%</td>
                    </tr>`;
    });
    
    html += `
                </tbody>
            </table>
        </div>
        <div class="ranking-box bottom">
            <div class="ranking-box-title">ğŸ“‰ è¡¨ç¾æœ€å·® BOTTOM 10</div>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>ä»£è™Ÿ</th>
                        <th>åç¨±</th>
                        <th>é¡å‹</th>
                        <th>ç‹€æ…‹</th>
                        <th>æ›ç‰Œé«˜</th>
                        <th>æ›ç‰Œä½</th>
                        <th>æŒ¯å¹…</th>
                    </tr>
                </thead>
                <tbody>`;
    
    data.bottom10.forEach((item, idx) => {
        const typeClass = item.type === 'ç«¶æ‹' ? 'auction' : 'inquiry';
        const statusClass = item.status === 'æ›ç‰Œä¸­' ? 'listed' : 'delisted';
        html += `
                    <tr>
                        <td><span class="rank-num">${idx + 1}</span></td>
                        <td>${item.id || '-'}</td>
                        <td title="${item.name}">${item.name}</td>
                        <td><span class="ranking-type ${typeClass}">${item.type}</span></td>
                        <td><span class="dimension-status-badge ${statusClass}">${item.status || 'å·²ä¸‹å¸‚'}</span></td>
                        <td class="val-gain">${item.high.toFixed(1)}</td>
                        <td>${item.low.toFixed(1)}</td>
                        <td class="val-amp">${item.amp.toFixed(1)}%</td>
                    </tr>`;
    });
    
    html += `
                </tbody>
            </table>
        </div>
    </div>
    <div class="ranking-summary">
        ğŸ“Œ <strong>${year}å¹´(${data.total}æª”)ï¼š</strong>${data.summary}
    </div>`;
    
    document.getElementById('rankingContent').innerHTML = html;
}

// v3.56 æ–°å¢ï¼šæœˆå‡æˆäº¤çœŸå¯¦ç¸¾æ•ˆåˆ†æ
let realPerfData = {};

function generateRealPerformance() {
    // å»ºç«‹åç¨±åˆ°è³‡æ–™çš„å°ç…§è¡¨
    const nameToData = {};
    auctionRawData.forEach(d => {
        if (d.name) nameToData[d.name] = { id: d.id, type: 'ç«¶æ‹' };
    });
    inquiryRawData.forEach(d => {
        if (d.name && !nameToData[d.name]) nameToData[d.name] = { id: d.id, type: 'è©¢åœˆ' };
    });
    
    // è£œå……è³‡æ–™çš„è¼”åŠ©å‡½æ•¸
    const enrichItem = (item) => {
        const lookup = nameToData[item.name] || {};
        return {
            ...item,
            id: lookup.id || '',
            type: lookup.type || '-',
            status: lookup.id && listedSet.has(lookup.id) ? 'æ›ç‰Œä¸­' : 'å·²ä¸‹å¸‚'
        };
    };
    
    // ç¡¬ç·¨ç¢¼çš„æœˆå‡æˆäº¤ç¸¾æ•ˆæ•¸æ“šï¼ˆæœˆå‡åƒ¹ç„¡æ³•å¾Excelå–å¾—ï¼‰
    realPerfData = {
        2022: {
            total: 96,
            avgPos: 37.9,
            medianPos: 32.5,
            dist: { excellent: 12, good: 16, neutral: 13, weak: 18, poor: 37 },
            top5: [
                { name: 'äº‹æ¬£ç§‘ä¸‰', high: 215.0, low: 93.2, monthly: 215.0, pos: 100.0 },
                { name: 'ç¶­ç”°ä¸€', high: 185.0, low: 103.8, monthly: 185.0, pos: 100.0 },
                { name: 'å°å…‰é›»äº”', high: 388.0, low: 97.0, monthly: 382.4, pos: 98.1 },
                { name: 'å°ç£éŠ˜æ¿ä¸€', high: 496.0, low: 113.5, monthly: 479.0, pos: 95.6 },
                { name: 'è‰¯ç¶­ä¹', high: 208.0, low: 108.2, monthly: 203.0, pos: 95.0 }
            ].map(enrichItem),
            bottom5: [
                { name: 'æµ·å¾·å¨ä¸€', high: 133.3, low: 99.7, monthly: 99.8, pos: 0.4 },
                { name: 'ç«‹ç©ä¸€', high: 208.0, low: 99.5, monthly: 100.0, pos: 0.4 },
                { name: 'æ˜å®‰ä¸‰', high: 145.0, low: 99.6, monthly: 99.9, pos: 0.6 },
                { name: 'é¢¨é’äºŒ', high: 136.9, low: 99.7, monthly: 100.1, pos: 1.0 },
                { name: 'å¤§æ¨¹äºŒ', high: 155.0, low: 99.3, monthly: 99.9, pos: 1.0 }
            ].map(enrichItem),
            summary: 'å¹³å‡ä½ç½®37.9%åä½ï¼Œ38.5%æ¨™çš„ç›®å‰è™•æ–¼æ¥µå¼±å€(<20%)ï¼Œå¤šæ•¸æ›¾ç¶“è¼ç…Œç¾å·²å›è½ã€‚'
        },
        2023: {
            total: 91,
            avgPos: 36.0,
            medianPos: 29.5,
            dist: { excellent: 6, good: 13, neutral: 16, weak: 23, poor: 33 },
            top5: [
                { name: 'æ³°èŒ‚å››', high: 470.0, low: 121.5, monthly: 466.4, pos: 99.0 },
                { name: 'ç™¾é”äºŒK', high: 215.0, low: 104.0, monthly: 207.5, pos: 93.2 },
                { name: 'æ—­å“ä¸‰', high: 236.0, low: 115.3, monthly: 225.8, pos: 91.5 },
                { name: 'ç¢©å¤©äºŒ', high: 179.0, low: 111.0, monthly: 172.7, pos: 90.7 },
                { name: 'äº‹æ¬£ç§‘å››', high: 199.0, low: 99.5, monthly: 185.6, pos: 86.5 }
            ].map(enrichItem),
            bottom5: [
                { name: 'æ£®å´´èƒ½æºä¸€', high: 167.0, low: 97.8, monthly: 98.4, pos: 0.9 },
                { name: 'é«˜æ—ä¸€', high: 135.0, low: 99.8, monthly: 100.4, pos: 1.7 },
                { name: 'ä¸–å¾·äºŒ', high: 156.0, low: 96.0, monthly: 97.1, pos: 1.9 },
                { name: 'å¼˜å¸†ä¸€', high: 147.8, low: 100.0, monthly: 101.4, pos: 2.9 },
                { name: 'å¾¡åµ¿ä¸€', high: 159.0, low: 102.1, monthly: 104.1, pos: 3.6 }
            ].map(enrichItem),
            summary: 'å¹³å‡ä½ç½®36%ï¼Œ36%æ¨™çš„æ¥µå¼±ã€‚å† è»æ³°èŒ‚å››ä»ç¶­æŒé«˜æª”(99%)ï¼Œä½†å¤šæ•¸å·²å›è½è‡³ä½é»ã€‚'
        },
        2024: {
            total: 139,
            avgPos: 36.8,
            medianPos: 33.6,
            dist: { excellent: 9, good: 19, neutral: 29, weak: 33, poor: 49 },
            top5: [
                { name: 'ç¾¤ç¿ŠäºŒ', high: 120.4, low: 95.5, monthly: 118.2, pos: 90.9 },
                { name: 'jppä¸‰K', high: 202.0, low: 95.0, monthly: 192.0, pos: 90.6 },
                { name: 'é›™é´»äº”', high: 151.0, low: 105.0, monthly: 145.8, pos: 88.7 },
                { name: 'å˜‰æ™¶äº”', high: 110.9, low: 92.0, monthly: 108.6, pos: 87.9 },
                { name: 'å—ä¿Šåœ‹éš›äºŒ', high: 155.0, low: 98.0, monthly: 147.0, pos: 85.9 }
            ].map(enrichItem),
            bottom5: [
                { name: 'å€åŠ›ä¸€', high: 111.0, low: 97.5, monthly: 97.5, pos: 0.0 },
                { name: 'å…­è§’ä¸‰', high: 133.0, low: 99.8, monthly: 100.3, pos: 1.6 },
                { name: 'å¼˜å¸†ä¸‰', high: 155.0, low: 96.0, monthly: 98.1, pos: 3.5 },
                { name: 'è€€å‹ä¸€', high: 155.0, low: 97.6, monthly: 99.7, pos: 3.7 },
                { name: 'å…¶é™½äºŒ', high: 125.0, low: 95.1, monthly: 96.3, pos: 4.0 }
            ].map(enrichItem),
            summary: 'å¹³å‡ä½ç½®36.8%ï¼Œ35%æ¥µå¼±ã€‚ç™¼è¡Œé‡å¤§(139æª”)å°è‡´ç±Œç¢¼åˆ†æ•£ï¼Œå¤šæ•¸æ¨™çš„è¡¨ç¾å¹³æ·¡ã€‚'
        },
        2025: {
            total: 94,
            avgPos: 45.2,
            medianPos: 45.0,
            dist: { excellent: 4, good: 21, neutral: 31, weak: 24, poor: 14 },
            top5: [
                { name: 'å‡¡ç”²ä¸ƒ', high: 119.5, low: 105.0, monthly: 117.5, pos: 86.2 },
                { name: 'å¯¶ç·¯ä¸€', high: 105.0, low: 101.0, monthly: 104.4, pos: 84.0 },
                { name: 'è¯åˆäº”', high: 126.7, low: 106.0, monthly: 123.0, pos: 82.5 },
                { name: 'æ—ºçŸ½äº”', high: 232.0, low: 96.5, monthly: 206.1, pos: 80.9 },
                { name: 'è¯é›»ç¶²äº”', high: 116.2, low: 100.2, monthly: 112.9, pos: 79.6 }
            ].map(enrichItem),
            bottom5: [
                { name: 'çš‡æ™®å››', high: 112.2, low: 92.0, monthly: 92.4, pos: 2.0 },
                { name: 'æ³“å¾·èƒ½æºäºŒ', high: 114.0, low: 89.9, monthly: 90.7, pos: 3.4 },
                { name: 'è¯å¯¶ä¸€', high: 110.0, low: 102.0, monthly: 102.8, pos: 9.2 },
                { name: 'å¹³å’Œç’°ä¿ä¸€å‰µ', high: 118.0, low: 107.3, monthly: 108.3, pos: 9.3 },
                { name: 'å€‰å’Œä¸€', high: 101.0, low: 91.8, monthly: 92.8, pos: 10.8 }
            ].map(enrichItem),
            summary: 'å¹³å‡ä½ç½®45.2%è¼ƒé«˜ï¼Œæ¥µå¼±åƒ…14.9%ã€‚2025å¹´ç™¼è¡Œæ¨™çš„ç›¸å°è¼ƒæ–°ï¼Œå°šæœªå¤§å¹…å›è½ã€‚'
        }
    };
    
    // é è¨­é¡¯ç¤º2025å¹´ï¼ˆæœ€æ–°ï¼‰
    showRealPerfYear(2025);
}

function showRealPerfYear(year, event) {
    // é˜²æ­¢é é¢è·³å‹•
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    // æ›´æ–°tabç‹€æ…‹
    document.querySelectorAll('.realperf-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.textContent == year) {
            tab.classList.add('active');
        }
    });
    
    const data = realPerfData[year];
    if (!data) return;
    
    // çµ±è¨ˆåˆ†å¸ƒå€å¡Š
    let html = `
    <div class="realperf-stats">
        <div class="realperf-stat-box">
            <div class="realperf-stat-label">ğŸŸ¢æ¥µä½³(80%â†‘)</div>
            <div class="realperf-stat-value green">${data.dist.excellent}</div>
        </div>
        <div class="realperf-stat-box">
            <div class="realperf-stat-label">ğŸ”µè‰¯å¥½(60-80%)</div>
            <div class="realperf-stat-value blue">${data.dist.good}</div>
        </div>
        <div class="realperf-stat-box">
            <div class="realperf-stat-label">âšªä¸­æ€§(40-60%)</div>
            <div class="realperf-stat-value gray">${data.dist.neutral}</div>
        </div>
        <div class="realperf-stat-box">
            <div class="realperf-stat-label">ğŸŸ¡åå¼±(20-40%)</div>
            <div class="realperf-stat-value orange">${data.dist.weak}</div>
        </div>
        <div class="realperf-stat-box">
            <div class="realperf-stat-label">ğŸ”´æ¥µå¼±(<20%)</div>
            <div class="realperf-stat-value red">${data.dist.poor}</div>
        </div>
    </div>
    <div style="text-align:center; font-size:10px; color:#666; margin-bottom:10px;">
        å¹³å‡ä½ç½®: <b style="color:#1565c0">${data.avgPos}%</b> ï½œ ä¸­ä½æ•¸: <b style="color:#1565c0">${data.medianPos}%</b> ï½œ æ¨£æœ¬æ•¸: ${data.total}æª”
    </div>
    
    <div class="realperf-grid">
        <div class="realperf-box top">
            <div class="realperf-box-title">ğŸ”´ æœˆå‡æ¥è¿‘é«˜é» TOP5</div>
            <table class="realperf-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>ä»£è™Ÿ</th>
                        <th>åç¨±</th>
                        <th>é¡å‹</th>
                        <th>ç‹€æ…‹</th>
                        <th>æ›ç‰Œé«˜</th>
                        <th>æ›ç‰Œä½</th>
                        <th>æœˆå‡åƒ¹</th>
                        <th>ä½ç½®</th>
                    </tr>
                </thead>
                <tbody>`;
    
    data.top5.forEach((item, idx) => {
        const typeClass = item.type === 'ç«¶æ‹' ? 'auction' : 'inquiry';
        const statusClass = item.status === 'æ›ç‰Œä¸­' ? 'listed' : 'delisted';
        html += `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${item.id || '-'}</td>
                        <td>${item.name}</td>
                        <td><span class="ranking-type ${typeClass}">${item.type || '-'}</span></td>
                        <td><span class="dimension-status-badge ${statusClass}">${item.status || 'å·²ä¸‹å¸‚'}</span></td>
                        <td>${item.high.toFixed(1)}</td>
                        <td>${item.low.toFixed(1)}</td>
                        <td>${item.monthly.toFixed(1)}</td>
                        <td><span class="realperf-pos high">${item.pos.toFixed(1)}%</span></td>
                    </tr>`;
    });
    
    html += `
                </tbody>
            </table>
        </div>
        <div class="realperf-box bottom">
            <div class="realperf-box-title">ğŸŸ¢ æœˆå‡æ¥è¿‘ä½é» BOTTOM5</div>
            <table class="realperf-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>ä»£è™Ÿ</th>
                        <th>åç¨±</th>
                        <th>é¡å‹</th>
                        <th>ç‹€æ…‹</th>
                        <th>æ›ç‰Œé«˜</th>
                        <th>æ›ç‰Œä½</th>
                        <th>æœˆå‡åƒ¹</th>
                        <th>ä½ç½®</th>
                    </tr>
                </thead>
                <tbody>`;
    
    data.bottom5.forEach((item, idx) => {
        const typeClass = item.type === 'ç«¶æ‹' ? 'auction' : 'inquiry';
        const statusClass = item.status === 'æ›ç‰Œä¸­' ? 'listed' : 'delisted';
        html += `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${item.id || '-'}</td>
                        <td>${item.name}</td>
                        <td><span class="ranking-type ${typeClass}">${item.type || '-'}</span></td>
                        <td><span class="dimension-status-badge ${statusClass}">${item.status || 'å·²ä¸‹å¸‚'}</span></td>
                        <td>${item.high.toFixed(1)}</td>
                        <td>${item.low.toFixed(1)}</td>
                        <td>${item.monthly.toFixed(1)}</td>
                        <td><span class="realperf-pos low">${item.pos.toFixed(1)}%</span></td>
                    </tr>`;
    });
    
    html += `
                </tbody>
            </table>
        </div>
    </div>
    <div class="realperf-summary">
        ğŸ“Œ <strong>${year}å¹´ï¼š</strong>${data.summary}
    </div>`;
    
    document.getElementById('realperfContent').innerHTML = html;
}

// v3.59 æ–°å¢ï¼šç«¶æ‹ç›ˆè™§å‹ç‡åˆ†æ
let profitLossData = {};

function generateProfitLossAnalysis() {
    // å¾ç«¶æ‹è³‡æ–™è¨ˆç®—ç›ˆè™§
    const years = [2022, 2023, 2024, 2025];
    
    years.forEach(year => {
        // ç¯©é¸è©²å¹´åº¦æœ‰å®Œæ•´æ•¸æ“šçš„ç«¶æ‹
        const yearData = auctionRawData.filter(d => {
            if (!d.openDate || !d.minBidPrice || d.minBidPrice <= 0) return false;
            if (!d.marketHigh || d.marketHigh <= 0 || !d.marketLow || d.marketLow <= 0) return false;
            
            let dataYear = null;
            if (typeof d.openDate === 'number') {
                const date = new Date((d.openDate - 25569) * 86400 * 1000);
                dataYear = date.getFullYear();
            } else if (typeof d.openDate === 'string') {
                const parts = d.openDate.split(/[\/\-]/);
                dataYear = parseInt(parts[0]);
                if (dataYear < 100) dataYear += 2000;
            }
            return dataYear === year;
        });
        
        // è¨ˆç®—å„é …æŒ‡æ¨™
        let winByHigh = 0, winByLow = 0, winByAvg = 0;
        let totalProfitHigh = 0, totalProfitLow = 0, totalProfitAvg = 0;
        let details = [];
        
        yearData.forEach(d => {
            const minBid = d.minBidPrice;
            const avgBid = d.avgBidPrice || minBid;
            const high = d.marketHigh;
            const low = d.marketLow;
            
            // ä»¥æœ€ä½å¾—æ¨™è¨ˆç®—
            const profitByHigh = ((high - minBid) / minBid * 100);
            const profitByLow = ((low - minBid) / minBid * 100);
            const profitByAvgBid = ((high - avgBid) / avgBid * 100);
            
            if (high > minBid) winByHigh++;
            if (low > minBid) winByLow++;
            if (high > avgBid) winByAvg++;
            
            totalProfitHigh += profitByHigh;
            totalProfitLow += profitByLow;
            totalProfitAvg += profitByAvgBid;
            
            details.push({
                id: d.id,
                name: d.name,
                minBid: minBid,
                avgBid: avgBid,
                high: high,
                low: low,
                profitByHigh: profitByHigh,
                profitByLow: profitByLow,
                status: listedSet.has(d.id) ? 'æ›ç‰Œä¸­' : 'å·²ä¸‹å¸‚'
            });
        });
        
        const count = yearData.length;
        profitLossData[year] = {
            total: count,
            winRateByHigh: count > 0 ? (winByHigh / count * 100) : 0,
            winRateByLow: count > 0 ? (winByLow / count * 100) : 0,
            winRateByAvg: count > 0 ? (winByAvg / count * 100) : 0,
            avgProfitHigh: count > 0 ? (totalProfitHigh / count) : 0,
            avgProfitLow: count > 0 ? (totalProfitLow / count) : 0,
            avgProfitAvg: count > 0 ? (totalProfitAvg / count) : 0,
            details: details.sort((a, b) => b.profitByHigh - a.profitByHigh)
        };
    });
    
    // è¨ˆç®—å…¨éƒ¨å¹´åº¦ç¸½è¨ˆ
    let allData = [];
    years.forEach(y => {
        if (profitLossData[y]) {
            allData = allData.concat(profitLossData[y].details);
        }
    });
    
    const allCount = allData.length;
    let allWinHigh = 0, allWinLow = 0, allWinAvg = 0;
    let allProfitHigh = 0, allProfitLow = 0, allProfitAvg = 0;
    
    allData.forEach(d => {
        if (d.high > d.minBid) allWinHigh++;
        if (d.low > d.minBid) allWinLow++;
        if (d.high > d.avgBid) allWinAvg++;
        allProfitHigh += d.profitByHigh;
        allProfitLow += d.profitByLow;
    });
    
    profitLossData['all'] = {
        total: allCount,
        winRateByHigh: allCount > 0 ? (allWinHigh / allCount * 100) : 0,
        winRateByLow: allCount > 0 ? (allWinLow / allCount * 100) : 0,
        winRateByAvg: allCount > 0 ? (allWinAvg / allCount * 100) : 0,
        avgProfitHigh: allCount > 0 ? (allProfitHigh / allCount) : 0,
        avgProfitLow: allCount > 0 ? (allProfitLow / allCount) : 0,
        details: allData.sort((a, b) => b.profitByHigh - a.profitByHigh)
    };
    
    // é è¨­é¡¯ç¤º2022å¹´
    showProfitLossYear(2022);
}

function showProfitLossYear(year, event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    // æ›´æ–°tabç‹€æ…‹
    document.querySelectorAll('.profitloss-tab').forEach(tab => {
        tab.classList.remove('active');
        if ((year === 'all' && tab.textContent === 'å…¨éƒ¨') || tab.textContent == year) {
            tab.classList.add('active');
        }
    });
    
    const data = profitLossData[year];
    if (!data) return;
    
    const yearLabel = year === 'all' ? 'å…¨éƒ¨(2022-2025)' : year + 'å¹´';
    
    // çµ±è¨ˆå€å¡Š
    let html = `
    <div class="profitloss-stats">
        <div class="profitloss-stat-box">
            <div class="profitloss-stat-label">ğŸ“Š æ¨£æœ¬æ•¸</div>
            <div class="profitloss-stat-value neutral">${data.total}æª”</div>
        </div>
        <div class="profitloss-stat-box">
            <div class="profitloss-stat-label">ğŸ¯ æœ€ä½å¾—æ¨™vsæ›ç‰Œé«˜<br>å‹ç‡</div>
            <div class="profitloss-stat-value win">${data.winRateByHigh.toFixed(1)}%</div>
        </div>
        <div class="profitloss-stat-box">
            <div class="profitloss-stat-label">âš ï¸ æœ€ä½å¾—æ¨™vsæ›ç‰Œä½<br>å‹ç‡</div>
            <div class="profitloss-stat-value ${data.winRateByLow >= 50 ? 'win' : 'lose'}">${data.winRateByLow.toFixed(1)}%</div>
        </div>
        <div class="profitloss-stat-box">
            <div class="profitloss-stat-label">ğŸ“ˆ å¹³å‡å¾—æ¨™vsæ›ç‰Œé«˜<br>å‹ç‡</div>
            <div class="profitloss-stat-value win">${data.winRateByAvg.toFixed(1)}%</div>
        </div>
    </div>
    
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;">
        <div style="background:white; padding:10px; border-radius:8px; text-align:center;">
            <div style="font-size:10px; color:#666;">ä»¥æœ€ä½å¾—æ¨™è¨ˆ å¹³å‡å ±é…¬(æ›ç‰Œé«˜)</div>
            <div style="font-size:18px; font-weight:900; color:${data.avgProfitHigh >= 0 ? '#c62828' : '#2e7d32'};">${data.avgProfitHigh >= 0 ? '+' : ''}${data.avgProfitHigh.toFixed(1)}%</div>
        </div>
        <div style="background:white; padding:10px; border-radius:8px; text-align:center;">
            <div style="font-size:10px; color:#666;">ä»¥æœ€ä½å¾—æ¨™è¨ˆ å¹³å‡å ±é…¬(æ›ç‰Œä½)</div>
            <div style="font-size:18px; font-weight:900; color:${data.avgProfitLow >= 0 ? '#c62828' : '#2e7d32'};">${data.avgProfitLow >= 0 ? '+' : ''}${data.avgProfitLow.toFixed(1)}%</div>
        </div>
    </div>
    
    <div style="font-size:11px; font-weight:bold; color:#ad1457; margin:10px 0 5px 0;">ğŸ“‹ ${yearLabel} ç›ˆè™§æ˜ç´° TOP10/BOTTOM10</div>
    <table class="profitloss-table">
        <thead>
            <tr>
                <th>#</th>
                <th>ä»£è™Ÿ</th>
                <th>åç¨±</th>
                <th>ç‹€æ…‹</th>
                <th>æœ€ä½å¾—æ¨™</th>
                <th>æ›ç‰Œé«˜</th>
                <th>æ›ç‰Œä½</th>
                <th>å ±é…¬(é«˜)</th>
                <th>å ±é…¬(ä½)</th>
            </tr>
        </thead>
        <tbody>`;
    
    // TOP10
    const top10 = data.details.slice(0, 10);
    top10.forEach((item, idx) => {
        const statusClass = item.status === 'æ›ç‰Œä¸­' ? 'listed' : 'delisted';
        html += `
            <tr>
                <td>${idx + 1}</td>
                <td>${item.id || '-'}</td>
                <td>${item.name || '-'}</td>
                <td><span class="dimension-status-badge ${statusClass}">${item.status}</span></td>
                <td>${item.minBid.toFixed(2)}</td>
                <td>${item.high.toFixed(1)}</td>
                <td>${item.low.toFixed(1)}</td>
                <td class="val-win">+${item.profitByHigh.toFixed(1)}%</td>
                <td class="${item.profitByLow >= 0 ? 'val-win' : 'val-lose'}">${item.profitByLow >= 0 ? '+' : ''}${item.profitByLow.toFixed(1)}%</td>
            </tr>`;
    });
    
    // åˆ†éš”ç·š
    html += `<tr style="background:#fce4ec;"><td colspan="9" style="text-align:center; font-size:8px; color:#ad1457;">â”€â”€ BOTTOM 10 â”€â”€</td></tr>`;
    
    // BOTTOM10
    const bottom10 = data.details.slice(-10).reverse();
    bottom10.forEach((item, idx) => {
        const statusClass = item.status === 'æ›ç‰Œä¸­' ? 'listed' : 'delisted';
        html += `
            <tr>
                <td>${data.details.length - 9 + idx}</td>
                <td>${item.id || '-'}</td>
                <td>${item.name || '-'}</td>
                <td><span class="dimension-status-badge ${statusClass}">${item.status}</span></td>
                <td>${item.minBid.toFixed(2)}</td>
                <td>${item.high.toFixed(1)}</td>
                <td>${item.low.toFixed(1)}</td>
                <td class="${item.profitByHigh >= 0 ? 'val-win' : 'val-lose'}">${item.profitByHigh >= 0 ? '+' : ''}${item.profitByHigh.toFixed(1)}%</td>
                <td class="${item.profitByLow >= 0 ? 'val-win' : 'val-lose'}">${item.profitByLow >= 0 ? '+' : ''}${item.profitByLow.toFixed(1)}%</td>
            </tr>`;
    });
    
    html += `</tbody></table>`;
    
    // æ´å¯Ÿ
    const insight = data.winRateByLow >= 80 ? 
        `${yearLabel}ç«¶æ‹å‹ç‡æ¥µé«˜ï¼Œå³ä½¿ä»¥æ›ç‰Œä½è¨ˆç®—ä»æœ‰${data.winRateByLow.toFixed(0)}%æ©Ÿç‡ç²åˆ©ã€‚` :
        (data.winRateByLow >= 50 ?
            `${yearLabel}ç«¶æ‹å‹ç‡å°šå¯ï¼Œä»¥æ›ç‰Œä½è¨ˆç®—æœ‰${data.winRateByLow.toFixed(0)}%æ©Ÿç‡ç²åˆ©ï¼Œä½†éœ€æ³¨æ„é¸è‚¡ã€‚` :
            `${yearLabel}ç«¶æ‹é¢¨éšªè¼ƒé«˜ï¼Œä»¥æ›ç‰Œä½è¨ˆç®—åƒ…${data.winRateByLow.toFixed(0)}%æ©Ÿç‡ç²åˆ©ï¼Œå»ºè­°åš´æ§æŠ•æ¨™åƒ¹æ ¼ã€‚`);
    
    html += `
    <div class="profitloss-insight">
        <strong>ğŸ’¡ Rexå¤§å”åˆ†æï¼š</strong>${insight}
        ä»¥æœ€ä½å¾—æ¨™åƒ¹è¨ˆç®—ï¼Œè³£åœ¨æ›ç‰Œé«˜å¯ç²åˆ©${data.avgProfitHigh.toFixed(1)}%ï¼Œè³£åœ¨æ›ç‰Œä½å‰‡${data.avgProfitLow >= 0 ? 'ä»æœ‰' + data.avgProfitLow.toFixed(1) + '%ç²åˆ©ç©ºé–“' : 'å¹³å‡è™§æ' + Math.abs(data.avgProfitLow).toFixed(1) + '%'}ã€‚
    </div>`;
    
    document.getElementById('profitlossContent').innerHTML = html;
}

// v3.57 æ–°å¢ï¼šç¶­åº¦åˆ†æç¸½è¦½
// v3.58 æ–°å¢ï¼šå¸‚å ´è¶¨å‹¢åˆ†ææ•¸æ“š
let marketTrendData = {
    yearly: [], // å¹´åº¦è¶¨å‹¢
    guarantee: {}, // æ“”ä¿æ¯”è¼ƒ
    size: {}, // ç™¼è¡Œè¦æ¨¡
    capital: {}, // è‚¡æœ¬å¤§å°
    type: {} // ç«¶æ‹vsè©¢åœˆ
};

let dimensionData = {};

function generateDimensionAnalysis() {
    // å¾01å·¥ä½œè¡¨å»ºç«‹å®Œæ•´çš„CBè³‡æ–™ï¼ˆå«è©¢åœˆå’Œç«¶æ‹ï¼‰
    // é€™è£¡ä½¿ç”¨ç¡¬ç·¨ç¢¼çš„çµ±è¨ˆæ•¸æ“šï¼Œå¯¦éš›æ•¸æ“šå·²å¾Excelåˆ†æå¾—å‡º
    
    dimensionData = {
        capital: {
            name: 'è‚¡æœ¬',
            ranges: [
                {
                    label: '< 3å„„',
                    total: 26, auction: 9, inquiry: 17,
                    avgHigh: 158.9, avgLow: 101.2, avgAmp: 55.1,
                    items: [
                        { id: '65931', name: 'å°ç£éŠ˜æ¿ä¸€', type: 'ç«¶æ‹', high: 496.0, low: 113.5, amp: 337.0, status: 'æ›ç‰Œä¸­' },
                        { id: '62592', name: 'ç™¾å¾½äºŒ', type: 'è©¢åœˆ', high: 293.0, low: 100.2, amp: 192.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '27261', name: 'é›…èŒ—ä¸€K', type: 'è©¢åœˆ', high: 250.0, low: 110.0, amp: 127.3, status: 'å·²ä¸‹å¸‚' },
                        { id: '34341', name: 'å“²å›ºä¸€', type: 'ç«¶æ‹', high: 219.0, low: 107.0, amp: 104.7, status: 'å·²ä¸‹å¸‚' },
                        { id: '22501', name: 'IKKAä¸€K', type: 'è©¢åœˆ', high: 185.0, low: 100.2, amp: 84.6, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '3~6å„„',
                    total: 214, auction: 65, inquiry: 149,
                    avgHigh: 159.7, avgLow: 100.2, avgAmp: 58.1,
                    items: [
                        { id: '32051', name: 'ä½°ç ”ä¸€', type: 'è©¢åœˆ', high: 1100.0, low: 107.0, amp: 928.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '33101', name: 'ä½³ç©ä¸€', type: 'è©¢åœˆ', high: 489.0, low: 107.8, amp: 353.6, status: 'å·²ä¸‹å¸‚' },
                        { id: '66641', name: 'ç¾¤ç¿Šä¸€', type: 'è©¢åœˆ', high: 403.0, low: 102.0, amp: 295.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '35801', name: 'å‹å¨ç§‘ä¸€', type: 'è©¢åœˆ', high: 388.0, low: 100.1, amp: 287.6, status: 'å·²ä¸‹å¸‚' },
                        { id: '22304', name: 'æ³°èŒ‚å››', type: 'ç«¶æ‹', high: 470.0, low: 121.5, amp: 287.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '6~10å„„',
                    total: 315, auction: 86, inquiry: 229,
                    avgHigh: 182.2, avgLow: 100.4, avgAmp: 79.8,
                    items: [
                        { id: '47632', name: 'ææ–™äºŒK', type: 'è©¢åœˆ', high: 1035.0, low: 99.1, amp: 944.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '52631', name: 'æ™ºå´´ä¸€', type: 'è©¢åœˆ', high: 822.0, low: 107.0, amp: 668.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '14361', name: 'è¯å‹è¯ä¸€', type: 'ç«¶æ‹', high: 695.0, low: 106.0, amp: 555.7, status: 'å·²ä¸‹å¸‚' },
                        { id: '52632', name: 'æ™ºå´´äºŒ', type: 'è©¢åœˆ', high: 629.0, low: 103.3, amp: 508.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '47633', name: 'ææ–™ä¸‰K', type: 'ç«¶æ‹', high: 601.0, low: 100.0, amp: 501.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '10~15å„„',
                    total: 239, auction: 52, inquiry: 187,
                    avgHigh: 161.4, avgLow: 99.1, avgAmp: 62.4,
                    items: [
                        { id: '26364', name: 'å°é©ŠæŠ•æ§å››', type: 'ç«¶æ‹', high: 750.0, low: 106.2, amp: 606.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '22311', name: 'ç‚ºå‡ä¸€', type: 'è©¢åœˆ', high: 522.0, low: 107.0, amp: 387.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '64771', name: 'å®‰é›†ä¸€', type: 'ç«¶æ‹', high: 323.0, low: 91.0, amp: 254.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '62207', name: 'å²³è±ä¸ƒ', type: 'è©¢åœˆ', high: 329.0, low: 94.8, amp: 247.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '36251', name: 'è¥¿å‹ä¸€', type: 'è©¢åœˆ', high: 366.0, low: 106.5, amp: 243.7, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '15~20å„„',
                    total: 103, auction: 23, inquiry: 80,
                    avgHigh: 164.6, avgLow: 100.2, avgAmp: 63.3,
                    items: [
                        { id: '36651', name: 'è²¿è¯ä¸€', type: 'è©¢åœˆ', high: 522.0, low: 104.5, amp: 399.5, status: 'å·²ä¸‹å¸‚' },
                        { id: '15981', name: 'å²±å®‡ä¸€', type: 'è©¢åœˆ', high: 381.0, low: 100.0, amp: 281.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '61801', name: 'æ©˜å­ä¸€', type: 'è©¢åœˆ', high: 300.0, low: 100.2, amp: 199.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '98024', name: 'éˆºé½Šå››K', type: 'è©¢åœˆ', high: 293.0, low: 102.0, amp: 187.3, status: 'å·²ä¸‹å¸‚' },
                        { id: '62908', name: 'è‰¯ç¶­å…«', type: 'è©¢åœˆ', high: 298.0, low: 107.0, amp: 178.4, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '> 20å„„',
                    total: 359, auction: 57, inquiry: 302,
                    avgHigh: 166.0, avgLow: 98.8, avgAmp: 66.9,
                    items: [
                        { id: '17953', name: 'ç¾æ™‚ä¸‰', type: 'è©¢åœˆ', high: 611.0, low: 107.0, amp: 471.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '37072', name: 'æ¼¢ç£ŠäºŒ', type: 'è©¢åœˆ', high: 610.0, low: 109.8, amp: 455.8, status: 'å·²ä¸‹å¸‚' },
                        { id: '49191', name: 'æ–°å”ä¸€', type: 'ç«¶æ‹', high: 450.0, low: 97.0, amp: 363.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '80763', name: 'ä¼è±ä¸‰', type: 'è©¢åœˆ', high: 477.0, low: 107.0, amp: 345.8, status: 'å·²ä¸‹å¸‚' },
                        { id: '52137', name: 'äºæ˜•ä¸ƒ', type: 'è©¢åœˆ', high: 448.0, low: 102.0, amp: 339.2, status: 'å·²ä¸‹å¸‚' }
                    ]
                }
            ],
            summary: '6~10å„„å€é–“å¹³å‡æŒ¯å¹…æœ€é«˜(79.8%)ï¼Œå°è‚¡æœ¬(<3å„„)å› æ¨£æœ¬å°‘æ³¢å‹•å¤§ã€‚'
        },
        size: {
            name: 'ç™¼è¡Œè¦æ¨¡',
            ranges: [
                {
                    label: '< 2å„„',
                    total: 155, auction: 12, inquiry: 143,
                    avgHigh: 186.8, avgLow: 100.0, avgAmp: 88.1,
                    items: [
                        { id: '82871', name: 'è‹±æ ¼çˆ¾ã„§', type: 'è©¢åœˆ', high: 1390.0, low: 96.2, amp: 1344.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '32051', name: 'ä½°ç ”ä¸€', type: 'è©¢åœˆ', high: 1100.0, low: 107.0, amp: 928.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '52631', name: 'æ™ºå´´ä¸€', type: 'è©¢åœˆ', high: 822.0, low: 107.0, amp: 668.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '32521', name: 'æµ·ç£ä¸€', type: 'è©¢åœˆ', high: 159.0, low: 24.2, amp: 557.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '52632', name: 'æ™ºå´´äºŒ', type: 'è©¢åœˆ', high: 629.0, low: 103.3, amp: 508.9, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '2~5å„„',
                    total: 678, auction: 105, inquiry: 573,
                    avgHigh: 169.4, avgLow: 99.6, avgAmp: 70.4,
                    items: [
                        { id: '26364', name: 'å°é©ŠæŠ•æ§å››', type: 'ç«¶æ‹', high: 750.0, low: 106.2, amp: 606.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '14361', name: 'è¯å‹è¯ä¸€', type: 'ç«¶æ‹', high: 695.0, low: 106.0, amp: 555.7, status: 'å·²ä¸‹å¸‚' },
                        { id: '55342', name: 'é•·è™¹äºŒ', type: 'è©¢åœˆ', high: 585.0, low: 94.5, amp: 519.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '89321', name: 'å®å¤§ä¸€', type: 'è©¢åœˆ', high: 681.0, low: 116.0, amp: 487.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '17953', name: 'ç¾æ™‚ä¸‰', type: 'è©¢åœˆ', high: 611.0, low: 107.0, amp: 471.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '5~10å„„',
                    total: 415, auction: 85, inquiry: 330,
                    avgHigh: 168.7, avgLow: 98.3, avgAmp: 71.0,
                    items: [
                        { id: '47632', name: 'ææ–™äºŒK', type: 'è©¢åœˆ', high: 1035.0, low: 99.1, amp: 944.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '47633', name: 'ææ–™ä¸‰K', type: 'ç«¶æ‹', high: 601.0, low: 100.0, amp: 501.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '37072', name: 'æ¼¢ç£ŠäºŒ', type: 'è©¢åœˆ', high: 610.0, low: 109.8, amp: 455.8, status: 'å·²ä¸‹å¸‚' },
                        { id: '14773', name: 'èšé™½ä¸‰', type: 'è©¢åœˆ', high: 495.0, low: 106.5, amp: 364.8, status: 'å·²ä¸‹å¸‚' },
                        { id: '33101', name: 'ä½³ç©ä¸€', type: 'è©¢åœˆ', high: 489.0, low: 107.8, amp: 353.6, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '10~15å„„',
                    total: 177, auction: 52, inquiry: 125,
                    avgHigh: 160.0, avgLow: 96.8, avgAmp: 66.5,
                    items: [
                        { id: '14362', name: 'è¯å‹è¯äºŒ', type: 'è©¢åœˆ', high: 600.0, low: 111.1, amp: 440.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '33244', name: 'é›™é´»å››', type: 'è©¢åœˆ', high: 496.0, low: 100.8, amp: 392.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '61874', name: 'è¬æ½¤å››', type: 'ç«¶æ‹', high: 467.0, low: 98.0, amp: 376.5, status: 'å·²ä¸‹å¸‚' },
                        { id: '52137', name: 'äºæ˜•ä¸ƒ', type: 'è©¢åœˆ', high: 448.0, low: 102.0, amp: 339.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '25424', name: 'èˆˆå¯Œç™¼å››', type: 'è©¢åœˆ', high: 415.0, low: 107.0, amp: 287.9, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '15~20å„„',
                    total: 72, auction: 20, inquiry: 52,
                    avgHigh: 157.6, avgLow: 96.5, avgAmp: 64.2,
                    items: [
                        { id: '18083', name: 'æ½¤éš†ä¸‰', type: 'è©¢åœˆ', high: 305.0, low: 105.2, amp: 189.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '80703', name: 'é•·è¯ä¸‰', type: 'è©¢åœˆ', high: 269.0, low: 98.4, amp: 173.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '80702', name: 'é•·è¯äºŒ', type: 'è©¢åœˆ', high: 269.0, low: 99.1, amp: 171.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '25472', name: 'æ—¥å‹äºŒ', type: 'è©¢åœˆ', high: 175.0, low: 65.2, amp: 168.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '24891', name: 'ç‘è»’äºŒ', type: 'è©¢åœˆ', high: 228.0, low: 87.5, amp: 160.7, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '> 20å„„',
                    total: 142, auction: 22, inquiry: 120,
                    avgHigh: 148.9, avgLow: 94.4, avgAmp: 63.7,
                    items: [
                        { id: '62892', name: 'è¯ä¸ŠäºŒ', type: 'è©¢åœˆ', high: 147.9, low: 19.8, amp: 647.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '49191', name: 'æ–°å”ä¸€', type: 'ç«¶æ‹', high: 450.0, low: 97.0, amp: 363.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '53461', name: 'åŠ›æ™¶ä¸€', type: 'è©¢åœˆ', high: 119.8, low: 27.2, amp: 340.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '53462', name: 'åŠ›æ™¶äºŒ', type: 'è©¢åœˆ', high: 121.0, low: 28.5, amp: 324.6, status: 'å·²ä¸‹å¸‚' },
                        { id: '23835', name: 'å°å…‰é›»äº”', type: 'è©¢åœˆ', high: 388.0, low: 97.0, amp: 300.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                }
            ],
            summary: 'å°è¦æ¨¡(<2å„„)æŒ¯å¹…æœ€é«˜(88.1%)ï¼Œ5~10å„„ç‚ºç”œèœœé»(71.0%)ï¼Œå¤§è¦æ¨¡(>20å„„)æŒ¯å¹…ä»æœ‰63.7%ã€‚'
        },
        conversion: {
            name: 'è½‰æ›åƒ¹',
            ranges: [
                {
                    label: '< 20å…ƒ',
                    total: 341, auction: 25, inquiry: 303,
                    avgHigh: 174.5, avgLow: 100.2, avgAmp: 77.1,
                    items: [
                        { id: '82871', name: 'è‹±æ ¼çˆ¾ã„§', type: 'è©¢åœˆ', high: 1390.0, low: 96.2, amp: 1344.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '89321', name: 'å®å¤§ä¸€', type: 'è©¢åœˆ', high: 681.0, low: 116.0, amp: 487.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '24822', name: 'é€£å®‡äºŒ', type: 'ç«¶æ‹', high: 552.0, low: 110.1, amp: 401.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '61082', name: 'ç«¶åœ‹äºŒ', type: 'è©¢åœˆ', high: 305.0, low: 64.8, amp: 370.3, status: 'å·²ä¸‹å¸‚' },
                        { id: '53461', name: 'åŠ›æ™¶ä¸€', type: 'è©¢åœˆ', high: 119.8, low: 27.2, amp: 340.4, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '20~50å…ƒ',
                    total: 619, auction: 86, inquiry: 511,
                    avgHigh: 167.8, avgLow: 97.0, avgAmp: 74.1,
                    items: [
                        { id: '32051', name: 'ä½°ç ”ä¸€', type: 'è©¢åœˆ', high: 1100.0, low: 107.0, amp: 928.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '62892', name: 'è¯ä¸ŠäºŒ', type: 'è©¢åœˆ', high: 147.9, low: 19.8, amp: 647.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '26364', name: 'å°é©ŠæŠ•æ§å››', type: 'ç«¶æ‹', high: 750.0, low: 106.2, amp: 606.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '32521', name: 'æµ·ç£ä¸€', type: 'è©¢åœˆ', high: 159.0, low: 24.2, amp: 557.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '14361', name: 'è¯å‹è¯ä¸€', type: 'ç«¶æ‹', high: 695.0, low: 106.0, amp: 555.7, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '50~100å…ƒ',
                    total: 396, auction: 80, inquiry: 303,
                    avgHigh: 167.0, avgLow: 98.6, avgAmp: 68.6,
                    items: [
                        { id: '52631', name: 'æ™ºå´´ä¸€', type: 'è©¢åœˆ', high: 822.0, low: 107.0, amp: 668.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '52632', name: 'æ™ºå´´äºŒ', type: 'è©¢åœˆ', high: 629.0, low: 103.3, amp: 508.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '17953', name: 'ç¾æ™‚ä¸‰', type: 'è©¢åœˆ', high: 611.0, low: 107.0, amp: 471.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '37072', name: 'æ¼¢ç£ŠäºŒ', type: 'è©¢åœˆ', high: 610.0, low: 109.8, amp: 455.8, status: 'å·²ä¸‹å¸‚' },
                        { id: '14362', name: 'è¯å‹è¯äºŒ', type: 'è©¢åœˆ', high: 600.0, low: 111.1, amp: 440.1, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '100~150å…ƒ',
                    total: 143, auction: 47, inquiry: 94,
                    avgHigh: 164.8, avgLow: 98.2, avgAmp: 69.0,
                    items: [
                        { id: '47632', name: 'ææ–™äºŒK', type: 'è©¢åœˆ', high: 1035.0, low: 99.1, amp: 944.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '99551', name: 'ä½³é¾ä¸€', type: 'è©¢åœˆ', high: 602.0, low: 100.0, amp: 502.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '47633', name: 'ææ–™ä¸‰K', type: 'ç«¶æ‹', high: 601.0, low: 100.0, amp: 501.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '22311', name: 'ç‚ºå‡ä¸€', type: 'è©¢åœˆ', high: 522.0, low: 107.0, amp: 387.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '36651', name: 'è²¿è¯ä¸€', type: 'è©¢åœˆ', high: 522.0, low: 104.5, amp: 399.5, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '150~200å…ƒ',
                    total: 62, auction: 19, inquiry: 42,
                    avgHigh: 152.8, avgLow: 99.8, avgAmp: 52.7,
                    items: [
                        { id: '61394', name: 'äºç¿”å››', type: 'è©¢åœˆ', high: 310.0, low: 110.0, amp: 181.8, status: 'æ›ç‰Œä¸­' },
                        { id: '80703', name: 'é•·è¯ä¸‰', type: 'è©¢åœˆ', high: 269.0, low: 98.4, amp: 173.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '61973', name: 'ä½³å¿…çªä¸‰', type: 'ç«¶æ‹', high: 268.0, low: 101.8, amp: 163.4, status: 'æ›ç‰Œä¸­' },
                        { id: '84621', name: 'æŸæ–‡ä¸€', type: 'è©¢åœˆ', high: 259.0, low: 104.1, amp: 148.8, status: 'å·²ä¸‹å¸‚' },
                        { id: '34132', name: 'äº¬é¼äºŒ', type: 'è©¢åœˆ', high: 243.0, low: 105.1, amp: 131.2, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '> 200å…ƒ',
                    total: 99, auction: 39, inquiry: 58,
                    avgHigh: 157.6, avgLow: 99.9, avgAmp: 57.2,
                    items: [
                        { id: '33244', name: 'é›™é´»å››', type: 'è©¢åœˆ', high: 496.0, low: 100.8, amp: 392.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '23835', name: 'å°å…‰é›»äº”', type: 'è©¢åœˆ', high: 388.0, low: 97.0, amp: 300.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '64722', name: 'ä¿ç‘äºŒ', type: 'ç«¶æ‹', high: 355.0, low: 104.0, amp: 241.3, status: 'å·²ä¸‹å¸‚' },
                        { id: '80702', name: 'é•·è¯äºŒ', type: 'è©¢åœˆ', high: 269.0, low: 99.1, amp: 171.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '89964', name: 'é«˜åŠ›å››', type: 'ç«¶æ‹', high: 264.0, low: 107.0, amp: 146.7, status: 'æ›ç‰Œä¸­' }
                    ]
                }
            ],
            summary: 'ä½åƒ¹è‚¡(<20å…ƒ)æŒ¯å¹…æœ€é«˜(77.1%)ï¼Œ20~50å…ƒå€é–“(74.1%)æ¬¡ä¹‹ï¼Œé«˜è½‰æ›åƒ¹150~200å…ƒæŒ¯å¹…æœ€ä½(52.7%)ã€‚'
        },
        rating: {
            name: 'ä¿¡è©•',
            ranges: [
                {
                    label: 'TCRI 3',
                    total: 27, auction: 5, inquiry: 22,
                    avgHigh: 175.2, avgLow: 99.0, avgAmp: 75.3,
                    items: [
                        { id: '23835', name: 'å°å…‰é›»äº”', type: 'è©¢åœˆ', high: 388.0, low: 97.0, amp: 300.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '14774', name: 'èšé™½å››', type: 'è©¢åœˆ', high: 401.0, low: 106.2, amp: 277.6, status: 'å·²ä¸‹å¸‚' },
                        { id: '54255', name: 'å°åŠäº”', type: 'è©¢åœˆ', high: 257.0, low: 99.5, amp: 158.3, status: 'å·²ä¸‹å¸‚' },
                        { id: '62853', name: 'å•Ÿç¢ä¸‰', type: 'è©¢åœˆ', high: 251.0, low: 100.3, amp: 150.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '23836', name: 'å°å…‰é›»å…­', type: 'è©¢åœˆ', high: 230.0, low: 101.8, amp: 126.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: 'TCRI 4',
                    total: 135, auction: 37, inquiry: 98,
                    avgHigh: 163.8, avgLow: 100.4, avgAmp: 62.6,
                    items: [
                        { id: '26364', name: 'å°é©ŠæŠ•æ§å››', type: 'ç«¶æ‹', high: 750.0, low: 106.2, amp: 606.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '33244', name: 'é›™é´»å››', type: 'è©¢åœˆ', high: 496.0, low: 100.8, amp: 392.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '49191', name: 'æ–°å”ä¸€', type: 'ç«¶æ‹', high: 450.0, low: 97.0, amp: 363.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '30366', name: 'æ–‡æ›„å…­', type: 'è©¢åœˆ', high: 330.0, low: 104.0, amp: 217.3, status: 'å·²ä¸‹å¸‚' },
                        { id: '23602', name: 'è‡´èŒ‚äºŒ', type: 'è©¢åœˆ', high: 309.0, low: 100.0, amp: 209.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: 'TCRI 5',
                    total: 231, auction: 55, inquiry: 176,
                    avgHigh: 169.6, avgLow: 99.6, avgAmp: 69.2,
                    items: [
                        { id: '47632', name: 'ææ–™äºŒK', type: 'è©¢åœˆ', high: 1035.0, low: 99.1, amp: 944.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '47633', name: 'ææ–™ä¸‰K', type: 'ç«¶æ‹', high: 601.0, low: 100.0, amp: 501.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '35523', name: 'åŒè‡´ä¸‰', type: 'è©¢åœˆ', high: 545.0, low: 102.0, amp: 434.3, status: 'å·²ä¸‹å¸‚' },
                        { id: '36651', name: 'è²¿è¯ä¸€', type: 'è©¢åœˆ', high: 522.0, low: 104.5, amp: 399.5, status: 'å·²ä¸‹å¸‚' },
                        { id: '61874', name: 'è¬æ½¤å››', type: 'ç«¶æ‹', high: 467.0, low: 98.0, amp: 376.5, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: 'TCRI 6',
                    total: 261, auction: 72, inquiry: 189,
                    avgHigh: 155.4, avgLow: 97.7, avgAmp: 58.6,
                    items: [
                        { id: '52632', name: 'æ™ºå´´äºŒ', type: 'è©¢åœˆ', high: 629.0, low: 103.3, amp: 508.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '66641', name: 'ç¾¤ç¿Šä¸€', type: 'è©¢åœˆ', high: 403.0, low: 102.0, amp: 295.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '31631', name: 'æ³¢è‹¥å¨ä¸€', type: 'è©¢åœˆ', high: 402.0, low: 107.0, amp: 275.7, status: 'å·²ä¸‹å¸‚' },
                        { id: '64771', name: 'å®‰é›†ä¸€', type: 'ç«¶æ‹', high: 323.0, low: 91.0, amp: 254.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '62207', name: 'å²³è±ä¸ƒ', type: 'è©¢åœˆ', high: 329.0, low: 94.8, amp: 247.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: 'TCRI 7',
                    total: 107, auction: 16, inquiry: 91,
                    avgHigh: 143.8, avgLow: 94.6, avgAmp: 52.2,
                    items: [
                        { id: '26302', name: 'äºèˆªäºŒ', type: 'è©¢åœˆ', high: 390.0, low: 97.0, amp: 302.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '18156', name: 'å¯Œå–¬å…­', type: 'è©¢åœˆ', high: 283.0, low: 95.6, amp: 196.0, status: 'æ›ç‰Œä¸­' },
                        { id: '50113', name: 'ä¹…é™½ä¸‰', type: 'è©¢åœˆ', high: 237.0, low: 85.0, amp: 178.8, status: 'å·²ä¸‹å¸‚' },
                        { id: '89335', name: 'æ„›åœ°é›…äº”', type: 'è©¢åœˆ', high: 180.0, low: 72.0, amp: 150.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '27311', name: 'é›„ç…ä¸€', type: 'è©¢åœˆ', high: 225.0, low: 92.0, amp: 144.6, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: 'TCRI 8',
                    total: 27, auction: 6, inquiry: 21,
                    avgHigh: 162.7, avgLow: 95.5, avgAmp: 68.8,
                    items: [
                        { id: '37011', name: 'å¤§çœ¾æ§ä¸€', type: 'è©¢åœˆ', high: 441.0, low: 111.1, amp: 296.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '62209', name: 'å²³è±ä¹', type: 'è©¢åœˆ', high: 268.0, low: 80.0, amp: 235.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '89276', name: 'åŒ—åŸºå…­', type: 'ç«¶æ‹', high: 272.0, low: 98.2, amp: 177.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '13165', name: 'ä¸Šæ›œäº”', type: 'è©¢åœˆ', high: 232.0, low: 99.6, amp: 132.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '99062', name: 'æ¬£å·´å·´äºŒ', type: 'è©¢åœˆ', high: 247.0, low: 110.0, amp: 124.5, status: 'å·²ä¸‹å¸‚' }
                    ]
                }
            ],
            summary: 'TCRI 3æŒ¯å¹…æœ€é«˜(75.3%)ä½†æ¨£æœ¬å°‘ï¼ŒTCRI 5ç‚ºæœ€ä½³å¹³è¡¡é»(69.2%/231æª”)ã€‚'
        },
        years: {
            name: 'å¹´æœŸ',
            ranges: [
                {
                    label: '3å¹´æœŸ',
                    total: 1047, auction: 225, inquiry: 822,
                    avgHigh: 163.0, avgLow: 99.8, avgAmp: 62.2,
                    items: [
                        { id: '32051', name: 'ä½°ç ”ä¸€', type: 'è©¢åœˆ', high: 1100.0, low: 107.0, amp: 928.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '52631', name: 'æ™ºå´´ä¸€', type: 'è©¢åœˆ', high: 822.0, low: 107.0, amp: 668.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '26364', name: 'å°é©ŠæŠ•æ§å››', type: 'ç«¶æ‹', high: 750.0, low: 106.2, amp: 606.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '52632', name: 'æ™ºå´´äºŒ', type: 'è©¢åœˆ', high: 629.0, low: 103.3, amp: 508.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '99551', name: 'ä½³é¾ä¸€', type: 'è©¢åœˆ', high: 602.0, low: 100.0, amp: 502.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '5å¹´æœŸ',
                    total: 578, auction: 70, inquiry: 508,
                    avgHigh: 176.9, avgLow: 96.1, avgAmp: 86.9,
                    items: [
                        { id: '82871', name: 'è‹±æ ¼çˆ¾ã„§', type: 'è©¢åœˆ', high: 1390.0, low: 96.2, amp: 1344.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '47632', name: 'ææ–™äºŒK', type: 'è©¢åœˆ', high: 1035.0, low: 99.1, amp: 944.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '32521', name: 'æµ·ç£ä¸€', type: 'è©¢åœˆ', high: 159.0, low: 24.2, amp: 557.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '14361', name: 'è¯å‹è¯ä¸€', type: 'ç«¶æ‹', high: 695.0, low: 106.0, amp: 555.7, status: 'å·²ä¸‹å¸‚' },
                        { id: '47633', name: 'ææ–™ä¸‰K', type: 'ç«¶æ‹', high: 601.0, low: 100.0, amp: 501.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: '7å¹´æœŸ',
                    total: 1, auction: 1, inquiry: 0,
                    avgHigh: 450.0, avgLow: 97.0, avgAmp: 363.9,
                    items: [
                        { id: '49191', name: 'æ–°å”ä¸€', type: 'ç«¶æ‹', high: 450.0, low: 97.0, amp: 363.9, status: 'å·²ä¸‹å¸‚' }
                    ]
                }
            ],
            summary: '5å¹´æœŸæŒ¯å¹…æœ€ä½³(86.9%)ï¼Œ3å¹´æœŸç‚ºä¸»æµ(1047æª”/62.2%)ï¼Œ7å¹´æœŸç›®å‰åƒ…1æª”ã€‚'
        },
        guarantee: {
            name: 'æ“”ä¿',
            ranges: [
                {
                    label: 'æœ‰æ“”ä¿',
                    total: 455, auction: 100, inquiry: 355,
                    avgHigh: 183.0, avgLow: 102.4, avgAmp: 77.0,
                    items: [
                        { id: '32051', name: 'ä½°ç ”ä¸€', type: 'è©¢åœˆ', high: 1100.0, low: 107.0, amp: 928.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '52631', name: 'æ™ºå´´ä¸€', type: 'è©¢åœˆ', high: 822.0, low: 107.0, amp: 668.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '14361', name: 'è¯å‹è¯ä¸€', type: 'ç«¶æ‹', high: 695.0, low: 106.0, amp: 555.7, status: 'å·²ä¸‹å¸‚' },
                        { id: '89321', name: 'å®å¤§ä¸€', type: 'è©¢åœˆ', high: 681.0, low: 116.0, amp: 487.1, status: 'å·²ä¸‹å¸‚' },
                        { id: '17953', name: 'ç¾æ™‚ä¸‰', type: 'è©¢åœˆ', high: 611.0, low: 107.0, amp: 471.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                },
                {
                    label: 'ç„¡æ“”ä¿',
                    total: 827, auction: 196, inquiry: 631,
                    avgHigh: 161.0, avgLow: 98.2, avgAmp: 63.4,
                    items: [
                        { id: '47632', name: 'ææ–™äºŒK', type: 'è©¢åœˆ', high: 1035.0, low: 99.1, amp: 944.4, status: 'å·²ä¸‹å¸‚' },
                        { id: '26364', name: 'å°é©ŠæŠ•æ§å››', type: 'ç«¶æ‹', high: 750.0, low: 106.2, amp: 606.2, status: 'å·²ä¸‹å¸‚' },
                        { id: '52632', name: 'æ™ºå´´äºŒ', type: 'è©¢åœˆ', high: 629.0, low: 103.3, amp: 508.9, status: 'å·²ä¸‹å¸‚' },
                        { id: '99551', name: 'ä½³é¾ä¸€', type: 'è©¢åœˆ', high: 602.0, low: 100.0, amp: 502.0, status: 'å·²ä¸‹å¸‚' },
                        { id: '47633', name: 'ææ–™ä¸‰K', type: 'ç«¶æ‹', high: 601.0, low: 100.0, amp: 501.0, status: 'å·²ä¸‹å¸‚' }
                    ]
                }
            ],
            summary: 'æœ‰æ“”ä¿æŒ¯å¹…(77.0%)é«˜æ–¼ç„¡æ“”ä¿(63.4%)ï¼Œæœ‰æ“”ä¿æä¾›è¼ƒé«˜å®‰å…¨é‚Šéš›ã€‚'
        }
    };
    
    // é è¨­é¡¯ç¤ºè‚¡æœ¬
    showDimensionTab('capital');
}

// v3.59 æ›´æ–°ï¼šå¸‚å ´è¶¨å‹¢åˆ†æï¼ˆå¾01å·¥ä½œè¡¨å®Œæ•´çµ±è¨ˆï¼Œå¤šå¹´åº¦ç‰ˆï¼‰
function generateMarketTrendAnalysis() {
    // å®Œæ•´å¹´åº¦æ•¸æ“šï¼ˆ2010-2025ï¼Œå¾01å·¥ä½œè¡¨Ræ¬„æ›ç‰Œæ—¥æœŸçµ±è¨ˆï¼‰
    marketTrendData.yearly = [
        { year: 2010, total: 118, inquiry: 118, auction: 0, avgAmp: 51.4 },
        { year: 2011, total: 100, inquiry: 99, auction: 0, avgAmp: 48.8 },
        { year: 2012, total: 76, inquiry: 75, auction: 0, avgAmp: 68.6 },
        { year: 2013, total: 89, inquiry: 88, auction: 0, avgAmp: 91.3 },
        { year: 2014, total: 96, inquiry: 95, auction: 0, avgAmp: 48.8 },
        { year: 2015, total: 100, inquiry: 96, auction: 0, avgAmp: 62.2 },
        { year: 2016, total: 55, inquiry: 55, auction: 0, avgAmp: 72.9 },
        { year: 2017, total: 46, inquiry: 45, auction: 0, avgAmp: 60.8 },
        { year: 2018, total: 57, inquiry: 56, auction: 0, avgAmp: 79.5 },
        { year: 2019, total: 71, inquiry: 63, auction: 6, avgAmp: 79.1 },
        { year: 2020, total: 97, inquiry: 73, auction: 24, avgAmp: 112.2 },
        { year: 2021, total: 103, inquiry: 59, auction: 44, avgAmp: 79.4 },
        { year: 2022, total: 96, inquiry: 43, auction: 53, avgAmp: 83.5 },
        { year: 2023, total: 91, inquiry: 47, auction: 44, avgAmp: 68.3 },
        { year: 2024, total: 139, inquiry: 64, auction: 75, avgAmp: 44.5 },
        { year: 2025, total: 95, inquiry: 47, auction: 48, avgAmp: 22.5 }
    ];
    
    // æ“”ä¿æ¯”è¼ƒï¼ˆå¤šå¹´åº¦æ•¸æ“šï¼‰
    marketTrendData.guarantee = {
        overall: {
            guaranteed: { count: 455, avgHigh: 183.0, avgLow: 102.4, avgAmp: 77.0 },
            unguaranteed: { count: 827, avgHigh: 161.0, avgLow: 98.2, avgAmp: 63.4 }
        },
        yearly: [
            { year: 2011, gCount: 35, gAmp: 48.8, uCount: 26, uAmp: 54.6 },
            { year: 2012, gCount: 37, gAmp: 73.8, uCount: 38, uAmp: 64.3 },
            { year: 2013, gCount: 40, gAmp: 119.0, uCount: 48, uAmp: 68.5 },
            { year: 2014, gCount: 42, gAmp: 41.7, uCount: 53, uAmp: 54.8 },
            { year: 2015, gCount: 52, gAmp: 73.9, uCount: 44, uAmp: 43.0 },
            { year: 2016, gCount: 28, gAmp: 85.6, uCount: 27, uAmp: 60.2 },
            { year: 2017, gCount: 19, gAmp: 61.8, uCount: 26, uAmp: 57.2 },
            { year: 2018, gCount: 10, gAmp: 116.2, uCount: 46, uAmp: 72.7 },
            { year: 2019, gCount: 27, gAmp: 70.8, uCount: 42, uAmp: 80.0 },
            { year: 2020, gCount: 42, gAmp: 109.9, uCount: 55, uAmp: 114.3 },
            { year: 2021, gCount: 39, gAmp: 94.8, uCount: 64, uAmp: 69.7 },
            { year: 2022, gCount: 23, gAmp: 71.3, uCount: 73, uAmp: 86.2 },
            { year: 2023, gCount: 17, gAmp: 107.8, uCount: 74, uAmp: 59.3 },
            { year: 2024, gCount: 21, gAmp: 40.7, uCount: 118, uAmp: 44.8 },
            { year: 2025, gCount: 16, gAmp: 17.7, uCount: 79, uAmp: 23.9 }
        ]
    };
    
    // ç™¼è¡Œè¦æ¨¡å€é–“ï¼ˆä¾05å·¥ä½œè¡¨è¨­å®šï¼‰
    marketTrendData.size = {
        ranges: [
            { label: 'å°æ–¼2å„„', count: 155, avgHigh: 186.8, avgLow: 100.0, avgAmp: 88.1 },
            { label: '2~5å„„', count: 678, avgHigh: 169.4, avgLow: 99.6, avgAmp: 70.4 },
            { label: '5~10å„„', count: 415, avgHigh: 168.7, avgLow: 98.3, avgAmp: 71.0 },
            { label: '10~15å„„', count: 177, avgHigh: 160.0, avgLow: 96.8, avgAmp: 66.6 },
            { label: '15~20å„„', count: 72, avgHigh: 157.6, avgLow: 96.5, avgAmp: 64.2 },
            { label: 'å¤§æ–¼20å„„', count: 142, avgHigh: 148.9, avgLow: 94.4, avgAmp: 63.7 }
        ]
    };
    
    // è‚¡æœ¬å€é–“ï¼ˆä¾05å·¥ä½œè¡¨è¨­å®šï¼‰
    marketTrendData.capital = {
        ranges: [
            { label: 'å°æ–¼3å„„', count: 26, avgHigh: 158.9, avgLow: 101.2, avgAmp: 55.1 },
            { label: '3~6å„„', count: 214, avgHigh: 159.7, avgLow: 100.2, avgAmp: 58.1 },
            { label: '6~10å„„', count: 315, avgHigh: 182.2, avgLow: 100.4, avgAmp: 79.8 },
            { label: '10~15å„„', count: 239, avgHigh: 161.4, avgLow: 99.1, avgAmp: 62.4 },
            { label: '15~20å„„', count: 103, avgHigh: 164.6, avgLow: 100.2, avgAmp: 63.3 },
            { label: 'å¤§æ–¼20å„„', count: 359, avgHigh: 166.0, avgLow: 98.8, avgAmp: 66.9 }
        ]
    };
    
    // è½‰æ›åƒ¹å€é–“ï¼ˆä¾05å·¥ä½œè¡¨è¨­å®šï¼‰
    marketTrendData.conversion = {
        ranges: [
            { label: 'å°æ–¼20å…ƒ', count: 341, avgHigh: 174.5, avgLow: 100.2, avgAmp: 77.1 },
            { label: '20~50å…ƒ', count: 619, avgHigh: 167.8, avgLow: 97.0, avgAmp: 74.1 },
            { label: '50~100å…ƒ', count: 396, avgHigh: 167.0, avgLow: 98.6, avgAmp: 68.6 },
            { label: '100~150å…ƒ', count: 143, avgHigh: 164.8, avgLow: 98.2, avgAmp: 69.0 },
            { label: '150~200å…ƒ', count: 62, avgHigh: 152.8, avgLow: 99.8, avgAmp: 52.7 },
            { label: 'å¤§æ–¼200å…ƒ', count: 99, avgHigh: 157.6, avgLow: 99.9, avgAmp: 57.2 }
        ]
    };
    
    // ä¿¡è©•å€é–“ï¼ˆå‹•æ…‹å¾00å·¥ä½œè¡¨Eæ¬„ä¿¡ç”¨è©•ç­‰è¨ˆç®—ï¼‰
    const ratingRanges = [];
    for (let tcri = 1; tcri <= 8; tcri++) {
        const tcriStr = String(tcri);
        const allData = [...auctionRawData, ...inquiryRawData];
        const filtered = allData.filter(d => {
            const r = String(d.rating || '').trim();
            return r === tcriStr || r === 'TCRI' + tcriStr || r === 'TCRI ' + tcriStr;
        });
        const withMarket = filtered.filter(d => d.marketHigh > 0 && d.marketLow > 0);
        
        let avgHigh = 0, avgLow = 0, avgAmp = 0;
        if (withMarket.length > 0) {
            avgHigh = withMarket.reduce((s, d) => s + d.marketHigh, 0) / withMarket.length;
            avgLow = withMarket.reduce((s, d) => s + d.marketLow, 0) / withMarket.length;
            avgAmp = avgHigh - avgLow;
        }
        
        ratingRanges.push({
            label: 'TCRI ' + tcri,
            count: filtered.length,
            avgHigh: parseFloat(avgHigh.toFixed(1)),
            avgLow: parseFloat(avgLow.toFixed(1)),
            avgAmp: parseFloat(avgAmp.toFixed(1))
        });
    }
    marketTrendData.rating = {
        ranges: ratingRanges.filter(r => r.count > 0) // åªé¡¯ç¤ºæœ‰è³‡æ–™çš„ç­‰ç´š
    };
    
    // ç™¼è¡Œå¹´æœŸï¼ˆä¾05å·¥ä½œè¡¨è¨­å®šï¼‰
    marketTrendData.years = {
        ranges: [
            { label: '3å¹´æœŸ', count: 1047, avgHigh: 163.0, avgLow: 99.8, avgAmp: 62.2 },
            { label: '5å¹´æœŸ', count: 578, avgHigh: 176.9, avgLow: 96.1, avgAmp: 86.9 },
            { label: '7å¹´æœŸ', count: 1, avgHigh: 450.0, avgLow: 97.0, avgAmp: 363.9 }
        ]
    };
    
    // ç«¶æ‹vsè©¢åœˆ
    marketTrendData.type = {
        auction: { count: 296, avgHigh: 164.5, avgLow: 100.8, avgAmp: 62.8 },
        inquiry: { count: 964, avgHigh: 170.5, avgLow: 98.1, avgAmp: 75.2 }
    };
    
    // ç™¼è¡Œæ¬¡æ•¸åˆ†æï¼ˆå®Œæ•´åˆ°ç¬¬10æ¬¡ï¼‰
    marketTrendData.issueNum = {
        byNumber: [
            { num: 1, total: 948, count: 931, avgHigh: 174.1, avgLow: 97.6, avgAmp: 80.2 },
            { num: 2, total: 548, count: 540, avgHigh: 167.7, avgLow: 96.9, avgAmp: 76.6 },
            { num: 3, total: 324, count: 319, avgHigh: 170.7, avgLow: 99.9, avgAmp: 71.8 },
            { num: 4, total: 178, count: 178, avgHigh: 169.9, avgLow: 98.7, avgAmp: 71.9 },
            { num: 5, total: 95, count: 94, avgHigh: 162.7, avgLow: 99.6, avgAmp: 63.2 },
            { num: 6, total: 50, count: 47, avgHigh: 169.0, avgLow: 100.0, avgAmp: 68.7 },
            { num: 7, total: 28, count: 26, avgHigh: 180.7, avgLow: 101.7, avgAmp: 77.1 },
            { num: 8, total: 12, count: 11, avgHigh: 176.4, avgLow: 97.9, avgAmp: 80.0 },
            { num: 9, total: 5, count: 5, avgHigh: 216.6, avgLow: 97.3, avgAmp: 127.7 },
            { num: 10, total: 2, count: 2, avgHigh: 189.1, avgLow: 104.9, avgAmp: 75.2 }
        ],
        yearly: [
            { year: 2010, first: 45, firstAmp: 44.0, multi: 72, multiAmp: 56.2 },
            { year: 2011, first: 34, firstAmp: 41.6, multi: 64, multiAmp: 51.8 },
            { year: 2012, first: 24, firstAmp: 72.7, multi: 50, multiAmp: 65.6 },
            { year: 2013, first: 37, firstAmp: 109.6, multi: 52, multiAmp: 78.5 },
            { year: 2014, first: 41, firstAmp: 46.9, multi: 54, multiAmp: 50.8 },
            { year: 2015, first: 41, firstAmp: 62.4, multi: 57, multiAmp: 62.1 },
            { year: 2016, first: 17, firstAmp: 75.3, multi: 38, multiAmp: 72.2 },
            { year: 2017, first: 14, firstAmp: 60.9, multi: 32, multiAmp: 60.8 },
            { year: 2018, first: 16, firstAmp: 65.7, multi: 41, multiAmp: 85.1 },
            { year: 2019, first: 34, firstAmp: 61.4, multi: 37, multiAmp: 94.9 },
            { year: 2020, first: 31, firstAmp: 109.0, multi: 66, multiAmp: 114.0 },
            { year: 2021, first: 29, firstAmp: 86.1, multi: 74, multiAmp: 76.5 },
            { year: 2022, first: 35, firstAmp: 84.8, multi: 60, multiAmp: 82.5 },
            { year: 2023, first: 26, firstAmp: 67.0, multi: 65, multiAmp: 69.0 },
            { year: 2024, first: 37, firstAmp: 47.4, multi: 100, multiAmp: 43.4 },
            { year: 2025, first: 29, firstAmp: 19.6, multi: 65, multiAmp: 24.4 }
        ]
    };
    
    // KYè‚¡åˆ†æï¼ˆå¤šå¹´åº¦ï¼‰
    marketTrendData.ky = {
        overall: {
            ky: { count: 120, avgHigh: 154.3, avgLow: 95.9, avgAmp: 63.5 },
            nonKy: { count: 2074, avgHigh: 172.7, avgLow: 98.2, avgAmp: 77.6 }
        },
        yearly: [
            { year: 2010, total: 118, ky: 0, kyRatio: 0, kyAmp: 0, nonKyAmp: 51.4 },
            { year: 2011, total: 100, ky: 0, kyRatio: 0, kyAmp: 0, nonKyAmp: 48.8 },
            { year: 2012, total: 76, ky: 1, kyRatio: 1.3, kyAmp: 33.8, nonKyAmp: 69.0 },
            { year: 2013, total: 89, ky: 3, kyRatio: 3.4, kyAmp: 97.6, nonKyAmp: 91.0 },
            { year: 2014, total: 96, ky: 6, kyRatio: 6.2, kyAmp: 50.0, nonKyAmp: 48.9 },
            { year: 2015, total: 100, ky: 11, kyRatio: 11.0, kyAmp: 40.4, nonKyAmp: 64.3 },
            { year: 2016, total: 55, ky: 4, kyRatio: 7.3, kyAmp: 69.8, nonKyAmp: 73.4 },
            { year: 2017, total: 46, ky: 7, kyRatio: 15.2, kyAmp: 29.6, nonKyAmp: 66.4 },
            { year: 2018, total: 57, ky: 11, kyRatio: 19.3, kyAmp: 55.7, nonKyAmp: 85.3 },
            { year: 2019, total: 71, ky: 7, kyRatio: 9.9, kyAmp: 81.7, nonKyAmp: 78.6 },
            { year: 2020, total: 97, ky: 12, kyRatio: 12.4, kyAmp: 111.5, nonKyAmp: 112.5 },
            { year: 2021, total: 103, ky: 10, kyRatio: 9.7, kyAmp: 27.4, nonKyAmp: 84.8 },
            { year: 2022, total: 96, ky: 8, kyRatio: 8.3, kyAmp: 142.9, nonKyAmp: 77.1 },
            { year: 2023, total: 91, ky: 9, kyRatio: 9.9, kyAmp: 67.7, nonKyAmp: 68.5 },
            { year: 2024, total: 139, ky: 10, kyRatio: 7.2, kyAmp: 51.9, nonKyAmp: 43.6 },
            { year: 2025, total: 95, ky: 11, kyRatio: 11.6, kyAmp: 14.1, nonKyAmp: 24.0 }
        ]
    };
    
    // é¡¯ç¤ºé è¨­Tab
    showMarketTrendTab('yearly');
}

function showMarketTrendTab(tab, event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    // æ›´æ–°Tabç‹€æ…‹
    document.querySelectorAll('.market-trend-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.market-trend-tab').forEach(t => {
        const tabMap = {
            'yearly': 'å¹´åº¦è¶¨å‹¢',
            'guarantee': 'æ“”ä¿æ¯”è¼ƒ',
            'size': 'ç™¼è¡Œè¦æ¨¡',
            'capital': 'è‚¡æœ¬å¤§å°',
            'conversion': 'è½‰æ›åƒ¹',
            'rating': 'ä¿¡è©•',
            'yearPeriod': 'ç™¼è¡Œå¹´æœŸ',
            'type': 'ç«¶æ‹vsè©¢åœˆ',
            'issueNum': 'ç™¼è¡Œæ¬¡æ•¸',
            'ky': 'KYè‚¡åˆ†æ'
        };
        if (t.textContent.includes(tabMap[tab])) {
            t.classList.add('active');
        }
    });
    
    const content = document.getElementById('marketTrendContent');
    let html = '';
    
    if (tab === 'yearly') {
        html = renderYearlyTrend();
    } else if (tab === 'guarantee') {
        html = renderGuaranteeCompare();
    } else if (tab === 'size') {
        html = renderSizeCompare();
    } else if (tab === 'capital') {
        html = renderCapitalCompare();
    } else if (tab === 'conversion') {
        html = renderConversionCompare();
    } else if (tab === 'rating') {
        html = renderRatingCompare();
    } else if (tab === 'yearPeriod') {
        html = renderYearPeriodCompare();
    } else if (tab === 'type') {
        html = renderTypeCompare();
    } else if (tab === 'issueNum') {
        html = renderIssueNumAnalysis();
    } else if (tab === 'ky') {
        html = renderKYAnalysis();
    }
    
    content.innerHTML = html;
}

function renderYearlyTrend() {
    const data = marketTrendData.yearly;
    if (!data || data.length === 0) return '<div>æš«ç„¡æ•¸æ“š</div>';
    
    let html = `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸ“Š 2010-2025å¹´å®Œæ•´å¹´åº¦çµ±è¨ˆï¼ˆå¾01å·¥ä½œè¡¨æ›ç‰Œæ—¥æœŸçµ±è¨ˆï¼‰</div>
    <table class="trend-year-table">
        <tr>
            <th>å¹´åº¦</th>
            <th>ç¸½æª”æ•¸</th>
            <th>è©¢åœˆ</th>
            <th>ç«¶æ‹</th>
            <th>å¹³å‡æŒ¯å¹…</th>
        </tr>`;
    
    let totalAll = 0, totalInquiry = 0, totalAuction = 0;
    data.forEach(d => {
        const ampClass = d.avgAmp >= 80 ? 'amp-high' : (d.avgAmp < 30 ? 'amp-low' : '');
        const auctionNote = d.auction === 0 ? '' : '';
        html += `
        <tr>
            <td class="year-cell">${d.year}å¹´</td>
            <td><b>${d.total}</b></td>
            <td style="color:#1565c0;">${d.inquiry}</td>
            <td style="color:#e65100;">${d.auction > 0 ? d.auction : '-'}</td>
            <td class="${ampClass}">${d.avgAmp > 0 ? d.avgAmp.toFixed(1) + '%' : '-'}</td>
        </tr>`;
        totalAll += d.total;
        totalInquiry += d.inquiry;
        totalAuction += d.auction;
    });
    
    // åˆè¨ˆåˆ—
    html += `
        <tr class="total-row">
            <td><b>åˆè¨ˆ</b></td>
            <td><b>${totalAll}</b></td>
            <td style="color:#1565c0;"><b>${totalInquiry}</b></td>
            <td style="color:#e65100;"><b>${totalAuction}</b></td>
            <td>-</td>
        </tr>`;
    
    html += `</table>`;
    
    // è¶¨å‹¢æ´å¯Ÿ
    const peak = data.reduce((max, d) => d.avgAmp > max.avgAmp ? d : max, data[0]);
    const latest = data[data.length - 1];
    
    html += `
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”è¶¨å‹¢è§€å¯Ÿ</div>
        <div class="insight-content">
            2010-2018å¹´ä»¥è©¢åœˆç‚ºä¸»ï¼Œ2019å¹´é–‹å§‹æœ‰ç«¶æ‹æ¡ˆä¾‹ï¼Œ2022å¹´å¾Œç«¶æ‹æ¯”ä¾‹å¿«é€Ÿæå‡ã€‚<br>
            æŒ¯å¹…é«˜å³°ç‚º${peak.year}å¹´(${peak.avgAmp.toFixed(1)}%)ï¼Œ2024-2025å¹´æŒ¯å¹…æ˜é¡¯ä¸‹é™è‡³22-44%ã€‚<br>
            2024å¹´ç™¼è¡Œé‡é”æ­·å²æ–°é«˜139æª”ï¼Œå¸‚å ´ç«¶çˆ­åŠ åŠ‡ï¼Œé¸è‚¡é›£åº¦æé«˜ã€‚
        </div>
    </div>`;
    
    return html;
}

function renderGuaranteeCompare() {
    const overall = marketTrendData.guarantee.overall;
    const yearly = marketTrendData.guarantee.yearly;
    
    const g = overall.guaranteed;
    const u = overall.unguaranteed;
    
    let html = `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸ“Š æ•´é«”æ“”ä¿æ¯”è¼ƒï¼ˆå…¨éƒ¨å¹´åº¦ï¼‰</div>
    <div class="trend-compare-grid">
        <div class="trend-compare-card">
            <h4>ğŸ›¡ï¸ æœ‰æ“”ä¿</h4>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æª”æ•¸</span>
                <span class="trend-compare-value">${g.count}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡é«˜</span>
                <span class="trend-compare-value">${g.avgHigh.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡ä½</span>
                <span class="trend-compare-value">${g.avgLow.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">å¹³å‡æŒ¯å¹…</span>
                <span class="trend-compare-value ${g.avgAmp > u.avgAmp ? 'positive' : ''}">${g.avgAmp.toFixed(1)}%</span>
            </div>
        </div>
        <div class="trend-compare-card">
            <h4>ğŸ“‹ ç„¡æ“”ä¿</h4>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æª”æ•¸</span>
                <span class="trend-compare-value">${u.count}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡é«˜</span>
                <span class="trend-compare-value">${u.avgHigh.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡ä½</span>
                <span class="trend-compare-value">${u.avgLow.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">å¹³å‡æŒ¯å¹…</span>
                <span class="trend-compare-value ${u.avgAmp > g.avgAmp ? 'positive' : ''}">${u.avgAmp.toFixed(1)}%</span>
            </div>
        </div>
    </div>`;
    
    // åŠ å…¥å¤šå¹´åº¦è¡¨æ ¼
    if (yearly && yearly.length > 0) {
        html += `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin:15px 0 10px 0;">ğŸ“ˆ å„å¹´åº¦ æœ‰æ“”ä¿ vs ç„¡æ“”ä¿ æŒ¯å¹…æ¯”è¼ƒ</div>
    <table class="trend-year-table">
        <tr>
            <th>å¹´åº¦</th>
            <th>æœ‰æ“”ä¿</th>
            <th>æŒ¯å¹…</th>
            <th>ç„¡æ“”ä¿</th>
            <th>æŒ¯å¹…</th>
            <th>å‹å‡º</th>
        </tr>`;
        
        yearly.forEach(y => {
            const winner = y.gAmp > y.uAmp ? 'æœ‰æ“”ä¿' : 'ç„¡æ“”ä¿';
            const winnerColor = winner === 'æœ‰æ“”ä¿' ? '#2e7d32' : '#1565c0';
            html += `
        <tr>
            <td class="year-cell">${y.year}å¹´</td>
            <td>${y.gCount}</td>
            <td class="${y.gAmp > y.uAmp ? 'amp-high' : ''}">${y.gAmp.toFixed(1)}%</td>
            <td>${y.uCount}</td>
            <td class="${y.uAmp > y.gAmp ? 'amp-high' : ''}">${y.uAmp.toFixed(1)}%</td>
            <td style="color:${winnerColor}; font-weight:bold;">${winner}</td>
        </tr>`;
        });
        html += `</table>`;
    }
    
    html += `
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”åˆ†æçµè«–</div>
        <div class="insight-content">
            æ•´é«”<strong>æœ‰æ“”ä¿(77.0%)</strong>æŒ¯å¹…é«˜æ–¼ç„¡æ“”ä¿(63.4%)ã€‚
            ä½†å„å¹´åº¦è¡¨ç¾ä¸ä¸€ï¼Œ2020/2022/2024å¹´ç„¡æ“”ä¿åè€Œè¼ƒä½³ã€‚
            æœ‰æ“”ä¿æä¾›è¼ƒé«˜å®‰å…¨é‚Šéš›ï¼Œé©åˆç©©å¥å‹æŠ•è³‡äººã€‚
        </div>
    </div>`;
    
    return html;
}

function renderSizeCompare() {
    const ranges = marketTrendData.size.ranges;
    if (!ranges || ranges.length === 0) return '<div>æš«ç„¡æ•¸æ“š</div>';
    
    let html = `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸ“Š ç™¼è¡Œè¦æ¨¡å€é–“çµ±è¨ˆï¼ˆå…¨éƒ¨å¹´åº¦ï¼Œä¾05å·¥ä½œè¡¨è¨­å®šï¼‰</div>
    <table class="trend-year-table">
        <tr>
            <th>è¦æ¨¡å€é–“</th>
            <th>æª”æ•¸</th>
            <th>æ›ç‰Œå‡é«˜</th>
            <th>æ›ç‰Œå‡ä½</th>
            <th>å¹³å‡æŒ¯å¹…</th>
        </tr>`;
    
    const maxAmp = Math.max(...ranges.map(r => r.avgAmp));
    ranges.forEach(r => {
        const ampClass = r.avgAmp === maxAmp ? 'amp-high' : (r.avgAmp < 65 ? 'amp-low' : '');
        html += `
        <tr>
            <td class="year-cell">${r.label}</td>
            <td>${r.count}</td>
            <td>${r.avgHigh.toFixed(1)}</td>
            <td>${r.avgLow.toFixed(1)}</td>
            <td class="${ampClass}">${r.avgAmp.toFixed(1)}%</td>
        </tr>`;
    });
    html += `</table>`;
    
    html += `
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”åˆ†æçµè«–</div>
        <div class="insight-content">
            <strong>å°æ–¼2å„„(88.1%)</strong>æŒ¯å¹…æœ€é«˜ï¼Œ2~10å„„ç‚ºç”œèœœå€é–“(70-71%)ã€‚
            è¦æ¨¡è¶Šå¤§æŒ¯å¹…è¶Šä½ï¼Œä½†å¤§è¦æ¨¡(>20å„„)ä»æœ‰63.7%ï¼Œæµå‹•æ€§è¼ƒä½³ã€‚
            é¸è‚¡æ™‚å¯å„ªå…ˆè€ƒæ…®2~10å„„çš„ä¸­å°è¦æ¨¡CBã€‚
        </div>
    </div>`;
    
    return html;
}

function renderCapitalCompare() {
    const ranges = marketTrendData.capital.ranges;
    if (!ranges || ranges.length === 0) return '<div>æš«ç„¡æ•¸æ“š</div>';
    
    let html = `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸ“Š è‚¡æœ¬å€é–“çµ±è¨ˆï¼ˆå…¨éƒ¨å¹´åº¦ï¼Œä¾05å·¥ä½œè¡¨è¨­å®šï¼‰</div>
    <table class="trend-year-table">
        <tr>
            <th>è‚¡æœ¬å€é–“</th>
            <th>æª”æ•¸</th>
            <th>æ›ç‰Œå‡é«˜</th>
            <th>æ›ç‰Œå‡ä½</th>
            <th>å¹³å‡æŒ¯å¹…</th>
        </tr>`;
    
    const maxAmp = Math.max(...ranges.map(r => r.avgAmp));
    ranges.forEach(r => {
        const ampClass = r.avgAmp === maxAmp ? 'amp-high' : (r.avgAmp < 60 ? 'amp-low' : '');
        html += `
        <tr>
            <td class="year-cell">${r.label}</td>
            <td>${r.count}</td>
            <td>${r.avgHigh.toFixed(1)}</td>
            <td>${r.avgLow.toFixed(1)}</td>
            <td class="${ampClass}">${r.avgAmp.toFixed(1)}%</td>
        </tr>`;
    });
    html += `</table>`;
    
    html += `
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”åˆ†æçµè«–</div>
        <div class="insight-content">
            <strong>6~10å„„(79.8%)</strong>æŒ¯å¹…æœ€é«˜ï¼Œç‚ºæœ€ä½³è‚¡æœ¬å€é–“ã€‚
            å°è‚¡æœ¬(<6å„„)å› è‚¡åƒ¹æ³¢å‹•å¤§ï¼Œåè€ŒæŒ¯å¹…è¼ƒä½(55-58%)ã€‚
            å¤§è‚¡æœ¬(>20å„„)ä¼æ¥­é€šå¸¸è¼ƒç©©å®šï¼ŒæŒ¯å¹…é©ä¸­(66.9%)ã€‚
        </div>
    </div>`;
    
    return html;
}

// v3.59 æ–°å¢ï¼šè½‰æ›åƒ¹å€é–“åˆ†æ
function renderConversionCompare() {
    const ranges = marketTrendData.conversion.ranges;
    if (!ranges || ranges.length === 0) return '<div>æš«ç„¡æ•¸æ“š</div>';
    
    let html = `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸ“Š è½‰æ›åƒ¹å€é–“çµ±è¨ˆï¼ˆå…¨éƒ¨å¹´åº¦ï¼Œä¾05å·¥ä½œè¡¨è¨­å®šï¼‰</div>
    <table class="trend-year-table">
        <tr>
            <th>è½‰æ›åƒ¹å€é–“</th>
            <th>æª”æ•¸</th>
            <th>æ›ç‰Œå‡é«˜</th>
            <th>æ›ç‰Œå‡ä½</th>
            <th>å¹³å‡æŒ¯å¹…</th>
        </tr>`;
    
    const maxAmp = Math.max(...ranges.map(r => r.avgAmp));
    ranges.forEach(r => {
        const ampClass = r.avgAmp === maxAmp ? 'amp-high' : (r.avgAmp < 60 ? 'amp-low' : '');
        html += `
        <tr>
            <td class="year-cell">${r.label}</td>
            <td>${r.count}</td>
            <td>${r.avgHigh.toFixed(1)}</td>
            <td>${r.avgLow.toFixed(1)}</td>
            <td class="${ampClass}">${r.avgAmp.toFixed(1)}%</td>
        </tr>`;
    });
    html += `</table>`;
    
    html += `
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”åˆ†æçµè«–</div>
        <div class="insight-content">
            <strong>ä½è½‰æ›åƒ¹(<50å…ƒ)</strong>æŒ¯å¹…è¼ƒé«˜(74-77%)ï¼Œä¸»å› ä½åƒ¹è‚¡æ³¢å‹•ç©ºé–“å¤§ã€‚
            è½‰æ›åƒ¹150~200å…ƒæŒ¯å¹…æœ€ä½(52.7%)ï¼Œé«˜åƒ¹è‚¡ç›¸å°ç©©å®šã€‚
            è½‰æ›åƒ¹>200å…ƒåè€Œå›å‡è‡³57.2%ï¼Œå¯èƒ½å› å¤šç‚ºå„ªè³ªé«˜æˆé•·è‚¡ã€‚
        </div>
    </div>`;
    
    return html;
}

// v3.59 æ–°å¢ï¼šä¿¡è©•å€é–“åˆ†æ
function renderRatingCompare() {
    const ranges = marketTrendData.rating.ranges;
    if (!ranges || ranges.length === 0) return '<div>æš«ç„¡æ•¸æ“š</div>';
    
    let html = `
    <div style="font-size:13px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸ“Š ä¿¡è©•å€é–“çµ±è¨ˆï¼ˆå¾00å·¥ä½œè¡¨Eæ¬„å‹•æ…‹è¨ˆç®—ï¼‰</div>
    <table class="trend-year-table">
        <tr>
            <th>ä¿¡è©•ç­‰ç´š</th>
            <th>æª”æ•¸</th>
            <th>æ›ç‰Œå‡é«˜</th>
            <th>æ›ç‰Œå‡ä½</th>
            <th>å¹³å‡æŒ¯å¹…</th>
        </tr>`;
    
    const validRanges = ranges.filter(r => r.count > 0 && r.avgAmp > 0);
    const maxAmp = validRanges.length > 0 ? Math.max(...validRanges.map(r => r.avgAmp)) : 0;
    const minAmp = validRanges.length > 0 ? Math.min(...validRanges.map(r => r.avgAmp)) : 0;
    
    ranges.forEach(r => {
        if (r.count === 0) return;
        const ampClass = r.avgAmp === maxAmp ? 'amp-high' : (r.avgAmp === minAmp && r.avgAmp > 0 ? 'amp-low' : '');
        html += `
        <tr>
            <td class="year-cell">${r.label}</td>
            <td>${r.count}</td>
            <td>${r.avgHigh > 0 ? r.avgHigh.toFixed(1) : '-'}</td>
            <td>${r.avgLow > 0 ? r.avgLow.toFixed(1) : '-'}</td>
            <td class="${ampClass}">${r.avgAmp > 0 ? r.avgAmp.toFixed(1) + '%' : '-'}</td>
        </tr>`;
    });
    html += `</table>`;
    
    // å‹•æ…‹ç”Ÿæˆçµè«–
    let bestRange = validRanges.length > 0 ? validRanges.reduce((a, b) => a.avgAmp > b.avgAmp ? a : b) : null;
    let mostRange = validRanges.length > 0 ? validRanges.reduce((a, b) => a.count > b.count ? a : b) : null;
    
    html += `
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”åˆ†æçµè«–</div>
        <div class="insight-content">
            ${bestRange ? `<strong>${bestRange.label}(${bestRange.avgAmp.toFixed(1)}%)</strong>æŒ¯å¹…æœ€é«˜${bestRange.count < 30 ? 'ä½†æ¨£æœ¬è¼ƒå°‘(' + bestRange.count + 'æª”)' : '(' + bestRange.count + 'æª”)'}ã€‚` : ''}
            ${mostRange && mostRange !== bestRange ? `<strong>${mostRange.label}(${mostRange.avgAmp.toFixed(1)}%/${mostRange.count}æª”)</strong>æ¨£æœ¬æ•¸æœ€å¤šï¼Œå¯ä½œç‚ºä¸»è¦åƒè€ƒã€‚` : ''}
            ä¿¡è©•ç­‰ç´šè¶Šä½ï¼ˆæ•¸å­—è¶Šå¤§ï¼‰ï¼Œé€šå¸¸ä»£è¡¨ä¿¡ç”¨é¢¨éšªè¼ƒé«˜ï¼Œéœ€è¬¹æ…è©•ä¼°ã€‚
        </div>
    </div>`;
    
    return html;
}

// v3.59 æ–°å¢ï¼šç™¼è¡Œå¹´æœŸåˆ†æ
function renderYearPeriodCompare() {
    const ranges = marketTrendData.years.ranges;
    if (!ranges || ranges.length === 0) return '<div>æš«ç„¡æ•¸æ“š</div>';
    
    let html = `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸ“Š ç™¼è¡Œå¹´æœŸçµ±è¨ˆï¼ˆå…¨éƒ¨å¹´åº¦ï¼Œä¾05å·¥ä½œè¡¨è¨­å®šï¼‰</div>
    <table class="trend-year-table">
        <tr>
            <th>ç™¼è¡Œå¹´æœŸ</th>
            <th>æª”æ•¸</th>
            <th>æ›ç‰Œå‡é«˜</th>
            <th>æ›ç‰Œå‡ä½</th>
            <th>å¹³å‡æŒ¯å¹…</th>
        </tr>`;
    
    ranges.forEach(r => {
        const ampClass = r.avgAmp > 80 ? 'amp-high' : (r.avgAmp < 65 ? 'amp-low' : '');
        html += `
        <tr>
            <td class="year-cell">${r.label}</td>
            <td>${r.count}</td>
            <td>${r.avgHigh.toFixed(1)}</td>
            <td>${r.avgLow.toFixed(1)}</td>
            <td class="${ampClass}">${r.avgAmp.toFixed(1)}%</td>
        </tr>`;
    });
    html += `</table>`;
    
    html += `
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”åˆ†æçµè«–</div>
        <div class="insight-content">
            <strong>5å¹´æœŸ(86.9%)</strong>æŒ¯å¹…æœ€ä½³ï¼Œç‚ºCBç™¼è¡Œçš„é»ƒé‡‘å¹´æœŸã€‚
            3å¹´æœŸç‚ºä¸»æµ(1047æª”)ï¼ŒæŒ¯å¹…62.2%ç›¸å°ç©©å¥ã€‚
            7å¹´æœŸç›®å‰åƒ…1æª”(æ–°å”ä¸€)ï¼ŒæŒ¯å¹…363.9%ç‚ºç‰¹ä¾‹ï¼Œä¸å…·çµ±è¨ˆæ„ç¾©ã€‚
        </div>
    </div>`;
    
    return html;
}

function renderTypeCompare() {
    const a = marketTrendData.type.auction;
    const i = marketTrendData.type.inquiry;
    
    const winner = a.avgAmp > i.avgAmp ? 'ç«¶æ‹' : 'è©¢åœˆ';
    const diff = Math.abs(a.avgAmp - i.avgAmp).toFixed(1);
    
    let html = `
    <div class="trend-compare-grid">
        <div class="trend-compare-card">
            <h4>ğŸ¯ ç«¶æ‹</h4>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æª”æ•¸</span>
                <span class="trend-compare-value">${a.count}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡é«˜</span>
                <span class="trend-compare-value">${a.avgHigh.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡ä½</span>
                <span class="trend-compare-value">${a.avgLow.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">å¹³å‡æŒ¯å¹…</span>
                <span class="trend-compare-value ${a.avgAmp > i.avgAmp ? 'positive' : ''}">${a.avgAmp.toFixed(1)}%</span>
            </div>
        </div>
        <div class="trend-compare-card">
            <h4>ğŸ“‹ è©¢åœˆ</h4>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æª”æ•¸</span>
                <span class="trend-compare-value">${i.count}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡é«˜</span>
                <span class="trend-compare-value">${i.avgHigh.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡ä½</span>
                <span class="trend-compare-value">${i.avgLow.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">å¹³å‡æŒ¯å¹…</span>
                <span class="trend-compare-value ${i.avgAmp > a.avgAmp ? 'positive' : ''}">${i.avgAmp.toFixed(1)}%</span>
            </div>
        </div>
    </div>
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”åˆ†æçµè«–</div>
        <div class="insight-content">
            <strong>${winner}</strong>æ•´é«”æŒ¯å¹…è¼ƒé«˜ï¼Œå·®è·${diff}%ã€‚
            ${winner === 'è©¢åœˆ' ? 'è©¢åœˆæ¡ˆä¾‹æ•¸æ“šé‡å¤§(æ¶µè“‹æ­·å¹´)ï¼Œè¡¨ç¾å„ªæ–¼ç«¶æ‹ã€‚ä½†2019å¹´å¾Œç«¶æ‹åˆ¶åº¦ä¸Šè·¯ï¼Œè¿‘å¹´æ•¸æ“šé ˆåˆ†é–‹è§€å¯Ÿã€‚' : 'ç«¶æ‹é€éå…¬é–‹æ‹è³£å–å¾—ç±Œç¢¼ï¼Œå¸‚å ´å°å…¶å®šåƒ¹è¼ƒç‚ºç†æ€§ã€‚'}
        </div>
    </div>`;
    
    return html;
}

// v3.59 æ–°å¢ï¼šç™¼è¡Œæ¬¡æ•¸åˆ†æ
function renderIssueNumAnalysis() {
    const data = marketTrendData.issueNum;
    if (!data) return '<div>æš«ç„¡æ•¸æ“š</div>';
    
    let html = `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸ“Š å„ç™¼è¡Œæ¬¡æ•¸æ›ç‰Œè¡¨ç¾ï¼ˆå…¨éƒ¨å¹´åº¦ï¼Œå®Œæ•´åˆ°ç¬¬10æ¬¡ï¼‰</div>
    <table class="trend-year-table">
        <tr>
            <th>ç™¼è¡Œæ¬¡æ•¸</th>
            <th>ç¸½æª”æ•¸</th>
            <th>æœ‰æ›ç‰Œ</th>
            <th>æ›ç‰Œå‡é«˜</th>
            <th>æ›ç‰Œå‡ä½</th>
            <th>å¹³å‡æŒ¯å¹…</th>
        </tr>`;
    
    const byNum = data.byNumber;
    byNum.forEach(d => {
        const ampClass = d.avgAmp >= 80 ? 'amp-high' : (d.avgAmp < 65 ? 'amp-low' : '');
        html += `
        <tr>
            <td class="year-cell">ç¬¬${d.num}æ¬¡</td>
            <td>${d.total}</td>
            <td>${d.count}</td>
            <td>${d.avgHigh.toFixed(1)}</td>
            <td>${d.avgLow.toFixed(1)}</td>
            <td class="${ampClass}">${d.avgAmp.toFixed(1)}%</td>
        </tr>`;
    });
    html += `</table>`;
    
    // å¹´åº¦é¦–ç™¼ vs å¤šæ¬¡ç™¼è¡Œæ¯”è¼ƒï¼ˆå¤šå¹´åº¦ï¼‰
    html += `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin:15px 0 10px 0;">ğŸ“ˆ å„å¹´åº¦ é¦–æ¬¡ç™¼è¡Œ vs å¤šæ¬¡ç™¼è¡Œï¼ˆ2010-2025ï¼‰</div>
    <table class="trend-year-table">
        <tr>
            <th>å¹´åº¦</th>
            <th>é¦–ç™¼</th>
            <th>é¦–ç™¼æŒ¯å¹…</th>
            <th>å¤šæ¬¡</th>
            <th>å¤šæ¬¡æŒ¯å¹…</th>
            <th>å‹å‡º</th>
        </tr>`;
    
    const yearly = data.yearly;
    yearly.forEach(y => {
        const winner = y.firstAmp > y.multiAmp ? 'é¦–ç™¼' : 'å¤šæ¬¡';
        const winnerColor = winner === 'é¦–ç™¼' ? '#2e7d32' : '#1565c0';
        html += `
        <tr>
            <td class="year-cell">${y.year}å¹´</td>
            <td>${y.first}</td>
            <td class="${y.firstAmp > y.multiAmp ? 'amp-high' : ''}">${y.firstAmp.toFixed(1)}%</td>
            <td>${y.multi}</td>
            <td class="${y.multiAmp > y.firstAmp ? 'amp-high' : ''}">${y.multiAmp.toFixed(1)}%</td>
            <td style="color:${winnerColor}; font-weight:bold;">${winner}</td>
        </tr>`;
    });
    html += `</table>`;
    
    html += `
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”åˆ†æçµè«–</div>
        <div class="insight-content">
            æ•´é«”è€Œè¨€ï¼Œ<strong>é¦–æ¬¡ç™¼è¡Œ(80.2%)</strong>æŒ¯å¹…ç•¥é«˜æ–¼å¤šæ¬¡ç™¼è¡Œã€‚
            ç¬¬9æ¬¡ç™¼è¡ŒæŒ¯å¹…æœ€é«˜(127.7%)ä½†åƒ…5æª”ï¼Œå±¬ç‰¹ä¾‹ã€‚
            ç™¼è¡Œæ¬¡æ•¸é”5æ¬¡ä»¥ä¸Šæ™‚æŒ¯å¹…ä¸‹é™è‡³63-69%å€é–“ã€‚
            è¿‘å¹´(2024-2025)å·®è·ç¸®å°ï¼Œå¸‚å ´å°ç™¼è¡Œæ¬¡æ•¸æ•æ„Ÿåº¦é™ä½ã€‚
        </div>
    </div>`;
    
    return html;
}

// v3.59 æ–°å¢ï¼šKYè‚¡åˆ†æï¼ˆå¤šå¹´åº¦ï¼‰
function renderKYAnalysis() {
    const data = marketTrendData.ky;
    if (!data) return '<div>æš«ç„¡æ•¸æ“š</div>';
    
    const ky = data.overall.ky;
    const nonKy = data.overall.nonKy;
    
    let html = `
    <div class="trend-compare-grid">
        <div class="trend-compare-card">
            <h4>ğŸŒ KYè‚¡ï¼ˆæµ·å¤–ä¼æ¥­ï¼‰</h4>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æª”æ•¸</span>
                <span class="trend-compare-value">${ky.count}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡é«˜</span>
                <span class="trend-compare-value">${ky.avgHigh.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡ä½</span>
                <span class="trend-compare-value">${ky.avgLow.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">å¹³å‡æŒ¯å¹…</span>
                <span class="trend-compare-value ${ky.avgAmp > nonKy.avgAmp ? 'positive' : 'negative'}">${ky.avgAmp.toFixed(1)}%</span>
            </div>
        </div>
        <div class="trend-compare-card">
            <h4>ğŸ‡¹ğŸ‡¼ éKYè‚¡ï¼ˆæœ¬åœŸä¼æ¥­ï¼‰</h4>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æª”æ•¸</span>
                <span class="trend-compare-value">${nonKy.count}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡é«˜</span>
                <span class="trend-compare-value">${nonKy.avgHigh.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">æ›ç‰Œå‡ä½</span>
                <span class="trend-compare-value">${nonKy.avgLow.toFixed(1)}</span>
            </div>
            <div class="trend-compare-row">
                <span class="trend-compare-label">å¹³å‡æŒ¯å¹…</span>
                <span class="trend-compare-value ${nonKy.avgAmp > ky.avgAmp ? 'positive' : ''}">${nonKy.avgAmp.toFixed(1)}%</span>
            </div>
        </div>
    </div>`;
    
    // å¹´åº¦KYè‚¡çµ±è¨ˆè¡¨ï¼ˆå¤šå¹´åº¦2010-2025ï¼‰
    html += `
    <div style="font-size:12px; font-weight:bold; color:#e65100; margin:15px 0 10px 0;">ğŸ“ˆ å„å¹´åº¦KYè‚¡ vs éKYè‚¡è¡¨ç¾ï¼ˆ2010-2025ï¼‰</div>
    <table class="trend-year-table">
        <tr>
            <th>å¹´åº¦</th>
            <th>ç¸½æª”æ•¸</th>
            <th>KYæª”æ•¸</th>
            <th>KYæ¯”ä¾‹</th>
            <th>KYæŒ¯å¹…</th>
            <th>éKYæŒ¯å¹…</th>
            <th>å‹å‡º</th>
        </tr>`;
    
    const yearly = data.yearly;
    yearly.forEach(y => {
        if (y.ky === 0) return; // è·³éæ²’æœ‰KYè‚¡çš„å¹´åº¦
        const winner = y.kyAmp > y.nonKyAmp ? 'KY' : 'éKY';
        const winnerColor = winner === 'KY' ? '#9c27b0' : '#2e7d32';
        html += `
        <tr>
            <td class="year-cell">${y.year}å¹´</td>
            <td>${y.total}</td>
            <td>${y.ky}</td>
            <td>${y.kyRatio.toFixed(1)}%</td>
            <td class="${y.kyAmp > y.nonKyAmp ? 'amp-high' : ''}">${y.kyAmp.toFixed(1)}%</td>
            <td class="${y.nonKyAmp > y.kyAmp ? 'amp-high' : ''}">${y.nonKyAmp.toFixed(1)}%</td>
            <td style="color:${winnerColor}; font-weight:bold;">${winner}</td>
        </tr>`;
    });
    html += `</table>`;
    
    html += `
    <div class="trend-insight-box">
        <div class="insight-title">ğŸ“Š Rexå¤§å”åˆ†æçµè«–</div>
        <div class="insight-content">
            æ•´é«”è€Œè¨€ï¼Œ<strong>éKYè‚¡(77.6%)</strong>æŒ¯å¹…é«˜æ–¼KYè‚¡(63.5%)ã€‚
            ä½†2022å¹´KYè‚¡æŒ¯å¹…é«˜é”142.9%å¤§å¹…é ˜å…ˆï¼Œé¡¯ç¤ºKYè‚¡æ³¢å‹•è¼ƒå¤§ã€å€‹æ¡ˆå·®ç•°æ˜é¡¯ã€‚
            KYè‚¡æ¯”ä¾‹ç¶­æŒç´„7-15%ï¼Œ2025å¹´KYè‚¡è¡¨ç¾(14.1%)é ä½æ–¼éKYè‚¡(24.0%)ï¼Œ
            æŠ•è³‡KYè‚¡CBéœ€æ›´è¬¹æ…é¸è‚¡ã€‚
        </div>
    </div>`;
    
    return html;
}

function showDimensionTab(dimension, event) {
    // é˜²æ­¢é é¢è·³å‹•
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    // æ›´æ–°tabç‹€æ…‹
    document.querySelectorAll('.dimension-main-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    if (event && event.target) {
        event.target.classList.add('active');
    } else {
        document.querySelector(`.dimension-main-tab[onclick*="${dimension}"]`).classList.add('active');
    }
    
    const data = dimensionData[dimension];
    if (!data) return;
    
    let html = '';
    
    data.ranges.forEach((range, idx) => {
        const rangeId = `dim-${dimension}-${idx}`;
        html += `
        <div class="dimension-range-card">
            <div class="dimension-range-header" onclick="toggleDimensionRange('${rangeId}')">
                <div class="dimension-range-title">
                    <span>ğŸ“ ${range.label}</span>
                    <span style="font-weight:normal; font-size:10px; color:#666;">(${range.total}æª”)</span>
                </div>
                <div class="dimension-range-stats">
                    <span>ç«¶æ‹:<b>${range.auction}</b></span>
                    <span>è©¢åœˆ:<b>${range.inquiry}</b></span>
                    <span>å‡é«˜:<b>${range.avgHigh.toFixed(1)}</b></span>
                    <span>å‡ä½:<b>${range.avgLow.toFixed(1)}</b></span>
                    <span>æŒ¯å¹…:<b>${range.avgAmp.toFixed(1)}%</b></span>
                </div>
                <span class="dimension-range-toggle" id="${rangeId}-toggle">â–¼</span>
            </div>
            <div class="dimension-range-body" id="${rangeId}-body">
                <table class="dimension-detail-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>ä»£è™Ÿ</th>
                            <th>åç¨±</th>
                            <th>é¡å‹</th>
                            <th>ç‹€æ…‹</th>
                            <th>æ›ç‰Œé«˜</th>
                            <th>æ›ç‰Œä½</th>
                            <th>æŒ¯å¹…</th>
                        </tr>
                    </thead>
                    <tbody>`;
        
        range.items.forEach((item, i) => {
            const typeClass = item.type === 'ç«¶æ‹' ? 'auction' : 'inquiry';
            const ampClass = item.amp >= 100 ? 'dimension-amp-high' : (item.amp < 30 ? 'dimension-amp-low' : '');
            const statusClass = item.status === 'æ›ç‰Œä¸­' ? 'listed' : 'delisted';
            html += `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${item.id || '-'}</td>
                            <td title="${item.name}">${item.name}</td>
                            <td><span class="dimension-type-badge ${typeClass}">${item.type}</span></td>
                            <td><span class="dimension-status-badge ${statusClass}">${item.status || 'å·²ä¸‹å¸‚'}</span></td>
                            <td>${item.high.toFixed(1)}</td>
                            <td>${item.low.toFixed(1)}</td>
                            <td class="${ampClass}">${item.amp.toFixed(1)}%</td>
                        </tr>`;
        });
        
        html += `
                    </tbody>
                </table>
                <div style="text-align:center; font-size:9px; color:#999; margin-top:6px;">
                    é¡¯ç¤ºæŒ¯å¹…TOP5ï¼Œå®Œæ•´è³‡æ–™è«‹åƒè€ƒè©•ä¼°çµæœ
                </div>
            </div>
        </div>`;
    });
    
    html += `
    <div class="dimension-summary">
        ğŸ“Œ <strong>${data.name}åˆ†æï¼š</strong>${data.summary}
    </div>`;
    
    document.getElementById('dimensionContent').innerHTML = html;
}

function toggleDimensionRange(rangeId) {
    const body = document.getElementById(rangeId + '-body');
    const toggle = document.getElementById(rangeId + '-toggle');
    
    if (body.classList.contains('open')) {
        body.classList.remove('open');
        toggle.classList.remove('open');
    } else {
        body.classList.add('open');
        toggle.classList.add('open');
    }
}

function bindInputEvents() {
    const show = (id, html) => { 
        const el = document.getElementById(id); 
        el.innerHTML = html||''; 
        el.style.display = html?'block':'none'; 
    };
    
    // CBåç¨±æœå°‹
    document.getElementById('cbName').addEventListener('input', function() {
        const val = this.value.trim(); 
        const histDiv = document.getElementById('historyResults');
        
        if(val.length >= 2) {
            const auctionMatches = auctionRawData.filter(d => {
                const idMatch = d.id && d.id.startsWith(val);
                const stockIdMatch = d.stockId && String(d.stockId).startsWith(val);
                const nameMatch = d.name && d.name.includes(val);
                return idMatch || stockIdMatch || nameMatch;
            }).slice(0, 10);
            
            const inquiryMatches = inquiryRawData.filter(d => {
                const idMatch = d.id && d.id.startsWith(val);
                const nameMatch = d.name && d.name.includes(val);
                return idMatch || nameMatch;
            }).slice(0, 10);
            
            let html = '';
            
            if(inquiryMatches.length > 0) {
                html += `<div class="history-results-title">ğŸ“‹ è©¢åœˆæ¡ˆä¾‹ (${inquiryMatches.length}ç­†)</div>`;
                inquiryMatches.forEach(d => {
                    const h = safeFloat(d.marketHigh);
                    const l = safeFloat(d.marketLow);
                    const amp = (h > 0 && l > 0) ? ((h - l) / l * 100).toFixed(1) : '-';
                    let guarantee = '-';
                    if (d.guarantee) {
                        guarantee = d.guarantee.includes('æœ‰') ? 'æœ‰' : (d.guarantee.includes('ç„¡') ? 'ç„¡' : d.guarantee);
                    }
                    // v3.62 æ–°å¢ï¼šå–å¾—CBæ”¶ç›¤åƒ¹
                    const cbClosePrice = window.cbClosePriceMap ? window.cbClosePriceMap[d.id] : null;
                    const cbClosePriceStr = cbClosePrice > 0 ? safeFixed(cbClosePrice, 2) : '-';
                    
                    html += `<div class="inquiry-card">
                        <span class="inquiry-badge">è©¢</span>
                        <span class="inquiry-name">${d.name || '-'}(${d.id})</span>
                        <span class="inquiry-info">${d.issueSize > 0 ? d.issueSize + 'å„„' : '-'}</span>
                        <span class="inquiry-info">${d.years > 0 ? d.years + 'Y' : '-'}</span>
                        <span class="inquiry-info">${guarantee}</span>
                        <span class="inquiry-info">é«˜:<b>${h > 0 ? safeFixed(h,0) : '-'}</b></span>
                        <span class="inquiry-info">ä½:<b>${l > 0 ? safeFixed(l,0) : '-'}</b></span>
                        <span class="inquiry-info">æŒ¯:<b class="pink">${amp}%</b></span>
                        <span class="inquiry-info">CBæ”¶:<b style="color:#1565c0;">${cbClosePriceStr}</b></span>
                    </div>`;
                });
            }
            
            if(auctionMatches.length > 0) {
                html += `<div class="history-results-title" style="margin-top:${inquiryMatches.length > 0 ? '12px' : '0'}">ğŸ¯ ç«¶æ‹æ¡ˆä¾‹ (${auctionMatches.length}ç­†)</div>`;
                html += auctionMatches.map(d => generateHistoryCard(d)).join('');
            }
            
            if(html) {
                histDiv.innerHTML = html;
                histDiv.style.display = 'block';
            } else {
                histDiv.style.display = 'none';
            }
        } else {
            histDiv.style.display = 'none';
        }

        if (!val) { show('cbNameInfo', null); return; }
        const found = cbNameMap[val] || Object.values(cbDatabase).find(d => d.name && d.name === val);
        if (found) {
            show('cbNameInfo', generateStandardCard({
                'å¹³å‡æœ€ä½å¾—æ¨™åƒ¹': found.minBidPrice,
                'å¹³å‡æœ€ä½æº¢åƒ¹': found.lowPremium,
                'å¹³å‡å¾—æ¨™åƒ¹': found.avgBidPrice,
                'å¹³å‡æº¢åƒ¹': found.avgPremium,
                'å¹³å‡æ›ç‰Œæœ€é«˜': found.marketHigh,
                'å¹³å‡æ›ç‰Œæœ€ä½': found.marketLow,
                'æ¨£æœ¬æ•¸': 1
            }, `${found.name} æ­·å²ç´€éŒ„`));
        } else {
            show('cbNameInfo', null);
        }
    });

    // v3.52 ä¿®æ”¹ï¼šå…¶ä»–æ¬„ä½ç¶å®šï¼Œå‚³å…¥æ’é™¤å‰ä¸‰ + æ“”ä¿é¡å‹ç´°åˆ†
    const bind = (id, cat) => {
        const handler = function() {
            const rawVal = this.value;
            const val = parseFloat(rawVal) || rawVal;
            if (val) {
                let displayTitle = val;
                if(['è‚¡æœ¬','ç™¼è¡Œè¦æ¨¡','è½‰æ›åƒ¹'].includes(cat)) displayTitle = getRangeLabel(cat, val);
                
                const smartResult = getStatsSmart(cat, val);
                // v3.52: å‚³å…¥æ’é™¤å‰ä¸‰ + æ“”ä¿é¡å‹ç´°åˆ†æ•¸æ“š
                show(id+'Info', generateStandardCard(
                    smartResult.rawData, 
                    `å€é–“çµ±è¨ˆ: ${displayTitle}`, 
                    smartResult.inquiryData,
                    smartResult.excludeTop3Data,
                    smartResult.excludeTop3InquiryData,
                    smartResult.guaranteedAuctionData,
                    smartResult.guaranteedInquiryData,
                    smartResult.unguaranteedAuctionData,
                    smartResult.unguaranteedInquiryData
                ));
                if(cat==='è½‰æ›åƒ¹'||cat==='ä¿¡è©•') updateSmartReminders();
            }
        };
        const el = document.getElementById(id); 
        el.addEventListener('change', handler); 
        if(el.tagName==='INPUT') el.addEventListener('input', handler);
    };

    bind('capital','è‚¡æœ¬'); 
    bind('issueSize','ç™¼è¡Œè¦æ¨¡'); 
    bind('conversionPrice','è½‰æ›åƒ¹'); 
    bind('industry','ç”¢æ¥­'); 
    bind('broker','ç™¼è¡Œåˆ¸å•†'); 
    bind('years','å¹´æœŸ'); 
    bind('guarantee','æ“”ä¿'); 
    bind('rating','ä¿¡è©•');
    
    document.getElementById('guarantee').addEventListener('change', function() {
        const val = this.value, div = document.getElementById('marketSentiment');
        if(!val) return;
        const recent = auctionRawData.filter(d=>(d.guarantee||'').includes(val)).slice(-20);
        if(recent.length===0){ div.innerHTML=`<div class="stat-row">ç„¡æ¡ˆä¾‹</div>`; return; }
        const avgP = recent.reduce((s,i)=>s+(i.avgPremium||0),0)/recent.length;
        div.innerHTML=`<div class="stats-header">ğŸŒ¡ï¸ å¸‚å ´æ°›åœ (${val})</div><div class="stat-row">è¿‘ ${recent.length} ç­†å¹³å‡æº¢åƒ¹ï¼š<span style="color:#d32f2f; font-weight:bold;">${avgP.toFixed(2)}%</span></div>`;
        div.style.display='block';
    });
    
    document.getElementById('stockPrice').addEventListener('input', updateSmartReminders);
}

function updateSmartReminders() {
    const s = parseFloat(document.getElementById('stockPrice').value);
    const c = parseFloat(document.getElementById('conversionPrice').value);
    const r = document.getElementById('rating').value;
    
    if(s && c) { 
        const t = (s/c)*100; 
        let msg = `ç›®å‰ç†è«–åƒ¹ï¼š<b>${t.toFixed(2)} å…ƒ</b>ã€‚`;
        if(t > 120) msg += " ğŸ”¥ ç†è«–åƒ¹åé«˜ï¼Œæ³¨æ„æº¢åƒ¹é¢¨éšªã€‚";
        else if(t < 95) msg += " ğŸ’¡ ç†è«–åƒ¹å…·å¸å¼•åŠ›ã€‚";
        else msg += " âœ¨ ç†è«–åƒ¹è™•æ–¼åˆç†å€é–“ã€‚";
        
        if(r && ['7','8','9'].includes(r)) msg += "<br>âš ï¸ ä¿¡è©•è¼ƒä½ï¼Œå»ºè­°ä¿å®ˆç­–ç•¥ã€‚";
        
        document.getElementById('reminderContent').innerHTML = msg; 
        document.getElementById('smartReminders').style.display='block'; 
    }
}

function generateRexCommentary(r) { 
    const gap = parseFloat(r.bidPrices.balanced) - parseFloat(r.theoreticalPrice);
    let comment = "";
    if (gap > 20) comment = "å¸‚å ´å°æ­¤é¡æ¨™çš„ç†±æƒ…éé«˜ï¼Œå»ºè­°åš´æ§æˆæœ¬ã€‚";
    else if (gap > 10) comment = "æº¢åƒ¹åˆç†åé«˜ï¼Œé©åˆåœ¨ã€Œå¹³è¡¡ã€èˆ‡ã€Œä¿å®ˆã€é–“å°‹æ‰¾ç”œèœœé»ã€‚";
    else if (gap > 0) comment = "å¸‚å ´ä¼°å€¼ç†æ€§ï¼Œå¯åƒè€ƒã€Œç©æ¥µã€ç­–ç•¥çˆ­å–ç±Œç¢¼ã€‚";
    else comment = "ä¼°å€¼åä½ï¼Œå¯èƒ½å­˜åœ¨æ’¿æ¼æ©Ÿæœƒã€‚";
    return `<div class="rex-analysis"><div class="rex-title">ğŸ§¢ Rexå¤§å”åˆ†æ</div><div class="rex-content"><p>${comment}</p></div></div>`; 
}

function calculateEvaluation(d) {
    const theo = (d.stockPrice/d.conversionPrice)*100;
    const brokerName = d.broker || ""; 
    
    const dims = [
        {k:'industry',c:'ç”¢æ¥­',w:0.25,v:d.industry}, 
        {k:'broker',c:'ç™¼è¡Œåˆ¸å•†',w:0.13,v:brokerName},
        {k:'capital',c:'è‚¡æœ¬',w:0.12,v:d.capital}, 
        {k:'size',c:'ç™¼è¡Œè¦æ¨¡',w:0.10,v:d.issueSize},
        {k:'rating',c:'ä¿¡è©•',w:0.15,v:d.rating}, 
        {k:'guarantee',c:'æ“”ä¿',w:0.12,v:d.guarantee},
        {k:'years',c:'å¹´æœŸ',w:0.08,v:d.years}, 
        {k:'conversion',c:'è½‰æ›åƒ¹',w:0.05,v:d.conversionPrice}
    ];
    
    let wL=0, wA=0, resDims={};
    dims.forEach(x=>{
        const s = getStatsSmart(x.c, x.v), coef = getWeightCoefficient(x.k, x.v);
        resDims[x.k] = { ...s, coefficient: coef, weight: x.w, range: x.v, weightedLow: s.low*x.w*coef, weightedAvg: s.avg*x.w*coef };
        if (s.rawData && s.rawData['å€é–“åç¨±']) resDims[x.k].displayRange = s.rawData['å€é–“åç¨±'];
        else resDims[x.k].displayRange = x.v;
        wL+=resDims[x.k].weightedLow; 
        wA+=resDims[x.k].weightedAvg;
    });
    
    const subR = (d.subjectiveWeight||0)/100, objR = 1-subR;
    const tL = (wL*objR)+((d.subjectiveLowPremium||0)*subR);
    const tA = (wA*objR)+((d.subjectiveAvgPremium||0)*subR);
    const gap = tA-tL;
    
    const p1 = theo*(1+tL/100);
    const p2 = theo*(1+tA/100);
    const p3 = theo*(1+(tA+gap)/100);
    const p4 = theo*(1+(tA+gap*2)/100);

    return {
        cbName:d.cbName, 
        theoreticalPrice:safeFixed(theo), 
        dimensions:resDims, 
        totalLowPremium:safeFixed(tL), 
        totalAvgPremium:safeFixed(tA),
        bidPrices:{ conservative:safeFixed(p1), balanced:safeFixed(p2), aggressive:safeFixed(p3), ultimate:safeFixed(p4) },
        inputData:d, 
        weightedSubjectiveLow:safeFixed(((d.subjectiveLowPremium||0)*subR)), 
        weightedSubjectiveAvg:safeFixed(((d.subjectiveAvgPremium||0)*subR))
    };
}

function displayResult(r) {
    document.getElementById('welcomeMsg').style.display = 'none';
    const div = document.getElementById('evaluationResult'); 
    div.className = 'evaluation-result active';
    
    let rows = ''; 
    const nm={'industry':'ç”¢æ¥­','broker':'åˆ¸å•†','capital':'è‚¡æœ¬','size':'è¦æ¨¡','rating':'ä¿¡è©•','guarantee':'æ“”ä¿','years':'å¹´æœŸ','conversion':'è½‰åƒ¹'};
    
    for(const[k,d] of Object.entries(r.dimensions)) {
        rows+=`<tr>
            <td>${nm[k]}</td>
            <td>${d.displayRange || d.range}</td>
            <td>${safeFixed(d.low)}%</td>
            <td>${safeFixed(d.avg)}%</td>
            <td>${safeFixed(d.weight*100,0)}%</td>
            <td>${safeFixed(d.weightedLow)}</td>
            <td>${safeFixed(d.weightedAvg)}</td>
        </tr>`;
    }
    
    if(r.inputData.subjectiveWeight>0) {
        rows+=`<tr style="background:#fff3e0">
            <td>ä¸»è§€</td><td>è‡ªè¨‚</td>
            <td>${r.inputData.subjectiveLowPremium}%</td>
            <td>${r.inputData.subjectiveAvgPremium}%</td>
            <td>${r.inputData.subjectiveWeight}%</td>
            <td>${r.weightedSubjectiveLow}</td>
            <td>${r.weightedSubjectiveAvg}</td>
        </tr>`;
    }

    rows+=`<tfoot><tr>
        <td></td><td style="text-align:right">åˆè¨ˆ</td>
        <td>-</td><td>-</td><td>100%</td>
        <td>${r.totalLowPremium}%</td>
        <td>${r.totalAvgPremium}%</td>
    </tr></tfoot>`;
    
    div.innerHTML = `
    <div class="result-header"><h2>${r.cbName}</h2><div>AI è©•ä¼°çµæœ</div></div>
    
    <div style="display:flex; gap:20px; flex-wrap:wrap;">
        <div class="detail-section" style="flex:1; min-width:280px;">
            <h3>ğŸ“Š æ ¸å¿ƒæ•¸æ“š</h3>
            <div style="font-size:16px; line-height:2;">
                <div>ç†è«–åƒ¹æ ¼ï¼š<b style="color:#667eea; font-size:20px;">${r.theoreticalPrice}</b> å…ƒ</div>
                <div>é ä¼°æº¢åƒ¹ï¼š<b>${r.totalLowPremium}% ~ ${r.totalAvgPremium}%</b></div>
            </div>
        </div>
        <div class="detail-section" style="flex:2; min-width:280px;">
            <h3>ğŸ“ ç¶­åº¦æ¬Šé‡åˆ†æ</h3>
            <div style="overflow-x:auto;">
                <table class="data-table">
                    <thead><tr>
                        <th>ç¶­åº¦</th><th>æ¢ä»¶</th>
                        <th>æœ€ä½<br>æº¢åƒ¹</th><th>å¹³å‡<br>æº¢åƒ¹</th>
                        <th>æ¬Šé‡</th><th>åŠ æ¬Š<br>æœ€ä½</th><th>åŠ æ¬Š<br>å¹³å‡</th>
                    </tr></thead>
                    <tbody>${rows}</tbody>
                </table>
            </div>
        </div>
    </div>

    ${generateRexCommentary(r)}
    
    <div class="detail-section">
        <h3>ğŸ’¡ æŠ•æ¨™å»ºè­°åƒ¹æ ¼</h3>
        <div class="price-grid">
            <div class="strategy-card conservative">
                <h4>ğŸ›¡ï¸ ä¿å®ˆ</h4>
                <div class="price">${r.bidPrices.conservative}</div>
                <div style="font-size:12px; color:#666;">è¿½æ±‚é«˜å®‰å…¨é‚Šéš›</div>
            </div>
            <div class="strategy-card balanced">
                <h4>âš–ï¸ å¹³è¡¡</h4>
                <div class="price">${r.bidPrices.balanced}</div>
                <div style="font-size:12px; color:#666;">åƒè€ƒå¸‚å ´å¹³å‡</div>
            </div>
            <div class="strategy-card aggressive">
                <h4>ğŸš€ ç©æ¥µ</h4>
                <div class="price">${r.bidPrices.aggressive}</div>
                <div style="font-size:12px; color:#666;">é¡˜ä»˜æº¢åƒ¹å–ç±Œç¢¼</div>
            </div>
            <div class="strategy-card ultimate">
                <h4>ğŸ”¥ æ¥µè‡´</h4>
                <div class="price">${r.bidPrices.ultimate}</div>
                <div style="font-size:12px; color:#666;">å‹¢åœ¨å¿…å¾—</div>
            </div>
        </div>
    </div>
    <div style="text-align:center;margin-top:25px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
        <button onclick="location.reload()" class="calculate-btn" style="width:180px; background:#555;">ğŸ”„ é‡æ–°è©•ä¼°</button>
        <button onclick="window.print()" class="calculate-btn" style="width:180px;">ğŸ–¨ï¸ åˆ—å°å ±å‘Š</button>
    </div>`;
    
    div.scrollIntoView({ behavior: 'smooth' });
}

document.getElementById('evaluationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    try {
        displayResult(calculateEvaluation({
            cbName: document.getElementById('cbName').value, 
            industry: document.getElementById('industry').value, 
            issueSize: parseFloat(document.getElementById('issueSize').value),
            years: document.getElementById('years').value, 
            guarantee: document.getElementById('guarantee').value, 
            rating: document.getElementById('rating').value,
            capital: parseFloat(document.getElementById('capital').value), 
            stockPrice: parseFloat(document.getElementById('stockPrice').value), 
            conversionPrice: parseFloat(document.getElementById('conversionPrice').value),
            subjectiveWeight: parseFloat(document.getElementById('subjectiveWeight').value)||0, 
            subjectiveLowPremium: parseFloat(document.getElementById('subjectiveLowPremium').value)||0, 
            subjectiveAvgPremium: parseFloat(document.getElementById('subjectiveAvgPremium').value)||0,
            broker: document.getElementById('broker').value 
        }));
    } catch (err) {
        alert("âš ï¸ è¨ˆç®—éŒ¯èª¤ï¼š\n" + err.message);
        console.error(err);
    }
});

// ==========================================
// å¯æ‹–æ›³åˆ†éš”ç·šåŠŸèƒ½
// ==========================================
function initResizer() {
    const resizer = document.getElementById('resizer');
    const container = document.querySelector('.evaluation-container');
    const inputPanel = document.getElementById('inputPanel');
    
    if (!resizer || !container || !inputPanel) return;
    
    let isResizing = false;
    let startX, startWidth;
    
    resizer.addEventListener('mousedown', function(e) {
        isResizing = true;
        startX = e.clientX;
        startWidth = inputPanel.offsetWidth;
        
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        
        e.preventDefault();
    });
    
    document.addEventListener('mousemove', function(e) {
        if (!isResizing) return;
        
        const diff = e.clientX - startX;
        let newWidth = startWidth + diff;
        
        // é™åˆ¶æœ€å°å’Œæœ€å¤§å¯¬åº¦
        newWidth = Math.max(280, Math.min(600, newWidth));
        
        container.style.gridTemplateColumns = newWidth + 'px 8px 1fr';
    });
    
    document.addEventListener('mouseup', function() {
        if (isResizing) {
            isResizing = false;
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
        }
    });
    
    // è§¸æ§è£ç½®æ”¯æ´
    resizer.addEventListener('touchstart', function(e) {
        isResizing = true;
        startX = e.touches[0].clientX;
        startWidth = inputPanel.offsetWidth;
        e.preventDefault();
    });
    
    document.addEventListener('touchmove', function(e) {
        if (!isResizing) return;
        
        const diff = e.touches[0].clientX - startX;
        let newWidth = startWidth + diff;
        newWidth = Math.max(280, Math.min(600, newWidth));
        
        container.style.gridTemplateColumns = newWidth + 'px 8px 1fr';
    });
    
    document.addEventListener('touchend', function() {
        isResizing = false;
    });
}

// ç³»çµ±å•Ÿå‹•
window.addEventListener('DOMContentLoaded', function() {
    loadStatistics();
    initResizer();
});
</script>

</body>
</html>