<script>
// ==========================================
// V3.37 çµ‚æ¥µæ•¸æ“šå°æ¥ç‰ˆ (ä¾æ“šæˆªåœ–æ¬„ä½å®¢è£½åŒ–)
// ==========================================

// å…¨åŸŸè®Šæ•¸
let statistics = {};     // å„²å­˜ Sheet 05 çš„çµ±è¨ˆè³‡æ–™
let cbDatabase = {};     // å„²å­˜ Sheet 01 + 00 çš„å€‹è‚¡è³‡æ–™
let cbNameMap = {};      // åç¨±å°ç…§è¡¨
let auctionRawData = []; // å„²å­˜ Sheet 04 çš„åŸå§‹ç«¶æ‹è³‡æ–™
let globalMarketStats = { low: 5, avg: 10 }; // é è¨­å®‰å…¨å€¼

// 1. å•Ÿå‹•è¼‰å…¥
window.addEventListener('DOMContentLoaded', loadExcelDatabase);

async function loadExcelDatabase() {
    const loadingDiv = document.getElementById('loading');
    const detailDiv = document.getElementById('loading-detail');
    const errorDiv = document.getElementById('error-msg');

    try {
        // æª”æ¡ˆåç¨±è«‹å‹™å¿…ç¢ºèªèˆ‡æ‚¨ä¸Šå‚³çš„ä¸€è‡´
        const fileName = '00_CB.xlsx'; 
        
        detailDiv.textContent = `æ­£åœ¨è®€å– ${fileName} ...`;
        const response = await fetch(fileName);
        
        if (!response.ok) throw new Error(`æ‰¾ä¸åˆ°æª”æ¡ˆ: ${fileName}ï¼Œè«‹ç¢ºèªæª”æ¡ˆä½ç½®ã€‚`);
        
        const arrayBuffer = await response.arrayBuffer();
        detailDiv.textContent = "æ­£åœ¨è§£æ Excel æ¬„ä½æ¶æ§‹...";
        
        const workbook = XLSX.read(arrayBuffer);
        processExcelData(workbook);
        
        // è¼‰å…¥å®Œæˆï¼Œéš±è—è®€å–ç•«é¢
        loadingDiv.style.display = 'none';
        document.querySelector('.container').style.display = 'block';
        
        // åˆå§‹åŒ–é¸å–®
        initializeUI();

    } catch (e) {
        console.error(e);
        detailDiv.textContent = "âš ï¸ è³‡æ–™åº«è®€å–å¤±æ•—";
        errorDiv.textContent = e.message + "\n\nè«‹ç¢ºèª Excel æª”æ¡ˆæ˜¯å¦æ”¾åœ¨æ­£ç¢ºç›®éŒ„ä¸‹ã€‚";
    }
}

// 2. æ ¸å¿ƒï¼šè™•ç† Excel è³‡æ–™ (å°æ¥æˆªåœ–æ¬„ä½)
function processExcelData(workbook) {
    const sheetNames = workbook.SheetNames;
    
    // è¼”åŠ©æ‰¾å·¥ä½œè¡¨å‡½æ•¸
    const getSheet = (keys) => {
        const name = sheetNames.find(n => keys.some(k => n.includes(k)));
        return name ? XLSX.utils.sheet_to_json(workbook.Sheets[name]) : null;
    };

    // --- A. è™•ç† Sheet 00 (æ›ç‰Œé«˜ä½) & Sheet 01 (åŸºæœ¬è³‡æ–™) ---
    // æˆªåœ–é¡¯ç¤ºï¼šSheet 00 æœ‰ã€Œæ›ç‰Œæœ€é«˜ã€ã€ã€Œæ›ç‰Œæœ€ä½ã€ã€ã€Œä»£è™Ÿã€
    // æˆªåœ–é¡¯ç¤ºï¼šSheet 01 æœ‰ã€Œè‚¡æœ¬ã€ã€ã€Œç™¼è¡Œè¦æ¨¡ã€ç­‰
    
    const raw00 = getSheet(['00_', 'æ›ç‰Œ']);
    const raw01 = getSheet(['01_', 'åŸºæœ¬è³‡æ–™']);

    // å…ˆå»ºç«‹åŸºæœ¬è³‡æ–™åº« (ä»¥ 01 ç‚ºä¸»)
    if (raw01) {
        raw01.forEach(row => {
            let code = safeString(row['ä»£è™Ÿ'] || row['CBä»£è™Ÿ']);
            if (!code) return;
            
            cbDatabase[code] = {
                "ä»£è™Ÿ": code,
                "åç¨±": safeString(row['åç¨±']),
                "ç”¢æ¥­åˆ†é¡": safeString(row['ç”¢æ¥­åˆ†é¡']),
                "ç™¼è¡Œåˆ¸å•†": safeString(row['æ‰¿éŠ·åˆ¸å•†'] || row['ä¸»è¾¦åˆ¸å•†']),
                "è‚¡æœ¬": safeFloat(row['è‚¡æœ¬'] || row['è‚¡æœ¬(å„„)'] || row['è‚¡æœ¬è¦æ¨¡']),
                "ç™¼è¡Œè¦æ¨¡": safeFloat(row['ç™¼è¡Œè¦æ¨¡'] || row['ç™¼è¡Œè¦æ¨¡(å„„)']),
                "å¹´æœŸ": safeFloat(row['ç™¼è¡Œå¹´æœŸ'] || row['å¹´æœŸ']),
                "è½‰æ›åƒ¹": safeFloat(row['è½‰æ›åƒ¹æ ¼']),
                "æ“”ä¿": safeString(row['æ“”ä¿'] || row['æœ‰ç„¡æ“”ä¿']),
                "ä¿¡è©•": safeString(row['ä¿¡è©•'] || row['TCRI(è©•ç­‰)']),
                "æ›ç‰Œæœ€é«˜": 0, "æ›ç‰Œæœ€ä½": 0 // é è¨­
            };
        });
    }

    // å†æŠŠ 00 çš„åƒ¹æ ¼è£œé€²å»
    if (raw00) {
        raw00.forEach(row => {
            let code = safeString(row['ä»£è™Ÿ']);
            // æˆªåœ–ä¸­ Sheet 00 æœ‰ã€Œæ›ç‰Œæœ€é«˜ã€è·Ÿã€Œæ›ç‰Œæœ€ä½ã€
            if (cbDatabase[code]) {
                cbDatabase[code]['æ›ç‰Œæœ€é«˜'] = safeFloat(row['æ›ç‰Œæœ€é«˜']);
                cbDatabase[code]['æ›ç‰Œæœ€ä½'] = safeFloat(row['æ›ç‰Œæœ€ä½']);
            }
        });
    }
    
    // å»ºç«‹åç¨±ç´¢å¼•ï¼Œæ–¹ä¾¿è¼¸å…¥æ™‚æŸ¥æ‰¾
    Object.values(cbDatabase).forEach(item => {
        if (item['åç¨±']) cbNameMap[item['åç¨±']] = item;
    });

    // --- B. è™•ç† Sheet 04 (ç«¶æ‹è³‡æ–™åº«) ---
    const raw04 = getSheet(['04_', 'ç«¶æ‹']);
    if (raw04) {
        auctionRawData = raw04.map(row => ({
            "åç¨±": safeString(row['åç¨±']),
            "æœ€ä½æº¢åƒ¹": safeFloat(row['æœ€ä½æº¢åƒ¹'] || row['æœ€ä½å¾—æ¨™åƒ¹æ ¼_æº¢åƒ¹ç‡']),
            "å¹³å‡æº¢åƒ¹": safeFloat(row['å¹³å‡æº¢åƒ¹'] || row['å¾—æ¨™åŠ æ¬Šå¹³å‡åƒ¹æ ¼_æº¢åƒ¹ç‡']),
            "ç”¢æ¥­åˆ†é¡": safeString(row['ç”¢æ¥­åˆ†é¡']),
            "ç™¼è¡Œåˆ¸å•†": safeString(row['æ‰¿éŠ·åˆ¸å•†'] || row['ç™¼è¡Œåˆ¸å•†']),
            "æ“”ä¿": safeString(row['æ“”ä¿']),
            "å¹´æœŸ": safeFloat(row['å¹´æœŸ'] || row['ç™¼è¡Œå¹´æœŸ']),
            "è‚¡æœ¬": safeFloat(row['è‚¡æœ¬'] || row['è‚¡æœ¬(å„„)']),
            "ç™¼è¡Œè¦æ¨¡": safeFloat(row['ç™¼è¡Œè¦æ¨¡'] || row['ç™¼è¡Œè¦æ¨¡(å„„)'])
        }));
        
        // è¨ˆç®—å…¨å¸‚å ´å¹³å‡å€¼ (ç•¶å‚™ç”¨)
        calculateGlobalStats();
    }

    // --- C. è™•ç† Sheet 05 (çµ±è¨ˆ/ç¯©é¸æ¢ä»¶) ---
    // é€™è£¡æˆ‘å€‘å‡è¨­ Sheet 05 å­˜æ”¾çš„æ˜¯å·²ç¶“ç®—å¥½çš„ã€Œå¹³å‡å€¼ã€
    // Key å€¼å¿…é ˆå°æ‡‰æˆªåœ–ä¸­çš„ "1_è‚¡æœ¬å¤§å°_å°æ–¼3å„„" ç­‰
    const raw05 = getSheet(['05_', 'ç¯©é¸', 'çµ±è¨ˆ']);
    
    // åˆå§‹åŒ–çµ±è¨ˆçµæ§‹
    statistics['è‚¡æœ¬'] = {};
    statistics['ç™¼è¡Œè¦æ¨¡'] = {};
    statistics['è½‰æ›åƒ¹'] = {};
    statistics['ä¿¡è©•'] = {};
    statistics['ç”¢æ¥­'] = {};
    statistics['ç™¼è¡Œåˆ¸å•†'] = {};
    statistics['æ“”ä¿'] = {};
    statistics['å¹´æœŸ'] = {};

    if (raw05) {
        raw05.forEach(row => {
            // è®€å– Key (æ¢ä»¶å€é–“)
            // å‡è¨­ Excel è£¡æœ‰ä¸€æ¬„å«åšã€Œæ¢ä»¶å€é–“ã€æˆ–ã€Œç¶­åº¦ã€ï¼Œå…§å®¹æ˜¯ "1_è‚¡æœ¬å¤§å°_å°æ–¼3å„„"
            // å¦ä¸€æ¬„å«åšã€Œæ­·å²å¹³å‡æº¢åƒ¹ã€ã€ã€Œæ­·å²æœ€ä½æº¢åƒ¹ã€
            
            let key = safeString(row['æ¢ä»¶å€é–“'] || row['ç¶­åº¦'] || row['å€é–“']);
            
            // è®€å– Value (çµ±è¨ˆæ•¸æ“š)
            let data = {
                "å¹³å‡æœ€ä½æº¢åƒ¹": safeFloat(row['æ­·å²æœ€ä½æº¢åƒ¹'] || row['å¹³å‡æœ€ä½æº¢åƒ¹']),
                "å¹³å‡æº¢åƒ¹": safeFloat(row['æ­·å²å¹³å‡æº¢åƒ¹'] || row['å¹³å‡æº¢åƒ¹']),
                "æ¨£æœ¬æ•¸": safeFloat(row['æ¨£æœ¬æ•¸'])
            };

            // åˆ†é¡æ­¸æª”
            if (key.includes('è‚¡æœ¬')) statistics['è‚¡æœ¬'][key] = data;
            else if (key.includes('è¦æ¨¡')) statistics['ç™¼è¡Œè¦æ¨¡'][key] = data;
            else if (key.includes('è½‰æ›åƒ¹æ ¼')) statistics['è½‰æ›åƒ¹'][key] = data;
            // å…¶ä»–éå€é–“é¡å‹çš„ç›´æ¥å­˜ (ä¾‹å¦‚ç”¢æ¥­ã€åˆ¸å•†)
            else {
                // é€™è£¡éœ€è¦çœ‹ Excel 05 æ€éº¼å­˜ç”¢æ¥­ï¼Œæš«æ™‚å‡è¨­æ˜¯ç”¨åŒæ¨£çš„ Key æ ¼å¼
                // å¦‚æœæ‰¾ä¸åˆ°ï¼Œæˆ‘å€‘ç¨å¾Œæœƒç”¨å³æ™‚é‹ç®—è£œè¶³
            }
        });
    }
}

// 3. æ ¸å¿ƒé‹ç®—ï¼šå€é–“åˆ†é¡å™¨ (å®Œå…¨ä¾ç…§æˆªåœ–é‚è¼¯)
function getClassTag(category, val) {
    if (category === 'è‚¡æœ¬') {
        let v = parseFloat(val);
        if (v < 3) return "1_è‚¡æœ¬å¤§å°_å°æ–¼3å„„";
        if (v >= 3 && v < 6) return "2_è‚¡æœ¬å¤§å°_3~6å„„";
        if (v >= 6 && v < 10) return "3_è‚¡æœ¬å¤§å°_6~10å„„";
        if (v >= 10 && v < 15) return "4_è‚¡æœ¬å¤§å°_10~15å„„";
        if (v >= 15 && v < 20) return "5_è‚¡æœ¬å¤§å°_15~20å„„";
        if (v >= 20) return "6_è‚¡æœ¬å¤§å°_å¤§æ–¼20å„„";
    }
    if (category === 'ç™¼è¡Œè¦æ¨¡') {
        let v = parseFloat(val);
        if (v < 2) return "1_ç™¼è¡Œè¦æ¨¡_å°æ–¼2å„„";
        if (v >= 2 && v < 5) return "2_ç™¼è¡Œè¦æ¨¡_2~5å„„";
        if (v >= 5 && v < 10) return "3_ç™¼è¡Œè¦æ¨¡_5~10å„„";
        if (v >= 10 && v < 15) return "4_ç™¼è¡Œè¦æ¨¡_10~15å„„";
        if (v >= 15 && v < 20) return "5_ç™¼è¡Œè¦æ¨¡_15~20å„„";
        if (v >= 20) return "6_ç™¼è¡Œè¦æ¨¡_å¤§æ–¼20å„„";
    }
    if (category === 'è½‰æ›åƒ¹') {
        let v = parseFloat(val);
        if (v < 20) return "1_è½‰æ›åƒ¹æ ¼_å°æ–¼20å…ƒ";
        if (v >= 20 && v < 50) return "2_è½‰æ›åƒ¹æ ¼_ä»‹æ–¼20~50å…ƒ";
        if (v >= 50 && v < 100) return "3_è½‰æ›åƒ¹æ ¼_ä»‹æ–¼50~100å…ƒ";
        if (v >= 100 && v < 150) return "4_è½‰æ›åƒ¹æ ¼_ä»‹æ–¼100~150å…ƒ";
        if (v >= 150 && v < 200) return "5_è½‰æ›åƒ¹æ ¼_ä»‹æ–¼150~200å…ƒ";
        if (v >= 200) return "6_è½‰æ›åƒ¹æ ¼_å¤§æ–¼200å…ƒ";
    }
    return null;
}

// 4. å–å¾—çµ±è¨ˆæ•¸æ“š (æ··åˆ æŸ¥è¡¨ + å³æ™‚é‹ç®—)
function getStatsSmart(category, val) {
    let result = { low: globalMarketStats.low, avg: globalMarketStats.avg, rawData: null, label: val };

    // A. è™•ç†æ•¸å€¼å€é–“é¡ (è‚¡æœ¬ã€è¦æ¨¡ã€è½‰æ›åƒ¹) -> å„ªå…ˆæŸ¥ Sheet 05
    let lookupKey = null;
    if (['è‚¡æœ¬', 'ç™¼è¡Œè¦æ¨¡', 'è½‰æ›åƒ¹'].includes(category)) {
        lookupKey = getClassTag(category, val);
        if (lookupKey && statistics[category] && statistics[category][lookupKey]) {
            let data = statistics[category][lookupKey];
            result.low = data['å¹³å‡æœ€ä½æº¢åƒ¹'];
            result.avg = data['å¹³å‡æº¢åƒ¹'];
            result.rawData = data;
            result.label = lookupKey; // é¡¯ç¤ºä¾‹å¦‚ "6_è‚¡æœ¬å¤§å°_å¤§æ–¼20å„„"
            return result;
        }
    }

    // B. è™•ç†é¡åˆ¥é¡ (ç”¢æ¥­ã€åˆ¸å•†ã€æ“”ä¿ã€å¹´æœŸã€ä¿¡è©•) -> å„ªå…ˆç”¨ Sheet 04 å³æ™‚é‹ç®—
    // å› ç‚ºé¡åˆ¥å¤ªå¤šï¼Œç”¨ Excel 05 æŸ¥è¡¨å¯èƒ½ä¸å…¨ï¼Œç›´æ¥ç®— Raw Data æœ€æº–
    let filterFn = null;
    if (category === 'ç™¼è¡Œåˆ¸å•†') filterFn = d => d['ç™¼è¡Œåˆ¸å•†'] === val;
    else if (category === 'ç”¢æ¥­') filterFn = d => d['ç”¢æ¥­åˆ†é¡'] === val;
    else if (category === 'æ“”ä¿') filterFn = d => (d['æ“”ä¿']||'').includes(val);
    else if (category === 'å¹´æœŸ') filterFn = d => d['å¹´æœŸ'] == val;
    else if (category === 'ä¿¡è©•') filterFn = d => (d['ä¿¡è©•']||'').toString().includes(val.toString()); // ç°¡åŒ–è™•ç†
    
    // å¦‚æœæŸ¥è¡¨æ²’æŸ¥åˆ° (å€é–“é¡) æˆ– æ˜¯é¡åˆ¥é¡ï¼Œå°±è·‘å³æ™‚é‹ç®—
    if (filterFn || lookupKey) { 
        // é‡å°å€é–“é¡ï¼Œå¦‚æœ Excel 05 æ²’è³‡æ–™ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ç”¨å³æ™‚é‹ç®—è£œæ•‘
        if (!filterFn && category === 'è‚¡æœ¬') {
             // é€™è£¡å¦‚æœä¸æŸ¥è¡¨ï¼Œä¹Ÿå¯ä»¥å¯«å³æ™‚ç¯©é¸é‚è¼¯ï¼Œä½†æš«æ™‚ä¾è³´æŸ¥è¡¨
        }
        
        if (filterFn) {
            const matches = auctionRawData.filter(filterFn);
            if (matches.length > 0) {
                let sumLow = 0, sumAvg = 0, count = 0;
                matches.forEach(d => {
                    let l = d['æœ€ä½æº¢åƒ¹'];
                    let a = d['å¹³å‡æº¢åƒ¹'];
                    // è³‡æ–™æ¸…æ´—ï¼šæœ‰äº› Excel æ˜¯ 0.05, æœ‰äº›æ˜¯ 5
                    if (l < 2 && l > -2) l *= 100;
                    if (a < 2 && a > -2) a *= 100;
                    
                    if (l > -10 && l < 200) { // æ’é™¤æ¥µç«¯å€¼
                        sumLow += l; sumAvg += a; count++;
                    }
                });
                if (count > 0) {
                    result.low = sumLow / count;
                    result.avg = sumAvg / count;
                    result.rawData = { 'æ¨£æœ¬æ•¸': count, 'å¹³å‡æœ€ä½æº¢åƒ¹': result.low, 'å¹³å‡æº¢åƒ¹': result.avg };
                }
            }
        }
    }

    return result;
}

// 5. è¼”åŠ©å‡½æ•¸
function safeString(val) { return val ? String(val).trim() : ""; }
function safeFloat(val) {
    if (val == null || val === '') return 0;
    if (typeof val === 'string') val = val.replace(/,/g, '').replace(/%/g, '');
    let n = parseFloat(val);
    return isNaN(n) ? 0 : n;
}
function calculateGlobalStats() {
    if (auctionRawData.length === 0) return;
    let sumLow=0, sumAvg=0, count=0;
    auctionRawData.forEach(d => {
        let l = safeFloat(d['æœ€ä½æº¢åƒ¹']);
        let a = safeFloat(d['å¹³å‡æº¢åƒ¹']);
        if(l < 2) l*=100; if(a < 2) a*=100;
        if(l > 0) { sumLow+=l; sumAvg+=a; count++; }
    });
    if(count>0) { globalMarketStats.low = sumLow/count; globalMarketStats.avg = sumAvg/count; }
}

// 6. UI æ›´æ–°èˆ‡ç¶å®š
function initializeUI() {
    document.getElementById('headerSubtitle').textContent = `Rexå¤§å”è³‡æ–™åº« | å·²è¼‰å…¥ ${Object.keys(cbDatabase).length} æª” CB è³‡æ–™`;

    // å¡«å……é¸å–®
    const industries = new Set(auctionRawData.map(d => d['ç”¢æ¥­åˆ†é¡']).filter(Boolean));
    const brokers = new Set(auctionRawData.map(d => d['ç™¼è¡Œåˆ¸å•†']).filter(Boolean));
    
    populateSelect('industry', Array.from(industries).sort());
    populateSelect('broker', Array.from(brokers).sort());

    showStatsSummary();
    bindEvents();
}

function populateSelect(id, list) {
    const sel = document.getElementById(id);
    sel.innerHTML = '<option value="">è«‹é¸æ“‡...</option>';
    list.forEach(item => {
        const opt = document.createElement('option');
        opt.value = item; opt.textContent = item;
        sel.appendChild(opt);
    });
}

function showStatsSummary() {
    document.getElementById('statsSummary').innerHTML = `
        <div class="stat-box"><div class="number">${Object.keys(cbDatabase).length}</div><div class="label">CB è³‡æ–™åº«</div></div>
        <div class="stat-box"><div class="number">${auctionRawData.length}</div><div class="label">ç«¶æ‹æ¡ˆä¾‹</div></div>
    `;
}

// ç¶å®šäº‹ä»¶
function bindEvents() {
    // CB åç¨±è¼¸å…¥ -> è‡ªå‹•å¸¶å…¥ 00/01 è³‡æ–™
    document.getElementById('cbName').addEventListener('input', function() {
        const val = this.value.trim();
        const info = document.getElementById('cbNameInfo');
        if(!val) { info.style.display='none'; return; }

        const match = Object.values(cbDatabase).find(d => d['åç¨±'].includes(val) || d['ä»£è™Ÿ'].includes(val));
        
        if (match) {
            let html = `<div class="stats-header">âœ… æ‰¾åˆ°è³‡æ–™: ${match['åç¨±']} (${match['ä»£è™Ÿ']})</div>`;
            if (match['æ›ç‰Œæœ€é«˜'] > 0) {
                 html += `<div class="stat-row"><span>æ­·å²æœ€é«˜:</span><strong>${match['æ›ç‰Œæœ€é«˜']}</strong></div>`;
                 html += `<div class="stat-row"><span>æ­·å²æœ€ä½:</span><strong>${match['æ›ç‰Œæœ€ä½']}</strong></div>`;
            }
            // è‡ªå‹•å¡«å…¥è¡¨å–®
            if(match['è‚¡æœ¬']) document.getElementById('capital').value = match['è‚¡æœ¬'];
            if(match['ç™¼è¡Œè¦æ¨¡']) document.getElementById('issueSize').value = match['ç™¼è¡Œè¦æ¨¡'];
            if(match['ç”¢æ¥­åˆ†é¡']) document.getElementById('industry').value = match['ç”¢æ¥­åˆ†é¡'];
            if(match['ç™¼è¡Œåˆ¸å•†']) document.getElementById('broker').value = match['ç™¼è¡Œåˆ¸å•†'];
            if(match['è½‰æ›åƒ¹']) document.getElementById('conversionPrice').value = match['è½‰æ›åƒ¹'];
            
            // è§¸ç™¼é€£å‹•æ›´æ–°
            updateAllStats();
            
            info.innerHTML = html;
            info.style.display = 'block';
        } else {
            info.style.display = 'none';
        }
    });

    // æ•¸å€¼æ”¹è®Š -> æŸ¥æ‰¾çµ±è¨ˆ
    ['capital', 'issueSize', 'conversionPrice'].forEach(id => {
        document.getElementById(id).addEventListener('change', updateAllStats);
    });
    
    ['industry', 'broker', 'years', 'guarantee', 'rating'].forEach(id => {
        document.getElementById(id).addEventListener('change', updateAllStats);
    });
}

function updateAllStats() {
    // ç°¡å–®å°è£ï¼šæ›´æ–°å–®ä¸€æ¬„ä½çš„çµ±è¨ˆé¡¯ç¤º
    const updateOne = (inputId, category, infoId) => {
        const val = document.getElementById(inputId).value;
        const info = document.getElementById(infoId);
        if (!val) { info.style.display = 'none'; return; }

        const stats = getStatsSmart(category, val);
        
        // é¡¯ç¤ºå…§å®¹
        info.innerHTML = `
            <div class="stats-header">ğŸ“Š æ­·å²çµ±è¨ˆ (${stats.label || val})</div>
            <div class="stat-row"><span>æ¨£æœ¬æ•¸:</span><strong>${stats.rawData ? stats.rawData['æ¨£æœ¬æ•¸'] : 'N/A'}</strong></div>
            <div style="background:#e8f5e9; padding:5px; margin-top:5px; border-radius:4px;">
                <div class="stat-row">æœ€ä½æº¢åƒ¹: <span style="color:#d32f2f; font-weight:bold;">${stats.low.toFixed(2)}%</span></div>
                <div class="stat-row">å¹³å‡æº¢åƒ¹: <span style="color:#388e3c; font-weight:bold;">${stats.avg.toFixed(2)}%</span></div>
            </div>
        `;
        info.style.display = 'block';
    };

    updateOne('capital', 'è‚¡æœ¬', 'capitalInfo');
    updateOne('issueSize', 'ç™¼è¡Œè¦æ¨¡', 'issueSizeInfo');
    updateOne('conversionPrice', 'è½‰æ›åƒ¹', 'conversionPriceInfo');
    updateOne('industry', 'ç”¢æ¥­', 'industryInfo');
    updateOne('broker', 'ç™¼è¡Œåˆ¸å•†', 'brokerInfo');
    updateOne('years', 'å¹´æœŸ', 'yearsInfo');
    updateOne('guarantee', 'æ“”ä¿', 'guaranteeInfo');
    updateOne('rating', 'ä¿¡è©•', 'ratingInfo');
}

</script>
